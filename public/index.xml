<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>AntiO2</title>
        <link>https://antio2.cn/</link>
        <description>Recent content on AntiO2</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>zh-cn</language>
        <lastBuildDate>Mon, 05 Feb 2024 17:08:55 +0800</lastBuildDate><atom:link href="https://antio2.cn/index.xml" rel="self" type="application/rss+xml" /><item>
        <title>2023ï¼Œæˆ‘åœ¨æ‰¾å®ä¹ ä¸­æ¶ˆå¤±çš„ä¸‹åŠå¹´</title>
        <link>https://antio2.cn/blog/2023-autumn-recurit/</link>
        <pubDate>Mon, 05 Feb 2024 17:08:55 +0800</pubDate>
        
        <guid>https://antio2.cn/blog/2023-autumn-recurit/</guid>
        <description>&lt;img src="https://antio2.cn/blog/2023-autumn-recurit/bg.jpg" alt="Featured image of post 2023ï¼Œæˆ‘åœ¨æ‰¾å®ä¹ ä¸­æ¶ˆå¤±çš„ä¸‹åŠå¹´" /&gt;&lt;p&gt;æ˜ŸæœŸå¤©ï¼Œ2024å¹´2æœˆ4æ—¥&lt;/p&gt;
&lt;p&gt;å¤§æ¦‚åšäº†ä¸€ä¸ªå¾ˆé•¿çš„æ¢¦ä¸­æ¢¦ï¼Œåç‚¹é’Ÿé†’äº†ä¸€æ¬¡ï¼Œä½†å› ä¸ºæ˜¯å‘¨æœ«åˆç»§ç»­ç¡åˆ°äº†æ—©ä¸ŠåäºŒç‚¹åŠæ‰é†’ã€‚å†é†’çš„æ—¶å€™çœ‹åˆ°æ‰‹æœºæœ‰å‡ ä¸ªåŒ—äº¬çš„æœªæ¥æ¥ç”µï¼Œç”µå­é‚®ç®±é‡ŒHRå‘æ¥é‚®ä»¶:â€œåŒå­¦æ”¶åˆ°é‚®ä»¶å›å¤æˆ‘ä¸€ä¸‹ï¼Œæˆ‘ç”µè¯è”ç³»åŒå­¦å“ˆâ€ï¼ŒBOSSé‡Œé¢ä¹Ÿæœ‰äººå‘æ¶ˆæ¯è®©æˆ‘æ¥ç”µè¯ã€‚äºæ˜¯æˆ‘é©¬ä¸Šå›å¤äº†é‚®ä»¶ï¼ŒåŠä¸ªå°æ—¶ä¹‹åç­‰åˆ°äº†ç”µè¯ï¼Œå‘Šè¯‰æˆ‘ä¸‰é¢é€šè¿‡å¼€å§‹è°ˆOfferäº†ã€‚&lt;/p&gt;
&lt;p&gt;å› ä¸ºä¹‹å‰æ˜¯åœ¨æ˜ŸæœŸä¸‰è¿›è¡Œä¸‰é¢çš„ï¼Œæƒ³ç€ä¸€èˆ¬æ˜¯ä¸‰ä¸ªå·¥ä½œæ—¥åé€šçŸ¥ï¼Œäºæ˜¯ç­‰ç€æƒ³æ˜ŸæœŸä¸€å†é—®ä¸‹HRï¼Œä½†æ˜¯å¿˜äº†è¿™å¤©è¿™æ˜¯æ˜¥èŠ‚å‰ä¸€å‘¨è°ƒä¼‘çš„å·¥ä½œæ—¥ã€‚ä¸ç®¡æ€ä¹ˆè¯´ï¼Œæˆ‘ä¸‹åˆå¼€å§‹å¡«å„ç§å„æ ·çš„ä¸ªäººä¿¡æ¯ã€æå­¦ä¿¡ç½‘è®¤è¯ã€é ç€å®¶é‡Œçš„å¢™æ‹è¯ä»¶ç…§ã€‚&lt;/p&gt;
&lt;p&gt;å½“åŠ ä¸ŠHRå¾®ä¿¡ï¼Œè¯¢é—®å¾—çŸ¥åé¢å·²ç»æ²¡æœ‰æµç¨‹äº†ï¼Œç»·äº†åŠå¹´çš„ç¥ç»ç»ˆäºèƒ½æœ‰ç‚¹æ”¾æ¾ä¸‹æ¥äº†ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;å†ç¨‹&#34;&gt;å†ç¨‹&lt;/h2&gt;
&lt;p&gt;å¤§ä¸‰ä¸Šå­¦æœŸå¼€å­¦ä¹‹åï¼Œå°±ä¸€ç›´åœ¨å‡†å¤‡é¡¹ç›®ï¼Œåˆ·LeetCodeï¼ŒèƒŒå…«è‚¡æ–‡ï¼Œä»¥åŠç„¦è™‘ã€‚&lt;/p&gt;
&lt;p&gt;å¤§æ¦‚åæœˆçš„æ—¶å€™æ¨æ€»å»å°çº¢ä¹¦ä¹‹å‰ï¼Œå‡ºå»åƒäº†é¡¿çƒ§çƒ¤ï¼Œé¡ºä¾¿æŠŠæˆ‘ç‹ ç‹ å‹åŠ›äº†ä¸€é¡¿ã€‚ä»æ˜¥ç†™è·¯èµ°å›å­¦æ ¡çš„è·¯ä¸Šï¼Œæ„Ÿè§‰è‡ªå·±çœŸçš„æ˜¯ä¸ªæ²¸ç‰©ã€‚åˆåœ¨æ”¹äº†å¾ˆå¤šæ¬¡ç®€å†ä¹‹åï¼Œåœ¨BOSSä¸Šé¢å¼€å§‹æŠ•äº†ã€‚é‚£ä¸ªæ—¶å€™æˆ‘è¿˜æƒ³å»DBå‚ï¼Œç¬¬ä¸€æ¬¡æŠ•ç®€å†æŠ•äº†ä¸ªæµ·é‡æ•°æ®ï¼ŒæŠ•äº†ä¸€å®¶ä¹‹ååˆå¼€å§‹ç»§ç»­èƒŒè®¡ç½‘é‚£äº›äº†ã€‚åœ¨ç­‰äº†ä¸€å‘¨ä¹‹åï¼Œè‡ªç„¶è€Œç„¶åœ°å°±æ²¡æœ‰ä¸‹æ–‡äº†ã€‚ä½†æ˜¯å½“æ—¶æˆ‘è¿˜æ²¡æ‚Ÿåˆ°è¿™äº›Bå°å…¬å¸å¯èƒ½æ ¹æœ¬å°±æ²¡åœ¨æ‹›äººï¼Œäºæ˜¯åˆç‹ ç‹ åœ°EMOï¼Œå¼€å§‹æƒ³æ€ä¹ˆæ”¹ç®€å†ã€‚&lt;/p&gt;
&lt;p&gt;ä¹‹ååœ¨åä¸€æœˆï¼Œæœ‰ä¸€å®¶åŒ—äº¬çš„DBåˆåˆ›é¢äº†ä¸‰æ¬¡ï¼Œæ¯è½®ä¹‹å‰éƒ½æ‹–ä¸€å‘¨ï¼Œæœ€åæ³¡äº†ä¸€å‘¨æ± å­æ·¹æ­»äº†ã€‚åˆ°äº†åäºŒæœˆä»½ï¼Œå¼€å§‹é¢å¦å¤–ä¸€å®¶æ­å·çš„DBï¼Œä¸€è¾¹å¤ä¹ è‡ªå·±çš„è¯¾ç¨‹å‡†å¤‡è€ƒè¯•ï¼Œä¸€è¾¹å‡†å¤‡é¢è¯•ã€‚ä¸­é—´å­¦æ ¡è”ç³»äº†ä¸€äº›ä¼ä¸šï¼Œå‘ç°äº†æœ‰ä¸€å¼€å§‹æˆ‘æŠ•çš„é‚£å®¶å°å…¬å¸ï¼Œåˆåœ¨å­¦æ ¡é‚£é‡ŒæŠ•äº†ä¸€éã€‚ç»“æœå‘äº†ä¸ªç¬”è¯•å°±æ²¡æœ‰ä¸‹æ–‡äº†ï¼Œä¼°è®¡åˆæ˜¯åœ¨é€—äººã€‚æ­å·çš„å…¬å¸ç¬¬äºŒé¢æ˜¯åœ¨å…ƒæ—¦å‰æœ€åä¸€ä¸ªå·¥ä½œæ—¥ï¼Œäºæ˜¯é‚£ä¸ªæ—¶å€™åˆç­‰äº†ä¸€å‘¨æ‰å‘Šè¯‰æˆ‘äºŒé¢è¿‡äº†ã€‚å½“æ—¶HRå‘Šè¯‰æˆ‘ä¸‰é¢çš„é¢è¯•å®˜æ”¾å¹´å‡äº†ï¼Œåé¢æµç¨‹ä¼šç­‰ä¸€ä¸‹ã€‚å…ƒæ—¦åçš„ç¬¬ä¸€å‘¨è¦é é©¬åŸå’Œæ¯›æ¦‚ï¼Œè¿˜è¦åšæˆ‘é‚£ä¸ªç»¼åˆè®¾è®¡ï¼Œæ‰€ä»¥æˆ‘æƒ³çš„åˆšå¥½æ²¡é‚£ä¹ˆå†²çªï¼Œè¿˜æŒºçˆ½ğŸ¤—ã€‚è€ƒå®Œä¹‹ååˆå¼€å§‹å‡†å¤‡é¢è¯•ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯ä¸‹ä¸€å‘¨å½“æˆ‘é—®æµç¨‹çš„æ—¶å€™æ‚²å‰§äº†ï¼Œå‘Šè¯‰æˆ‘é‚£ä¸ªç»„ä¸šåŠ¡è°ƒæ•´ï¼Œå†»ç»“HCäº†ã€‚å½“æ—¶æˆ‘å°±å¾…åœ¨å®¿èˆï¼Œå…·ä½“åœ¨å¹²ä»€ä¹ˆå¿˜äº†ï¼Œå¤§æ¦‚æ˜¯åœ¨æ”¹ç»¼åˆè®¾è®¡çš„WORDæ–‡æ¡£æ ¼å¼ã€‚&lt;/p&gt;
&lt;p&gt;åˆè¿‡äº†ä¸€å‘¨ï¼Œæˆ‘æƒ³çš„åæ­£èººç€ä¹Ÿæ˜¯èººç€ï¼Œå°±æ”¶æ‹¾ä¸œè¥¿å›å®¶èººç€äº†ã€‚åœ¨å®¶é‡Œæ¥åˆ°äº†ä¹‹å‰æŠ•çš„ä¸€ä¸ªç ”ç©¶æ‰€ç”µè¯ï¼Œè¯´ç»™æˆ‘offerï¼Œå¥½ï¼Œæˆ‘æ¥äº†ã€‚æˆ‘åˆéšä¾¿æ‹¿äº†ç‚¹ä¸œè¥¿å›å®¿èˆä½äº†å‡ å¤©ï¼Œå‡†å¤‡æè‡ªè¡Œè”ç³»å®ä¹ çš„ææ–™ã€‚æˆ‘è®©HRæä¾›ææ–™ï¼Œå‘Šè¯‰æˆ‘Offerå®¡æ‰¹ã€‚ä¸­é—´æˆ‘è¿˜æ‹’äº†å…¶ä»–å‡ å®¶çš„é¢è¯•ï¼ˆåŒ…æ‹¬æˆ‘è®©åˆ«äººå†…æ¨æˆ‘çš„ï¼‰ï¼Œç»“æœè¿™ä¸ªå®¡æ‰¹ä¸€ç­‰å°±æ˜¯ä¸€å‘¨ï¼Œå½“æˆ‘å†é—®HRè¿›åº¦æ€ä¹ˆæ ·ï¼Œå·²ç»ä¸ç†æˆ‘äº†ï¼Œè¯„ä»·ä¸ºçº¯å‚»é€¼ã€‚è¿™ä¸ªæ—¶å€™æˆ‘å·²ç»ä¸çŸ¥é“è¿˜èƒ½æŠ•ä»€ä¹ˆäº†ï¼Œå¼€å§‹å½»åº•ç–¯ç‹‚ï¼ŒBOSSä¸Šé¢çœ‹åˆ°ä¸€ä¸ªæŠ•ä¸€ä¸ªï¼Œç”šè‡³æŠ•äº†å‡ ä¸ªé‡åŒ–ã€‚&lt;/p&gt;
&lt;p&gt;è¿˜å¥½åœ¨åäºŒæœˆåº•çš„æ—¶å€™ï¼Œåœ¨BOSSä¸Šé¢æŠ•äº†ç™¾åº¦ä¸€ä¸ªå²—ä½ï¼Œåœ¨æˆ‘è¿·èŒ«çš„æ—¶å€™æ‰“ç”µè¯å«æˆ‘å»é¢è¯•ã€‚è™½ç„¶å¾ˆä¹…æ²¡æœ‰åˆ·å…«è‚¡å’Œç®—æ³•ï¼Œè¿˜æ˜¯ç¡¬ç€å¤´çš®é¢ï¼Œæ‰€å¹¸é—®çš„åŸºç¡€éƒ½è¿˜ä¼šï¼Œä»¥åŠæµç¨‹å¾ˆå¿«ï¼Œåœ¨ä¸¤å‘¨å†…é¢å®Œä¸‰åœºæ‹¿åˆ°offerã€‚ç»ˆäºåœ¨å¹´å‰ç¡®å®šäº†å»å¤„ã€‚&lt;/p&gt;
&lt;p&gt;æ€»ç»“ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸è¦å¯¹å‚»é€¼å…¬å¸ä»¥åŠå°å…¬å¸çš„æ•ˆç‡å’Œè¯šä¿¡æŠ±æœ‰æœŸæœ›ã€‚&lt;/li&gt;
&lt;li&gt;ä¸è¦è½»ä¿¡HRå’Œé¢è¯•å®˜ï¼Œå³ä½¿è¯´å¾—å†æ€ä¹ˆå¥½ã€‚&lt;/li&gt;
&lt;li&gt;æ²¡æ‹¿åˆ°&lt;strong&gt;æ­£å¼&lt;/strong&gt;offerå‰ï¼Œä¸è¦åœæ­¢é¢è¯•ï¼Œå³ä½¿æœ‰å£å¤´æ‰¿è¯ºã€‚&lt;/li&gt;
&lt;li&gt;æ—©ç‚¹æµ·æŠ•ï¼Œä»¥åŠç¬¬äºŒç‚¹ï¼šä¸è¦å¹»æƒ³è‡ªå·±ç¨³è¿›ï¼Œå°±ç®—ä¸ç„¶å°±ä¼šåƒæˆ‘ä¸€æ ·å•çº¿ç¨‹ï¼Œä»å»å¹´9æœˆæåˆ°2æœˆã€‚å•çº¿ç¨‹è¢«æ­»å¦ˆå…¬å¸æäº†ï¼Œä¸€ä¸‹å°±æ˜¯ä¸€ä¸ªæœˆç™¾æ­ã€‚ä½†å¦‚æœä½ åŒæ—¶é¢ä¸‰å››å®¶æ’æ»¡å°±ä¸ä¼šé‚£ä¹ˆç„¦è™‘äº†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æˆ‘çš„å‡†å¤‡&#34;&gt;æˆ‘çš„å‡†å¤‡&lt;/h2&gt;
&lt;p&gt;å…ˆæ˜¯åœ¨LeetCodeä¸Šé¢åšHot100ï¼Œä»¥åŠæ¯æ—¥ä¸€é¢˜ã€‚åé¢æˆ‘æ„è¯†åˆ°é¢è¯•åŸºæœ¬ä¸ŠHOT100é‡Œé¢çš„é¢˜å°±å¤Ÿäº†ã€‚å°±å¼€å§‹åå¤åšHot100ã€‚ä¸­é—´åœ¨å­¦æ ¡çš„æ—¶å€™ï¼Œæ‰“äº†ä¸¤ä¸‰åœºå‘¨èµ›ï¼Œä¸€ç›´åšä¸å‡ºæ¥Hardé¢˜ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/blog/2023-autumn-recurit/image-20240205183447782.png&#34;
	width=&#34;1066&#34;
	height=&#34;768&#34;
	srcset=&#34;https://antio2.cn/blog/2023-autumn-recurit/image-20240205183447782_hu6e14d899ea995a5f59c21a2b0eaa3b62_107920_480x0_resize_box_3.png 480w, https://antio2.cn/blog/2023-autumn-recurit/image-20240205183447782_hu6e14d899ea995a5f59c21a2b0eaa3b62_107920_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;LeetCode&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;138&#34;
		data-flex-basis=&#34;333px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;å…«è‚¡æ–¹é¢ï¼š&lt;/p&gt;
&lt;p&gt;çœ‹&lt;a class=&#34;link&#34; href=&#34;https://xiaolincoding.com/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;å°æ—coding&lt;/a&gt;ï¼Œ è™½ç„¶è®²çš„å¾ˆç»†ï¼Œä½†æ˜¯é‡Œé¢çš„ä¸œè¥¿çœŸæ˜¯ä¸€ä¸ªéƒ½æ²¡é—®åˆ°ã€‚æœ€å¤šå°±åªé—®äº†ä¸€ä¸‹ä¸‰æ¬¡æ¡æ‰‹å››æ¬¡æŒ¥æ‰‹ã€‚&lt;/p&gt;
&lt;p&gt;çœ‹&lt;a class=&#34;link&#34; href=&#34;https://csguide.cn/cpp/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;C/C++åå°å¼€å‘é¢è¯•é‡ç‚¹çŸ¥è¯† | ç¼–ç¨‹æŒ‡åŒ— (csguide.cn)&lt;/a&gt;ï¼Œæ¯”è¾ƒå¸¸è§„çš„C++å…«è‚¡ï¼Œä¸¤å¤©çœ‹å®Œäº†ã€‚&lt;/p&gt;
&lt;p&gt;å› ä¸ºå½“æ—¶æƒ³æ‰¾DBï¼Œä¸çŸ¥é“æˆ‘åœ¨å‘ä»€ä¹ˆç–¯ï¼ŒæŠŠ&lt;a class=&#34;link&#34; href=&#34;https://leetcode.cn/studyplan/sql-free-50/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;é«˜é¢‘ SQL 50 é¢˜ï¼ˆåŸºç¡€ç‰ˆï¼‰&lt;/a&gt;åšå®Œäº†ï¼ˆå®Œå…¨æ²¡æœ‰ç”¨ï¼Œæ ¹æœ¬æ²¡äººä¼šé—®SQLğŸ¤£ï¼‰,ä»¥åŠçœ‹å®Œäº†MySQLå®æˆ˜45è®²ï¼Œè¿™ä¸ªå¯¹æˆ‘æ„Ÿè§‰ä¹Ÿæ²¡å•¥ç”¨ï¼Œä½†æ˜¯æ„Ÿè§‰è®²çš„æŒºå¥½çš„ï¼Œæ¯”è¾ƒæ¨èæ²¡æ¥è§¦è¿‡å†…æ ¸çš„åŒå­¦çœ‹çœ‹ã€‚è¿˜çœ‹å®Œäº†Redisæºç å’ŒInnoDBçš„æºç è§£æã€‚ä¸­é—´åˆç¨å¾®çœ‹äº†ä¸‹TiDBçš„æºç å’ŒLevelDBæºç ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨C++åŸºç¡€æ–¹é¢,çœ‹ã€ŠEffective C++ã€‹,ã€Š STLæºç å‰–æã€‹ï¼ˆæŒºæœ‰ç”¨ï¼‰ï¼Œã€Šæ·±å…¥æ¢ç´¢C++å¯¹è±¡æ¨¡å‹ã€‹ï¼ˆçº¯çœ‹ä¸æ‡‚ï¼Œè¿™ä¸ªæ·±åº¦ä¹Ÿæ²¡äººé—®ï¼‰ã€‚ä¹‹åçœ‹ã€Šlinuxé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹ã€‹å¤ä¹ ç½‘ç»œç¼–ç¨‹çš„çŸ¥è¯†ï¼Œä¼šé—®åˆ°çš„ä¸»è¦å°±æ˜¯socketï¼Œepollé‚£äº›ã€‚&lt;/p&gt;
&lt;p&gt;è¯´å®è¯ï¼Œæ„Ÿè§‰è¹‰è·äº†åŠå¹´ã€‚è‡ªå·±çš„æŠ€èƒ½æ˜¯å®Œå…¨æ²¡æœ‰æå‡ã€‚å‡†å¤‡çœ‹å®Œçš„ä¹¦ä¹Ÿæ²¡çœ‹ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;é¢ç»æ”¾åœ¨ä¸‹é¢é“¾æ¥é‡Œé¢äº†ï¼Œæ„Ÿè§‰Notionè¿˜æŒºå¥½ç”¨ï¼Œå°±æ˜¯åˆ›å»ºViewçš„æ—¶å€™åˆ†äº«æƒé™åšçš„ä¸æ˜¯å¾ˆå®Œå–„ã€‚&lt;/p&gt;
</description>
        </item>
        <item>
        <title>ä»äººæ°‘å…¬å›­åˆ°ç§‘ååŒ—è·¯</title>
        <link>https://antio2.cn/blog/2024-01-18/</link>
        <pubDate>Thu, 18 Jan 2024 01:43:34 +0800</pubDate>
        
        <guid>https://antio2.cn/blog/2024-01-18/</guid>
        <description>&lt;img src="https://antio2.cn/blog/2024-01-18/brand.jpg" alt="Featured image of post ä»äººæ°‘å…¬å›­åˆ°ç§‘ååŒ—è·¯" /&gt;&lt;h2 id=&#34;go&#34;&gt;GO&lt;/h2&gt;
&lt;p&gt;ä¸­åˆçš„æ—¶å€™é˜³é˜³åœ¨ç¾¤é‡Œé¢é—®æœ‰æ²¡æœ‰åƒå­ã€‚æˆ‘è¯´å‡ºæ¥ï¼Œä¹‹å‰å»å·å¤§å°±æƒ³åƒé’æœ¨çƒ§è‚‰ç»“æœæ²¡åƒæˆã€‚ä¸‹åˆå…ˆéšä¾¿æ‰¾ä¸ªåœ°æ–¹è€ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/blog/2024-01-18/1.jpg&#34;
	width=&#34;1080&#34;
	height=&#34;2092&#34;
	srcset=&#34;https://antio2.cn/blog/2024-01-18/1_huceb655e917750acc396f999a6914d47c_100624_480x0_resize_q75_box.jpg 480w, https://antio2.cn/blog/2024-01-18/1_huceb655e917750acc396f999a6914d47c_100624_1024x0_resize_q75_box.jpg 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;51&#34;
		data-flex-basis=&#34;123px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;ä¸¤ç‚¹è¿‡çš„æˆ‘æ—¶å€™å‘äº†ä¸ªäººæ°‘å…¬å›­çš„åæ ‡ï¼Œç»“æœä»–å››ç‚¹æ‰åˆ°ï¼Œè¯´åœ¨å®¶é‡Œé¢æ‰“äº†ä¸¤æŠŠè‹±é›„è”ç›Ÿã€‚&lt;/p&gt;
&lt;p&gt;æ¥ç€å»é‡Œé¢é€›äº†ä¸€ä¸‹ï¼ŒèŒ¶ç¤¾å’Œç›¸äº²è§’çœŸæ˜¯æ°´æ³„ä¸é€šğŸ¶ã€‚èµ°å®Œä¸€åœˆä¹‹åå»æ—è¾¹ç¥ å ‚è¡—èµ°äº†ä¸€ä¸‹ï¼Œåˆæ˜¯ç»å…¸ç½‘çº¢æ‹ç…§ä¸“ç”¨ï¼Œå®é™…ä¸Šå•¥ä¹Ÿæ²¡æœ‰çš„åœ°æ–¹ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;åˆ°è¾¾&#34;&gt;åˆ°è¾¾&lt;/h2&gt;
&lt;p&gt;ä¹‹åçš„é”™è¯¯å†³å®šï¼šèµ°å»å·å¤§æœ›æ±Ÿã€‚æ„Ÿè§‰è…¿éƒ½è¦æ–­äº†ï¼Œè™½ç„¶åªæœ‰äº”å…¬é‡Œã€‚é˜³é˜³åœ¨è·¯ä¸Šä¸€ç›´åå£æ°´ï¼Œæˆ‘é—®ä»–ä¸ºä»€ä¹ˆä¸è‡ªå·±åäº†ï¼Œä»–è¯´ä¸ä¼šã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;èµ°åˆ°ç›®çš„åœ°é™„è¿‘ï¼Œä¸€å¼€å§‹è¿˜æ²¡æ‰¾åˆ°åº—é¢åœ¨å“ªé‡Œï¼Œç»“æœèµ°è¿‡äº†ã€‚èµ°å›å»ä¹‹åæ‰å‘ç°æ‹›ç‰Œæ˜¯ç°åº•å®‹ä½“æ²¡æœ‰ä»»ä½•ä¿®é¥°çš„â€œé’æœ¨çƒ§è‚‰â€ï¼Œåœ¨æˆ‘çš„åˆ»æ¿å°è±¡é‡Œé¢è¿™ç§åº—ä¸€èˆ¬éƒ½æœ‰æœ¨çº¹åº•çš„æ‹›ç‰Œä¸åˆ»è¿›å»çš„æ—¥æ–‡ã€‚ä»–ä»¬çš„é“ºé¢åªæœ‰ä¸€æˆ·ï¼Œæ‰¾åˆ°çš„æ—¶å€™å·²ç»æ˜¯å…­ç‚¹åŠäº†ï¼Œä¸€ä¸ªçƒ¤è‚‰åº—å¤§æ¦‚åªæœ‰å…­å¼ æ¡Œå­ï¼Œäºæ˜¯æˆ‘ä»¬é¡ºåˆ©æˆç« åœ°æ‹’ç»æ’é˜Ÿï¼Œå¦å¯»ä»–å¤„ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€è‡´æ„è§ï¼š&lt;strong&gt;ä»Šå¤©å¿…é¡»åƒç‰›è‚‰&lt;/strong&gt;ï¼Œåœ¨è¡—å¯¹é¢çœ‹è§ä¸€å®¶ç‰›è‚‰ç«é”…ï¼Œå°±è¿›å»äº†ã€‚æ¶ˆè´¹æ˜¯80/äºº+50é”…åº•+50æŠ¼é‡‘ã€‚å’Œæ½®æ±•ç‰›è‚‰ç«é”…çš„åŒºåˆ«å°±æ˜¯å¯ä»¥é€‰çº¢æ±¤åº•ã€‚&lt;/p&gt;
&lt;p&gt;æ„Ÿè§‰æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œä¸­è§„ä¸­çŸ©å§ï¼Œå…¬å¼åŒ–ç‰›è‚‰ã€‚é˜³é˜³è¾¹çœ‹æ’¸ç‹—è§†é¢‘è¾¹åƒä¸¤å£å†çŒ›å–ä¸¤ç›’åŠ å¤šå®å°±é¥±äº†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/blog/2024-01-18/IMG_20240117_191123.jpg&#34;
	width=&#34;3000&#34;
	height=&#34;3000&#34;
	srcset=&#34;https://antio2.cn/blog/2024-01-18/IMG_20240117_191123_hufa86ebeb8c48363a155e4d5429adfed7_1605454_480x0_resize_q75_box.jpg 480w, https://antio2.cn/blog/2024-01-18/IMG_20240117_191123_hufa86ebeb8c48363a155e4d5429adfed7_1605454_1024x0_resize_q75_box.jpg 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;é˜³ç¥è¯¶&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;100&#34;
		data-flex-basis=&#34;240px&#34;
	
&gt; &lt;img src=&#34;https://antio2.cn/blog/2024-01-18/IMG_20240117_192341.jpg&#34;
	width=&#34;3000&#34;
	height=&#34;4000&#34;
	srcset=&#34;https://antio2.cn/blog/2024-01-18/IMG_20240117_192341_hu1f7444139e11fd8a53801b535e33bf79_3549615_480x0_resize_q75_box.jpg 480w, https://antio2.cn/blog/2024-01-18/IMG_20240117_192341_hu1f7444139e11fd8a53801b535e33bf79_3549615_1024x0_resize_q75_box.jpg 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;å”‰ æ²™èŒ¶&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;75&#34;
		data-flex-basis=&#34;180px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;æ„Ÿè§‰æ²™èŒ¶é…±åŠ çº¢æ±¤ä¸å¤ªå¥½ï¼Œä½†æ˜¯ä¸åŠ æ±¤æ„Ÿè§‰è·Ÿåƒç›å·´å·®ä¸äº†å¤šå°‘ğŸ§‚ã€‚è¿˜æ˜¯è€è€å®å®æ²¹ç¢Ÿã€‚&lt;/p&gt;
&lt;h2 id=&#34;èµ°äº†&#34;&gt;èµ°äº†&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/blog/2024-01-18/3.jpg&#34;
	width=&#34;1080&#34;
	height=&#34;2400&#34;
	srcset=&#34;https://antio2.cn/blog/2024-01-18/3_hu3775f561361f8e0bc0f04da307ddcb7f_1500312_480x0_resize_q75_box.jpg 480w, https://antio2.cn/blog/2024-01-18/3_hu3775f561361f8e0bc0f04da307ddcb7f_1500312_1024x0_resize_q75_box.jpg 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;45&#34;
		data-flex-basis=&#34;108px&#34;
	
&gt; &lt;img src=&#34;https://antio2.cn/blog/2024-01-18/4.png&#34;
	width=&#34;310&#34;
	height=&#34;270&#34;
	srcset=&#34;https://antio2.cn/blog/2024-01-18/4_hu3c23eeaf98c8257399c735093d8ef39e_51066_480x0_resize_box_3.png 480w, https://antio2.cn/blog/2024-01-18/4_hu3c23eeaf98c8257399c735093d8ef39e_51066_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;114&#34;
		data-flex-basis=&#34;275px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;åº—å®¶ç»™å¥½è¯„ï¼Œé€äº†ç›’é…¸å¥¶ã€‚çœ‹äº†ä¸€ä¸‹ç°åœ¨å¤©æ°”æ˜¯10â„ƒï¼Œåˆšå¥½åœ¨å†·è—èŒƒå›´ä¸‹ï¼Œå¾—è¶æ˜å¤©æ—¥å‡ºå‰å–äº†ğŸ˜‚ã€‚æ™šä¸Šå›å»åˆå¼€é»‘æ‰“äº†å‡ æŠŠæªã€‚çœŸæ˜¯å……å……åˆå®å®å•Šï¼Œä½ ä»¬æœ‰è¿™æ ·çš„å¯’å‡å—ï¼Ÿ&lt;/p&gt;
</description>
        </item>
        <item>
        <title>åŠæ¢¦åŠé†’</title>
        <link>https://antio2.cn/blog/half-asleep-half-awaken/</link>
        <pubDate>Sat, 30 Dec 2023 19:28:03 +0800</pubDate>
        
        <guid>https://antio2.cn/blog/half-asleep-half-awaken/</guid>
        <description>&lt;img src="https://antio2.cn/blog/half-asleep-half-awaken/bg.jpg" alt="Featured image of post åŠæ¢¦åŠé†’" /&gt;&lt;p&gt;ChiliChillæ–°ä¸“è¾‘åˆ°äº†ï¼Œæ„Ÿè§‰è¿™è®¾è®¡æ— æ•Œäº†ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/blog/half-asleep-half-awaken/0.jpg&#34;
	width=&#34;3000&#34;
	height=&#34;3000&#34;
	srcset=&#34;https://antio2.cn/blog/half-asleep-half-awaken/0_hucf82618b28e7a9d2f05ae25be9e535aa_879836_480x0_resize_q75_box.jpg 480w, https://antio2.cn/blog/half-asleep-half-awaken/0_hucf82618b28e7a9d2f05ae25be9e535aa_879836_1024x0_resize_q75_box.jpg 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;å£³å­&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;100&#34;
		data-flex-basis=&#34;240px&#34;
	
&gt;&lt;img src=&#34;https://antio2.cn/blog/half-asleep-half-awaken/bg.jpg&#34;
	width=&#34;3000&#34;
	height=&#34;3000&#34;
	srcset=&#34;https://antio2.cn/blog/half-asleep-half-awaken/bg_hu4e65532c3540d331c9cdf62efb9e895c_1928682_480x0_resize_q75_box.jpg 480w, https://antio2.cn/blog/half-asleep-half-awaken/bg_hu4e65532c3540d331c9cdf62efb9e895c_1928682_1024x0_resize_q75_box.jpg 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;å¤è€å¸ˆ&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;100&#34;
		data-flex-basis=&#34;240px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/blog/half-asleep-half-awaken/2.jpg&#34;
	width=&#34;3000&#34;
	height=&#34;3000&#34;
	srcset=&#34;https://antio2.cn/blog/half-asleep-half-awaken/2_hu3ebbee43abfbca735d9e1dbaa4f0fd27_1601954_480x0_resize_q75_box.jpg 480w, https://antio2.cn/blog/half-asleep-half-awaken/2_hu3ebbee43abfbca735d9e1dbaa4f0fd27_1601954_1024x0_resize_q75_box.jpg 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;æ­Œè¯æœ¬&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;100&#34;
		data-flex-basis=&#34;240px&#34;
	
&gt; &lt;img src=&#34;https://antio2.cn/blog/half-asleep-half-awaken/1.jpg&#34;
	width=&#34;3000&#34;
	height=&#34;3000&#34;
	srcset=&#34;https://antio2.cn/blog/half-asleep-half-awaken/1_hua7e3b23dd83d12108fd7352707798d57_1014473_480x0_resize_q75_box.jpg 480w, https://antio2.cn/blog/half-asleep-half-awaken/1_hua7e3b23dd83d12108fd7352707798d57_1014473_1024x0_resize_q75_box.jpg 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;PVçš„èƒ¶ç‰‡&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;100&#34;
		data-flex-basis=&#34;240px&#34;
	
&gt;&lt;/p&gt;
&lt;hr&gt;






    


&lt;div class=&#34;video-wrapper&#34;&gt;
    &lt;iframe src=&#34;https://player.bilibili.com/player.html?as_wide=1&amp;amp;high_quality=1&amp;amp;page=1&amp;bvid=BV1ua41157G1&#34;
            scrolling=&#34;no&#34;
            frameborder=&#34;no&#34;
            framespacing=&#34;0&#34;
            allowfullscreen=&#34;true&#34;
    &gt;
    &lt;/iframe&gt;
&lt;/div&gt;

</description>
        </item>
        <item>
        <title>é«˜é¢‘ SQL 50 é¢˜ï¼ˆåŸºç¡€ç‰ˆï¼‰</title>
        <link>https://antio2.cn/tech/mysql_hot_50/</link>
        <pubDate>Thu, 30 Nov 2023 01:32:28 +0800</pubDate>
        
        <guid>https://antio2.cn/tech/mysql_hot_50/</guid>
        <description>&lt;p&gt;åšäº†ä¸€ä¸‹LeetCodeçš„SQL50é¢˜é¢˜å•, è®°å½•ä¸€ä¸‹æœ‰çš„æ²¡çš„çš„ä¸œè¥¿ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://leetcode.cn/studyplan/sql-free-50/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;é«˜é¢‘ SQL 50 é¢˜ï¼ˆåŸºç¡€ç‰ˆï¼‰ - å­¦ä¹ è®¡åˆ’ &lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;ä¸‰å€¼é€»è¾‘è¿ç®—&#34;&gt;ä¸‰å€¼é€»è¾‘è¿ç®—&lt;/h2&gt;
&lt;p&gt;åœ¨ &lt;a class=&#34;link&#34; href=&#34;https://leetcode.cn/problems/find-customer-referee/description/?envType=study-plan-v2&amp;amp;envId=sql-free-50&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;584. å¯»æ‰¾ç”¨æˆ·æ¨èäºº - åŠ›æ‰£ï¼ˆLeetCodeï¼‰&lt;/a&gt; ä¸­ã€‚ä¸€ä¸ªåˆ¤æ–­æ¡ä»¶æ˜¯è¦æ±‚æŸä¸€åˆ—ä¸æ˜¯ä¸€ä¸ªç‰¹å®šçš„å€¼ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯è¿™ä¸€åˆ—å¯èƒ½æ˜¯NULLã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸€æ¬¡å†™äº†ä¸ªé”™è¯¯æ–¹æ³•ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;SELECT&lt;/span&gt; name 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;FROM&lt;/span&gt; customer
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;WHERE&lt;/span&gt; referee_id &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å› ä¸º&lt;code&gt;WHERE&lt;/code&gt; è¿‡æ»¤çš„æ¡ä»¶ä¸ºtrueï¼Œæ‰ä¼šä½¿ç”¨è¿™æ¡è®°å½•ã€‚ä½†æ˜¯ &lt;code&gt;null!=2&lt;/code&gt; çš„å€¼ä¸æ˜¯&lt;code&gt;false&lt;/code&gt;, è€Œæ˜¯&lt;code&gt;unknown&lt;/code&gt;ã€‚ æ‰€ä»¥ä¸Šé¢çš„è¯­å¥ä¹Ÿä¸ä¼šé€‰å‡ºåˆ—ä¸ºNULLçš„è®°å½•ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‰å€¼é€»è¾‘è¿ç®—çš„ç»“æœï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;NOT&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;unknown&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;unknown&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;OR&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;OR&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;unknown&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;unknown&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;OR&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;unknown&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;unknown&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;         &lt;span style=&#34;color:#66d9ef&#34;&gt;OR&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;unknown&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;unknown&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;AND&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;AND&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;unknown&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;unknown&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;unknown&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;AND&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;unknown&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;unknown&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;         &lt;span style=&#34;color:#66d9ef&#34;&gt;AND&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;unknown&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;å­—ç¬¦ä¸²é•¿åº¦&#34;&gt;å­—ç¬¦ä¸²é•¿åº¦&lt;/h2&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://leetcode.cn/problems/invalid-tweets/description/?envType=study-plan-v2&amp;amp;envId=sql-free-50&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;1683. æ— æ•ˆçš„æ¨æ–‡ - åŠ›æ‰£ï¼ˆLeetCodeï¼‰&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;char_length(str)&lt;/li&gt;
&lt;/ul&gt;
&lt;ol&gt;
&lt;li&gt;è®¡ç®—å•ä½ï¼šå­—ç¬¦&lt;/li&gt;
&lt;li&gt;ä¸ç®¡æ±‰å­—è¿˜æ˜¯æ•°å­—æˆ–è€…æ˜¯å­—æ¯éƒ½ç®—æ˜¯ä¸€ä¸ªå­—ç¬¦&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;length(str)&lt;/li&gt;
&lt;/ul&gt;
&lt;ol&gt;
&lt;li&gt;è®¡ç®—å•ä½ï¼šå­—èŠ‚&lt;/li&gt;
&lt;li&gt;utf8ç¼–ç ï¼šä¸€ä¸ªæ±‰å­—ä¸‰ä¸ªå­—èŠ‚ï¼Œä¸€ä¸ªæ•°å­—æˆ–å­—æ¯ä¸€ä¸ªå­—èŠ‚ã€‚&lt;/li&gt;
&lt;li&gt;gbkç¼–ç ï¼šä¸€ä¸ªæ±‰å­—ä¸¤ä¸ªå­—èŠ‚ï¼Œä¸€ä¸ªæ•°å­—æˆ–å­—æ¯ä¸€ä¸ªå­—èŠ‚ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¸¾ä¸ªä¾‹å­ï¼Œå‡å¦‚ä¸€å¼ è¡¨çš„ä¸€åˆ—å†…å®¹ä¸º&lt;code&gt;åäº”å­—åäº”å­—åäº”å­—åäº”å­—åäº”å­—&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;CHAR_LENGTH&lt;/span&gt;(content) &lt;span style=&#34;color:#66d9ef&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;`&lt;/span&gt;tweets&lt;span style=&#34;color:#f92672&#34;&gt;`&lt;/span&gt;; &lt;span style=&#34;color:#f92672&#34;&gt;#&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;è¾“å‡º&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;15&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;LENGTH&lt;/span&gt;(content) &lt;span style=&#34;color:#66d9ef&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;`&lt;/span&gt;tweets&lt;span style=&#34;color:#f92672&#34;&gt;`&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;#&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;è¾“å‡º&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;45&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;havingonwhere-çš„åŒºåˆ«&#34;&gt;HAVING,ON,WHERE çš„åŒºåˆ«&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;WHERE&lt;/code&gt;ä¸&lt;code&gt;HAVING&lt;/code&gt;çš„æ ¹æœ¬åŒºåˆ«åœ¨äºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;WHERE&lt;/code&gt;å­å¥åœ¨&lt;code&gt;GROUP BY&lt;/code&gt;åˆ†ç»„å’Œèšåˆå‡½æ•°&lt;strong&gt;ä¹‹å‰&lt;/strong&gt;å¯¹æ•°æ®è¡Œè¿›è¡Œè¿‡æ»¤ï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;HAVING&lt;/code&gt;å­å¥å¯¹&lt;code&gt;GROUP BY&lt;/code&gt;åˆ†ç»„å’Œèšåˆå‡½æ•°&lt;strong&gt;ä¹‹å&lt;/strong&gt;çš„æ•°æ®è¡Œè¿›è¡Œè¿‡æ»¤ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;ON&lt;/code&gt;å’Œ&lt;code&gt;WHERE&lt;/code&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;ON&lt;/code&gt; å¯ä»¥ä½œä¸º&lt;code&gt;JOIN Conditions&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;WHERE&lt;/code&gt;åœ¨è¿æ¥ä¹‹åã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯¹äºå†…è¿æ¥æ²¡åŒºåˆ«&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯å¯¹äºå¤–è¿æ¥ï¼Œæ¯”å¦‚è¡¨&lt;code&gt;T1(a,b)&lt;/code&gt;,è¡¨&lt;code&gt;T2(a,c)&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;T1 LEFT JOIN T2 WHERE T1.a=1&lt;/code&gt;å’Œ&lt;code&gt;T1 LEFT JOIN T2 ON(T1.a=1)&lt;/code&gt;ç»“æœä¸åŒ&lt;/p&gt;
&lt;p&gt;é€šè¿‡JOINç®—å­æ˜¯å¦‚ä½•å®ç°çš„ï¼Œåº”è¯¥å¾ˆå¥½ç†è§£ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å…³äºæ—¶é—´çš„å‡½æ•°&#34;&gt;å…³äºæ—¶é—´çš„å‡½æ•°&lt;/h2&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.w3school.com.cn/sql/sql_dates.asp&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;SQL Date å‡½æ•° (w3school.com.cn)&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;NOW()      &lt;/code&gt;             å½“å‰çš„æ—¥æœŸå’Œæ—¶é—´&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;CURDATE()  &lt;/code&gt;             å½“å‰æ—¥æœŸ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;CURTIME() &lt;/code&gt;          å½“å‰æ—¶é—´&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;DATE(string)    &lt;/code&gt;        æå–ç»™å®šæ—¶é—´å­—ç¬¦ä¸²çš„æ—¥æœŸ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;EXTRACT(unit FROM date)&lt;/code&gt;  æå–æ—¥æœŸè¡¨è¾¾å¼çš„æŒ‡å®šéƒ¨åˆ†&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;DATE_ADD(date,INTERVAL expr type)&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://leetcode.cn/problems/game-play-analysis-iv/description/?envType=study-plan-v2&amp;amp;envId=sql-free-50&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;550. æ¸¸æˆç©æ³•åˆ†æ IV - åŠ›æ‰£ï¼ˆLeetCodeï¼‰&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;expræ˜¯å¢åŠ çš„å•ä½é‡&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;TYPEæ˜¯æ—¶é—´é—´éš”å•ä½&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;MICROSECOND&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;SECOND&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;MINUTE&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;HOUR&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;DAY&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;WEEK&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;MONTH&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;QUARTER&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;YEAR&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;SECOND_MICROSECOND&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;MINUTE_MICROSECOND&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;MINUTE_SECOND&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;HOUR_MICROSECOND&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;HOUR_SECOND&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;HOUR_MINUTE&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;DAY_MICROSECOND&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;DAY_SECOND&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;DAY_MINUTE&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;DAY_HOUR&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;YEAR_MONTH&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;SELECT&lt;/span&gt; OrderId,DATE_ADD(OrderDate,INTERVAL &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;DAY&lt;/span&gt;) &lt;span style=&#34;color:#66d9ef&#34;&gt;AS&lt;/span&gt; OrderPayDate
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;FROM&lt;/span&gt; Orders
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.w3school.com.cn/sql/func_date_sub.asp&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;DATE_SUB()&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;DATEDIFF(date1,date2)&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¿”å›ä¸¤ä¸ªæ—¥æœŸä¹‹é—´çš„å¤©æ•°&lt;/li&gt;
&lt;li&gt;è‹¥date1 &amp;gt; date2 è¿”å›æ­£æ•°ã€‚&lt;/li&gt;
&lt;li&gt;ä¾‹å¦‚&lt;code&gt;DATEDIFF(&#39;2023-11-2&#39;,&#39;2023-11-1&#39;)=1&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://leetcode.cn/problems/rising-temperature/description/?envType=study-plan-v2&amp;amp;envId=sql-free-50&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;197. ä¸Šå‡çš„æ¸©åº¦ - åŠ›æ‰£ï¼ˆLeetCodeï¼‰&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.w3school.com.cn/sql/func_date_format.asp&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;MySQL DATE_FORMAT() å‡½æ•° (w3school.com.cn)&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æ ¼å¼åŒ–è¾“å‡º&#34;&gt;æ ¼å¼åŒ–è¾“å‡º&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://dev.mysql.com/doc/refman/8.0/en/mathematical-functions.html#function_round&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ROUND&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-mysql&#34; data-lang=&#34;mysql&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mysql&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ROUND&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;23&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mysql&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ROUND&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;58&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mysql&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ROUND&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;58&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mysql&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ROUND&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;298&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mysql&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ROUND&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;298&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mysql&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ROUND&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;23&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;298&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;20&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mysql&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ROUND&lt;/span&gt;(.&lt;span style=&#34;color:#ae81ff&#34;&gt;12345678901234567890123456789012345&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;35&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;123456789012345678901234567890&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€šè¿‡roundèˆå…¥ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯éœ€è¦å››èˆäº”å…¥çš„æ•°å­—ã€‚ç¬¬äºŒä¸ªæ˜¯å¯é€‰å‚æ•°ï¼Œè¡¨ç¤ºä¿ç•™çš„ä½æ•°ï¼Œé»˜è®¤ä¸º0ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://dev.mysql.com/doc/refman/8.0/en/mathematical-functions.html#function_truncate&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;truncate&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æˆªæ–­æŒ‡å®šçš„å°æ•°ä½æ•°ï¼Œè€Œä¸èˆå…¥ã€‚&lt;/p&gt;
&lt;h2 id=&#34;cross-join&#34;&gt;CROSS JOIN&lt;/h2&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://leetcode.cn/problems/students-and-examinations/description/?envType=study-plan-v2&amp;amp;envId=sql-free-50&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;1280. å­¦ç”Ÿä»¬å‚åŠ å„ç§‘æµ‹è¯•çš„æ¬¡æ•° - åŠ›æ‰£ï¼ˆLeetCodeï¼‰&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;è·å¾—ç¬›å¡å°”ç§¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ififnullnullifisnullå‡½æ•°è¿›è¡Œæµç¨‹çš„æ§åˆ¶&#34;&gt;IF()ã€IFNULL()ã€NULLIF()ã€ISNULL()å‡½æ•°è¿›è¡Œæµç¨‹çš„æ§åˆ¶&lt;/h2&gt;
&lt;p&gt;1ã€IF()å‡½æ•°çš„ä½¿ç”¨
IF(expr1,expr2,expr3)ï¼Œå¦‚æœexpr1çš„å€¼ä¸ºtrueï¼Œåˆ™è¿”å›expr2çš„å€¼ï¼Œå¦‚æœexpr1çš„å€¼ä¸ºfalseï¼Œåˆ™è¿”å›expr3çš„å€¼ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;SELECT IF(TRUE,&amp;#39;A&amp;#39;,&amp;#39;B&amp;#39;);    -- è¾“å‡ºç»“æœï¼šA
SELECT IF(FALSE,&amp;#39;A&amp;#39;,&amp;#39;B&amp;#39;);   -- è¾“å‡ºç»“æœï¼šB
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;2ã€IFNULL()å‡½æ•°çš„ä½¿ç”¨
IFNULL(expr1,expr2)ï¼Œå¦‚æœexpr1çš„å€¼ä¸ºnullï¼Œåˆ™è¿”å›expr2çš„å€¼ï¼Œå¦‚æœexpr1çš„å€¼ä¸ä¸ºnullï¼Œåˆ™è¿”å›expr1çš„å€¼ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;SELECT IFNULL(NULL,&amp;#39;B&amp;#39;);    -- è¾“å‡ºç»“æœï¼šB
SELECT IFNULL(&amp;#39;HELLO&amp;#39;,&amp;#39;B&amp;#39;); -- è¾“å‡ºç»“æœï¼šHELLO
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;3ã€NULLIF()å‡½æ•°çš„ä½¿ç”¨
NULLIF(expr1,expr2)ï¼Œå¦‚æœexpr1=expr2æˆç«‹ï¼Œé‚£ä¹ˆè¿”å›å€¼ä¸ºnullï¼Œå¦åˆ™è¿”å›å€¼ä¸ºexpr1çš„å€¼ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;SELECT NULLIF(&amp;#39;A&amp;#39;,&amp;#39;A&amp;#39;);     -- è¾“å‡ºç»“æœï¼šnull
SELECT NULLIF(&amp;#39;A&amp;#39;,&amp;#39;B&amp;#39;);     -- è¾“å‡ºç»“æœï¼šA
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;4ã€ISNULL()å‡½æ•°çš„ä½¿ç”¨
ISNULL(expr)ï¼Œå¦‚æœexprçš„å€¼ä¸ºnullï¼Œåˆ™è¿”å›1ï¼Œå¦‚æœexpr1çš„å€¼ä¸ä¸ºnullï¼Œåˆ™è¿”å›0ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;SELECT ISNULL(NULL);        -- è¾“å‡ºç»“æœï¼š1
SELECT ISNULL(&amp;#39;HELLO&amp;#39;);     -- è¾“å‡ºç»“æœï¼š0
&lt;/code&gt;&lt;/pre&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://blog.csdn.net/pan_junbiao/article/details/85928004&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;MySQLä¸­IF()ã€IFNULL()ã€NULLIF()ã€ISNULL()å‡½æ•°çš„ä½¿ç”¨_ifnull mysql-CSDNåšå®¢&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;distinct-å…³é”®å­—&#34;&gt;DISTINCT å…³é”®å­—&lt;/h2&gt;
&lt;p&gt;ç”¨äºå»é‡&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://leetcode.cn/problems/number-of-unique-subjects-taught-by-each-teacher/description/?envType=study-plan-v2&amp;amp;envId=sql-free-50&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;2356. æ¯ä½æ•™å¸ˆæ‰€æ•™æˆçš„ç§‘ç›®ç§ç±»çš„æ•°é‡ - åŠ›æ‰£ï¼ˆLeetCodeï¼‰&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;å¼€çª—å‡½æ•°&#34;&gt;å¼€çª—å‡½æ•°&lt;/h2&gt;
&lt;p&gt;ä¹‹å‰è¿˜çœŸä¸çŸ¥é“æœ‰è¿™ä¸ªä¸œè¥¿ã€‚ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://blog.csdn.net/baomingshu/article/details/111945681&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ã€ç²¾é€‰ã€‘ä¸‰ç§å¼€çª—å‡½æ•°è¯¦ç»†ç”¨æ³•ï¼Œå›¾æ–‡è¯¦è§£-CSDNåšå®¢&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å…¶å®å°±æ˜¯æˆ‘ä»¬æœ‰æ—¶å€™æƒ³ç”¨èšåˆå‡½æ•°ï¼Œä½†æ˜¯åˆæƒ³ä¿ç•™èšåˆçš„é‚£äº›è¡Œã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;partition by:æ¯”å¦‚æœ‰Aï¼ŒBï¼ŒCä¸‰ä¸ªç­çº§ï¼Œæˆ‘ä»¬æƒ³ç»Ÿè®¡æ¯ä¸ªç­çº§çš„å¹³å‡å€¼ï¼Œä½†åˆæƒ³ä¿ç•™æ¯ä¸ªäººçš„æˆç»©ã€‚æŒ‰ç…§ä¹‹å‰çš„åšæ³•è‚¯å®šæ˜¯å…ˆGROUPå†JOINï¼Œä½†æ˜¯å®é™…ä¸Šå¯ä»¥ä½¿ç”¨å¼€çª—å‡½æ•°æ¥å®Œæˆè¿™ä¸ªæ“ä½œã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;OVER(order by [col])&lt;/code&gt; è¿™ä¸ªæ˜¯æŒ‰ç…§åˆ—æ’åºã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;case-whenå’Œifå­å¥&#34;&gt;CASE WHENå’ŒIFå­å¥&lt;/h2&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://zhuanlan.zhihu.com/p/292205172&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Mysqlï¼šæ¡ä»¶åˆ¤æ–­å‡½æ•°-CASE WHENã€IFã€IFNULLè¯¦è§£ - çŸ¥ä¹ (zhihu.com)&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-SQL&#34; data-lang=&#34;SQL&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;CASE&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;å­—æ®µ&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;WHEN&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;é¢„æœŸå€¼&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;THEN&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;ç»“æœ&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;ELSE&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;ç»“æœ&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;END&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™ä¸å°±æ˜¯&lt;code&gt;IF(CONDITION, ç»“æœ1ï¼Œ ç»“æœ2)&lt;/code&gt;å—&lt;/p&gt;
&lt;p&gt;å¥½åƒä¸åŒçš„ç‚¹åœ¨äºå¤šæ¡ä»¶æ—¶ï¼Œå¯ä»¥åšåˆ°å¾ˆæ–¹ä¾¿åœ°åˆ¤æ–­&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-SQL&#34; data-lang=&#34;SQL&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;SELECT&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;CASE&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;WHEN&lt;/span&gt; score&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;60&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;THEN&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;ä¸åŠæ ¼&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;WHEN&lt;/span&gt; score&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;60&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;and&lt;/span&gt; score&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;85&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;THEN&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;è‰¯&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;WHEN&lt;/span&gt; score&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;85&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;THEN&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;ä¼˜ç§€&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;ELSE&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;æœªçŸ¥&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;END&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;é˜¶æ®µ&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;,&lt;span style=&#34;color:#66d9ef&#34;&gt;count&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;DISTINCT&lt;/span&gt; a.s_id) &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;åŒ…å«äººæ•°&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;å­—ç¬¦ä¸²å‡½æ•°&#34;&gt;å­—ç¬¦ä¸²å‡½æ•°&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;SUBSTRING(column_name, start, length)ï¼šè¿™å°†ä»åˆ—çš„å€¼ä¸­æå–ä¸€ä¸ªå­å­—ç¬¦ä¸²ï¼Œä»æŒ‡å®šçš„èµ·å§‹ä½ç½®å¼€å§‹ï¼Œç›´åˆ°æŒ‡å®šçš„é•¿åº¦ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;UPPER(expression)ï¼šè¿™ä¼šå°†å­—ç¬¦ä¸²è¡¨è¾¾å¼è½¬æ¢ä¸ºå¤§å†™ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;LOWER(expression)ï¼šè¿™ä¼šå°†å­—ç¬¦ä¸²è¡¨è¾¾å¼è½¬æ¢ä¸ºå°å†™ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;CONCAT(string1, string2, &amp;hellip;)ï¼šè¿™ä¼šå°†ä¸¤ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ä¸²è¿æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt; GROUP_CONCAT&lt;/code&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://blog.csdn.net/xiao297328/article/details/120737556&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;mysqlä¸­group_contactå‡½æ•°çš„ä½¿ç”¨_mysql group contact-CSDNåšå®¢&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æ­£åˆ™è¡¨è¾¾å¼&#34;&gt;æ­£åˆ™è¡¨è¾¾å¼&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨&lt;code&gt;REGEXP&lt;/code&gt;æŸ¥è¯¢&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.runoob.com/regexp/regexp-tutorial.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;æ­£åˆ™è¡¨è¾¾å¼ â€“ æ•™ç¨‹ | èœé¸Ÿæ•™ç¨‹ (runoob.com)&lt;/a&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>å¾®å…‰2023åˆ†äº«ä¼š|DB</title>
        <link>https://antio2.cn/tech/glimmer_db_share/</link>
        <pubDate>Sat, 04 Nov 2023 00:50:47 +0800</pubDate>
        
        <guid>https://antio2.cn/tech/glimmer_db_share/</guid>
        <description>&lt;h1 id=&#34;è®¡åˆ’&#34;&gt;è®¡åˆ’&lt;/h1&gt;
&lt;p&gt;ç®€å•ä»‹ç»å…³ç³»å‹æ•°æ®åº“çš„å„ä¸ªç»„æˆéƒ¨åˆ†ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å…³ç³»æ¨¡å‹å‘å±•å†å²&lt;/li&gt;
&lt;li&gt;å†…å­˜ç®¡ç†å™¨&lt;/li&gt;
&lt;li&gt;ç´¢å¼•ç®€ä»‹&lt;/li&gt;
&lt;li&gt;äº‹åŠ¡ç®¡ç†å™¨&lt;/li&gt;
&lt;li&gt;æ•…éšœæ¢å¤&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;é€šè¿‡marpåˆ¶ä½œçš„æ¼”ç¤ºç‰ˆæœ¬&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://antio2.cn/res/glimmer_share_db/Note.md&#34; &gt;æ–‡æ¡£&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://antio2.cn/res/glimmer_share_db/Share.pptx&#34; &gt;æ¼”ç¤º&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h1 id=&#34;ä»æˆç»©ç®¡ç†å¼€å§‹&#34;&gt;ä»æˆç»©ç®¡ç†å¼€å§‹&amp;hellip;&lt;/h1&gt;
&lt;p&gt;ä½ çš„Cè¯­è¨€è€å¸ˆç»™ä½ å¸ƒç½®äº†ä¸€ä¸ªä»»åŠ¡ï¼š
è¦æ±‚ç¼–å†™ä¸€ä¸ªç¨‹åºï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;èƒ½å¤Ÿå­˜å‚¨å­¦ç”Ÿçš„å­¦å·ã€å§“åã€å¹´é¾„ã€Cè¯­è¨€è¯¾çš„æˆç»©&lt;/li&gt;
&lt;li&gt;èƒ½å¤Ÿç»Ÿè®¡å‡ºæˆç»©æœ€å¤§æœ€å°å€¼ï¼Œå¹³å‡å€¼ã€‚&lt;/li&gt;
&lt;li&gt;èƒ½å¤Ÿæ‰¾åˆ°ç»™å®šå­¦å·å­¦ç”Ÿçš„æˆç»©ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h2 id=&#34;äºæ˜¯ä½ é€šè¿‡å·²æœ‰çŸ¥è¯†å†™å‡ºç¨‹åº&#34;&gt;äºæ˜¯ä½ é€šè¿‡å·²æœ‰çŸ¥è¯†ï¼Œå†™å‡ºç¨‹åº&lt;/h2&gt;
&lt;p&gt;é¦–é€‰ç¡®å®šéœ€è¦å­˜å‚¨å“ªäº›ä¿¡æ¯&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;typedef&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt;      &lt;span style=&#34;color:#75715e&#34;&gt;/*å­˜å‚¨å­¦ç”Ÿä¿¡æ¯çš„ç»“æ„ä½“*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;char&lt;/span&gt; stu_name[&lt;span style=&#34;color:#ae81ff&#34;&gt;32&lt;/span&gt;];                        &lt;span style=&#34;color:#75715e&#34;&gt;/*å­˜å‚¨å§“å*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;char&lt;/span&gt; stu_num[&lt;span style=&#34;color:#ae81ff&#34;&gt;32&lt;/span&gt;];                         &lt;span style=&#34;color:#75715e&#34;&gt;/*å­˜å‚¨å­¦å·*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; stu_age;                              &lt;span style=&#34;color:#75715e&#34;&gt;/*å­˜å‚¨å¹´é¾„*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; stu_point;                            &lt;span style=&#34;color:#75715e&#34;&gt;/*å­˜å‚¨æˆç»©*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; stu_year;                             &lt;span style=&#34;color:#75715e&#34;&gt;/*å­˜å‚¨å…¥å­¦å¹´ä»½*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; stu_gender;                           &lt;span style=&#34;color:#75715e&#34;&gt;/*å­˜å‚¨æ€§åˆ«*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;} Student;                                    &lt;span style=&#34;color:#75715e&#34;&gt;/*ç®¡ç†å­¦ç”Ÿç»“æ„ä½“åå­—ä¸ºStudent*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h2 id=&#34;ä½ å®ç°äº†ç£ç›˜å­˜å‚¨&#34;&gt;ä½ å®ç°äº†ç£ç›˜å­˜å‚¨&amp;hellip;&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;FILE &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;outfile &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;fopen&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;stuinfo.txt&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;w&amp;#34;&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;/*æ‰“å¼€æ–‡ä»¶*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;fprintf&lt;/span&gt;(outfile, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;%d&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, tot_stu_num);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt; (num &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; tot_stu_num)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;/*å°†ä¿¡æ¯æŒ‰ç…§é¡ºåºè¾“å‡ºåˆ°æ–‡ä»¶*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;fprintf&lt;/span&gt;(outfile, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;...&amp;#34;&lt;/span&gt;, student_info[num].stu_name,...)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    num&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;fclose&lt;/span&gt;(outfile); &lt;span style=&#34;color:#75715e&#34;&gt;/*å…³é—­æ–‡ä»¶æŒ‡é’ˆ*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å°†ä¿¡æ¯å­˜å‚¨åœ¨&lt;code&gt;&amp;quot;stuinfo.txt&amp;quot;&lt;/code&gt;ä¸­ã€‚
&lt;img src=&#34;https://antio2.cn/tech/glimmer_db_share/blog20231103175950.png&#34;
	width=&#34;569&#34;
	height=&#34;722&#34;
	srcset=&#34;https://antio2.cn/tech/glimmer_db_share/blog20231103175950_hu8d8be4531135c339fd494cc7868e2b52_17862_480x0_resize_box_3.png 480w, https://antio2.cn/tech/glimmer_db_share/blog20231103175950_hu8d8be4531135c339fd494cc7868e2b52_17862_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;bg right &#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;78&#34;
		data-flex-basis=&#34;189px&#34;
	
&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;ä½ å®ç°äº†ç»Ÿè®¡å‡½æ•°&#34;&gt;ä½ å®ç°äº†ç»Ÿè®¡å‡½æ•°&lt;/h2&gt;
&lt;p&gt;MIN,MAX,SUM,AVERAGE&amp;hellip;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;max_point&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; ans &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; student_info[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;].stu_point; &lt;span style=&#34;color:#75715e&#34;&gt;/*ansä¸ºä¸´æ—¶çš„æœ€å¤§å€¼*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; num &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt; (num &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; tot_stu_num)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;/*å¦‚æœå½“å‰åˆ†æ•°å¤§äºä¸´æ—¶æœ€é«˜åˆ†ï¼Œæ›´æ–°*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (student_info[num].stu_point &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; ans)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ans &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; student_info[num].stu_point;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        num&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;printf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;æœ€é«˜åˆ†æ˜¯%d&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;, ans);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h2 id=&#34;ä½ å®ç°äº†cè¯­è¨€è€å¸ˆçš„è¦æ±‚ä½†æ˜¯&#34;&gt;ä½ å®ç°äº†Cè¯­è¨€è€å¸ˆçš„è¦æ±‚ï¼Œä½†æ˜¯&amp;hellip;&lt;/h2&gt;
&lt;p&gt;æ­¤æ—¶ä½ çš„å¾®ç§¯åˆ†è€å¸ˆæ¥äº†ï¼Œè¡¨ç¤ºï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æˆ‘ä¹Ÿè¦ç”¨ä½ è¿™ä¸ªç¨‹åºæ¥ç»Ÿè®¡æˆ‘çš„å­¦ç”Ÿæˆç»©&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;äºæ˜¯ä½ åªæœ‰ä¿®æ”¹å­¦ç”Ÿç»“æ„ä½“ï¼Œéšä¹‹è€Œæ¥çš„æ˜¯æ‰€æœ‰å‡½æ•°çš„ä¿®æ”¹ã€‚&lt;/p&gt;
&lt;p&gt;åŒ…æ‹¬è¯»å†™å‡½æ•°ï¼Œç»Ÿè®¡æ•°æ®çš„å‡½æ•°ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;typedef&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt;      &lt;span style=&#34;color:#75715e&#34;&gt;/*å­˜å‚¨å­¦ç”Ÿä¿¡æ¯çš„ç»“æ„ä½“*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;char&lt;/span&gt; stu_name[&lt;span style=&#34;color:#ae81ff&#34;&gt;32&lt;/span&gt;];                        
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; stu_c_point;    &lt;span style=&#34;color:#75715e&#34;&gt;// Cè¯­è¨€æˆç»©                  
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; stu_math_point; &lt;span style=&#34;color:#75715e&#34;&gt;// å¾®ç§¯åˆ†æˆç»©
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;} Student;                                 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h2 id=&#34;éº»çƒ¦æ¥è¸µè€Œæ¥&#34;&gt;éº»çƒ¦æ¥è¸µè€Œæ¥&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœç”µè„‘åœ¨ä¿®æ”¹æ•°æ®æ—¶å´©æºƒäº†ï¼Œä¼šæ€ä¹ˆæ ·ï¼Ÿ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¯”å¦‚è€å¸ˆå°†100åˆ†åˆ¶æ”¹ä¸ºäº†5åˆ†åˆ¶ã€‚&lt;/li&gt;
&lt;li&gt;ç„¶åç­ä¸Šæœ‰100ä½åŒå­¦ï¼Œä¿®æ”¹äº†50ä½åŒå­¦çš„æ•°æ®æ—¶ï¼Œç”µè„‘å®•æœºäº†ã€‚&lt;/li&gt;
&lt;li&gt;å¯¼è‡´æœ‰50ä¸ª4åˆ†çš„åŒå­¦ï¼Œä¸50ä¸ª100åˆ†çš„åŒå­¦ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœæœ‰ä½ çš„ä¸€ä¸ªCè¯­è¨€è€å¸ˆåœ¨ä¿®æ”¹æˆç»©ï¼Œå¦ä¸€ä½Cè¯­è¨€è€å¸ˆä¹Ÿå¼€å¯äº†è¯¥ç¨‹åºï¼Œå¹¶è¯»å–æˆç»©ã€‚æ˜¯å¦ä¼šå‘ç”Ÿå†²çªã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœç°åœ¨å…¨å›½100ä¸‡ä¸ªå­¦ç”Ÿçš„æˆç»©éƒ½è¦é€šè¿‡è¯¥ç¨‹åºå½•å…¥&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æŸ¥è¯¢ä¸€ä½ç‰¹å®šå­¦ç”Ÿçš„æˆç»©éœ€è¦å¤šä¹…ï¼Ÿ&lt;/li&gt;
&lt;li&gt;ç¨‹åºéœ€è¦å¤šå°‘è¿è¡Œå†…å­˜ï¼Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h1 id=&#34;å…³ç³»æ¨¡å‹çš„æå‡º&#34;&gt;å…³ç³»æ¨¡å‹çš„æå‡º&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Edgar Frank Codd åŸƒå¾·åŠ Â·å¼—å…°å…‹Â·ç§‘å¾· 1969å¹´çš„ä¸€ç¯‡è®ºæ–‡ï¼Œæå‡ºäº†å…³ç³»æ¨¡å‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä»è¡¨ï¼ˆTableï¼‰åŠè¡¨çš„å¤„ç†æ–¹å¼ä¸­æŠ½è±¡å‡ºæ¥çš„ï¼Œæ˜¯åœ¨å¯¹ä¼ ç»Ÿè¡¨åŠå…¶æ“ä½œè¿›è¡Œæ•°å­¦åŒ–ä¸¥æ ¼å®šä¹‰çš„åŸºç¡€ä¸Šï¼Œå¼•å…¥é›†åˆç†è®ºä¸é€»è¾‘å­¦ç†è®º&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;em&gt;å…³ç³»æ¨¡å‹çš„ä¸‰ä¸ªè¦ç´ &lt;/em&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;åŸºæœ¬ç»“æ„ï¼šRelation/Table&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åŸºæœ¬æ“ä½œï¼šRelation Operatorï¼ˆä¾‹å¦‚ï¼šäº¤âˆ©ã€å¹¶âˆªã€å·®-ã€æŠ•å½±Ï€ç­‰ç­‰ï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å®Œæ•´æ€§çº¦æŸï¼šå®ä½“å®Œæ•´æ€§ã€å‚ç…§å®Œæ•´æ€§å’Œç”¨æˆ·è‡ªå®šä¹‰å®Œæ•´æ€§ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/glimmer_db_share/blog20231103220717.png&#34;
	width=&#34;1033&#34;
	height=&#34;726&#34;
	srcset=&#34;https://antio2.cn/tech/glimmer_db_share/blog20231103220717_hud6243a25af5aaaeb00232a7b6e6975c7_87515_480x0_resize_box_3.png 480w, https://antio2.cn/tech/glimmer_db_share/blog20231103220717_hud6243a25af5aaaeb00232a7b6e6975c7_87515_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;bg right contain&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;142&#34;
		data-flex-basis=&#34;341px&#34;
	
&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æˆ‘ä»¬æŠŠä¸€è¡Œå«åšä¸€ä¸ªå…ƒç»„ã€‚tuple/record/rowã€‚ä¸€è¡Œæ•°æ®ï¼Œä¸€æ¡è®°å½•&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å…³ç³»ä»£æ•°&#34;&gt;å…³ç³»ä»£æ•°&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç¬¦å·&lt;/th&gt;
&lt;th&gt;åç§°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Ïƒ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Select&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Ï€&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Projection&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;âˆª&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Union&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;âˆ©&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Intersection&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;â€“&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Difference&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Ã—&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Product&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;â‹ˆ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Join&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;-&amp;ndash;&lt;/p&gt;
&lt;h3 id=&#34;select&#34;&gt;Select&lt;/h3&gt;
&lt;p&gt;ä»é›†åˆä¸­é€‰å‡ºä¸€ä¸ªæ»¡è¶³æ¡ä»¶å­é›†&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/glimmer_db_share/blog20231103221940.png&#34;
	width=&#34;248&#34;
	height=&#34;175&#34;
	srcset=&#34;https://antio2.cn/tech/glimmer_db_share/blog20231103221940_hu82e1ea723f964bedfdfcc8102738b414_6382_480x0_resize_box_3.png 480w, https://antio2.cn/tech/glimmer_db_share/blog20231103221940_hu82e1ea723f964bedfdfcc8102738b414_6382_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;141&#34;
		data-flex-basis=&#34;340px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;$Select_{å­¦å·\le3}(å­¦ç”Ÿæˆç»©è¡¨)$&lt;/li&gt;
&lt;li&gt;$Select_{å§“å=XiaFen}(å­¦ç”Ÿæˆç»©è¡¨)$&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;projectionæŠ•å½±&#34;&gt;Projection/æŠ•å½±&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/glimmer_db_share/blog20231103222534.png&#34;
	width=&#34;246&#34;
	height=&#34;170&#34;
	srcset=&#34;https://antio2.cn/tech/glimmer_db_share/blog20231103222534_hu046ad88468be949b8a13d42c3ea98dce_6640_480x0_resize_box_3.png 480w, https://antio2.cn/tech/glimmer_db_share/blog20231103222534_hu046ad88468be949b8a13d42c3ea98dce_6640_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;bg right contain&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;144&#34;
		data-flex-basis=&#34;347px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;$Î _{æˆç»©}(R)$&lt;/p&gt;
&lt;h3 id=&#34;å¹¶é›†&#34;&gt;å¹¶é›†&lt;/h3&gt;
&lt;p&gt;SQLä¸­çš„UNION ALLå¯ä»¥ä¿ç•™é‡å¤&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/glimmer_db_share/blog20231103223333.png&#34;
	width=&#34;586&#34;
	height=&#34;202&#34;
	srcset=&#34;https://antio2.cn/tech/glimmer_db_share/blog20231103223333_hu68f84af4db9c842ec174d2ffd40808bf_8945_480x0_resize_box_3.png 480w, https://antio2.cn/tech/glimmer_db_share/blog20231103223333_hu68f84af4db9c842ec174d2ffd40808bf_8945_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;bg left contain&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;290&#34;
		data-flex-basis=&#34;696px&#34;
	
&gt;
&lt;img src=&#34;https://antio2.cn/tech/glimmer_db_share/blog20231103223415.png&#34;
	width=&#34;252&#34;
	height=&#34;244&#34;
	srcset=&#34;https://antio2.cn/tech/glimmer_db_share/blog20231103223415_hu75e5ba94b4becbbaa818a8d04332aabd_7676_480x0_resize_box_3.png 480w, https://antio2.cn/tech/glimmer_db_share/blog20231103223415_hu75e5ba94b4becbbaa818a8d04332aabd_7676_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;103&#34;
		data-flex-basis=&#34;247px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;(SELECT * FROM 1ç­)
UNION ALL
(SELECT * FROM 2ç­);&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;intersectionäº¤é›†&#34;&gt;Intersection/äº¤é›†&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/glimmer_db_share/blog20231103223651.png&#34;
	width=&#34;256&#34;
	height=&#34;80&#34;
	srcset=&#34;https://antio2.cn/tech/glimmer_db_share/blog20231103223651_hu6bcd5008f8f6bcd5dfc1cd4b492e6a37_2678_480x0_resize_box_3.png 480w, https://antio2.cn/tech/glimmer_db_share/blog20231103223651_hu6bcd5008f8f6bcd5dfc1cd4b492e6a37_2678_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;320&#34;
		data-flex-basis=&#34;768px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;$(1ç­ âˆ© 2ç­)$&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;joinè¿æ¥-r--s&#34;&gt;JOIN/è¿æ¥ &lt;strong&gt;(R&lt;/strong&gt; &lt;strong&gt;â‹ˆ&lt;/strong&gt; &lt;strong&gt;S)&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;å‡å¦‚ç°åœ¨1ç­å°†å§“åå’Œæˆç»©åˆ†è¡¨å­˜å‚¨ã€‚ï¼ˆå› ä¸ºå¯èƒ½æœ‰å¤šä¸ªç§‘ç›®ï¼‰&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/glimmer_db_share/blog20231103225237.png&#34;
	width=&#34;197&#34;
	height=&#34;150&#34;
	srcset=&#34;https://antio2.cn/tech/glimmer_db_share/blog20231103225237_hua0ee86d95e65242fbd9754a061efd48c_3877_480x0_resize_box_3.png 480w, https://antio2.cn/tech/glimmer_db_share/blog20231103225237_hua0ee86d95e65242fbd9754a061efd48c_3877_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;131&#34;
		data-flex-basis=&#34;315px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/glimmer_db_share/blogimage-20231103225305490.png&#34;
	width=&#34;223&#34;
	height=&#34;181&#34;
	srcset=&#34;https://antio2.cn/tech/glimmer_db_share/blogimage-20231103225305490_hu9fe55b098f594eb5391e09f1c6f3d427_3525_480x0_resize_box_3.png 480w, https://antio2.cn/tech/glimmer_db_share/blogimage-20231103225305490_hu9fe55b098f594eb5391e09f1c6f3d427_3525_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20231103225305490&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;123&#34;
		data-flex-basis=&#34;295px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/glimmer_db_share/blog20231103225319.png&#34;
	width=&#34;206&#34;
	height=&#34;150&#34;
	srcset=&#34;https://antio2.cn/tech/glimmer_db_share/blog20231103225319_hu01b46d7f14261d1f5ab4df7b3e2f5e11_3462_480x0_resize_box_3.png 480w, https://antio2.cn/tech/glimmer_db_share/blog20231103225319_hu01b46d7f14261d1f5ab4df7b3e2f5e11_3462_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;137&#34;
		data-flex-basis=&#34;329px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;- SELECT * FROM 1ç­åŸºæœ¬ä¿¡æ¯ JOIN å¾®ç§¯åˆ†æˆç»©è¡¨ USING (å­¦å·);&lt;/p&gt;
&lt;p&gt;-&amp;ndash;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/glimmer_db_share/blog20231103225835.png&#34;
	width=&#34;356&#34;
	height=&#34;300&#34;
	srcset=&#34;https://antio2.cn/tech/glimmer_db_share/blog20231103225835_hu4a97ac310a83ba849137160240de6973_13120_480x0_resize_box_3.png 480w, https://antio2.cn/tech/glimmer_db_share/blog20231103225835_hu4a97ac310a83ba849137160240de6973_13120_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;bg contain&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;118&#34;
		data-flex-basis=&#34;284px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;ä½ ä¹Ÿå¯ä»¥å°†å¤šä¸ªå…³ç³»ä»£æ•°ç»„åˆ&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ $Î _{å§“åï¼Œå­¦å·ï¼Œå¾®ç§¯åˆ†æˆç»©ï¼ŒCè¯­è¨€æˆç»©}((1ç­åŸºæœ¬æˆç»©â‹ˆå¾®ç§¯åˆ†æˆç»©)â‹ˆCè¯­è¨€æˆç»©)$&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/glimmer_db_share/blogimage-20231103230021561.png&#34;
	width=&#34;451&#34;
	height=&#34;311&#34;
	srcset=&#34;https://antio2.cn/tech/glimmer_db_share/blogimage-20231103230021561_hu089d57db300d8dd84fde0fae296741a2_19962_480x0_resize_box_3.png 480w, https://antio2.cn/tech/glimmer_db_share/blogimage-20231103230021561_hu089d57db300d8dd84fde0fae296741a2_19962_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20231103230021561&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;145&#34;
		data-flex-basis=&#34;348px&#34;
	
&gt;&lt;/p&gt;
&lt;h3 id=&#34;è¿˜æœ‰æ›´å¤šçš„å…³ç³»ä»£æ•°&#34;&gt;è¿˜æœ‰æ›´å¤šçš„å…³ç³»ä»£æ•°&amp;hellip;&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;â€“&lt;/strong&gt; Difference	å·®é›†
&lt;strong&gt;Ã—&lt;/strong&gt; Product 		ç¬›å¡å°”ç§¯
&lt;strong&gt;Ï&lt;/strong&gt; Rename	é‡å‘½å
&lt;strong&gt;Râ†S&lt;/strong&gt; Assignment	èµ‹å€¼
&lt;strong&gt;Î´&lt;/strong&gt; Duplicate Elimination	å»é‡
&lt;strong&gt;Î³&lt;/strong&gt; Aggregation	èšåˆ
&lt;strong&gt;Ï„&lt;/strong&gt; Sorting 	æ’åº
&lt;strong&gt;RÃ·S&lt;/strong&gt; Division é™¤æ³•&lt;/p&gt;
&lt;h1 id=&#34;æ•°æ®çš„ç»„ç»‡&#34;&gt;æ•°æ®çš„ç»„ç»‡&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;ç£ç›˜æ–‡ä»¶çš„ç»“æ„&lt;/li&gt;
&lt;li&gt;é¡µé¢çš„ç»“æ„&lt;/li&gt;
&lt;li&gt;å…ƒç»„çš„ç»“æ„&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/glimmer_db_share/blog20231103231629.png&#34;
	width=&#34;462&#34;
	height=&#34;207&#34;
	srcset=&#34;https://antio2.cn/tech/glimmer_db_share/blog20231103231629_hudb5bf130e18cdd7cb7835d95056ef097_29000_480x0_resize_box_3.png 480w, https://antio2.cn/tech/glimmer_db_share/blog20231103231629_hudb5bf130e18cdd7cb7835d95056ef097_29000_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;223&#34;
		data-flex-basis=&#34;535px&#34;
	
&gt;&lt;/p&gt;
&lt;h2 id=&#34;æ•°æ®å­˜å‚¨åœ¨&#34;&gt;æ•°æ®å­˜å‚¨åœ¨ï¼Ÿ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;DDR5: 100GB/s&lt;/li&gt;
&lt;li&gt;SSD: 3GB/s&lt;/li&gt;
&lt;li&gt;å›ºæ€ç¡¬ç›˜:  50MB/s&lt;/li&gt;
&lt;li&gt;æ‰‹æ‘‡ç¡¬ç›˜ï¼šï¼Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æ•°æ®åˆ†é¡µ&#34;&gt;æ•°æ®åˆ†é¡µ&lt;/h2&gt;
&lt;p&gt;æ“ä½œç³»ç»Ÿä»æœ€å¼€å§‹çš„å†…å­˜åˆ†æ®µã€å†…å­˜ç½®æ¢ã€åˆ°è™šæ‹Ÿå†…å­˜ï¼Œæ®µé¡µæ¨¡å¼ã€‚&lt;/p&gt;
&lt;p&gt;å°†è™šæ‹Ÿåœ°å€ç©ºé—´åˆ†æˆè‹¥å¹²ä¸ªå—ï¼Œæ¯ä¸ªå—éƒ½æœ‰å›ºå®šçš„å¤§å°ï¼Œç‰©ç†åœ°å€ç©ºé—´ä¹Ÿè¢«åˆ’åˆ†æˆè‹¥å¹²ä¸ªå—ï¼Œæ¯ä¸ªå—ä¹Ÿéƒ½æœ‰å›ºå®šçš„å¤§å°ï¼Œç‰©ç†åœ°å€ç©ºé—´çš„å—å’Œè™šæ‹Ÿåœ°å€ç©ºé—´çš„å—å¤§å°ç›¸ç­‰ï¼Œè™šæ‹Ÿåœ°å€ç©ºé—´è¿™äº›å—å°±è¢«ç§°ä¸ºé¡µé¢ï¼Œç‰©ç†åœ°å€ç©ºé—´è¿™äº›å—è¢«ç§°ä¸ºå¸§ã€‚&lt;/p&gt;
&lt;p&gt;å…³äºåˆ†é¡µè¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼Œé¡µé¢çš„å¤§å°æ˜¯å¤šå°‘åˆé€‚å‘¢ï¼Ÿé¡µé¢å¤ªå¤§å®¹æ˜“äº§ç”Ÿç©ºé—´æµªè´¹ï¼Œç¨‹åºå‡å¦‚åªä½¿ç”¨äº†1ä¸ªå­—èŠ‚å´è¢«åˆ†é…äº†10Mçš„é¡µé¢ï¼Œè¿™å²‚ä¸æ˜¯æå¤§çš„æµªè´¹ï¼Œé¡µé¢å¤ªå°ä¼šå¯¼è‡´é¡µè¡¨ï¼ˆä¸‹é¢ä»‹ç»ï¼‰å ç”¨ç©ºé—´è¿‡å¤§ï¼Œæ‰€ä»¥é¡µé¢éœ€è¦æŠ˜ä¸­é€‰æ‹©åˆé€‚çš„å¤§å°ï¼Œç›®å‰å¤§å¤šæ•°ç³»ç»Ÿéƒ½ä½¿ç”¨4KBä½œä¸ºé¡µçš„å¤§å°ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¡¬ç›˜åˆ†é¡µï¼š 4KB&lt;/li&gt;
&lt;li&gt;æ“ä½œç³»ç»Ÿåˆ†é¡µï¼š4KB&lt;/li&gt;
&lt;li&gt;æ•°æ®åº“åˆ†é¡µï¼š512B-16KB&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯ä»¥è¿™ä¹ˆç†è§£åˆ†é¡µï¼š
æ¯”å¦‚ä¸€ä¸ªå¹´çº§æœ‰1000åå­¦ç”Ÿï¼Œæ¯ä¸ªç­æœ‰100åå­¦ç”Ÿï¼Œä¸€å…±æœ‰10ä¸ªç­ã€‚å°†æˆç»©æ‰“å°å‡ºæ¥ä¹‹åï¼Œå°†æ•°æ®åˆ†æˆäº†10é¡µï¼Œæ–¹ä¾¿æŸ¥è¯¢ã€‚ä½ ä¹Ÿå¯ä»¥ç”¨ä¸€å¼ 100mçš„çº¸ï¼Œä½†æ˜¯ä¼šå¯¼è‡´åˆ†é¡µçš„æµªè´¹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç£ç›˜ä¸Šæ–‡ä»¶çš„ç»“æ„&#34;&gt;ç£ç›˜ä¸Šæ–‡ä»¶çš„ç»“æ„&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;heap&lt;/li&gt;
&lt;li&gt;tree&lt;/li&gt;
&lt;li&gt;sequential&lt;/li&gt;
&lt;li&gt;hash&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;heap-file&#34;&gt;Heap File&lt;/h3&gt;
&lt;p&gt;Heap Fileè®°å½•ä¸åŒé¡µçš„ä½ç½®ã€‚&lt;/p&gt;
&lt;p&gt;ä¸åŒçš„é¡µå¯èƒ½å­˜åœ¨äºä¸åŒçš„ç£ç›˜ç©ºé—´ï¼Œç”šè‡³åœ¨ç½‘ç»œä¸Šã€‚&lt;/p&gt;
&lt;p&gt;ä¸€ç§æœ€ç®€å•çš„è®¾è®¡æ˜¯åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/glimmer_db_share/blog20231103234201.png&#34;
	width=&#34;400&#34;
	height=&#34;113&#34;
	srcset=&#34;https://antio2.cn/tech/glimmer_db_share/blog20231103234201_hub775d5a4ce389207c9221ded90d9f6a7_7858_480x0_resize_box_3.png 480w, https://antio2.cn/tech/glimmer_db_share/blog20231103234201_hub775d5a4ce389207c9221ded90d9f6a7_7858_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;bg contain&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;353&#34;
		data-flex-basis=&#34;849px&#34;
	
&gt;&lt;/p&gt;
&lt;h3 id=&#34;pageç»“æ„&#34;&gt;Pageç»“æ„&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/glimmer_db_share/blogimage-20231103235443335.png&#34;
	width=&#34;262&#34;
	height=&#34;277&#34;
	srcset=&#34;https://antio2.cn/tech/glimmer_db_share/blogimage-20231103235443335_hubff07cff251488d32afab24c912e36f0_12237_480x0_resize_box_3.png 480w, https://antio2.cn/tech/glimmer_db_share/blogimage-20231103235443335_hubff07cff251488d32afab24c912e36f0_12237_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20231103235443335&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;94&#34;
		data-flex-basis=&#34;227px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;åœ¨ä¸€ä¸ªç®€å•çš„è®¾è®¡ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡é¡µé¢ç¼–å·å’ŒTupleç¼–å·å°±èƒ½å¤Ÿå®šä½ä¸€ä¸ªtuple&lt;/p&gt;
&lt;h3 id=&#34;tupleç»“æ„&#34;&gt;Tupleç»“æ„&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/glimmer_db_share/blogimage-20231103235920729.png&#34;
	width=&#34;558&#34;
	height=&#34;229&#34;
	srcset=&#34;https://antio2.cn/tech/glimmer_db_share/blogimage-20231103235920729_huda679902d6377054d9a8b44645459942_6648_480x0_resize_box_3.png 480w, https://antio2.cn/tech/glimmer_db_share/blogimage-20231103235920729_huda679902d6377054d9a8b44645459942_6648_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;243&#34;
		data-flex-basis=&#34;584px&#34;
	
&gt;&lt;/p&gt;
&lt;h3 id=&#34;æ¦‚è§ˆ&#34;&gt;æ¦‚è§ˆ&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/glimmer_db_share/blog20231104000203.png&#34;
	width=&#34;1300&#34;
	height=&#34;377&#34;
	srcset=&#34;https://antio2.cn/tech/glimmer_db_share/blog20231104000203_hu61017224101db7042b69796432f6185b_22096_480x0_resize_box_3.png 480w, https://antio2.cn/tech/glimmer_db_share/blog20231104000203_hu61017224101db7042b69796432f6185b_22096_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;344&#34;
		data-flex-basis=&#34;827px&#34;
	
&gt;&lt;/p&gt;
&lt;h2 id=&#34;å†…å­˜ç®¡ç†å™¨&#34;&gt;å†…å­˜ç®¡ç†å™¨&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/glimmer_db_share/blog20231104005639.png&#34;
	width=&#34;888&#34;
	height=&#34;722&#34;
	srcset=&#34;https://antio2.cn/tech/glimmer_db_share/blog20231104005639_huef7ddf45e4542d6d087243c3dbc1a9f4_543971_480x0_resize_box_3.png 480w, https://antio2.cn/tech/glimmer_db_share/blog20231104005639_huef7ddf45e4542d6d087243c3dbc1a9f4_543971_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;bg contain&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;122&#34;
		data-flex-basis=&#34;295px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/glimmer_db_share/blog20231104005806.png&#34;
	width=&#34;694&#34;
	height=&#34;361&#34;
	srcset=&#34;https://antio2.cn/tech/glimmer_db_share/blog20231104005806_hu04f4c2e13fd8ebbaa87a3fc697d8bd54_46100_480x0_resize_box_3.png 480w, https://antio2.cn/tech/glimmer_db_share/blog20231104005806_hu04f4c2e13fd8ebbaa87a3fc697d8bd54_46100_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;192&#34;
		data-flex-basis=&#34;461px&#34;
	
&gt;&lt;/p&gt;
&lt;h1 id=&#34;ç´¢å¼•&#34;&gt;ç´¢å¼•&lt;/h1&gt;
&lt;h2 id=&#34;æƒ…æ™¯&#34;&gt;æƒ…æ™¯&lt;/h2&gt;
&lt;p&gt;åœ¨10000ä¸ªå­¦ç”Ÿçš„æˆç»©è¡¨ä¸­ï¼ˆå­¦å·ä¸º1-10000ï¼‰ï¼Œå¯»æ‰¾ä½ çš„ç¼–å·ï¼ˆå‡å¦‚ä¸º7777ï¼‰&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½ ä¼šä»å¤´æ‰¾åˆ°å°¾å—ï¼Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;bst-äºŒå‰æœç´¢æ ‘&#34;&gt;BST äºŒå‰æœç´¢æ ‘&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/glimmer_db_share/blogv2-a979f7099bf4d4d62ad2ab3ef8c95baa_b.webp&#34;
	width=&#34;531&#34;
	height=&#34;344&#34;
	srcset=&#34;https://antio2.cn/tech/glimmer_db_share/blogv2-a979f7099bf4d4d62ad2ab3ef8c95baa_b_hu3bba6dd7ac92620f873e37f4ff61d119_9064_480x0_resize_q75_h2_box_2.webp 480w, https://antio2.cn/tech/glimmer_db_share/blogv2-a979f7099bf4d4d62ad2ab3ef8c95baa_b_hu3bba6dd7ac92620f873e37f4ff61d119_9064_1024x0_resize_q75_h2_box_2.webp 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;åŠ¨å›¾&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;154&#34;
		data-flex-basis=&#34;370px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;äºŒå‰æœç´¢æ ‘çš„ç‰¹æ€§&lt;/p&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆæ•°æ®åº“ä¸ç”¨äºŒå‰æœç´¢æ ‘å½“ç´¢å¼•&lt;/p&gt;
&lt;p&gt;æœ€åçš„æƒ…å†µä¸‹ç£ç›˜çš„è¯»å†™æ¬¡æ•°ç­‰äºæ ‘çš„é«˜åº¦&lt;/p&gt;
&lt;h3 id=&#34;bæ ‘&#34;&gt;B+æ ‘&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/glimmer_db_share/blog990532-20170117135548927-1999158500.png&#34;
	width=&#34;795&#34;
	height=&#34;289&#34;
	srcset=&#34;https://antio2.cn/tech/glimmer_db_share/blog990532-20170117135548927-1999158500_huacc1d7c05af2ca76350c3a8bc7bd3491_56142_480x0_resize_box_3.png 480w, https://antio2.cn/tech/glimmer_db_share/blog990532-20170117135548927-1999158500_huacc1d7c05af2ca76350c3a8bc7bd3491_56142_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;img&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;275&#34;
		data-flex-basis=&#34;660px&#34;
	
&gt;&lt;/p&gt;
&lt;h3 id=&#34;ä¸ºä»€ä¹ˆè¦é€‰ç”¨bæ ‘&#34;&gt;ä¸ºä»€ä¹ˆè¦é€‰ç”¨B+æ ‘&lt;/h3&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://antio2-1258695065.cos.ap-chengdu.myqcloud.com/img/blogidx.png&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ä¸€ä¸ªB+æ ‘ä¾‹å­&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;- å¯¹äºåœ¨ç£ç›˜ä¸Šå­˜å‚¨çš„ç´¢å¼•æ–‡ä»¶ï¼ŒIOæ¬¡æ•°è¶Šå°‘ï¼Œæ•ˆç‡è¶Šé«˜ã€‚&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚BSTå¯¹äº1000æ¡æ•°æ®ï¼Œé«˜åº¦ä¸º10ã€‚è€ŒB+æ ‘çš„é«˜åº¦ä¸º2ã€‚&lt;/p&gt;
&lt;h1 id=&#34;æ‰§è¡Œå¼•æ“&#34;&gt;æ‰§è¡Œå¼•æ“&lt;/h1&gt;
&lt;h2 id=&#34;å¸¸è§çš„æ‰§è¡Œå¼•æ“æ¨¡å‹&#34;&gt;å¸¸è§çš„æ‰§è¡Œå¼•æ“æ¨¡å‹&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;è¿­ä»£æ¨¡å‹/ç«å±±æ¨¡å‹ï¼ˆIterator Modelï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç‰©åŒ–æ¨¡å‹ï¼ˆMaterialization Modelï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å‘é‡åŒ–/æ‰¹å¤„ç†æ¨¡å‹ï¼ˆVectorized / Batch Modelï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¯¥è®¡ç®—æ¨¡å‹å°†å…³ç³»ä»£æ•°ä¸­æ¯ä¸€ç§æ“ä½œæŠ½è±¡ä¸ºä¸€ä¸ª Operatorï¼Œå°†æ•´ä¸ª SQL æ„å»ºæˆä¸€ä¸ª Operator æ ‘ï¼ŒæŸ¥è¯¢æ ‘è‡ªé¡¶å‘ä¸‹çš„è°ƒç”¨next()æ¥å£ï¼Œæ•°æ®åˆ™è‡ªåº•å‘ä¸Šçš„è¢«æ‹‰å–å¤„ç†ã€‚&lt;/p&gt;
&lt;p&gt;ç«å±±æ¨¡å‹çš„è¿™ç§å¤„ç†æ–¹å¼ä¹Ÿç§°ä¸ºæ‹‰å–æ‰§è¡Œæ¨¡å‹(Pull Based)ã€‚&lt;/p&gt;
&lt;p&gt;å¤§å¤šæ•°å…³ç³»å‹æ•°æ®åº“éƒ½æ˜¯ä½¿ç”¨è¿­ä»£æ¨¡å‹çš„ï¼Œå¦‚ SQLiteã€MongoDBã€Impalaã€DB2ã€SQLServerã€Greenplumã€PostgreSQLã€Oracleã€MySQL ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;ç«å±±æ¨¡å‹çš„ä¼˜ç‚¹åœ¨äºï¼šç®€å•ï¼Œæ¯ä¸ª Operator å¯ä»¥å•ç‹¬å®ç°é€»è¾‘ã€‚&lt;/p&gt;
&lt;p&gt;ç«å±±æ¨¡å‹çš„ç¼ºç‚¹ï¼šæŸ¥è¯¢æ ‘è°ƒç”¨next()æ¥å£æ¬¡æ•°å¤ªå¤šï¼Œå¹¶ä¸”ä¸€æ¬¡åªå–ä¸€æ¡æ•°æ®ï¼ŒCPU æ‰§è¡Œæ•ˆç‡ä½ï¼›è€Œ Joins, Subqueries, Order By ç­‰æ“ä½œç»å¸¸ä¼šé˜»å¡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/glimmer_db_share/blog20231104005355.png&#34;
	width=&#34;997&#34;
	height=&#34;422&#34;
	srcset=&#34;https://antio2.cn/tech/glimmer_db_share/blog20231104005355_hu6de463d3f4896655d0b12ffd86be199e_81329_480x0_resize_box_3.png 480w, https://antio2.cn/tech/glimmer_db_share/blog20231104005355_hu6de463d3f4896655d0b12ffd86be199e_81329_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;236&#34;
		data-flex-basis=&#34;567px&#34;
	
&gt;&lt;/p&gt;
&lt;h1 id=&#34;äº‹åŠ¡&#34;&gt;äº‹åŠ¡&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;åŸå­æ€§(Atomicity)ï¼š
&lt;ul&gt;
&lt;li&gt;All-or-Nothing&lt;/li&gt;
&lt;li&gt;Before-or-After&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ä¸€è‡´æ€§(Consistency)ï¼š äº‹åŠ¡æ‰§è¡Œçš„ç»“æœå¿…é¡»æ˜¯ä½¿æ•°æ®åº“ä»ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€å˜åˆ°å¦ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€ã€‚ä¸€è‡´æ€§ä¸åŸå­æ€§æ˜¯å¯†åˆ‡ç›¸å…³çš„ã€‚&lt;/li&gt;
&lt;li&gt;éš”ç¦»æ€§(Isolation)ï¼š ä¸€ä¸ªäº‹åŠ¡çš„æ‰§è¡Œä¸èƒ½è¢«å…¶ä»–äº‹åŠ¡å¹²æ‰°ã€‚&lt;/li&gt;
&lt;li&gt;æŒç»­æ€§/æ°¸ä¹…æ€§(Durability)ï¼š ä¸€ä¸ªäº‹åŠ¡ä¸€æ—¦æäº¤ï¼Œå®ƒå¯¹æ•°æ®åº“ä¸­æ•°æ®çš„æ”¹å˜å°±åº”è¯¥æ˜¯æ°¸ä¹…æ€§çš„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»¥ä¸Šæ˜¯ä¹¦é¢è§£é‡Šï¼Œç®€å•æ¥è¯´å°±æ˜¯æŠŠä½ çš„æ“ä½œç»Ÿä¸€åŒ–ï¼Œè¦ä¹ˆæ‰€æœ‰æ“ä½œéƒ½æˆåŠŸï¼Œè¦ä¹ˆå°±éƒ½ä¸æˆåŠŸï¼Œå¦‚æœæ‰§è¡Œä¸­æœ‰æŸä¸€é¡¹æ“ä½œå¤±è´¥ï¼Œå…¶ä¹‹å‰æ‰€æœ‰çš„æ“ä½œéƒ½å›æ»šåˆ°æœªæ‰§è¡Œè¿™ä¸€ç³»åˆ—æ“ä½œä¹‹å‰çš„çŠ¶æ€ã€‚&lt;/p&gt;
&lt;h2 id=&#34;äº‹åŠ¡çš„åŸè¯­&#34;&gt;äº‹åŠ¡çš„åŸè¯­&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;begin&lt;/li&gt;
&lt;li&gt;commit&lt;/li&gt;
&lt;li&gt;abort&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id=&#34;è„è¯»&#34;&gt;è„è¯»&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/glimmer_db_share/blog20231104012313.png&#34;
	width=&#34;720&#34;
	height=&#34;612&#34;
	srcset=&#34;https://antio2.cn/tech/glimmer_db_share/blog20231104012313_hufaf31403da72cdbf5f14026537fa4a5a_191015_480x0_resize_box_3.png 480w, https://antio2.cn/tech/glimmer_db_share/blog20231104012313_hufaf31403da72cdbf5f14026537fa4a5a_191015_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;bg contain&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;117&#34;
		data-flex-basis=&#34;282px&#34;
	
&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;ä¸å¯é‡å¤è¯»&#34;&gt;ä¸å¯é‡å¤è¯»&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/glimmer_db_share/blog20231104012401.png&#34;
	width=&#34;850&#34;
	height=&#34;530&#34;
	srcset=&#34;https://antio2.cn/tech/glimmer_db_share/blog20231104012401_hu02aa710f93a5e1ac7853b91fa5cfa155_23539_480x0_resize_box_3.png 480w, https://antio2.cn/tech/glimmer_db_share/blog20231104012401_hu02aa710f93a5e1ac7853b91fa5cfa155_23539_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;bg contain&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;160&#34;
		data-flex-basis=&#34;384px&#34;
	
&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;å¹»è¯»&#34;&gt;å¹»è¯»&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/glimmer_db_share/blog20231104012603.png&#34;
	width=&#34;849&#34;
	height=&#34;531&#34;
	srcset=&#34;https://antio2.cn/tech/glimmer_db_share/blog20231104012603_hu1232e3a7151a0bd983eed4fc028c76f6_23389_480x0_resize_box_3.png 480w, https://antio2.cn/tech/glimmer_db_share/blog20231104012603_hu1232e3a7151a0bd983eed4fc028c76f6_23389_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;bg contain&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;159&#34;
		data-flex-basis=&#34;383px&#34;
	
&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;è¯»å†™é”&#34;&gt;è¯»å†™é”&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/glimmer_db_share/blog20231104012710.png&#34;
	width=&#34;896&#34;
	height=&#34;279&#34;
	srcset=&#34;https://antio2.cn/tech/glimmer_db_share/blog20231104012710_huae63db1158f0b9b29f39d43b12b85518_39345_480x0_resize_box_3.png 480w, https://antio2.cn/tech/glimmer_db_share/blog20231104012710_huae63db1158f0b9b29f39d43b12b85518_39345_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;321&#34;
		data-flex-basis=&#34;770px&#34;
	
&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;é€šè¿‡é”ç®€å•å®ç°äº‹åŠ¡&#34;&gt;é€šè¿‡é”ç®€å•å®ç°äº‹åŠ¡&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥é€šè¿‡åŠ è¡¨é”å’Œè¡Œé”æ¥å®ç°ä¹‹å‰çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;è¡¨é”:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å½“äº‹åŠ¡Aå¯¹è¡¨1åŠ è¯»é”ã€‚&lt;/li&gt;
&lt;li&gt;äº‹åŠ¡Bå¯ä»¥å¯¹è¡¨1è¿›è¡Œè¯»æ“ä½œï¼Œä½†æ˜¯æ— æ³•åŠ å†™é”ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è¡Œé”ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‡è®¾è¡¨1ä¸­æœ‰5æ¡è®°å½•ã€‚&lt;/li&gt;
&lt;li&gt;äº‹åŠ¡Aå¯¹ç¬¬1ï¼Œ2æ¡è®°å½•ä¸Šå†™é”&lt;/li&gt;
&lt;li&gt;äº‹åŠ¡Bä»ç„¶å¯ä»¥å°è¯•å¯¹å…¶ä»–è®°å½•ä¸Šé”&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id=&#34;äº‹åŠ¡çš„éš”ç¦»çº§åˆ«&#34;&gt;äº‹åŠ¡çš„éš”ç¦»çº§åˆ«&lt;/h2&gt;
&lt;p&gt;ä»å¼±åˆ°å¼º&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;RU: è¯»æœªæäº¤&lt;/li&gt;
&lt;li&gt;RC: è¯»å·²æäº¤ï¼ˆSå¤§å¤šæ•°æ•°æ®åº“çš„é»˜è®¤éš”ç¦»çº§åˆ«ï¼‰&lt;/li&gt;
&lt;li&gt;RR: å¯é‡å¤è¯»ï¼ˆMySQLçš„é»˜è®¤éš”ç¦»çº§åˆ«ï¼‰&lt;/li&gt;
&lt;li&gt;SE: å¯åºåˆ—åŒ–ã€‚éš”ç¦»çº§åˆ«æœ€å¼ºã€‚
&lt;img src=&#34;https://antio2.cn/tech/glimmer_db_share/blog20231104013506.png&#34;
	width=&#34;599&#34;
	height=&#34;356&#34;
	srcset=&#34;https://antio2.cn/tech/glimmer_db_share/blog20231104013506_hu9716de4ac10e7113d6def81570daaf43_23608_480x0_resize_box_3.png 480w, https://antio2.cn/tech/glimmer_db_share/blog20231104013506_hu9716de4ac10e7113d6def81570daaf43_23608_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;bg contain right&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;168&#34;
		data-flex-basis=&#34;403px&#34;
	
&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id=&#34;é€šè¿‡åŠ é”å®ç°ä¸åŒçš„éš”ç¦»çº§åˆ«&#34;&gt;é€šè¿‡åŠ é”å®ç°ä¸åŒçš„éš”ç¦»çº§åˆ«&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;RUï¼šè¿™é‡ŒæŸ¥è¯¢ä¸åŠ é”ï¼Œä½†æ˜¯å¢åˆ æ”¹åŠ äº†è¡Œçº§æ’ä»–é”ï¼Œç›´åˆ°äº‹ç‰©è¢«æäº¤æˆ–å›æ»šæ‰ä¼šè§£é”ã€‚&lt;/li&gt;
&lt;li&gt;RCï¼šäº‹åŠ¡è¯»å–çš„æ—¶å€™ï¼ŒæŸ¥è¯¢æ“ä½œå°è¯•åŠ å…±äº«é”ã€‚è¿›è¡Œå¢åˆ æ”¹æ—¶ï¼Œä¼šåŠ è¡Œçº§æ’ä»–é”ï¼Œç›´åˆ°äº‹ç‰©è¢«æäº¤æˆ–å›æ»šæ‰ä¼šè§£é”ã€‚&lt;/li&gt;
&lt;li&gt;RRï¼šäº‹åŠ¡è¯»å–æ—¶åŠ è¡Œçº§å…±äº«é”ï¼Œç›´åˆ°äº‹åŠ¡ç»“æŸæ‰ä¼šé‡Šæ”¾ã€‚&lt;/li&gt;
&lt;li&gt;SEï¼šäº‹åŠ¡è¯»å–æ—¶åŠ è¡¨çº§æ’å®ƒé”ï¼Œç›´åˆ°äº‹åŠ¡ç»“æŸæ—¶ï¼Œæ‰é‡Šæ”¾ã€‚è¿™é‡Œå› ä¸ºæœ‰ä¸€ä¸ªä¸²è¡ŒåŒ–çš„ä¸€ç§çŠ¶æ€ï¼Œæœªè§¦å‘å‰åªå¯ä»¥è¿›è¡ŒæŸ¥è¯¢æ“ä½œï¼Œä¸€æ—¦è¿›è¡Œå¢åˆ æ”¹ä¸²è¡ŒåŒ–å°±ä¼šè¢«è§¦å‘ï¼Œå¢åˆ æ”¹æŸ¥éƒ½ä¼šè¢«äº‹åŠ¡é˜»å¡&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;éš”ç¦»çº§åˆ«è¯»æœªæäº¤&#34;&gt;éš”ç¦»çº§åˆ«ï¼šè¯»æœªæäº¤&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;è§£å†³çš„é—®é¢˜ï¼šè„å†™&lt;/li&gt;
&lt;li&gt;è¯»ä¸åŠ é” å¢åˆ æ”¹åŠ æ’ä»–é”&lt;/li&gt;
&lt;li&gt;å­˜åœ¨çš„é—®é¢˜ï¼šè„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»
&lt;img src=&#34;https://antio2.cn/blog%E8%84%8F%E5%86%99%E9%97%AE%E9%A2%98.drawio.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;bg right auto&#34;
	
	
&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;éš”ç¦»çº§åˆ«è¯»å·²æäº¤&#34;&gt;éš”ç¦»çº§åˆ«ï¼šè¯»å·²æäº¤&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;è§£å†³çš„é—®é¢˜ï¼šè„è¯»&lt;/li&gt;
&lt;li&gt;äº‹åŠ¡è¯»å–çš„æ—¶å€™ï¼ŒæŸ¥è¯¢æ“ä½œå°è¯•åŠ å…±äº«é”ã€‚è¿›è¡Œå¢åˆ æ”¹æ—¶ï¼Œä¼šåŠ è¡Œçº§æ’ä»–é”ï¼Œç›´åˆ°äº‹ç‰©è¢«æäº¤æˆ–å›æ»šæ‰ä¼šè§£é”ã€‚&lt;/li&gt;
&lt;li&gt;å­˜åœ¨çš„é—®é¢˜ï¼šä¸å¯é‡å¤è¯»ã€å¹»è¯»&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/glimmer_db_share/blog20231104012313.png&#34;
	width=&#34;720&#34;
	height=&#34;612&#34;
	srcset=&#34;https://antio2.cn/tech/glimmer_db_share/blog20231104012313_hufaf31403da72cdbf5f14026537fa4a5a_191015_480x0_resize_box_3.png 480w, https://antio2.cn/tech/glimmer_db_share/blog20231104012313_hufaf31403da72cdbf5f14026537fa4a5a_191015_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;bg contain&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;117&#34;
		data-flex-basis=&#34;282px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;ä¸å¯é‡å¤è¯»é—®é¢˜ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/glimmer_db_share/blog20231104012401.png&#34;
	width=&#34;850&#34;
	height=&#34;530&#34;
	srcset=&#34;https://antio2.cn/tech/glimmer_db_share/blog20231104012401_hu02aa710f93a5e1ac7853b91fa5cfa155_23539_480x0_resize_box_3.png 480w, https://antio2.cn/tech/glimmer_db_share/blog20231104012401_hu02aa710f93a5e1ac7853b91fa5cfa155_23539_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;bg right contain&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;160&#34;
		data-flex-basis=&#34;384px&#34;
	
&gt;&lt;/p&gt;
&lt;h3 id=&#34;éš”ç¦»çº§åˆ«å¯é‡å¤è¯»&#34;&gt;éš”ç¦»çº§åˆ«ï¼šå¯é‡å¤è¯»&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;è§£å†³çš„é—®é¢˜ï¼šè„è¯»ã€ä¸å¯é‡å¤è¯»&lt;/li&gt;
&lt;li&gt;å­˜åœ¨çš„é—®é¢˜ï¼šå¹»è¯»&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¹»è¯»é—®é¢˜â†“&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/glimmer_db_share/blog20231104012603.png&#34;
	width=&#34;849&#34;
	height=&#34;531&#34;
	srcset=&#34;https://antio2.cn/tech/glimmer_db_share/blog20231104012603_hu1232e3a7151a0bd983eed4fc028c76f6_23389_480x0_resize_box_3.png 480w, https://antio2.cn/tech/glimmer_db_share/blog20231104012603_hu1232e3a7151a0bd983eed4fc028c76f6_23389_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;bg right contain&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;159&#34;
		data-flex-basis=&#34;383px&#34;
	
&gt;&lt;/p&gt;
&lt;h1 id=&#34;æ•…éšœæ¢å¤&#34;&gt;æ•…éšœæ¢å¤&lt;/h1&gt;
&lt;h2 id=&#34;æ—¥å¿—ç³»ç»Ÿ&#34;&gt;æ—¥å¿—ç³»ç»Ÿ&lt;/h2&gt;
&lt;p&gt;â€¢ &lt;strong&gt;UNDO&lt;/strong&gt;: The process of removing the effects of an incomplete or aborted transaction.&lt;/p&gt;
&lt;p&gt;â€¢ &lt;strong&gt;REDO&lt;/strong&gt;: The process of re-applying the effects of a committed transaction for durability.&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;å­˜å‚¨ä»‹è´¨çš„åˆ†ç±»&#34;&gt;å­˜å‚¨ä»‹è´¨çš„åˆ†ç±»&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;æ˜“å¤±æ€§å­˜å‚¨ã€‚å†…å­˜æ•°æ®ï¼Œæ–­ç”µåæ¶ˆå¤±ã€‚&lt;/li&gt;
&lt;li&gt;éæ˜“å¤±æ€§å­˜å‚¨ã€‚æ¯”å¦‚ä½ çš„ç£ç›˜ã€‚å¦‚æœä½ çš„ç£ç›˜æ–­ç”µåï¼Œæ‰€æœ‰æ•°æ®ä¸¢å¤±åï¼Œæ˜¯å¾ˆå¯æ€•çš„ã€‚&lt;/li&gt;
&lt;li&gt;ç¨³å®šå­˜å‚¨ã€‚ä¸€ç§ä¸å­˜åœ¨çš„éæ˜“å¤±æ€§å­˜å‚¨å½¢å¼ï¼Œå¯åœ¨æ‰€æœ‰å¯èƒ½çš„æ•…éšœæƒ…å†µä¸‹å¹¸å­˜ä¸‹æ¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;éæ˜“å¤±æ€§å­˜å‚¨å™¨(NVMe)æ˜¯ä¸€ç§åŠå¯¼ä½“æŠ€æœ¯ï¼Œä¸éœ€è¦æŒç»­ä¾›ç”µæ¥ä¿ç•™å­˜å‚¨åœ¨è®¡ç®—è®¾å¤‡ä¸­çš„æ•°æ®æˆ–ç¨‹åºä»£ç ã€‚ç³»ç»Ÿåˆ¶é€ å•†å‡ºäºå„ç§ç›®çš„ä½¿ç”¨ä¸åŒç±»å‹çš„éæ˜“å¤±æ€§å­˜å‚¨èŠ¯ç‰‡ã€‚ä¾‹å¦‚ï¼Œä¸€ç§ç±»å‹çš„NVMå¯èƒ½å­˜å‚¨è¯¸å¦‚ç¡¬ç›˜é©±åŠ¨å™¨(HDD)å’Œç£å¸¦é©±åŠ¨å™¨ç­‰è®¾å¤‡çš„æ§åˆ¶å™¨ç¨‹åºä»£ç ã€‚å¦ä¸€ç§ç±»å‹çš„NVMé€šå¸¸ç”¨äºå›ºæ€é©±åŠ¨å™¨(SSD)ã€USBé©±åŠ¨å™¨å’Œæ•°ç ç›¸æœºã€æ‰‹æœºå’Œå…¶ä»–è®¾å¤‡ä¸­çš„å­˜å‚¨å¡ä¸­çš„æ•°æ®å­˜å‚¨ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä¸€æ¡logçš„ç»“æ„&#34;&gt;ä¸€æ¡LOGçš„ç»“æ„&lt;/h3&gt;
&lt;p&gt;â€¢ Transaction ID.&lt;/p&gt;
&lt;p&gt;â€¢ Object ID.&lt;/p&gt;
&lt;p&gt;â€¢ Before Value (used for UNDO).&lt;/p&gt;
&lt;p&gt;â€¢ After Value (used for REDO).&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;äº‹åŠ¡1&lt;/code&gt;ï¼Œå°†&lt;code&gt;è¡¨1çš„ç¬¬äºŒæ¡&lt;/code&gt;è®°å½•ä¿®æ”¹äº†ã€‚ä¹‹å‰çš„å€¼æ˜¯&lt;code&gt;100&lt;/code&gt;ï¼Œä¿®æ”¹åçš„å€¼ä¸º&lt;code&gt;200&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;log-file&#34;&gt;Log File&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Log ID&lt;/th&gt;
&lt;th&gt;äº‹åŠ¡ç¼–å·&lt;/th&gt;
&lt;th&gt;æ“ä½œå¯¹è±¡&lt;/th&gt;
&lt;th&gt;Before Value&lt;/th&gt;
&lt;th&gt;After Value&lt;/th&gt;
&lt;th&gt;å…¶ä»–&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;T1&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;BEGIN&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;T2&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;BEGIN&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;T1&lt;/td&gt;
&lt;td&gt;è¡¨1ï¼Œè®°å½•1&lt;/td&gt;
&lt;td&gt;100&lt;/td&gt;
&lt;td&gt;200&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;T1&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;ABORT&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;td&gt;T2&lt;/td&gt;
&lt;td&gt;è¡¨1ï¼Œè®°å½•2&lt;/td&gt;
&lt;td&gt;500&lt;/td&gt;
&lt;td&gt;700&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;td&gt;T2&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;COMMIT&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;å†…å­˜æ›¿æ¢ç­–ç•¥&#34;&gt;å†…å­˜æ›¿æ¢ç­–ç•¥&lt;/h2&gt;
&lt;p&gt;A &lt;em&gt;steal policy&lt;/em&gt; dictates whether the DBMS allows an uncommitted transaction to overwrite the most recent&lt;/p&gt;
&lt;p&gt;committed value of an object in non-volatile storage (can a transaction write uncommitted changes belonging to a different traansaction to disk?).&lt;/p&gt;
&lt;p&gt;â€¢ &lt;strong&gt;STEAL&lt;/strong&gt;: Is allowed Stealçš„ä¼˜åŠ¿ï¼š&lt;/p&gt;
&lt;p&gt;â€¢ &lt;strong&gt;NO-STEAL&lt;/strong&gt;: Is not allowed.&lt;/p&gt;
&lt;p&gt;A &lt;em&gt;force policy&lt;/em&gt; dictates whether the DBMS requires that all updates made by a transaction are reflected on&lt;/p&gt;
&lt;p&gt;non-volatile storage before the transaction is allowed to commit (ie. return a commit message back to the&lt;/p&gt;
&lt;p&gt;client).&lt;/p&gt;
&lt;p&gt;â€¢ &lt;strong&gt;FORCE&lt;/strong&gt;: Is required&lt;/p&gt;
&lt;p&gt;â€¢ &lt;strong&gt;NO-FORCE&lt;/strong&gt;: Is not required&lt;/p&gt;
&lt;p&gt;DBMSéœ€è¦ç¡®ä¿ä»¥ä¸‹ä¿è¯ï¼š&lt;/p&gt;
&lt;p&gt;â€¢ ä¸€æ—¦ DBMS å‘Šè¯‰æŸäººå®ƒå·²æäº¤ï¼Œä»»ä½•äº‹åŠ¡çš„æ›´æ”¹éƒ½æ˜¯æŒä¹…çš„ã€‚&lt;/p&gt;
&lt;p&gt;â€¢ å¦‚æœäº‹åŠ¡ä¸­æ­¢ï¼Œåˆ™ä»»ä½•éƒ¨åˆ†æ›´æ”¹éƒ½ä¸ä¼šæŒä¹…ã€‚&lt;/p&gt;
&lt;p&gt;çªƒå–ç­–ç•¥æŒ‡ç¤º DBMS æ˜¯å¦å…è®¸æœªæäº¤çš„äº‹åŠ¡è¦†ç›–æœ€æ–°çš„ éæ˜“å¤±æ€§å­˜å‚¨ä¸­å¯¹è±¡çš„å·²æäº¤å€¼ï¼ˆäº‹åŠ¡å¯ä»¥å†™å…¥å±äº åˆ°å¦ä¸€ä¸ªtraansactionåˆ°ç£ç›˜ï¼Ÿ&lt;/p&gt;
&lt;p&gt;â€¢ STEALï¼šå…è®¸ â€¢ NO-STEALï¼šä¸å…è®¸ã€‚&lt;/p&gt;
&lt;p&gt;å¼ºåˆ¶ç­–ç•¥æŒ‡ç¤º DBMS æ˜¯å¦è¦æ±‚åæ˜ äº‹åŠ¡æ‰€åšçš„æ‰€æœ‰æ›´æ–° åœ¨å…è®¸äº‹åŠ¡æäº¤ä¹‹å‰è¿›è¡Œéæ˜“å¤±æ€§å­˜å‚¨ï¼ˆå³å°†æäº¤æ¶ˆæ¯è¿”å›ç»™ å®¢æˆ·ç«¯ï¼‰ã€‚ â€¢ FORCEï¼šå¿…å¡« â€¢ NO-FORCEï¼šä¸éœ€è¦ å¼ºåˆ¶å†™å…¥ä½¿å…¶æ›´å®¹æ˜“æ¢å¤ï¼Œå› ä¸ºæ‰€æœ‰æ›´æ”¹éƒ½ä¼šä¿ç•™ï¼Œä½†ä¼šå¯¼è‡´è¿è¡Œæ—¶é—´è¾ƒå·® æ€§èƒ½&lt;/p&gt;
&lt;h2 id=&#34;wal&#34;&gt;WAL&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨é¢„å†™æ—¥å¿—è®°å½•ï¼ŒDBMSåœ¨å¯¹ç£ç›˜é¡µé¢è¿›è¡Œæ›´æ”¹ä¹‹å‰ï¼Œå°†å¯¹æ•°æ®åº“æ‰€åšçš„æ‰€æœ‰æ›´æ”¹è®°å½•åœ¨ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ä¸­(åœ¨ç¨³å®šçš„å­˜å‚¨ä¸Š)ã€‚æ—¥å¿—åŒ…å«è¶³å¤Ÿçš„ä¿¡æ¯æ¥æ‰§è¡Œå¿…è¦çš„æ’¤æ¶ˆå’Œé‡åšæ“ä½œï¼Œä»¥ä¾¿åœ¨å´©æºƒåæ¢å¤æ•°æ®åº“ã€‚åœ¨å°†æ•°æ®åº“å¯¹è±¡åˆ·æ–°åˆ°ç£ç›˜ä¹‹å‰ï¼ŒDBMSå¿…é¡»å°†å¯¹åº”äºå¯¹æ•°æ®åº“å¯¹è±¡æ‰€åšæ›´æ”¹çš„æ—¥å¿—æ–‡ä»¶è®°å½•å†™å…¥ç£ç›˜ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡WALï¼Œå¯ä»¥å®ç°STEAL + NO FORCE&lt;/p&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯æœªæäº¤äº‹åŠ¡çš„ä¿®æ”¹å¯ä»¥å†™åˆ°ç£ç›˜ä¸Šï¼Œå½“äº‹åŠ¡æäº¤æ—¶ï¼Œä¹Ÿä¸ç”¨å¼ºåˆ¶å°†ä¿®æ”¹å†™å‡ºåˆ°ç£ç›˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;aries&#34;&gt;ARIES&lt;/h2&gt;
&lt;p&gt;å¯¹äºæ—¥å¿—ä¸­çš„æ‰€æœ‰è®°å½•&lt;/p&gt;
&lt;p&gt;å¯¹äºæ¯ä¸ªäº‹åŠ¡&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœè¯¥äº‹åŠ¡æ²¡æœ‰commitæˆ–abortï¼Œéœ€è¦undoè¯¥äº‹åŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;å¦åˆ™redoè¯¥äº‹åŠ¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å½“æ•°æ®åº“ç³»ç»Ÿå¯åŠ¨æ—¶ï¼Œä¼šè¿›è¡Œæ¢å¤æ“ä½œ&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;é‡åšé˜¶æ®µã€‚redo
&lt;ul&gt;
&lt;li&gt;ç³»ç»Ÿé¦–å…ˆæ‰¾åˆ°æœ€åä¸€ä¸ªæ£€æŸ¥ç‚¹ï¼Œä»å‰å¾€åæ‰«æå¹¶é‡åšæ‰€æœ‰é‡åˆ°çš„äº‹åŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;è¿™ä¸ªé‡åšåŒ…æ‹¬ä¹‹å‰æåˆ°çš„CLRï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ&lt;code&gt;&amp;lt;Ti,Xj,V1,V2&amp;gt;&lt;/code&gt;å’Œ&lt;code&gt;&amp;lt;Ti,Xj,V2&amp;gt;&lt;/code&gt;éƒ½ä¼šé‡åšXjçš„å€¼ä¸ºV2ã€‚&lt;/li&gt;
&lt;li&gt;è¿™æ ·ï¼Œé‡åˆ°äº†Abortå°±ä¸å†éœ€è¦ä»åå†å¾€å‰æ‰«æä¸€éäº†ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨redoé˜¶æ®µï¼Œéœ€è¦ç»´æŠ¤ä¸€ä¸ªæ´»è·ƒäº‹åŠ¡åˆ—è¡¨ï¼Œè¯¥åˆ—è¡¨åˆå€¼ä¸ºCheck pointä¸­çš„Lï¼Œé‡åˆ°commitæˆ–abortå°±ä¼šå°†Lä¸­çš„è¯¥äº‹åŠ¡å»æ‰ï¼Œé‡åˆ°startå°±ä¼šåœ¨Lä¸­å¢åŠ äº‹åŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;æœ€åï¼Œä¼šå¾—åˆ°ä¸€ä¸ªäº‹åŠ¡åˆ—è¡¨ã€‚undo-list&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ’¤é”€é˜¶æ®µã€‚undo
&lt;ul&gt;
&lt;li&gt;äº‹åŠ¡ä»åå¾€å‰å›æ»šæ‰€æœ‰undo-listä¸­çš„äº‹åŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;è¯·æ³¨æ„ï¼ŒCLRæ˜¯ä¸ä¼šè¢«undoçš„ã€‚&lt;/li&gt;
&lt;li&gt;å…·ä½“æ“ä½œå’Œç³»ç»Ÿæ­£å¸¸è¿è¡Œæ—¶abortæ‰çš„æµç¨‹ç›¸ä¼¼ï¼Œå½“é‡åˆ°startè®°å½•ï¼Œä»undo-listä¸­åˆ æ‰è¯¥äº‹åŠ¡ï¼Œå½“listä¸ºç©ºï¼Œundoé˜¶æ®µç»“æŸã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ç®€è¦ä»‹ç»ARIESçš„æ¢å¤ç®—æ³•&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/glimmer_db_share/blog20231104130548.png&#34;
	width=&#34;699&#34;
	height=&#34;367&#34;
	srcset=&#34;https://antio2.cn/tech/glimmer_db_share/blog20231104130548_hu2f748ccf210b8f434270cc6e1b31aae5_58685_480x0_resize_box_3.png 480w, https://antio2.cn/tech/glimmer_db_share/blog20231104130548_hu2f748ccf210b8f434270cc6e1b31aae5_58685_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;190&#34;
		data-flex-basis=&#34;457px&#34;
	
&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åˆ†æé˜¶æ®µ&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é¦–å…ˆæ‰¾åˆ°æœ€åçš„checkpoint,è·å–è„é¡µè¡¨ã€‚é€šè¿‡è„é¡µè¡¨ä¸­æœ€å°çš„reclsnç¡®å®šä»å“ªä¸ªlsnå¼€å§‹é‡åšã€‚å¦‚æœæ²¡æœ‰è„é¡µï¼Œå°±å°†redolsnè®¾ç½®ä¸ºcheckpointçš„lsnã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œredo lsnä¹‹å‰çš„æ‰€æœ‰recordéƒ½æ˜¯å·²ç»ç¡®ä¿å†™å…¥äº†ç£ç›˜çš„ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨åˆ†æé˜¶æ®µï¼Œè¿˜éœ€è¦ç»´æŠ¤undo-list,å’Œundo-listä¸­äº‹åŠ¡çš„lastLSNã€‚&lt;/p&gt;
&lt;p&gt;ä¸€æ—¦åˆ†æé˜¶æ®µå‘ç°åœ¨é¡µä¸Šæ›´æ–°çš„æ—¥å¿—è®°å½•ï¼Œè¿˜å°†æ›´æ–°è„é¡µè¡¨ã€‚æ–°çš„è„é¡µçš„rec lsnä¸ºè¯¥logçš„lsn&lt;/p&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;é‡åšé˜¶æ®µ&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é€šè¿‡ä»å‰å¾€åæ‰«ælogã€‚å¦‚æœè¯¥logçš„é¡µä¸åœ¨è„é¡µè¡¨ä¸­ï¼Œæˆ–è€…æ›´æ–°æ—¥å¿—è®°å½•çš„LSNå°äºè„é¡µè¡¨ä¸­è¯¥é¡µçš„rec lsn(è¯¥logå·²ç»è½ç›˜)ï¼Œå°±è·³è¿‡è¯¥æ¬¡è®°å½•&lt;/p&gt;
&lt;p&gt;å¦åˆ™å°±è°ƒå‡ºè¯¥é¡µï¼Œå¦‚æœè¯¥é¡µçš„page lsnå°äºè¯¥æ—¥å¿—çš„lsnï¼Œé‡åšæ—¥å¿—ã€‚&lt;/p&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;æ’¤é”€é˜¶æ®µ&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ’¤é”€é˜¶æ®µä¼šå¯¹æ—¥å¿—è¿›è¡Œåå‘æ‰«æï¼Œå¹¶å¯¹undo listä¸­çš„æ‰€æœ‰äº‹åŠ¡è¿›è¡Œæ’¤é”€ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœé‡åˆ°ä¸€ä¸ªæ›´æ–°æ—¥å¿—è®°å½•ï¼Œå°±ç”¨å…¶è¿›è¡Œç‰©ç†undo,å¹¶äº§ç”Ÿä¸€æ¡CLRï¼Œå°†è¯¥CLRçš„UndoNextLSNè®¾ç½®ä¸ºè¯¥æ—¥å¿—çš„prev LSNã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœé‡åˆ°ä¸€æ¡CLR,è¯´æ˜åœ¨&lt;strong&gt;é‡åšé˜¶æ®µå·²ç»è¿›è¡Œäº†å›æ»šæ“ä½œ&lt;/strong&gt;ï¼Œé‚£ä¹ˆç›´æ¥è·³åˆ°UndoNextLSNå°±è¡Œã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/glimmer_db_share/blog20231104131025.png&#34;
	width=&#34;842&#34;
	height=&#34;368&#34;
	srcset=&#34;https://antio2.cn/tech/glimmer_db_share/blog20231104131025_hu012c853aae648f435a93006fe176400e_19108_480x0_resize_box_3.png 480w, https://antio2.cn/tech/glimmer_db_share/blog20231104131025_hu012c853aae648f435a93006fe176400e_19108_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;228&#34;
		data-flex-basis=&#34;549px&#34;
	
&gt;&lt;/p&gt;
&lt;h1 id=&#34;åˆ†å¸ƒå¼æ•°æ®åº“&#34;&gt;åˆ†å¸ƒå¼æ•°æ®åº“&lt;/h1&gt;
&lt;h2 id=&#34;èŠ‚ç‚¹ç±»å‹&#34;&gt;èŠ‚ç‚¹ç±»å‹&lt;/h2&gt;
&lt;p&gt;åŒæ„èŠ‚ç‚¹ï¼šé›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥æ‰§è¡Œç›¸åŒçš„ä»»åŠ¡é›†ï¼ˆå°½ç®¡å¯èƒ½ ä¸åŒçš„æ•°æ®åˆ†åŒºï¼‰ï¼Œéå¸¸é€‚åˆå…±äº«æ— æ¶æ„ã€‚è¿™ä½¿å¾—é¢„é… å’Œæ•…éšœè½¬ç§»â€œæ›´å®¹æ˜“â€ã€‚å¤±è´¥çš„ä»»åŠ¡å°†åˆ†é…ç»™å¯ç”¨èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;å¼‚æ„èŠ‚ç‚¹ï¼šä¸ºèŠ‚ç‚¹åˆ†é…äº†ç‰¹å®šä»»åŠ¡ï¼Œå› æ­¤èŠ‚ç‚¹ä¹‹é—´å¿…é¡»è¿›è¡Œé€šä¿¡ æ‰§è¡Œç»™å®šçš„ä»»åŠ¡ã€‚å¯ä»¥å…è®¸å•ä¸ªç‰©ç†èŠ‚ç‚¹æ‰˜ç®¡å¤šä¸ªâ€œè™šæ‹Ÿâ€èŠ‚ç‚¹ç±»å‹ï¼Œç”¨äºä¸“ç”¨ ä»»åŠ¡ã€‚å¯ä»¥ç‹¬ç«‹åœ°ä»ä¸€ä¸ªèŠ‚ç‚¹æ‰©å±•åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹ã€‚ä¸€ä¸ªä¾‹å­æ˜¯MongoDBï¼Œå®ƒæœ‰è·¯ç”±å™¨èŠ‚ç‚¹ å°†æŸ¥è¯¢è·¯ç”±åˆ°åˆ†ç‰‡å’Œé…ç½®æœåŠ¡å™¨èŠ‚ç‚¹ï¼Œå­˜å‚¨ä»é”®åˆ°åˆ†ç‰‡çš„æ˜ å°„ã€‚&lt;/p&gt;
&lt;h3 id=&#34;åˆ†åŒº&#34;&gt;åˆ†åŒº&lt;/h3&gt;
&lt;p&gt;åˆ†å¸ƒå¼ç³»ç»Ÿå¿…é¡»è·¨å¤šä¸ªèµ„æºï¼ˆåŒ…æ‹¬ç£ç›˜ã€èŠ‚ç‚¹ã€å¤„ç†å™¨ï¼‰å¯¹æ•°æ®åº“è¿›è¡Œåˆ†åŒºã€‚ æ­¤è¿‡ç¨‹åœ¨ NoSQL ç³»ç»Ÿä¸­æœ‰æ—¶ç§°ä¸ºåˆ†ç‰‡ã€‚å½“ DBMS æ”¶åˆ°æŸ¥è¯¢æ—¶ï¼Œå®ƒé¦–å…ˆ åˆ†ææŸ¥è¯¢è®¡åˆ’éœ€è¦è®¿é—®çš„æ•°æ®ã€‚DBMS å¯èƒ½ä¼šå‘é€ æŸ¥è¯¢è®¡åˆ’åˆ°ä¸åŒçš„èŠ‚ç‚¹ï¼Œç„¶ååˆå¹¶ç»“æœä»¥ç”Ÿæˆå•ä¸ªç­”æ¡ˆã€‚&lt;/p&gt;
&lt;p&gt;åˆ†åŒºæ–¹æ¡ˆçš„ç›®æ ‡æ˜¯æœ€å¤§åŒ–å•èŠ‚ç‚¹äº‹åŠ¡ï¼Œæˆ–ä»…è®¿é—® åŒ…å«åœ¨ä¸€ä¸ªåˆ†åŒºä¸Šçš„æ•°æ®ã€‚è¿™ä½¿å¾— DBMS ä¸éœ€è¦åè°ƒå¹¶å‘çš„è¡Œä¸º åœ¨å…¶ä»–èŠ‚ç‚¹ä¸Šè¿è¡Œçš„äº‹åŠ¡ã€‚å¦ä¸€æ–¹é¢ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡åœ¨ä¸€ä¸ªæˆ– æ›´å¤šåˆ†åŒºã€‚è¿™éœ€è¦æ˜‚è´µä¸”å›°éš¾çš„åè°ƒã€‚å¯¹äºé€»è¾‘åˆ†åŒºçš„èŠ‚ç‚¹ï¼Œç‰¹å®šèŠ‚ç‚¹è´Ÿè´£ä»å…±äº«è®¿é—®ç‰¹å®šå…ƒç»„ ç£ç›˜ã€‚å¯¹äºç‰©ç†åˆ†åŒºçš„èŠ‚ç‚¹ï¼Œæ¯ä¸ªå…±äº«çš„ nothing èŠ‚ç‚¹éƒ½ä¼šè¯»å–å¹¶æ›´æ–°å…¶åœ¨å…¶ä¸ŠåŒ…å«çš„å…ƒç»„ è‡ªå·±çš„æœ¬åœ°ç£ç›˜ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å®ç°&#34;&gt;å®ç°&lt;/h3&gt;
&lt;p&gt;å¯¹è¡¨è¿›è¡Œåˆ†åŒºçš„æœ€ç®€å•æ–¹æ³•æ˜¯æœ´ç´ çš„æ•°æ®åˆ†åŒºã€‚å‡è®¾è¶³å¤Ÿäº†ï¼Œæ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨ä¸€ä¸ªè¡¨ ç»™å®šèŠ‚ç‚¹çš„å­˜å‚¨ç©ºé—´ã€‚è¿™å¾ˆå®¹æ˜“å®ç°ï¼Œå› ä¸ºæŸ¥è¯¢åªæ˜¯è·¯ç”±åˆ°ç‰¹å®šçš„ åˆ†åŒºã€‚è¿™å¯èƒ½å¾ˆç³Ÿç³•ï¼Œå› ä¸ºå®ƒä¸å¯æ‰©å±•ã€‚å¦‚æœä¸€ä¸ªåˆ†åŒºçš„èµ„æºè€—å°½ï¼Œåˆ™è¯¥åˆ†åŒºçš„èµ„æºå¯èƒ½ä¼šè€—å°½ ç»å¸¸æŸ¥è¯¢è¡¨ï¼Œè€Œä¸æ˜¯ä½¿ç”¨æ‰€æœ‰å¯ç”¨çš„èŠ‚ç‚¹ã€‚æœ‰å…³ç¤ºä¾‹ï¼Œè¯·å‚è§å›¾ 2ã€‚ å¦ä¸€ç§åˆ†åŒºæ–¹æ³•æ˜¯å‚ç›´åˆ†åŒºï¼Œå®ƒå°†è¡¨çš„å±æ€§æ‹†åˆ†ä¸ºå•ç‹¬çš„åˆ†åŒºã€‚ æ¯ä¸ªåˆ†åŒºè¿˜å¿…é¡»å­˜å‚¨ç”¨äºé‡å»ºåŸå§‹è®°å½•çš„å…ƒç»„ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;æ›´å¸¸ç”¨çš„æ˜¯æ°´å¹³åˆ†åŒºï¼Œå®ƒå°†è¡¨çš„å…ƒç»„æ‹†åˆ†ä¸ºä¸ç›¸äº¤çš„å­é›†ã€‚é€‰æ‹© æ ¹æ®å¤§å°ã€è´Ÿè½½æˆ–ä½¿ç”¨æƒ…å†µå¹³å‡åˆ’åˆ†æ•°æ®åº“çš„åˆ—ï¼Œç§°ä¸ºåˆ†åŒºé”®&lt;/p&gt;
&lt;p&gt;DBMS å¯ä»¥é€šè¿‡å“ˆå¸Œåˆ†åŒºæˆ–èŒƒå›´åˆ†åŒºå¯¹æ•°æ®åº“è¿›è¡Œç‰©ç†åˆ†åŒºï¼ˆæ— å…±äº«ï¼‰æˆ–é€»è¾‘åˆ†åŒºï¼ˆå…±äº«ç£ç›˜ï¼‰åˆ†åŒºã€‚æœ‰å…³ç¤ºä¾‹ï¼Œè¯·å‚è§å›¾ 3ã€‚å“ˆå¸Œåˆ†åŒºçš„é—®é¢˜åœ¨äºï¼Œå½“ æ·»åŠ æˆ–åˆ é™¤æ–°èŠ‚ç‚¹ï¼Œéœ€è¦å¯¹å¤§é‡æ•°æ®è¿›è¡Œæ´—ç‰Œã€‚å¯¹æ­¤çš„è§£å†³æ–¹æ¡ˆæ˜¯ä¸€è‡´çš„ æ•£åˆ—æ³•ã€‚ ä¸€è‡´æ€§å“ˆå¸Œå°†æ¯ä¸ªèŠ‚ç‚¹åˆ†é…åˆ°æŸä¸ªé€»è¾‘ç¯ä¸Šçš„æŸä¸ªä½ç½®ã€‚ç„¶åæ˜¯æ¯ä¸ªåˆ†åŒºçš„å“ˆå¸Œå€¼ é”®æ˜ å°„åˆ°ç¯ä¸Šçš„æŸä¸ªä½ç½®ã€‚é¡ºæ—¶é’ˆæ–¹å‘ä¸Šæœ€æ¥è¿‘é”®çš„èŠ‚ç‚¹æ˜¯ è´Ÿè´£è¯¥å¯†é’¥ã€‚æœ‰å…³ç¤ºä¾‹ï¼Œè¯·å‚è§å›¾ 4ã€‚æ·»åŠ æˆ–åˆ é™¤èŠ‚ç‚¹æ—¶ï¼Œé”®ä»… åœ¨ä¸æ–°èŠ‚ç‚¹/åˆ é™¤çš„èŠ‚ç‚¹ç›¸é‚»çš„èŠ‚ç‚¹ä¹‹é—´ç§»åŠ¨ã€‚å¤åˆ¶å› å­ n è¡¨ç¤ºæ¯ä¸ªé”® æŒ‰é¡ºæ—¶é’ˆæ–¹å‘åœ¨ n ä¸ªæœ€è¿‘çš„èŠ‚ç‚¹å¤„å¤åˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/glimmer_db_share/blog20231104132102.png&#34;
	width=&#34;1161&#34;
	height=&#34;766&#34;
	srcset=&#34;https://antio2.cn/tech/glimmer_db_share/blog20231104132102_huc9e528549a5a1f72954162a817d6c3ec_104943_480x0_resize_box_3.png 480w, https://antio2.cn/tech/glimmer_db_share/blog20231104132102_huc9e528549a5a1f72954162a817d6c3ec_104943_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;151&#34;
		data-flex-basis=&#34;363px&#34;
	
&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>MIT6.824 | Scaling Memcache</title>
        <link>https://antio2.cn/tech/mit6.824/memcache/</link>
        <pubDate>Fri, 13 Oct 2023 01:13:07 +0800</pubDate>
        
        <guid>https://antio2.cn/tech/mit6.824/memcache/</guid>
        <description>&lt;p&gt;ç›®æ ‡&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ€§èƒ½&lt;/li&gt;
&lt;li&gt;ä¸€è‡´æ€§å’Œæ€§èƒ½ä¹‹é—´çš„å…³ç³»ã€‚è¿™ç¯‡è®ºæ–‡æ²¡æœ‰è¿½æ±‚å¼ºä¸€è‡´æ€§&lt;/li&gt;
&lt;li&gt;ä¸€è‡´æ€§åº¦é‡&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æ€§èƒ½&#34;&gt;æ€§èƒ½&lt;/h2&gt;
&lt;p&gt;ä¸ºäº†è·å–æ›´é«˜çš„æ€§èƒ½ï¼Œå¯ä»¥ä¸ºä¸åŒåˆ†ç‰‡çš„æ•°æ®åº“æ·»åŠ ç¼“å­˜.&lt;/p&gt;
&lt;p&gt;å†™æ•°æ®ç›´æ¥å†™åˆ°æ•°æ®åº“,è€Œè¯»æ“ä½œä¼šè¿›è¡Œç¼“å­˜.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/mit6.824/memcache/blog20231104225740.png&#34;
	width=&#34;835&#34;
	height=&#34;474&#34;
	srcset=&#34;https://antio2.cn/tech/mit6.824/memcache/blog20231104225740_hu844086c432cd165b45b7d46ebe391d26_220252_480x0_resize_box_3.png 480w, https://antio2.cn/tech/mit6.824/memcache/blog20231104225740_hu844086c432cd165b45b7d46ebe391d26_220252_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;176&#34;
		data-flex-basis=&#34;422px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;é”®å€¼æœåŠ¡å™¨æœ¬èº«æ˜¯KVæœåŠ¡å™¨ï¼Œå¤šä¸ªæœåŠ¡å™¨è¿è¡Œmemcached daemon,å½¢æˆä¸€ä¸ªé›†ç¾¤ã€‚&lt;/p&gt;
&lt;p&gt;æŒ‘æˆ˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚ä½•ä¿è¯DBå’ŒCacheçš„ç¼“å­˜ä¸€è‡´æ€§ï¼Ÿ&lt;/li&gt;
&lt;li&gt;å¦‚ä½•ä¿è¯æ•°æ®åº“ä¸è¶…è½½ï¼Ÿå½“ç¼“å­˜å®•æœºï¼Œå‰ç«¯å°†æ•°æ®è®¿é—®éƒ½è½¬åˆ°DBä¸Šï¼Œå¦‚ä½•é¿å…è¿™ç§æƒ…å†µã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æœ€ç»ˆä¸€è‡´æ€§&#34;&gt;æœ€ç»ˆä¸€è‡´æ€§&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å†™å…¥æ˜¯æœ‰åºçš„ï¼Œéƒ½æ˜¯é€šè¿‡databaseè¿›è¡Œçš„ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;readåˆ°è¿‡æœŸçš„æ•°æ®æ˜¯å¯ä»¥æ¥å—çš„ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½†æ˜¯å®¢æˆ·ç«¯åº”è¯¥å¯ä»¥è¯»å–åˆ°è‡ªå·±æ›´æ–°çš„æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;æ¯”å¦‚ä½ ä¿®æ”¹äº†QQå¤´åƒï¼Œä½ è‡ªå·±èƒ½ç«‹å³è§åˆ°ï¼Œä½†æ˜¯ä½ çš„å¥½å‹å¯èƒ½éš”ä¸€åˆ†é’Ÿæ‰è§‚å¯Ÿåˆ°æ›´æ–°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ç¼“å­˜å¤±æ•ˆæ–¹æ¡ˆ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚ä½¿ç”¨MySQLä¸ºDBã€‚é€šè¿‡squealè§‚å¯ŸLOG,å“ªäº›é”®è¢«ä¿®æ”¹äº†.å¦‚æœé”®kè¢«ä¿®æ”¹ï¼Œå°±å‘ç¼“å­˜é›†ç¾¤å‘é€ä¿¡æ¯ï¼šdelete k.è¿™æ ·åœ¨å®¢æˆ·ç«¯ä¸‹æ¬¡è¯»å–æ—¶ï¼Œå°±ä¼šå‡ºç°ç¼“å­˜ä¸å‘½ä¸­ï¼Œç„¶åé‡æ–°ç¼“å­˜ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœç”¨æˆ·åœ¨å‘å‡ºä¿®æ”¹è¯·æ±‚åï¼Œä¸‹ä¸€æ¬¡è¯·æ±‚å‰ï¼Œå°†ç¼“å­˜å¤±æ•ˆï¼Œå°±å¯ä»¥å®ç°â€œå®¢æˆ·ç«¯åº”è¯¥å¯ä»¥ç«‹å³è¯»å–åˆ°è‡ªå·±æ›´æ–°çš„æ•°æ®â€ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä¸ºä»€ä¹ˆä¸ç›´æ¥æ›´æ–°ç¼“å­˜è€Œæ˜¯å°†å°±ç¼“å­˜å¤±æ•ˆå‘¢&#34;&gt;&lt;strong&gt;ä¸ºä»€ä¹ˆä¸ç›´æ¥æ›´æ–°ç¼“å­˜ï¼Œè€Œæ˜¯å°†å°±ç¼“å­˜å¤±æ•ˆå‘¢ï¼Ÿ&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;ä¿è¯ç¼“å­˜ä¸ä¼šä¸€ç›´æ˜¯æ—§æ•°æ®ï¼Œè€Œä¸èƒ½æ›´æ–°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/mit6.824/memcache/blog20231104232549.png&#34;
	width=&#34;704&#34;
	height=&#34;410&#34;
	srcset=&#34;https://antio2.cn/tech/mit6.824/memcache/blog20231104232549_hudcdd43bc8dd77ab1dc3714cdb0d2551d_95554_480x0_resize_box_3.png 480w, https://antio2.cn/tech/mit6.824/memcache/blog20231104232549_hudcdd43bc8dd77ab1dc3714cdb0d2551d_95554_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;171&#34;
		data-flex-basis=&#34;412px&#34;
	
&gt;&lt;/p&gt;
&lt;h2 id=&#34;ä¼˜åŒ–&#34;&gt;ä¼˜åŒ–&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/mit6.824/memcache/blogimage-20231104233046513.png&#34;
	width=&#34;745&#34;
	height=&#34;415&#34;
	srcset=&#34;https://antio2.cn/tech/mit6.824/memcache/blogimage-20231104233046513_hu6715ea725cec465a2cb709d69e827b89_166150_480x0_resize_box_3.png 480w, https://antio2.cn/tech/mit6.824/memcache/blogimage-20231104233046513_hu6715ea725cec465a2cb709d69e827b89_166150_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20231104233046513&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;179&#34;
		data-flex-basis=&#34;430px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;è¿™é‡Œä½¿ç”¨ä¸¤ä¸ªæ•°æ®ä¸­å¿ƒï¼Œä¸»ä»æ¨¡å¼ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€æœ‰çš„å†™éƒ½éœ€è¦å†™åˆ°è¥¿æµ·å²¸ï¼ˆPrimaryï¼‰,ç„¶åé€šè¿‡åŒæ­¥æœºåˆ¶ç»™backupæ•°æ®åº“ã€‚åœ¨ä¸œæµ·å²¸ï¼ˆbackupï¼‰çš„æ•°æ®ä¸­å¿ƒè§‚å¯Ÿåˆ°æ”¹å˜ï¼Œå°†ç¼“å­˜å¤±æ•ˆçš„ä¿¡æ¯å‘é€ç»™è‡ªå·±æ•°æ®ä¸­å¿ƒçš„memcachedã€‚è¿™æ ·ï¼Œä¸œæµ·å²¸çš„ç”¨æˆ·åœ¨è¯»æ“ä½œæ—¶ï¼Œå¯ä»¥å…ˆè®¿é—®æ‰€åœ¨åŒºåŸŸçš„memcachedã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä¸ºä»€ä¹ˆä¸é€šè¿‡å‰ç«¯å‘é€ç¼“å­˜å¤±æ•ˆè€Œæ˜¯squealå‘é€&#34;&gt;ä¸ºä»€ä¹ˆä¸é€šè¿‡å‰ç«¯å‘é€ç¼“å­˜å¤±æ•ˆï¼Œè€Œæ˜¯squealå‘é€ï¼Ÿ&lt;/h3&gt;
&lt;h3 id=&#34;ç¼“å­˜ç»“æ„çš„é€‰æ‹©&#34;&gt;ç¼“å­˜ç»“æ„çš„é€‰æ‹©&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;åˆ†åŒºã€‚å°†keyåˆ†åˆ°æ›´å¤šåŒºé‡Œé¢&lt;/li&gt;
&lt;li&gt;å¤åˆ¶ã€‚è§£å†³äº†Hotkeyé—®é¢˜&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¯ä»¥å°†ä¸å¤ªçƒ­é—¨çš„é”®å•ç‹¬æ”¾åœ¨ä¸€ä¸ªpoolä¸­ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¿æŠ¤æ•°æ®åº“&#34;&gt;ä¿æŠ¤æ•°æ®åº“&lt;/h2&gt;
&lt;h3 id=&#34;æ–°é›†ç¾¤&#34;&gt;æ–°é›†ç¾¤&lt;/h3&gt;
&lt;p&gt;å¦‚æœä¸€ä¸ªæ–°é›†ç¾¤åŠ å…¥ï¼Œæ‰€æœ‰çš„è¯»éƒ½è¦ç»è¿‡æ•°æ®åº“ï¼ˆå› ä¸ºæ²¡æœ‰ç¼“å­˜ï¼‰ã€‚è§£å†³æ–¹æ³•æ˜¯ä»æ—§é›†ç¾¤çš„ç¼“å­˜å¤åˆ¶è¿‡æ¥ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æƒŠç¾¤&#34;&gt;æƒŠç¾¤&lt;/h3&gt;
&lt;p&gt;å‡å¦‚åˆ é™¤äº†ä¸€ä¸ªhotkey,ç„¶ååœ¨åŒä¸€æ—¶é—´ï¼Œå¾ˆå¤šä¸ªå‰ç«¯è®¿é—®è¯¥hot keyå¹¶ä¸”å‘ç°ç¼“å­˜ä¸å‘½ä¸­ï¼Œå°±ä¼šåŒæ—¶å‘æ•°æ®åº“å‘é€å¾ˆå¤šä¸ªget hotkeyçš„è¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;è§£å†³æ–¹æ³•ï¼š ä½¿ç”¨ç§Ÿçº¦, å½“ç¬¬ä¸€ä¸ªå®¢æˆ·ç«¯å‘ç°ç¼“å­˜ä¸å‘½ä¸­ï¼Œå®ƒä¼šå»è´Ÿè´£æ›´æ–°ç¼“å­˜ï¼Œè€Œå…¶ä»–çš„å®¢æˆ·ç«¯å‘ç°å·²ç»æœ‰äº†ç§Ÿçº¦ï¼Œå°±ä¼šç­‰å¾…ï¼Œå¹¶ä¸”é‡è¯•è®¿é—®ç¼“å­˜ã€‚&lt;/p&gt;
&lt;h3 id=&#34;memcachedå¤±æ•ˆ&#34;&gt;memcachedå¤±æ•ˆ&lt;/h3&gt;
&lt;p&gt;å¦‚æœåªæ˜¯å°‘æ•°å‡ ä¸ª server å› ä¸ºç½‘ç»œåŸå› å¤±è”ï¼Œåˆ™ä¾èµ–äºä¸€ç§è‡ªåŠ¨æ¢å¤æœºåˆ¶ï¼Œé€šå¸¸æ¢å¤éœ€è¦å‡ åˆ†é’Ÿæ—¶é—´ï¼Œä½†å‡ åˆ†é’Ÿå°±æœ‰å¯èƒ½å°† DB å’Œåå°æœåŠ¡å‡»å®ã€‚ä¸ºæ­¤ï¼Œ FB å›¢é˜Ÿä¸“é—¨ç”¨å°‘é‡çš„æœºå™¨é…ç½®ä¸€ä¸ªå°çš„ memcache é›†ç¾¤ï¼Œç§°ä¸º Gutterã€‚å½“é›†ç¾¤å†…éƒ¨å°‘é‡çš„ server å‘ç”Ÿæ•…éšœæ—¶ï¼Œmemcached client ä¼šå°†è¯·æ±‚å…ˆè½¬å‘åˆ° Gutter ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;gutterä¹Ÿå°±æ˜¯åå¤‡çš„ï¼ŒçŸ­æ—¶é—´æœåŠ¡å™¨é›†ç¾¤ã€‚&lt;/p&gt;
</description>
        </item>
        <item>
        <title>MIT6.824 | Spark</title>
        <link>https://antio2.cn/tech/mit6.824/spark/</link>
        <pubDate>Thu, 12 Oct 2023 01:11:40 +0800</pubDate>
        
        <guid>https://antio2.cn/tech/mit6.824/spark/</guid>
        <description>&lt;img src="https://antio2.cn/tech/mit6.824/spark/blogimage-20231014013510461.png" alt="Featured image of post MIT6.824 | Spark" /&gt;&lt;h2 id=&#34;rdd&#34;&gt;RDD&lt;/h2&gt;
&lt;p&gt;å¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†:&lt;em&gt;resilient distributed datasets (RDDs)&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/mit6.824/spark/blogimage-20231014005757469.png&#34;
	width=&#34;1920&#34;
	height=&#34;1021&#34;
	srcset=&#34;https://antio2.cn/tech/mit6.824/spark/blogimage-20231014005757469_hudafa4b03a0ddbf92e56f10f74f099a23_736365_480x0_resize_box_3.png 480w, https://antio2.cn/tech/mit6.824/spark/blogimage-20231014005757469_hudafa4b03a0ddbf92e56f10f74f099a23_736365_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20231014005757469&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;188&#34;
		data-flex-basis=&#34;451px&#34;
	
&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;spark.textFileåˆ›å»ºä¸€ä¸ªRDD(å¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;RDDæœ‰ä¸¤ç±»API:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Transformation: å› ä¸ºRDDæ˜¯åªè¯»çš„ï¼Œè¿™ç±»æ“ä½œç”Ÿæˆä¸€ä¸ªæ–°çš„RDD,æ¯”å¦‚ç¬¬äºŒæ’ç”Ÿæˆä¸€ä¸ªerrorçš„RDD&lt;/li&gt;
&lt;li&gt;Action: åœ¨è¯¥RDDä¸Šè¿›è¡Œä¸€äº›è®¡ç®—ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯ä»¥çœ‹å‡ºæ¥ï¼ŒRDDçš„APIå¯ä»¥å®Œæˆ&lt;strong&gt;map&lt;/strong&gt;(é€šè¿‡transformation)&lt;strong&gt;reduce&lt;/strong&gt;(action)æ“ä½œ&lt;/p&gt;
&lt;p&gt;è¿™äº›æ“ä½œæ˜¯æµæ°´çº¿çš„ã€‚ï¼ˆç±»ä¼¼äºDBä¸­çš„ç«å±±æ¨¡å‹ï¼‰&lt;/p&gt;
&lt;p&gt;&lt;code&gt;errors.persist()&lt;/code&gt;å…è®¸è®°å½•åœ¨å†…å­˜ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œæœ‰ä¸¤ç§ä¾èµ–ï¼šå®½ä¾èµ–å’Œçª„ä¾èµ–ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/mit6.824/spark/blogimage-20231014011201500.png&#34;
	width=&#34;497&#34;
	height=&#34;228&#34;
	srcset=&#34;https://antio2.cn/tech/mit6.824/spark/blogimage-20231014011201500_hu22c8a5c0bf2205f7535b548756f6ed7a_61264_480x0_resize_box_3.png 480w, https://antio2.cn/tech/mit6.824/spark/blogimage-20231014011201500_hu22c8a5c0bf2205f7535b548756f6ed7a_61264_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20231014011201500&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;217&#34;
		data-flex-basis=&#34;523px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;çª„ä¾èµ–åªä¾èµ–ä¸€ä¸ªçˆ¶åˆ†åŒºï¼Œå¦åˆ™å°±æ˜¯å®½ä¾èµ–ã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œæˆ‘çš„ç†è§£å°±æ˜¯ï¼šç±»ä¼¼äºæ‰§è¡Œå› å­ï¼Œ&lt;code&gt;sort()&lt;/code&gt;å¿…é¡»å­æ‰§è¡Œå› ä¸ºå®Œäº†æ‰èƒ½æ‰§è¡Œå‡ºæ­£ç¡®ç»“æœï¼ˆå¥½åƒæœ¯è¯­å«é˜»å¡ï¼‰&lt;/p&gt;
&lt;p&gt;è€Œ&lt;code&gt;filter(predict)&lt;/code&gt;è¿™ç§å¯ä»¥æ¥ä¸€ä¸ªå°±æ‰§è¡Œä¸€ä¸ªï¼Œä¸ä¼šé˜»å¡ä½æµæ°´çº¿ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å®¹é”™&#34;&gt;å®¹é”™&lt;/h2&gt;
&lt;p&gt;Crash of Worker:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸¢å¤±åˆ†åŒº&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;scheduleré‡åšstage(ä»¥å®½ä¾èµ–ä¸ºç•Œ)ã€‚&lt;/p&gt;
&lt;p&gt;å®½ä¾èµ–å®¹é”™ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/mit6.824/spark/blogimage-20231014013130127.png&#34;
	width=&#34;824&#34;
	height=&#34;462&#34;
	srcset=&#34;https://antio2.cn/tech/mit6.824/spark/blogimage-20231014013130127_hu1a0231e9d31706c9ace11aa4da65d5d4_196897_480x0_resize_box_3.png 480w, https://antio2.cn/tech/mit6.824/spark/blogimage-20231014013130127_hu1a0231e9d31706c9ace11aa4da65d5d4_196897_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20231014013130127&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;178&#34;
		data-flex-basis=&#34;428px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;å¦‚æœä¸€ä¸ªå®½ä¾èµ–çš„è®¡ç®—å¤±è´¥äº†ï¼Œä¼šè¦æ±‚å¤šä¸ªçˆ¶åˆ†åŒºé‡æ–°è®¡ç®—ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½¿ç”¨checkpointï¼Œå°†æ•´ä¸ªRDDå†™å…¥HDFSã€‚(å’Œå•çº¯æ”¾å…¥å†…å­˜ä¸­ä¸åŒ)&lt;/p&gt;
&lt;h2 id=&#34;è¿­ä»£è®¡ç®—pagerank&#34;&gt;è¿­ä»£è®¡ç®—ï¼šPageRank&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/mit6.824/spark/blogimage-20231014013510461.png&#34;
	width=&#34;712&#34;
	height=&#34;444&#34;
	srcset=&#34;https://antio2.cn/tech/mit6.824/spark/blogimage-20231014013510461_hud2de661491b62cfa7da54cfbaa20fcf4_39103_480x0_resize_box_3.png 480w, https://antio2.cn/tech/mit6.824/spark/blogimage-20231014013510461_hud2de661491b62cfa7da54cfbaa20fcf4_39103_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20231014013510461&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;160&#34;
		data-flex-basis=&#34;384px&#34;
	
&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-scala&#34; data-lang=&#34;scala&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;val&lt;/span&gt; links &lt;span style=&#34;color:#66d9ef&#34;&gt;=&lt;/span&gt; spark&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;textFile&lt;span style=&#34;color:#f92672&#34;&gt;(...).&lt;/span&gt;map&lt;span style=&#34;color:#f92672&#34;&gt;(...).&lt;/span&gt;persist&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; ranks &lt;span style=&#34;color:#66d9ef&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// RDD of (URL, rank) pairs
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;i &lt;span style=&#34;color:#66d9ef&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; to &lt;span style=&#34;color:#a6e22e&#34;&gt;ITERATIONS&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Build an RDD of (targetURL, float) pairs
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// with the contributions sent by each page
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;val&lt;/span&gt; contribs &lt;span style=&#34;color:#66d9ef&#34;&gt;=&lt;/span&gt; links&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;join&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;ranks&lt;span style=&#34;color:#f92672&#34;&gt;).&lt;/span&gt;flatMap &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;url&lt;span style=&#34;color:#f92672&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;links&lt;span style=&#34;color:#f92672&#34;&gt;,&lt;/span&gt; rank&lt;span style=&#34;color:#f92672&#34;&gt;))&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;=&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;links&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;map&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;dest &lt;span style=&#34;color:#66d9ef&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;dest&lt;span style=&#34;color:#f92672&#34;&gt;,&lt;/span&gt; rank&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;links&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;size&lt;span style=&#34;color:#f92672&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Sum contributions by URL and get new ranks
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;ranks &lt;span style=&#34;color:#66d9ef&#34;&gt;=&lt;/span&gt; contribs&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;reduceByKey&lt;span style=&#34;color:#f92672&#34;&gt;((&lt;/span&gt;x&lt;span style=&#34;color:#f92672&#34;&gt;,&lt;/span&gt;y&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;=&amp;gt;&lt;/span&gt; x&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;y&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;mapValues&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;sum &lt;span style=&#34;color:#66d9ef&#34;&gt;=&amp;gt;&lt;/span&gt; a&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;N &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;a&lt;span style=&#34;color:#f92672&#34;&gt;)*&lt;/span&gt;sum&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;linksæ¯æ¬¡è¿­ä»£å’Œranksè¿›è¡Œjoinæ“ä½œï¼Œç„¶åç”Ÿæˆä¸€ä¸ª(dest,rank/links.size)çš„mapï¼Œå°±æ˜¯ç¬¬ä¸€æ¬¡è¿­ä»£destæ”¶åˆ°çš„æƒé‡ã€‚&lt;/p&gt;
&lt;p&gt;ä¼˜åŒ–ï¼šæ¯ä¸ªcontribséƒ½è¦è¿›è¡Œjoinæ“ä½œã€‚å¯ä»¥ä½¿ç”¨hashå¯¹linkså’Œranksåˆ†ç»„ã€‚ï¼ˆç±»ä¼¼äºhash joinçš„ç¬¬ä¸€æ¬¡åˆ†åŒºï¼‰ï¼Œç„¶åå†è¿›è¡Œä¸€æ¬¡joinï¼ˆåªå¯¹ç›¸åŒå“ˆå¸Œçš„åˆ†åŒºï¼‰ï¼Œè¿™æ ·å°±ä¼˜åŒ–æˆäº†çª„ä¾èµ–ã€‚&lt;/p&gt;
&lt;p&gt;â€‹&lt;/p&gt;
</description>
        </item>
        <item>
        <title>MIT6.824 | FaRM, Optimistic Concurrency Control</title>
        <link>https://antio2.cn/tech/mit6.824/farm/</link>
        <pubDate>Thu, 12 Oct 2023 01:09:39 +0800</pubDate>
        
        <guid>https://antio2.cn/tech/mit6.824/farm/</guid>
        <description>&lt;h1 id=&#34;mit6824-farm-optimistic-concurrency-control&#34;&gt;[MIT6.824] FaRM, Optimistic Concurrency Control&lt;/h1&gt;
&lt;p&gt;ç‰¹å¾ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Fa:é«˜æ€§èƒ½Txn&lt;/li&gt;
&lt;li&gt;R:  remoteä½¿ç”¨Kernel-bypasså’ŒRDMA(å…è®¸ç½‘å¡ä»è¿œç¨‹æœåŠ¡å™¨è¯»å†…å­˜)&lt;/li&gt;
&lt;li&gt;M: NVDRAM(æ¶ˆé™¤ç¡¬ç›˜ç“¶é¢ˆ)&lt;/li&gt;
&lt;li&gt;OCC: ä¹è§‚å¹¶å‘æ§åˆ¶&lt;/li&gt;
&lt;li&gt;Research Prototype: FaRMæ­£åœ¨ç ”ç©¶ä¸­ï¼Œä¸åƒSpannerä¸€æ ·å¤§è§„æ¨¡ä½¿ç”¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;setup&#34;&gt;Setup&lt;/h2&gt;
&lt;p&gt;æ‰€æœ‰çš„æœºå™¨éƒ½åœ¨ä¸€ä¸ªæ•°æ®ä¸­å¿ƒä¸­ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/mit6.824/farm/blogimage-20231012204831955.png&#34;
	width=&#34;748&#34;
	height=&#34;437&#34;
	srcset=&#34;https://antio2.cn/tech/mit6.824/farm/blogimage-20231012204831955_hu9be5985988f5fd42150ee15086013a19_153317_480x0_resize_box_3.png 480w, https://antio2.cn/tech/mit6.824/farm/blogimage-20231012204831955_hu9be5985988f5fd42150ee15086013a19_153317_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20231012204831955&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;171&#34;
		data-flex-basis=&#34;410px&#34;
	
&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;replicaåœ¨DRAMä¸­ï¼Œå¦‚æœæŸå°æœºå™¨å´©æºƒæ‰äº†ï¼Œæ•…éšœæ¢å¤ä¼šå°†backupä½œä¸ºprimaryæ¢å¤ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸€ä¸ªä½¿ç”¨Zookeeperçš„é…ç½®ç®¡ç†å™¨ï¼ˆCMï¼‰è´Ÿè´£è®°å½•åˆ†ç‰‡åˆ°ä¸»ä»æœåŠ¡å™¨çš„æ˜ å°„ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœæ•°æ®ä¸­å¿ƒç”µæºå…¨éƒ½æ‹‰é—¸ï¼Œå› ä¸ºå†…å­˜ä¸¢å¤±ï¼Œæ˜¯æ— æ³•æ¢å¤çš„ã€‚ä¸ºäº†è§£å†³é—®é¢˜ï¼Œæ¯å°æœåŠ¡å™¨é…ä¸€ä¸ªç‹¬ç«‹çš„ç”µæºã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœå‘ç”Ÿæ–­ç”µï¼Œæœºå™¨æœ‰è¶³å¤Ÿçš„æ—¶é—´ä½¿ç”¨ç”µæ± å°†å†…å­˜ä¸Šçš„æ—¥å¿—ã€äº‹åŠ¡çŠ¶æ€åˆ·æ–°åˆ°SSDä¸Šé¢ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å­˜å‚¨çš„objectæœ‰ä¸€ä¸ªå”¯ä¸€çš„oidï¼Œoidç”±region numberå’Œaddress(objectåœ¨æ‰€åœ¨åŒºåŸŸçš„åç§»é‡)ç»‘å®šã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨æ¯ä¸ªå¯¹è±¡çš„64ä½å¤´ä¸­ï¼Œå­˜å‚¨63ä½ç‰ˆæœ¬å·ï¼Œå’Œ1ä¸ªé”ä½ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;api&#34;&gt;API&lt;/h2&gt;
&lt;p&gt;æ“ä½œä¸€ä¸ªå¯¹è±¡ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Tx Begin.
&lt;ul&gt;
&lt;li&gt;read(oid) : è¯»å–å¯¹è±¡&lt;/li&gt;
&lt;li&gt;o.f += 1 ä¿®æ”¹å¯¹è±¡&lt;/li&gt;
&lt;li&gt;write(oid, o) å†™å›å¯¹è±¡&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;TX Commit.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½¿ç”¨ç±»ä¼¼2PCçš„æœºåˆ¶æ¥æäº¤äº‹åŠ¡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¸€äº›æŠ€æœ¯&#34;&gt;ä¸€äº›æŠ€æœ¯&lt;/h2&gt;
&lt;h3 id=&#34;kernel-bypass&#34;&gt;Kernel-bypass&lt;/h3&gt;
&lt;p&gt;é€šå¸¸ï¼Œåº”ç”¨ç¨‹åºé€šè¿‡è°ƒç”¨å†…æ ¸ä½¿ç”¨ç½‘å¡ã€‚æ¯”å¦‚é€šè¿‡è°ƒç”¨å†…æ ¸ä½¿å…¶å‘é€åŒ…æˆ–å†…æ ¸è¯»å–ç½‘å¡ä¸Šçš„å¯„å­˜å™¨ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡å†…æ ¸æ—è·¯ï¼Œå°†ç½‘å¡ä¸Šçš„å‘é€é˜Ÿåˆ—å’Œæ¥æ”¶é˜Ÿåˆ—ç­‰ç›´æ¥æ˜ å°„åˆ°åº”ç”¨ç¨‹åºçš„åœ°å€ç©ºé—´ä¸Šï¼Œç”¨æˆ·ç¨‹åºå¯ä»¥ç›´æ¥è¯»å†™ç½‘å¡è€Œä¸é€šè¿‡OSã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†é¿å…ç»ˆç«¯ï¼ŒFaRMå¯åŠ¨ä¸€ä¸ªçº¿ç¨‹è½®è¯¢ç½‘å¡é˜Ÿåˆ—ã€‚&lt;/p&gt;
&lt;h3 id=&#34;rdma--remote-direct-memory-access&#34;&gt;RDMA ï¼š Remote direct Memory access&lt;/h3&gt;
&lt;p&gt;é€šè¿‡å‘é€RDMAåŒ…ï¼Œå¯ä»¥è¿œç¨‹è¯»å†™å¦ä¸€å°æœºå™¨çš„å†…å­˜ã€‚&lt;/p&gt;
&lt;p&gt;Logå’ŒTxn(æäº¤è®°å½•ã€æ—¥å¿—è®°å½•ç­‰)é€šè¿‡RDMAå†™å…¥ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡RDMAå®ç°RPC Call: åœ¨å‘é€æ–¹çš„ç¨‹åºå†™RDMAåŒ…ï¼Œå°†æ•°æ®é€šè¿‡RDMAå†™å…¥è¿œç¨‹æ¶ˆæ¯é˜Ÿåˆ—ã€‚åœ¨æ¥æ”¶æ–¹è½®è¯¢æ¶ˆæ¯é˜Ÿåˆ—ï¼Œç„¶åé€šè¿‡å†™RDMAå›å¤ã€‚ä½¿ç”¨RDMAæ¯”RPCå¼€é”€æ›´å°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/mit6.824/farm/blogimage-20231012211143148.png&#34;
	width=&#34;836&#34;
	height=&#34;459&#34;
	srcset=&#34;https://antio2.cn/tech/mit6.824/farm/blogimage-20231012211143148_hud5c8139a16df288c8c2f53e75af3dcf7_214078_480x0_resize_box_3.png 480w, https://antio2.cn/tech/mit6.824/farm/blogimage-20231012211143148_hud5c8139a16df288c8c2f53e75af3dcf7_214078_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20231012211143148&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;182&#34;
		data-flex-basis=&#34;437px&#34;
	
&gt;&lt;/p&gt;
&lt;h2 id=&#34;ä½¿ç”¨rdmaæ¥å®ç°äº‹åŠ¡&#34;&gt;ä½¿ç”¨RDMAæ¥å®ç°äº‹åŠ¡&lt;/h2&gt;
&lt;p&gt;å¦‚ä½•ä½¿ç”¨RDMAè¿›è¡Œäº‹åŠ¡ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Protocols for TXN, RPC..&lt;/p&gt;
&lt;p&gt;æ¯ä¸ªæœåŠ¡å™¨éƒ½éœ€è¦è¿›è¡Œã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä½¿ç”¨ä¹è§‚å¹¶å‘æ§åˆ¶ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;read objects without lock&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å½“è¯»å–æŸä¸ªå¯¹è±¡æ—¶ï¼ŒåŒæ—¶è·å–å…¶Version&lt;/p&gt;
&lt;p&gt;å½“commitï¼Œæ£€æŸ¥å¼€å§‹å†™çš„å¯¹è±¡ï¼Œç‰ˆæœ¬å·æ˜¯å¦å·²ç»è¢«æ”¹å˜ã€‚å¦‚æœäº‹åŠ¡ç¼–å·ä¸åŒï¼Œäº‹åŠ¡ä¸­æ­¢ã€‚å¦‚æœç›¸åŒï¼Œåˆ™commitã€‚&lt;/p&gt;
&lt;p&gt;äº‹åŠ¡åè°ƒå™¨æ˜¯åœ¨åŒä¸€å°æœºå™¨ä¸Šçš„åº”ç”¨ç¨‹åºã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/mit6.824/farm/blogimage-20231012220037747.png&#34;
	width=&#34;763&#34;
	height=&#34;455&#34;
	srcset=&#34;https://antio2.cn/tech/mit6.824/farm/blogimage-20231012220037747_hu4e1dd53004440f8199e94043821135bc_268282_480x0_resize_box_3.png 480w, https://antio2.cn/tech/mit6.824/farm/blogimage-20231012220037747_hu4e1dd53004440f8199e94043821135bc_268282_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20231012220037747&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;167&#34;
		data-flex-basis=&#34;402px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;åœ¨æ‰§è¡Œäº‹åŠ¡æœŸé—´&lt;/strong&gt;ï¼ŒTXNä»3ä¸ªåˆ†ç‰‡è¿›è¡Œè¯»å–ã€‚ åœ¨ç¤ºä¾‹å›¾é‡Œï¼Œ1å’Œ2è¢«ä¿®æ”¹ï¼Œ3åªè¯»ã€‚è™šçº¿æ˜¯è¯»å–RDMAï¼Œå®ç°æ˜¯å†™RDMA&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;åœ¨æäº¤é˜¶æ®µ&lt;/strong&gt;ï¼šè¿›è¡Œå¦‚ä¸‹è¿‡ç¨‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Lock, äº‹åŠ¡å°è¯•è·å–å†™å…¥å¯¹è±¡çš„é”ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;åœ¨Primaryä¸Šï¼Œå°†Lockè®°å½•åˆ°Logä¸­ã€‚åŒ…å«oid, number, time, objectçš„æ–°å€¼ã€‚&lt;/p&gt;
&lt;p&gt;å½“P1æˆ–P2ä¸Šçš„è½®è¯¢çº¿ç¨‹çœ‹åˆ°æ–°çš„Logï¼Œå°è¯•è·å–Lock Logä¸­çš„é”ã€‚é€šè¿‡TASæ“ä½œè·å–é”ï¼Œå¦‚æœè·å–å¤±è´¥ï¼Œè¿”å›ä¸€æ¡RDMAæ¶ˆæ¯ï¼ŒTC abort è¿™ä¸ªäº‹åŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œé‡‡ç”¨no waitæ˜¯å› ä¸ºï¼Œå¦‚æœåŠ é”å¤±è´¥ï¼Œæ„å‘³è¯¥äº‹åŠ¡è¯»åˆ°äº†æ—§çš„å¯¹è±¡ï¼ˆè¯¥å¯¹è±¡å·²ç»è¢«å‰ä¸€ä¸ªäº‹åŠ¡åŠ é”å°è¯•ä¿®æ”¹ï¼‰ï¼Œè¿åäº†ä¸²è¡ŒåŒ–ã€‚&lt;/p&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;
&lt;p&gt;Validate: å¯¹äºåªè¯»çš„æ•°æ®ï¼Œè¿›è¡Œå•è¾¹çš„&lt;strong&gt;è¯»&lt;/strong&gt;RDMAã€‚æ³¨æ„ï¼šè¯»RDMAæ¯”å†™RDMAå¼€é”€å°ã€‚å› ä¸ºä¹‹å‰æåˆ°è¿‡ï¼Œ&lt;em&gt;åœ¨æ¯ä¸ªå¯¹è±¡çš„64ä½å¤´ä¸­ï¼Œå­˜å‚¨63ä½ç‰ˆæœ¬å·ï¼Œå’Œ1ä¸ªé”ä½ã€‚&lt;/em&gt; å¦‚æœè¯¥é”ä½è¢«è®¾ç½®ï¼Œè¯´æ˜è¯¥å¯¹è±¡æ­£åœ¨è¢«å…¶ä»–äº‹åŠ¡å°è¯•ä¿®æ”¹ã€‚å¦‚æœç‰ˆæœ¬å·æ”¹å˜ï¼Œä¹Ÿä¸­æ­¢äº‹åŠ¡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Commit Backup: å°†æ—¥å¿—å†™å…¥å¤‡ä»½(B1, B2) å¤‡ä»½æœåŠ¡å™¨æ­¤æ—¶ä¸éœ€è¦è¿è¡Œä»»ä½•æ“ä½œã€‚ç„¶åTCç¡®è®¤Backupå·²ç»å†™å…¥Logã€‚æ³¨æ„Primaryä¸ç›´æ¥å’ŒBackupé€šä¿¡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Commit Primary: å°†Logsé€šè¿‡RDMAå†™å…¥primary logsï¼Œ å¹¶é™„åŠ ä¸€æ¡commit RDMAã€‚ä¸€æ—¦ä¸€ä¸ªç½‘å¡ç¡®è®¤äº†&lt;strong&gt;æäº¤&lt;/strong&gt;ï¼Œå°±æ˜¯çœŸæ­£çš„æäº¤ç‚¹ã€‚å°±å¯ä»¥åº”ç”¨æ›´æ–°&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Truncate: è¿›è¡Œæ—¥å¿—æˆªæ–­ç­‰å·¥ä½œã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;TCé€šè¿‡ZookeeperçŸ¥é“æ€ä¹ˆè”ç³»Primaryå’ŒBackupã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¦‚ä½•å®ç°ä¸¥æ ¼çš„ä¸²è¡ŒåŒ–&#34;&gt;&lt;strong&gt;å¦‚ä½•å®ç°ä¸¥æ ¼çš„ä¸²è¡ŒåŒ–ï¼š&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;æ‰€æœ‰è¯»çš„æ•°æ®ï¼Œåœ¨è·å–é”æ—¶æ£€æŸ¥ç‰ˆæœ¬æ˜¯å¦ä¸€è‡´å¹¶ä¸”èƒ½å¦è·å–é”ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äº&lt;strong&gt;åªè¯»äº‹åŠ¡ï¼š&lt;/strong&gt; å¯ä»¥åªæ˜¯ç”¨ä¸¤ä¸ªè¯»RDMA:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Execute é˜¶æ®µ è¯»å–æ•°æ®&lt;/li&gt;
&lt;li&gt;Commité˜¶æ®µ åªValidateç‰ˆæœ¬å·ã€‚åº”è¯¥ä¸éœ€è¦å†™å…¥Commit Log&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™æ ·å°±ä¿è¯äº†åªè¯»äº‹åŠ¡çš„é«˜æ€§èƒ½ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/mit6.824/farm/blogimage-20231012225636417.png&#34;
	width=&#34;624&#34;
	height=&#34;370&#34;
	srcset=&#34;https://antio2.cn/tech/mit6.824/farm/blogimage-20231012225636417_hu6809173374314481f08ad58e0e420c24_46826_480x0_resize_box_3.png 480w, https://antio2.cn/tech/mit6.824/farm/blogimage-20231012225636417_hu6809173374314481f08ad58e0e420c24_46826_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20231012225636417&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;168&#34;
		data-flex-basis=&#34;404px&#34;
	
&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>MIT6.824 | Lab 4: Sharded Key/Value Service</title>
        <link>https://antio2.cn/tech/mit6.824/lab4/</link>
        <pubDate>Sat, 07 Oct 2023 01:02:59 +0800</pubDate>
        
        <guid>https://antio2.cn/tech/mit6.824/lab4/</guid>
        <description>&lt;h2 id=&#34;part-a-the-shard-controller&#34;&gt;Part A: The Shard controller&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;This lab uses &amp;ldquo;configuration&amp;rdquo; to refer to the assignment of shards to replica groups. This is not the same as Raft cluster membership changes. You don&amp;rsquo;t have to implement Raft cluster membership changes.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;é€šè¿‡é…ç½®ï¼Œæ¥åˆ†é…åˆ†ç‰‡ç»™ä¸åŒçš„æœåŠ¡å™¨ç»„.ä¸€ç»„æœåŠ¡å™¨é€šè¿‡gid(group identifiers )æ¥å”¯ä¸€æ ‡è¯†ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Config&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;Num&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;              &lt;span style=&#34;color:#75715e&#34;&gt;// config number
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;Shards&lt;/span&gt; [&lt;span style=&#34;color:#a6e22e&#34;&gt;NShards&lt;/span&gt;]&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;     &lt;span style=&#34;color:#75715e&#34;&gt;// shard -&amp;gt; gid
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;Groups&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;map&lt;/span&gt;[&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;][]&lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// gid -&amp;gt; servers[]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Num: å½“å‰çš„é…ç½®ç¼–å·ï¼Œåˆå§‹åŒ–ä¸º0ï¼Œéšç€æ¯æ¬¡ä¿®æ”¹é…ç½®é€’å¢ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Shards [NShards]&lt;/code&gt; å­˜å‚¨æ¯ä¸ªshardè¢«åˆ†é…ç»™å“ªç»„æœåŠ¡å™¨å·¥ä½œã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Groups map[int][]string&lt;/code&gt; å­˜å‚¨gidå¯¹åº”çš„æœåŠ¡å™¨åˆ—è¡¨ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¤ç”¨ä»£ç &#34;&gt;å¤ç”¨ä»£ç &lt;/h3&gt;
&lt;p&gt;é€šè¿‡Lab3ä¸­ç±»ä¼¼çš„ä»£ç å¼€å§‹ã€‚&lt;/p&gt;
&lt;p&gt;è®¾ç½®å¸¸é‡ï¼šè¿™é‡Œå…¶å®å¯ä»¥ç”¨intï¼Œä½†æ˜¯ä¸ºäº†è°ƒè¯•æ–¹ä¾¿ï¼Œä½¿ç”¨å­—ç¬¦ä¸²&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;OpTypeT&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; (
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;OpJoin&lt;/span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;OpTypeT&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;OP_JOIN&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;OpLeave&lt;/span&gt;         = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;OP_LEAVE&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;OpMove&lt;/span&gt;          = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;OP_MOVE&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;OpQuery&lt;/span&gt;         = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;OP_QUERY&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ“ä½œçš„ç»“æ„ä½“ï¼Œå‘é€ç»™RAFT&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Op&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// Your data here.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;OpType&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;OpTypeT&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;OpArgs&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;interface&lt;/span&gt;{}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;CommandId&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;ClientId&lt;/span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;int64&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœåŠ¡å™¨çš„applymsgæ ¹æ®å›å¤å†…å®¹ä¸åŒè¿›è¡Œæ”¹å˜&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ApplyResult&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;WrongLeader&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;Err&lt;/span&gt;         &lt;span style=&#34;color:#a6e22e&#34;&gt;Err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;Cfg&lt;/span&gt;         &lt;span style=&#34;color:#a6e22e&#34;&gt;Config&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;Term&lt;/span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;CommandContext&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;CommandId&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;Reply&lt;/span&gt;     &lt;span style=&#34;color:#a6e22e&#34;&gt;ApplyResult&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ShardCtrler&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;      &lt;span style=&#34;color:#a6e22e&#34;&gt;sync&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Mutex&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;me&lt;/span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;raft&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Raft&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;applyCh&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;chan&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;raft&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ApplyMsg&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#75715e&#34;&gt;// Your data here.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;configs&lt;/span&gt;     []&lt;span style=&#34;color:#a6e22e&#34;&gt;Config&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// indexed by config num
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;clientReply&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;map&lt;/span&gt;[&lt;span style=&#34;color:#66d9ef&#34;&gt;int64&lt;/span&gt;]&lt;span style=&#34;color:#a6e22e&#34;&gt;CommandContext&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;replyChMap&lt;/span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;map&lt;/span&gt;[&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;]&lt;span style=&#34;color:#66d9ef&#34;&gt;chan&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ApplyResult&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// logçš„indexå¯¹åº”çš„è¿”å›ä¿¡æ¯ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;ConfigIdNow&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;freeGid&lt;/span&gt;     []&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// ç©ºé—²çš„gid
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;éšåå¼€å§‹åˆå§‹åŒ–æœåŠ¡å™¨ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;StartServer&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;servers&lt;/span&gt; []&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;labrpc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ClientEnd&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;me&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;persister&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;raft&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Persister&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ShardCtrler&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; new(&lt;span style=&#34;color:#a6e22e&#34;&gt;ShardCtrler&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;me&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;me&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;configs&lt;/span&gt; = make([]&lt;span style=&#34;color:#a6e22e&#34;&gt;Config&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;configs&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;].&lt;span style=&#34;color:#a6e22e&#34;&gt;Groups&lt;/span&gt; = &lt;span style=&#34;color:#66d9ef&#34;&gt;map&lt;/span&gt;[&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;][]&lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;{}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;labgob&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Register&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;Op&lt;/span&gt;{})
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;labgob&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Register&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;QueryArgs&lt;/span&gt;{})
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;labgob&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Register&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;LeaveArgs&lt;/span&gt;{})
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;labgob&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Register&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;JoinArgs&lt;/span&gt;{})
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;labgob&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Register&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;MoveArgs&lt;/span&gt;{})
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;applyCh&lt;/span&gt; = make(&lt;span style=&#34;color:#66d9ef&#34;&gt;chan&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;raft&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ApplyMsg&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;raft&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Make&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;servers&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;me&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;persister&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;applyCh&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#75715e&#34;&gt;// Your code here.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;clientReply&lt;/span&gt; = make(&lt;span style=&#34;color:#66d9ef&#34;&gt;map&lt;/span&gt;[&lt;span style=&#34;color:#66d9ef&#34;&gt;int64&lt;/span&gt;]&lt;span style=&#34;color:#a6e22e&#34;&gt;CommandContext&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;replyChMap&lt;/span&gt; = make(&lt;span style=&#34;color:#66d9ef&#34;&gt;map&lt;/span&gt;[&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;]&lt;span style=&#34;color:#66d9ef&#34;&gt;chan&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ApplyResult&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;freeGid&lt;/span&gt; = make([]&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;freeGid&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] = &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;go&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;handleApplyMsg&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ShardCtrler&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;handleApplyMsg&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å› ä¸ºqueryè¦æ ¹æ®ä¹‹å‰çš„indexè¿›è¡ŒæŒ‡å®šconfigçš„æŸ¥è¯¢ï¼Œæ‰€ä»¥ä¸ç”¨è¿›è¡Œå¿«ç…§å‹ç¼©ã€‚&lt;/p&gt;
&lt;p&gt;apply msgä¹Ÿåªéœ€è¦å¤„ç†å‘½ä»¤å°±å¥½äº†&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ShardCtrler&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;handleApplyMsg&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; !&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Killed&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;applymsg&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;applyCh&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;applymsg&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;CommandValid&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;applyCommand&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;applymsg&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       panic(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Invalid Apply Msg&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ShardCtrler&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;Killed&lt;/span&gt;() &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ShardCtrler&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;applyCommand&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;applymsg&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;raft&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ApplyMsg&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;applyResult&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ApplyResult&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;op&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;applymsg&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Command&lt;/span&gt;.(&lt;span style=&#34;color:#a6e22e&#34;&gt;Op&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;applyResult&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Term&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;applymsg&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;CommandTerm&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;switch&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;op&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;OpType&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;OpJoin&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;op&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;OpArgs&lt;/span&gt;.(&lt;span style=&#34;color:#a6e22e&#34;&gt;JoinArgs&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;applyJoin&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;applyResult&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;OpLeave&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;op&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;OpArgs&lt;/span&gt;.(&lt;span style=&#34;color:#a6e22e&#34;&gt;LeaveArgs&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;applyLeave&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;applyResult&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;OpMove&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;op&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;OpArgs&lt;/span&gt;.(&lt;span style=&#34;color:#a6e22e&#34;&gt;MoveArgs&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;applyMove&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;applyResult&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;OpQuery&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;op&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;OpArgs&lt;/span&gt;.(&lt;span style=&#34;color:#a6e22e&#34;&gt;QueryArgs&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;applyQuery&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;applyResult&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;default&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;DPrintf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Error Op Type %v&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;op&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;OpType&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;ch&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;ok&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;replyChMap&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;applymsg&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;CommandIndex&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ok&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;ch&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;applyResult&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;clientReply&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;op&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ClientId&lt;/span&gt;] = &lt;span style=&#34;color:#a6e22e&#34;&gt;CommandContext&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;CommandId&lt;/span&gt;: &lt;span style=&#34;color:#a6e22e&#34;&gt;op&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;CommandId&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;Reply&lt;/span&gt;:     &lt;span style=&#34;color:#a6e22e&#34;&gt;applyResult&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…·ä½“ä¸åŒçš„æ“ä½œåœ¨ä¸‹é¢å®ç°ã€‚&lt;/p&gt;
&lt;h3 id=&#34;join&#34;&gt;Join&lt;/h3&gt;
&lt;p&gt;joinæ“ä½œæ·»åŠ &lt;strong&gt;ä¸€ç»„&lt;/strong&gt; æœåŠ¡å™¨ç»„ï¼Œ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;JoinArgs&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;Servers&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;map&lt;/span&gt;[&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;][]&lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// new GID -&amp;gt; servers mappings
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;JoinReply&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;WrongLeader&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;Err&lt;/span&gt;         &lt;span style=&#34;color:#a6e22e&#34;&gt;Err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å°è¯•å°†è¯¥GIDåŠ å…¥åˆ°é…ç½®ä¸­ã€‚å¹¶ä¸”é‡æ–°å¹³è¡¡åˆ†ç‰‡ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The new configuration should divide the shards as evenly as possible among the full set of groups, and should move as few shards as possible to achieve that goal.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;shardsåº”å½“å°½å¯èƒ½å¹³è¡¡åˆ†ç»™ä¸åŒçš„æœåŠ¡å™¨ç»„ï¼Œå¹¶ä¸”è¿™ä¸ªç›®æ ‡åº”å½“å°½å¯èƒ½å°‘çš„ç§»åŠ¨åˆ†ç‰‡ã€‚&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚ä¹‹å‰æœ‰6ä¸ªåˆ†ç‰‡ï¼Œåˆ†é…ç»™ä¸¤ä¸ªæœåŠ¡å™¨ç»„ï¼Œåˆ†åˆ«å¾—åˆ°åˆ†ç‰‡&lt;code&gt;1 2 3&lt;/code&gt; å’Œ&lt;code&gt;4 5 6&lt;/code&gt;ï¼Œ ç°åœ¨åŠ å…¥ä¸€ç»„æ–°çš„æœåŠ¡å™¨ï¼Œæœ€å°‘ç§»åŠ¨çš„åˆ†ç‰‡æ•°é‡æ˜¯2ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The shardctrler should allow re-use of a GID if it&amp;rsquo;s not part of the current configuration (i.e. a GID should be allowed to Join, then Leave, then Join again).&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;GIDåº”å½“è¢«å¤ç”¨ï¼Œæ¯”å¦‚ä¹‹å‰æœ‰GID:&lt;code&gt;1 2 3&lt;/code&gt;,ç„¶å2ç¦»å¼€ï¼Œæ­¤æ—¶å†åŠ å…¥ä¸€ç»„æ–°çš„æœåŠ¡å™¨ï¼Œå¯ä»¥åˆ†é…GIDä¸º2æˆ–è€…4ã€‚ï¼ˆæˆ‘çš„ç†è§£æ˜¯é€šè¿‡ä¸€ä¸ªé˜Ÿåˆ—ï¼Œå­˜å‚¨å¯èƒ½åˆ†é…çš„gidï¼‰ï¼Œæ¯”å¦‚å½“2ç¦»å¼€ï¼Œå°±å°†2åŠ å…¥è¯¥é˜Ÿåˆ—ã€‚å¦‚æœè¯¥é˜Ÿåˆ—ä¸ºç©ºï¼Œå°±å°†ä¸€ä¸ªæ›´å¤§çš„gidåŠ å…¥ï¼Œæ¯”å¦‚ï¼Œå·²æœ‰groupsçš„idä¸º&lt;code&gt;3 1 2&lt;/code&gt;, ä¸‹ä¸€ä¸ªå¯èƒ½çš„GIDæ˜¯4.&lt;/p&gt;
&lt;p&gt;Join RPCç»“æ„å’Œä¹‹å‰çš„KV Serverä¸€è‡´&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ShardCtrler&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;Join&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;JoinArgs&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;JoinReply&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#75715e&#34;&gt;// Your code here.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Lock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;clientReply&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;ok&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;clientReply&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ClientId&lt;/span&gt;]; &lt;span style=&#34;color:#a6e22e&#34;&gt;ok&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;clientReply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;CommandId&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;CommandId&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;WrongLeader&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;clientReply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;WrongLeader&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Err&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;clientReply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Unlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		} &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;CommandId&lt;/span&gt; &amp;lt; &lt;span style=&#34;color:#a6e22e&#34;&gt;clientReply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;CommandId&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Err&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;ErrOutDate&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// å·²ç»æ²¡æœ‰äº†ä¹‹å‰æ‰§è¡Œçš„è®°å½•ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Unlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Unlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;op&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Op&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;OpType&lt;/span&gt;:    &lt;span style=&#34;color:#a6e22e&#34;&gt;OpJoin&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;OpArgs&lt;/span&gt;:    &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;ClientId&lt;/span&gt;:  &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ClientId&lt;/span&gt;, &lt;span style=&#34;color:#75715e&#34;&gt;// è¿™é‡Œå†—ä½™ä¿¡æ¯
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;CommandId&lt;/span&gt;: &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;CommandId&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;index&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;term&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;isLeader&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Start&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;op&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; !&lt;span style=&#34;color:#a6e22e&#34;&gt;isLeader&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;WrongLeader&lt;/span&gt; = &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;DPrintf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Leader[%d] Receive Op\t:%v\tIndex[%d]&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;me&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;op&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;index&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;replyCh&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; make(&lt;span style=&#34;color:#66d9ef&#34;&gt;chan&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ApplyResult&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Lock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;replyChMap&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;index&lt;/span&gt;] = &lt;span style=&#34;color:#a6e22e&#34;&gt;replyCh&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Unlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;select&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;replyMsg&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;replyCh&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;term&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;replyMsg&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Term&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;WrongLeader&lt;/span&gt; = &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			} &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Err&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;replyMsg&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;WrongLeader&lt;/span&gt; = &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;After&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;scTimeOut&lt;/span&gt;):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;WrongLeader&lt;/span&gt; = &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;go&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;CloseIndexCh&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;index&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸ºäº†åº”ç”¨joinæ“ä½œå¸¦æ¥çš„æ”¹å˜ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„Configï¼Œå¹¶å¯¹è¯¥Configè¿›è¡Œæ“ä½œ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ShardCtrler&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;applyJoin&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;JoinArgs&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;result&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ApplyResult&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Lock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Unlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;newConfig&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Config&lt;/span&gt;{}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;newConfig&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Num&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ConfigIdNow&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;newConfig&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Groups&lt;/span&gt; = make(&lt;span style=&#34;color:#66d9ef&#34;&gt;map&lt;/span&gt;[&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;][]&lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;prevConfig&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;configs&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ConfigIdNow&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;value&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;range&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;prevConfig&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Groups&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#75715e&#34;&gt;// copy map
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;newConfig&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Groups&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt;] = &lt;span style=&#34;color:#a6e22e&#34;&gt;value&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;range&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;prevConfig&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Shards&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#75715e&#34;&gt;// copy shard
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;newConfig&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Shards&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;] = &lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;servers&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;range&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Servers&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;newConfig&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Groups&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;] = &lt;span style=&#34;color:#a6e22e&#34;&gt;servers&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;reBalanceShard&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;newConfig&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ConfigIdNow&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;newConfig&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Num&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;configs&lt;/span&gt; = append(&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;configs&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;newConfig&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;result&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;WrongLeader&lt;/span&gt; = &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;result&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Err&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¥ä¸‹æ¥è€ƒè™‘å¦‚ä½•é‡æ–°åˆ†é…Shardã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å‡å¦‚ç›®å‰æ²¡æœ‰ä»»ä½•Groupï¼Œå¹¶åŠ å…¥äº†ä¸€ä¸ªæ–°çš„Groupï¼Œç›´æ¥å°†æ‰€æœ‰çš„shardåˆ†é…ç»™å®ƒã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;groupsNum&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; len(&lt;span style=&#34;color:#a6e22e&#34;&gt;config&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Groups&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// æœ‰æ•ˆçš„groupæ•°é‡
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;groupsNum&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;groupsNum&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#75715e&#34;&gt;// å°†æ‰€æœ‰çš„åˆ†ç‰‡åˆ†é…ç»™è¯¥group
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt;,&lt;span style=&#34;color:#a6e22e&#34;&gt;_&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;range&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;config&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Groups&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &amp;lt;&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;;&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;					&lt;span style=&#34;color:#a6e22e&#34;&gt;config&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Shards&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;] = &lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœå·²æœ‰groupï¼Œå°±éœ€è¦è¿›è¡Œåˆ†ç‰‡ç§»åŠ¨æ“ä½œã€‚è¿™é‡Œä¸ºäº†ç§»åŠ¨æ¬¡æ•°æœ€å°‘ï¼Œé¦–å…ˆè¦è®¡ç®—åˆ†ç‰‡å®Œå…¨åˆ†é…åï¼Œæœ€å°‘è¦å¤šå°‘shardï¼Œæœ€å¤šä¸èƒ½è¶…è¿‡å¤šå°‘ã€‚æ¯”å¦‚10ä¸ªåˆ†ç‰‡ï¼Œä¹‹å‰æœ‰ä¸¤ä¸ªgroups,å„åˆ†é…5ä¸ªåˆ†ç‰‡ï¼Œä¹‹åå†åŠ å…¥ä¸€ä¸ªæ–°çš„Groupè¿›è¡Œå¹³è¡¡&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;é¦–å…ˆ10/3 = 3 ï¼Œæœ€å°‘æ‰¿æ‹…3ä¸ªåˆ†ç‰‡ã€‚å¤§äºç­‰äº3ä¸ªåˆ†ç‰‡çš„ä¸ä¼šå†å¾—åˆ°æ–°çš„åˆ†ç‰‡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä½†æ˜¯è¿˜æœ‰ä½™æ•°ï¼Œæœ‰çš„groupéœ€è¦æ‰¿æ‹…é¢å¤–1ä¸ªåˆ†ç‰‡ï¼Œä¹Ÿå³&lt;code&gt;sMax = 4&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´ï¼Œé¦–å…ˆæˆ‘ä»¬è¦å°†åˆ†é…åˆ†ç‰‡æ•°å¤§äºsMaxçš„groupä¸­çš„ä¸€äº›åˆ†ç‰‡ç§»åŠ¨ç»™ä¸åˆ°sMinçš„group&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœå¤§äºsMaxçš„ç”¨å®Œäº†ï¼Œæ¯”å¦‚10ä¸ªåˆ†ç‰‡ä¹‹å‰æ˜¯&lt;code&gt;5 5 0&lt;/code&gt;åˆ†é…ï¼ŒæŒ‰ç…§sMaxä¸ºä¸Šé™åˆ†é…ä¸º&lt;code&gt;4 4 2&lt;/code&gt;, æ­¤æ—¶å°±è¦ä»ç­‰äºsMaxä¸­æ‹¿å‡ºshardåˆ†é…ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ‰€ä»¥groupçš„æ•°é‡æœ‰å¦‚ä¸‹çŠ¶æ€&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ— æ•ˆï¼š å½“gid=0, æˆ–è€…group leaveå¯¼è‡´shardåˆ†é…ç»™äº†æ— æ•ˆçš„gid&lt;/li&gt;
&lt;li&gt;shardä¸è¶³ï¼šå½“shard&amp;lt; sminã€‚éœ€è¦è®°å½•&lt;/li&gt;
&lt;li&gt;shardåˆšå¥½ï¼šå½“shard=smin éœ€è¦è®°å½•è®°å½•&lt;/li&gt;
&lt;li&gt;shardå¤ªå¤šï¼šå½“shard &amp;gt; smaxã€‚ä¼˜å…ˆå‰¥å¤ºè¿™ç§groupçš„ã€‚éœ€è¦è®°å½•&lt;/li&gt;
&lt;li&gt;shardæœ‰ç‚¹å°å¤šï¼Œå¤‡ç”¨ï¼šå½“shard=smax,å½“ä¸Šä¸€ç§çŠ¶æ€çš„groupæ²¡æœ‰äº†&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é‡æ–°åˆ†é…ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ‰¿æ‹…shardä¸è¶³çš„groupå°†è·å¾—é¢å¤–çš„shardç›´åˆ°sMin&lt;/li&gt;
&lt;li&gt;ä¼˜å…ˆçº§ æ— æ•ˆgid-&amp;gt;è¿‡å¤šçš„shard-&amp;gt;å¤‡ç”¨çš„shard&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;moveShardç›®å‰åªæ›´æ”¹&lt;code&gt;config.Shards&lt;/code&gt;çš„åˆ†é…ï¼Œä¹‹ååº”è¯¥è¦ç§»åŠ¨åˆ†åŒºã€‚&lt;/p&gt;
&lt;p&gt;åœ¨é‡æ–°å¹³è¡¡çš„å‡½æ•°ä¸­ï¼Œè¿˜è¦è€ƒè™‘ç‰¹æ®Šæƒ…å†µã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœShardNum &amp;lt; GroupNumã€‚ä¹Ÿå°±æ˜¯åˆ†åŒºæ•°é‡å°äºæœåŠ¡å™¨ç»„æ•°ã€‚è¿™ç§æƒ…å†µsMin = 0, sMax = 1ã€‚ä¹Ÿå°±æ˜¯è¯´æ‰€æœ‰æœåŠ¡å™¨éƒ½æ»¡è¶³äº†æœ€ä½è¦æ±‚ï¼Œä¸ä¼šè¿›å…¥é‡æ–°åˆ†é…ç¯èŠ‚ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯æ¯”å¦‚12ä¸ªåˆ†ç‰‡åˆ†ç»™6ç»„æœåŠ¡å™¨ï¼Œæ­¤æ—¶å»æ‰ä¸€ä¸ªæœåŠ¡å™¨ç»„ï¼Œæ­¤æ—¶&lt;code&gt;sMin=12/5=2&lt;/code&gt;,æ‰€æœ‰æœåŠ¡å™¨éƒ½æ»¡è¶³æœ€ä½è¦æ±‚ï¼Œä½†æ˜¯è¿˜æœ‰ä¸¤ä¸ªåˆ†ç‰‡æ˜¯æ— æ•ˆçš„æœªåˆ†é…çŠ¶æ€ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬åœ¨æ»¡è¶³äº†æœ€ä½è¦æ±‚åï¼ˆé€šå¸¸æ˜¯æ–°æœåŠ¡å™¨JOINè¯·æ±‚å¯¼è‡´çš„ï¼‰ï¼Œè¿˜è¦å°†æ— æ•ˆçš„åˆ†ç‰‡åˆ†é…ç»™åˆšå¥½åˆ°è¾¾SMinçš„æœåŠ¡å™¨ç»„ï¼ˆé€šå¸¸åœ¨Leaveæ—¶äº§ç”Ÿï¼‰&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/*
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;*
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;reBalanceShard é‡æ–°åˆ†é…Shardç»™ä¸åŒçš„GID
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ShardCtrler&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;reBalanceShard&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;config&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Config&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;groupsNum&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; len(&lt;span style=&#34;color:#a6e22e&#34;&gt;config&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Groups&lt;/span&gt;) &lt;span style=&#34;color:#75715e&#34;&gt;// æœ‰æ•ˆçš„groupæ•°é‡
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;groupsNum&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;groupsNum&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#75715e&#34;&gt;// å°†æ‰€æœ‰çš„åˆ†ç‰‡åˆ†é…ç»™è¯¥group
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;_&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;range&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;config&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Groups&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &amp;lt; &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;					&lt;span style=&#34;color:#a6e22e&#34;&gt;config&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Shards&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;] = &lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;sMin&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;NShards&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;groupsNum&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// æ¯ä¸ªgroupæœ€å°‘çš„shardæ•°é‡
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;sMax&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sMin&lt;/span&gt;                &lt;span style=&#34;color:#75715e&#34;&gt;// æœ€å¤šçš„shardæ•°é‡ï¼Œæ¯”å¦‚10ä¸ªshardåˆ†é…ç»™3ä¸ªgroup, å¯ä»¥åˆ†é…ä¸º 3 3 4
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;NShards&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;%&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;groupsNum&lt;/span&gt; &amp;gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;sMax&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;groupShard&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;shardNum&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;assignShards&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; make(&lt;span style=&#34;color:#66d9ef&#34;&gt;map&lt;/span&gt;[&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;][]&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;)   &lt;span style=&#34;color:#75715e&#34;&gt;// è®°å½•æ¯ä¸ªgroupåˆå§‹æœ‰å“ªäº›shard
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;invalidQueue&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; make([]&lt;span style=&#34;color:#a6e22e&#34;&gt;groupShard&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#75715e&#34;&gt;// å³å°†leaveçš„shard
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;lowerQueue&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; make([]&lt;span style=&#34;color:#a6e22e&#34;&gt;groupShard&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)   &lt;span style=&#34;color:#75715e&#34;&gt;// è®°å½•è¿‡å°‘çš„group
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;upperQueue&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; make([]&lt;span style=&#34;color:#a6e22e&#34;&gt;groupShard&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)   &lt;span style=&#34;color:#75715e&#34;&gt;// è®°å½•è¿‡å¤šçš„group
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;maxBackupQueue&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; make([]&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)      &lt;span style=&#34;color:#75715e&#34;&gt;// è®°å½•åˆšå¥½åˆ°è¾¾smax,å¤‡ç”¨çš„gid
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;minBackupQueue&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; make([]&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)      &lt;span style=&#34;color:#75715e&#34;&gt;// è®°å½•åˆšå¥½åˆ°è¾¾smin,å¤‡ç”¨çš„gid
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;_&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;range&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;config&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Groups&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#75715e&#34;&gt;// åˆå§‹åŒ–æœ‰æ•ˆçš„gidæ‰€å«æœ‰çš„shardç»Ÿè®¡æ•°ç»„
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;assignShards&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt;] = make([]&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;shard&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;range&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;config&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Shards&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;shardsList&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;ok&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;assignShards&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ok&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;assignShards&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;] = append(&lt;span style=&#34;color:#a6e22e&#34;&gt;shardsList&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;shard&lt;/span&gt;) &lt;span style=&#34;color:#75715e&#34;&gt;// ç»Ÿè®¡è¯¥gidåˆ†é…çš„shards
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;		} &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#75715e&#34;&gt;// è¯¥gidæ— æ•ˆï¼ˆå·²ç»leaveäº†ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;invalidQueue&lt;/span&gt; = append(&lt;span style=&#34;color:#a6e22e&#34;&gt;invalidQueue&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;groupShard&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;:      &lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#a6e22e&#34;&gt;shardNum&lt;/span&gt;: &lt;span style=&#34;color:#a6e22e&#34;&gt;shard&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			})
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;shards&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;range&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;assignShards&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;l&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; len(&lt;span style=&#34;color:#a6e22e&#34;&gt;shards&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;l&lt;/span&gt; &amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sMax&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;upperQueue&lt;/span&gt; = append(&lt;span style=&#34;color:#a6e22e&#34;&gt;upperQueue&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;groupShard&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;:      &lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#a6e22e&#34;&gt;shardNum&lt;/span&gt;: &lt;span style=&#34;color:#a6e22e&#34;&gt;l&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			})
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;l&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sMax&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;maxBackupQueue&lt;/span&gt; = append(&lt;span style=&#34;color:#a6e22e&#34;&gt;maxBackupQueue&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;l&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sMin&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;minBackupQueue&lt;/span&gt; = append(&lt;span style=&#34;color:#a6e22e&#34;&gt;minBackupQueue&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;l&lt;/span&gt; &amp;lt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sMin&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;lowerQueue&lt;/span&gt; = append(&lt;span style=&#34;color:#a6e22e&#34;&gt;lowerQueue&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;groupShard&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;:      &lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#a6e22e&#34;&gt;shardNum&lt;/span&gt;: &lt;span style=&#34;color:#a6e22e&#34;&gt;l&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			})
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;groupInfo&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;range&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lowerQueue&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#75715e&#34;&gt;// å…ˆä¿è¯æ»¡è¶³smin(joinæƒ…å†µ)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lowerQueue&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;].&lt;span style=&#34;color:#a6e22e&#34;&gt;shardNum&lt;/span&gt; &amp;lt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sMin&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; len(&lt;span style=&#34;color:#a6e22e&#34;&gt;invalidQueue&lt;/span&gt;) &amp;gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;moveShard&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;invalidQueue&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;].&lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;groupInfo&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;invalidQueue&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;].&lt;span style=&#34;color:#a6e22e&#34;&gt;shardNum&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;config&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#a6e22e&#34;&gt;invalidQueue&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;invalidQueue&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;:]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#a6e22e&#34;&gt;lowerQueue&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;].&lt;span style=&#34;color:#a6e22e&#34;&gt;shardNum&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#66d9ef&#34;&gt;continue&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; len(&lt;span style=&#34;color:#a6e22e&#34;&gt;upperQueue&lt;/span&gt;) &amp;gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;moveShard&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;upperQueue&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;].&lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;groupInfo&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;assignShards&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;upperQueue&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;].&lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;][&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;], &lt;span style=&#34;color:#a6e22e&#34;&gt;config&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#a6e22e&#34;&gt;assignShards&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;upperQueue&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;].&lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;] = &lt;span style=&#34;color:#a6e22e&#34;&gt;assignShards&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;upperQueue&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;].&lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;][&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;:]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#a6e22e&#34;&gt;upperQueue&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;].&lt;span style=&#34;color:#a6e22e&#34;&gt;shardNum&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;--&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;upperQueue&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;].&lt;span style=&#34;color:#a6e22e&#34;&gt;shardNum&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sMax&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;					&lt;span style=&#34;color:#a6e22e&#34;&gt;maxBackupQueue&lt;/span&gt; = append(&lt;span style=&#34;color:#a6e22e&#34;&gt;maxBackupQueue&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;upperQueue&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;].&lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;					&lt;span style=&#34;color:#a6e22e&#34;&gt;upperQueue&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;upperQueue&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;:]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#a6e22e&#34;&gt;lowerQueue&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;].&lt;span style=&#34;color:#a6e22e&#34;&gt;shardNum&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#66d9ef&#34;&gt;continue&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; len(&lt;span style=&#34;color:#a6e22e&#34;&gt;maxBackupQueue&lt;/span&gt;) &amp;gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#75715e&#34;&gt;// ä»backupé‡Œé¢å¡«
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;				&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;moveShard&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;maxBackupQueue&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;], &lt;span style=&#34;color:#a6e22e&#34;&gt;groupInfo&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;assignShards&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;maxBackupQueue&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;]][&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;], &lt;span style=&#34;color:#a6e22e&#34;&gt;config&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#a6e22e&#34;&gt;assignShards&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;maxBackupQueue&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;]] = &lt;span style=&#34;color:#a6e22e&#34;&gt;assignShards&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;maxBackupQueue&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;]][&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;:]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#a6e22e&#34;&gt;maxBackupQueue&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;maxBackupQueue&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;:]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#a6e22e&#34;&gt;lowerQueue&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;].&lt;span style=&#34;color:#a6e22e&#34;&gt;shardNum&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#66d9ef&#34;&gt;continue&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;DPrintf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Cant Equally ReBalance&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lowerQueue&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;].&lt;span style=&#34;color:#a6e22e&#34;&gt;shardNum&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sMin&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;minBackupQueue&lt;/span&gt; = append(&lt;span style=&#34;color:#a6e22e&#34;&gt;minBackupQueue&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;groupInfo&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;_&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;invalidShard&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;range&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;invalidQueue&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; len(&lt;span style=&#34;color:#a6e22e&#34;&gt;minBackupQueue&lt;/span&gt;) &amp;gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;moveShard&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;invalidShard&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;minBackupQueue&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;], &lt;span style=&#34;color:#a6e22e&#34;&gt;invalidShard&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;shardNum&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;config&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;minBackupQueue&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;minBackupQueue&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;:]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Can&amp;#39;t assign invalidShard&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/*
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;*
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;å°†shardä»ä¸€ä¸ªgidç§»åŠ¨åˆ°å¦å¤–ä¸€ä¸ªgid
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ShardCtrler&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;moveShard&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;gidBefore&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;gidAfter&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;shardNum&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;config&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Config&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;config&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Shards&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;shardNum&lt;/span&gt;] = &lt;span style=&#34;color:#a6e22e&#34;&gt;gidAfter&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;leave&#34;&gt;Leave&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;The &lt;code&gt;Leave&lt;/code&gt; RPC&amp;rsquo;s argument is a list of GIDs of previously joined groups. The shardctrler should create a new configuration that does not include those groups, and that assigns those groups&amp;rsquo; shards to the remaining groups. The new configuration should divide the shards as evenly as possible among the groups, and should move as few shards as possible to achieve that goal.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å»æ‰æŸä¸ªgidçš„groupï¼Œå¹¶é‡æ–°åˆ†é…&lt;/p&gt;
&lt;p&gt;å’ŒapplyJoinæ¯”è¾ƒåƒï¼Œä½†æ˜¯å°†æ·»åŠ æœåŠ¡å™¨çš„æ“ä½œï¼Œå˜ä¸ºåˆ é™¤æœåŠ¡å™¨ç»„çš„æ“ä½œã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ShardCtrler&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;applyLeave&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;LeaveArgs&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;result&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ApplyResult&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Lock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Unlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;newConfig&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Config&lt;/span&gt;{}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;newConfig&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Num&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ConfigIdNow&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;newConfig&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Groups&lt;/span&gt; = make(&lt;span style=&#34;color:#66d9ef&#34;&gt;map&lt;/span&gt;[&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;][]&lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;prevConfig&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;configs&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ConfigIdNow&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;value&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;range&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;prevConfig&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Groups&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#75715e&#34;&gt;// copy map
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;newConfig&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Groups&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt;] = &lt;span style=&#34;color:#a6e22e&#34;&gt;value&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;range&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;prevConfig&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Shards&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#75715e&#34;&gt;// copy shard
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;newConfig&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Shards&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;] = &lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;_&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;range&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;GIDs&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		delete(&lt;span style=&#34;color:#a6e22e&#34;&gt;newConfig&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Groups&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;reBalanceShard&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;newConfig&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ConfigIdNow&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;newConfig&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Num&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;configs&lt;/span&gt; = append(&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;configs&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;newConfig&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;result&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;WrongLeader&lt;/span&gt; = &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;result&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Err&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;move&#34;&gt;Move&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;The &lt;code&gt;Move&lt;/code&gt; RPC&amp;rsquo;s arguments are a shard number and a GID. The shardctrler should create a new configuration in which the shard is assigned to the group. The purpose of &lt;code&gt;Move&lt;/code&gt; is to allow us to test your software. A &lt;code&gt;Join&lt;/code&gt; or &lt;code&gt;Leave&lt;/code&gt; following a &lt;code&gt;Move&lt;/code&gt; will likely un-do the &lt;code&gt;Move&lt;/code&gt;, since &lt;code&gt;Join&lt;/code&gt; and &lt;code&gt;Leave&lt;/code&gt; re-balance.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;moveæ“ä½œæ˜¯ä¸éœ€è¦æˆ‘ä»¬è‡ªå·±å»é‡æ–°å¹³è¡¡çš„ã€‚ç›¸å½“äº &lt;strong&gt;æµ‹è¯•&lt;/strong&gt;æ•…æ„å»ç§»åŠ¨åˆ†ç‰‡ï¼Œç„¶åé€šè¿‡Joinæˆ–è€…Leaveæ¥é‡æ–°å¹³è¡¡ã€‚&lt;/p&gt;
&lt;p&gt;è¿˜æ˜¯å¤§åŒå°å¼‚çš„ä»£ç &lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ShardCtrler&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;applyMove&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;MoveArgs&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;result&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ApplyResult&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Lock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Unlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;newConfig&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Config&lt;/span&gt;{}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;newConfig&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Num&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ConfigIdNow&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;newConfig&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Groups&lt;/span&gt; = make(&lt;span style=&#34;color:#66d9ef&#34;&gt;map&lt;/span&gt;[&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;][]&lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;prevConfig&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;configs&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ConfigIdNow&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;value&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;range&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;prevConfig&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Groups&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#75715e&#34;&gt;// copy map
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;newConfig&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Groups&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt;] = &lt;span style=&#34;color:#a6e22e&#34;&gt;value&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;range&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;prevConfig&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Shards&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#75715e&#34;&gt;// copy shard
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;newConfig&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Shards&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;] = &lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;moveShard&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;prevConfig&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Shards&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Shard&lt;/span&gt;], &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;GID&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Shard&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;newConfig&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ConfigIdNow&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;newConfig&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Num&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;configs&lt;/span&gt; = append(&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;configs&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;newConfig&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;result&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;WrongLeader&lt;/span&gt; = &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;result&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Err&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;query&#34;&gt;Query&lt;/h3&gt;
&lt;p&gt;queryç›¸å½“äºä¸€ä¸ªgetæ“ä½œï¼Œç›´æ¥è¿”å›å¯¹åº”çš„configå°±å¥½äº†&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ShardCtrler&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;applyQuery&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;QueryArgs&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;result&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ApplyResult&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Lock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Unlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;queryNum&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Num&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;queryNum&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;||&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;queryNum&lt;/span&gt; &amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ConfigIdNow&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;queryNum&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ConfigIdNow&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;result&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Cfg&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;sc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;configs&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;queryNum&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;result&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;WrongLeader&lt;/span&gt; = &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;result&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Err&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;clerk&#34;&gt;Clerk&lt;/h3&gt;
&lt;p&gt;å’Œkvraftçš„clerké€»è¾‘ç›¸ä¼¼ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Clerk&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;Query&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;num&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;Config&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;commandId&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;lastAppliedCommandId&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;QueryArgs&lt;/span&gt;{}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// Your code here.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Num&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;num&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ClientId&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;clientId&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;CommandId&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;commandId&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;serverId&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;lastFoundLeader&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;serverNum&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; len(&lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;servers&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; ; ; &lt;span style=&#34;color:#a6e22e&#34;&gt;serverId&lt;/span&gt; = (&lt;span style=&#34;color:#a6e22e&#34;&gt;serverId&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;%&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;serverNum&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#75715e&#34;&gt;// try each known server.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;DPrintf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Client Send [%v] Query Op:[%v]&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;serverId&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;QueryReply&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;ok&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;servers&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;serverId&lt;/span&gt;].&lt;span style=&#34;color:#a6e22e&#34;&gt;Call&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;ShardCtrler.Query&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ok&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;WrongLeader&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;DPrintf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Client[%d] Success Query:[%v] ValueL[%v]&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;clientId&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Num&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Config&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;lastFoundLeader&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;serverId&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;lastAppliedCommandId&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;commandId&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Config&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Sleep&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;100&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Millisecond&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Clerk&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;Join&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;servers&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;map&lt;/span&gt;[&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;][]&lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;JoinArgs&lt;/span&gt;{}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// Your code here.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Servers&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;servers&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;commandId&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;lastAppliedCommandId&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ClientId&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;clientId&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;CommandId&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;commandId&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;serverId&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;lastFoundLeader&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;serverNum&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; len(&lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;servers&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; ; ; &lt;span style=&#34;color:#a6e22e&#34;&gt;serverId&lt;/span&gt; = (&lt;span style=&#34;color:#a6e22e&#34;&gt;serverId&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;%&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;serverNum&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#75715e&#34;&gt;// try each known server.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;DPrintf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Client Send [%v] Join Op:[%v]&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;serverId&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;JoinReply&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;ok&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;servers&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;serverId&lt;/span&gt;].&lt;span style=&#34;color:#a6e22e&#34;&gt;Call&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;ShardCtrler.Join&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ok&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;WrongLeader&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;DPrintf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Client[%d] Success Join:[%v][%v]&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;clientId&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Servers&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;lastFoundLeader&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;serverId&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;lastAppliedCommandId&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;commandId&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Sleep&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;100&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Millisecond&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Clerk&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;Leave&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;gids&lt;/span&gt; []&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;LeaveArgs&lt;/span&gt;{}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// Your code here.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;GIDs&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;gids&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;commandId&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;lastAppliedCommandId&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ClientId&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;clientId&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;CommandId&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;commandId&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;serverId&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;lastFoundLeader&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;serverNum&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; len(&lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;servers&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; ; ; &lt;span style=&#34;color:#a6e22e&#34;&gt;serverId&lt;/span&gt; = (&lt;span style=&#34;color:#a6e22e&#34;&gt;serverId&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;%&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;serverNum&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;DPrintf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Client Send [%v] Leave Op:[%v]&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;serverId&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;LeaveReply&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;ok&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;servers&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;serverId&lt;/span&gt;].&lt;span style=&#34;color:#a6e22e&#34;&gt;Call&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;ShardCtrler.Leave&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ok&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;WrongLeader&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#a6e22e&#34;&gt;DPrintf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Client[%d] Success Leave:[%v]&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;clientId&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;GIDs&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;lastFoundLeader&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;serverId&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;lastAppliedCommandId&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;commandId&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Sleep&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;100&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Millisecond&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Clerk&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;Move&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;shard&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;MoveArgs&lt;/span&gt;{}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// Your code here.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Shard&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;shard&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;GID&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;commandId&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;lastAppliedCommandId&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ClientId&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;clientId&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;CommandId&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;commandId&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;serverId&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;lastFoundLeader&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;serverNum&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; len(&lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;servers&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; ; ; &lt;span style=&#34;color:#a6e22e&#34;&gt;serverId&lt;/span&gt; = (&lt;span style=&#34;color:#a6e22e&#34;&gt;serverId&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;%&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;serverNum&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#75715e&#34;&gt;// try each known server.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;DPrintf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Client Send [%v] Join Move: GID[%v] SHARD[%v]&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;serverId&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;GID&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Shard&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;MoveReply&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;ok&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;servers&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;serverId&lt;/span&gt;].&lt;span style=&#34;color:#a6e22e&#34;&gt;Call&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;ShardCtrler.Move&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ok&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;WrongLeader&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;DPrintf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Client[%d] Success Move GID[%v] SHARD[%v]&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;clientId&lt;/span&gt;,  &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;GID&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Shard&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;lastFoundLeader&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;serverId&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;lastAppliedCommandId&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;commandId&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Sleep&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;100&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Millisecond&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;è°ƒè¯•&#34;&gt;è°ƒè¯•&lt;/h3&gt;
&lt;p&gt;æ³¨æ„ï¼šæµ‹è¯•çš„æ—¶å€™shardé¡ºåºå¿…é¡»æ˜¯ç¡®å®šçš„ã€‚&lt;/p&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;The code in your state machine that performs the shard rebalancing needs to be deterministic. In Go, map iteration order is &lt;a class=&#34;link&#34; href=&#34;https://blog.golang.org/maps#TOC_7.&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;not deterministic&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¸€å¼€å§‹æ²¡æœ‰ç†è§£è¿™ä¸ªæç¤ºä»€ä¹ˆæ„æ€ã€‚ä½†æ˜¯æµ‹è¯•å‡ºé”™ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/mit6.824/lab4/blogimage-20231011224911622.png&#34;
	width=&#34;651&#34;
	height=&#34;769&#34;
	srcset=&#34;https://antio2.cn/tech/mit6.824/lab4/blogimage-20231011224911622_hu77768f23cea1eb5461a17b575745ddbb_61918_480x0_resize_box_3.png 480w, https://antio2.cn/tech/mit6.824/lab4/blogimage-20231011224911622_hu77768f23cea1eb5461a17b575745ddbb_61918_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20231011224911622&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;84&#34;
		data-flex-basis=&#34;203px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;æŸ¥è¯¢çš„ä¸¤ä¸ªæœåŠ¡å™¨çš„Config åˆ†ç‰‡ä¸åŒã€‚è¿™ä¸æ˜¯å› ä¸ºlogåŒæ­¥é—®é¢˜ã€‚é—®é¢˜åœ¨äºlogç¡®å®åŒæ­¥äº†ï¼Œä½†æ˜¯logæ˜¯é€»è¾‘logè€Œä¸æ˜¯ç‰©ç†logã€‚&lt;/p&gt;
&lt;p&gt;å°±æ˜¯è¯´æœåŠ¡å™¨Aæ”¶åˆ°äº†Joinçš„è¯·æ±‚å¹¶Commitï¼ŒæœåŠ¡å™¨ä¹ŸApplyè¯¥Joinï¼Œç›¸åŒçš„Joinå› ä¸ºGo mapè¿­ä»£é¡ºåºä¸ä¸€è‡´è€Œæ“ä½œçš„ç»“æœä¸åŒã€‚&lt;/p&gt;
&lt;p&gt;ä¸€æ®µlogå¦‚ä¸‹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2023&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;23&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;07&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;48&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] &lt;span style=&#34;color:#a6e22e&#34;&gt;Join&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Config&lt;/span&gt;:[{&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;] &lt;span style=&#34;color:#66d9ef&#34;&gt;map&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;:[&lt;span style=&#34;color:#a6e22e&#34;&gt;x&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;y&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;z&lt;/span&gt;] &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;:[&lt;span style=&#34;color:#a6e22e&#34;&gt;a&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;b&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;]]}]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2023&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;23&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;07&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;48&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;] &lt;span style=&#34;color:#a6e22e&#34;&gt;Join&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Config&lt;/span&gt;:[{&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;] &lt;span style=&#34;color:#66d9ef&#34;&gt;map&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;:[&lt;span style=&#34;color:#a6e22e&#34;&gt;x&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;y&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;z&lt;/span&gt;] &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;:[&lt;span style=&#34;color:#a6e22e&#34;&gt;a&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;b&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;]]}]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2023&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;23&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;07&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;48&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;] &lt;span style=&#34;color:#a6e22e&#34;&gt;Join&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Config&lt;/span&gt;:[{&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;] &lt;span style=&#34;color:#66d9ef&#34;&gt;map&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;:[&lt;span style=&#34;color:#a6e22e&#34;&gt;x&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;y&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;z&lt;/span&gt;] &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;:[&lt;span style=&#34;color:#a6e22e&#34;&gt;a&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;b&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;]]}]
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è§£å†³æ–¹æ³•å‚è€ƒ&lt;a class=&#34;link&#34; href=&#34;https://go.dev/blog/maps#TOC_7.&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Go maps in action - The Go Programming Language&lt;/a&gt;çš„æœ€ä¸‹é¢&lt;/p&gt;
&lt;blockquote&gt;
&lt;h2 id=&#34;iteration-order&#34;&gt;Iteration order&lt;/h2&gt;
&lt;p&gt;When iterating over a map with a range loop, the iteration order is not specified and is not guaranteed to be the same from one iteration to the next. If you require a stable iteration order you must maintain a separate data structure that specifies that order. This example uses a separate sorted slice of keys to print a &lt;code&gt;map[int]string&lt;/code&gt; in key order:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;sort&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;m&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;map&lt;/span&gt;[&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;]&lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;keys&lt;/span&gt; []&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;k&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;range&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;m&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;keys&lt;/span&gt; = append(&lt;span style=&#34;color:#a6e22e&#34;&gt;keys&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;k&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;sort&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Ints&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;keys&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;_&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;k&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;range&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;keys&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Key:&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;k&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Value:&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;m&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;k&lt;/span&gt;])
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/blockquote&gt;
&lt;p&gt;æˆ‘ä»¬åœ¨rebalanceä¸­ï¼Œéœ€è¦å…ˆæ’åºkeyï¼Œå†è¿›è¡Œæ“ä½œã€‚å› ä¸ºæˆ‘ä½¿ç”¨äº†å¤šä¸ªqueue, è¦ä¿è¯queueä¸­æ•°æ®ç›¸åŒï¼Œåªè¦ä¿è¯éå†è®¡æ•°å™¨mapæ—¶çš„é¡ºåºç›¸åŒå°±è¡Œäº†ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;assignGids&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; make([]&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;range&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;assignShards&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;assignGids&lt;/span&gt; = append(&lt;span style=&#34;color:#a6e22e&#34;&gt;assignGids&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;sort&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Ints&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;assignGids&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;_&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;range&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;assignGids&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;shards&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;assignShards&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;l&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; len(&lt;span style=&#34;color:#a6e22e&#34;&gt;shards&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;l&lt;/span&gt; &amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sMax&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;upperQueue&lt;/span&gt; = append(&lt;span style=&#34;color:#a6e22e&#34;&gt;upperQueue&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;groupShard&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;:      &lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;shardNum&lt;/span&gt;: &lt;span style=&#34;color:#a6e22e&#34;&gt;l&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       })
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;l&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sMax&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;maxBackupQueue&lt;/span&gt; = append(&lt;span style=&#34;color:#a6e22e&#34;&gt;maxBackupQueue&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;l&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sMin&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;minBackupQueue&lt;/span&gt; = append(&lt;span style=&#34;color:#a6e22e&#34;&gt;minBackupQueue&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;l&lt;/span&gt; &amp;lt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sMin&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;lowerQueue&lt;/span&gt; = append(&lt;span style=&#34;color:#a6e22e&#34;&gt;lowerQueue&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;groupShard&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;:      &lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;shardNum&lt;/span&gt;: &lt;span style=&#34;color:#a6e22e&#34;&gt;l&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       })
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;part-b-sharded-keyvalue-server&#34;&gt;Part B: Sharded Key/Value Server&lt;/h2&gt;
&lt;p&gt;æ„å»ºä¸€ä¸ªshardkv system.&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨æä¾›çš„è¿™ä¸ªå‡½æ•°ï¼ˆç±»ä¼¼äºå“ˆå¸Œï¼‰æ¥å†³å®šæŸä¸ªkeyåˆ†é…ç»™å“ªä¸ªåˆ†ç‰‡ä¸­ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;key2shard&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;) &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;shard&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; len(&lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt;) &amp;gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;shard&lt;/span&gt; = int(&lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;])
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;shard&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;%=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;shardctrler&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;NShards&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;shard&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;shardctrler&lt;/code&gt; è´Ÿè´£å°†åˆ†ç‰‡åˆ†é…ç»™æœåŠ¡å™¨ï¼ˆgidï¼‰ï¼Œå½“åˆ†é…å‘ç”Ÿå˜åŒ–ï¼Œåˆ†ç‰‡åœ¨ä¸åŒçš„ç»„ä¹‹é—´ç§»åŠ¨ã€‚&lt;/p&gt;
&lt;p&gt;å®ç°åº”å½“æä¾›çº¿æ€§ä¸€è‡´æ€§ï¼ˆåœ¨lab3ä¸­ï¼Œè¿™ä¸€ç‰¹æ€§é€šè¿‡raftæäº¤getè¯·æ±‚å®ç°ï¼‰ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;A shardkv server is a member of only a single replica group. The set of servers in a given replica group will never change.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¸€ä¸ªshardkv &lt;strong&gt;åªèƒ½å±äºä¸€ä¸ª&lt;/strong&gt;replica group, ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªæœåŠ¡å™¨ä¸èƒ½åŒæ—¶å±äºå¤šä¸ªgroupã€‚ç¬¬äºŒå¥è¯æ„æ€æ˜¯ï¼šä¸€ä¸ªæœåŠ¡å™¨ç»„ä¸­æœ‰å“ªäº›æœåŠ¡å™¨æ˜¯ä¸ä¼šå˜çš„ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;We supply you with &lt;code&gt;client.go&lt;/code&gt; code that sends each RPC to the replica group responsible for the RPC&amp;rsquo;s key. It re-tries if the replica group says it is not responsible for the key; in that case, the client code asks the shard controller for the latest configuration and tries again. You&amp;rsquo;ll have to modify client.go as part of your support for dealing with duplicate client RPCs, much as in the kvraft lab.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åœ¨clientä¸­ï¼Œä»£ç å°è¯•å°†RPCå‘é€ç»™client &lt;strong&gt;è®¤ä¸º&lt;/strong&gt;è´Ÿè´£ä»»çš„groupã€‚å¦‚æœè¯¥groupå®é™…ä¸Šä¸è´Ÿè´£è¿™ä¸ªkeyï¼Œé‚£ä¹ˆå°±ä½¿ç”¨Lab4Aé‡Œé¢çš„&lt;code&gt;Query(-1)&lt;/code&gt;è·å–åˆ°è¯¥shardå±äºå“ªä¸ªgidçš„æœ€æ–°æ¶ˆæ¯ã€‚&lt;/p&gt;
&lt;h3 id=&#34;basic&#34;&gt;Basic&lt;/h3&gt;
&lt;h4 id=&#34;client&#34;&gt;Client&lt;/h4&gt;
&lt;p&gt;åˆæ­¥è®¾è®¡clerkå¦‚ä¸‹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Clerk&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;sm&lt;/span&gt;       &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;shardctrler&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Clerk&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;config&lt;/span&gt;   &lt;span style=&#34;color:#a6e22e&#34;&gt;shardctrler&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Config&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;make_end&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;labrpc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ClientEnd&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// é€šè¿‡æœåŠ¡å™¨å ï¼ˆæ¯”å¦‚server1_aï¼‰ è·å¾—å¯¹åº”çš„client end
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#75715e&#34;&gt;// You will have to modify this struct.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;lastAppliedCommandId&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;         &lt;span style=&#34;color:#75715e&#34;&gt;// æœ€åä¸€æ¬¡commandçš„id
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;groupLeader&lt;/span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;map&lt;/span&gt;[&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;]&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// ç¼“å­˜ä¸Šæ¬¡çœ‹åˆ°çš„æŸä¸ªgidå¯¹åº”çš„leaderæ˜¯è°ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;clientId&lt;/span&gt;             &lt;span style=&#34;color:#66d9ef&#34;&gt;int64&lt;/span&gt;       &lt;span style=&#34;color:#75715e&#34;&gt;// å¯ä»¥è€ƒè™‘å¤ç”¨sm clerkçš„id?
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// the tester calls MakeClerk.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;//
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// ctrlers[] is needed to call shardctrler.MakeClerk().
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;//
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// makeEnd(servername) turns a server name from a
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Config.Groups[gid][i] into a labrpc.ClientEnd on which you can
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// send RPCs.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;MakeClerk&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;ctrlers&lt;/span&gt; []&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;labrpc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ClientEnd&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;make_end&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;labrpc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ClientEnd&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Clerk&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; new(&lt;span style=&#34;color:#a6e22e&#34;&gt;Clerk&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;sm&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;shardctrler&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;MakeClerk&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;ctrlers&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;make_end&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;make_end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#75715e&#34;&gt;// You&amp;#39;ll have to add code here.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;lastAppliedCommandId&lt;/span&gt; = &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;clientId&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;nrand&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;config&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;shardctrler&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Config&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;Num&lt;/span&gt;:    &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;Shards&lt;/span&gt;: [&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;]&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;{},
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;Groups&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;groupLeader&lt;/span&gt; = make(&lt;span style=&#34;color:#66d9ef&#34;&gt;map&lt;/span&gt;[&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;]&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…¶ä¸­ï¼Œconfigç”¨äºç¼“å­˜ä¸Šæ¬¡çœ‹åˆ°çš„Configã€‚ck.groupLeaderç”¨äºç¼“å­˜æŸä¸ªgroupå¯¹åº”çš„leaderã€‚&lt;/p&gt;
&lt;p&gt;ç„¶åå’Œä¹‹å‰ä¸€æ ·ï¼Œåœ¨è¯·æ±‚å‚æ•°ä¸­æ·»åŠ clientidå’ŒcommandIdç”¨äºå»é™¤é‡å¤çš„RPCã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ClientId&lt;/span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;int64&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;CommandId&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å®¢æˆ·ç«¯çš„&lt;code&gt;PutAppend(key string, value string, op string) &lt;/code&gt;å’Œ&lt;code&gt;Get(key string)&lt;/code&gt;åœ¨å·²æä¾›ä»£ç ä¸Šå¢åŠ clientIdå’ŒcommandIdï¼Œä»¥åŠä¼˜åŒ–ä¸€ä¸‹leaderæŸ¥æ‰¾å°±å¥½ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Clerk&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;Get&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;) &lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;commandId&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;lastAppliedCommandId&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;GetArgs&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;Key&lt;/span&gt;:       &lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;CommandId&lt;/span&gt;: &lt;span style=&#34;color:#a6e22e&#34;&gt;commandId&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;ClientId&lt;/span&gt;:  &lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;clientId&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;shard&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;key2shard&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;config&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Shards&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;shard&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;servers&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;ok&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;config&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Groups&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;]; &lt;span style=&#34;color:#a6e22e&#34;&gt;ok&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#75715e&#34;&gt;// try each server for the shard.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;si&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;groupLeader&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;] &lt;span style=&#34;color:#75715e&#34;&gt;// å°ä¼˜åŒ–ï¼š ä½¿ç”¨ä¸Šæ¬¡å‘ç°çš„group leader
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;sn&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; len(&lt;span style=&#34;color:#a6e22e&#34;&gt;servers&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; ; ; &lt;span style=&#34;color:#a6e22e&#34;&gt;si&lt;/span&gt; = (&lt;span style=&#34;color:#a6e22e&#34;&gt;si&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;%&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sn&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#a6e22e&#34;&gt;srv&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;make_end&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;servers&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;si&lt;/span&gt;])
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;GetReply&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#a6e22e&#34;&gt;ok&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;srv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Call&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;ShardKV.Get&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ok&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;OK&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;||&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ErrNoKey&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;					&lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;lastAppliedCommandId&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;commandId&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;					&lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;groupLeader&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;] = &lt;span style=&#34;color:#a6e22e&#34;&gt;si&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;					&lt;span style=&#34;color:#a6e22e&#34;&gt;DPrintf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Client[%v] Get k:[%v] v:[%v]&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;clientId&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Value&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;					&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Value&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ok&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ErrWrongGroup&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;					&lt;span style=&#34;color:#66d9ef&#34;&gt;break&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#75715e&#34;&gt;// ... not ok, or ErrWrongLeader
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;			}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Sleep&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;100&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Millisecond&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#75715e&#34;&gt;// ask controler for the latest configuration.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;config&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;sm&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Query&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// shared by Put and Append.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// You will have to modify this function.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Clerk&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;PutAppend&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;value&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;op&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;commandId&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;lastAppliedCommandId&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;PutAppendArgs&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;Key&lt;/span&gt;:       &lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;Value&lt;/span&gt;:     &lt;span style=&#34;color:#a6e22e&#34;&gt;value&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;Op&lt;/span&gt;:        &lt;span style=&#34;color:#a6e22e&#34;&gt;op&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;ClientId&lt;/span&gt;:  &lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;clientId&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;CommandId&lt;/span&gt;: &lt;span style=&#34;color:#a6e22e&#34;&gt;commandId&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;shard&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;key2shard&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;config&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Shards&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;shard&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;servers&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;ok&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;config&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Groups&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;]; &lt;span style=&#34;color:#a6e22e&#34;&gt;ok&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;si&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;groupLeader&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;] &lt;span style=&#34;color:#75715e&#34;&gt;// å°ä¼˜åŒ–ï¼š ä½¿ç”¨ä¸Šæ¬¡å‘ç°çš„group leader
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;sn&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; len(&lt;span style=&#34;color:#a6e22e&#34;&gt;servers&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; ; ; &lt;span style=&#34;color:#a6e22e&#34;&gt;si&lt;/span&gt; = (&lt;span style=&#34;color:#a6e22e&#34;&gt;si&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;%&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sn&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#a6e22e&#34;&gt;srv&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;make_end&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;servers&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;si&lt;/span&gt;])
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;PutAppendReply&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#a6e22e&#34;&gt;ok&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;srv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Call&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;ShardKV.PutAppend&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ok&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;OK&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;lastAppliedCommandId&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;commandId&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;groupLeader&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;] = &lt;span style=&#34;color:#a6e22e&#34;&gt;si&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ok&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ErrWrongGroup&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#66d9ef&#34;&gt;break&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#75715e&#34;&gt;// ... not ok, or ErrWrongLeader
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;          }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Sleep&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;100&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Millisecond&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#75715e&#34;&gt;// ask controler for the latest configuration.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;config&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;sm&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Query&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;server&#34;&gt;Server&lt;/h3&gt;
&lt;p&gt;é¦–å…ˆæŠŠLab3ä¸­çš„KVserverå¤åˆ¶è¿‡æ¥ã€‚æ¥ä¸‹æ¥è¦è€ƒè™‘ï¼šæœåŠ¡å™¨å¦‚ä½•çŸ¥é“å½“å‰æ˜¯å¦å¯¹æŸä¸ªshardè´Ÿè´£ï¼Ÿ&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Your server will need to periodically poll the shardctrler to learn about new configurations. The tests expect that your code polls roughly every 100 milliseconds; more often is OK, but much less often may cause problems.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¯åŠ¨ä¸€ä¸ªåç¨‹ï¼Œå‘¨æœŸæ€§åœ°è¯¢é—®é…ç½®ï¼Œå¦‚æœè§‚å¯Ÿåˆ°å‘ç”Ÿäº†æ”¹å˜ï¼Œè¿›è¡Œmove shardæ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;åœ¨Serverçš„Getå’ŒPutAppendæ“ä½œå‰é¢ï¼ŒåŠ ä¸Šåˆ¤æ–­æ˜¯å¦æœ‰è¯¥Shardçš„æ“ä½œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;shard&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;key2shard&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Key&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;cfg&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Shards&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;shard&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Err&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;ErrWrongGroup&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;å‘ç°æ–°config&#34;&gt;å‘ç°æ–°Config&lt;/h4&gt;
&lt;p&gt;å¦‚æœè§‚å¯Ÿåˆ°é…ç½®æ”¹å˜æ€ä¹ˆåŠå‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;é¦–å…ˆï¼Œè‚¯å®šä¸èƒ½ä¸€è§‚å¯Ÿåˆ°åˆ†åŒºç§»åŠ¨å°±ç«‹åˆ»è¿›è¡Œç§»åŠ¨æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;è€ƒè™‘è¿™ä¹ˆä¸€ç§æƒ…å†µï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®¢æˆ·ç«¯å·²ç»å‘é€5ä¸ªputè¯·æ±‚å¹¶å¾—åˆ°è¿”å›ã€‚&lt;/li&gt;
&lt;li&gt;ä¸€æ—¦putè¯·æ±‚å¾—åˆ°è¿”å›ï¼Œè¯´æ˜å·²ç»è¢«applyäº†ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœæœ‰å·²ç»commitä½†æ˜¯è¿˜æ²¡æœ‰applyçš„logï¼Œå¹¶ä¸”è¿™äº›logåŒ…å«å°†è¦è¢«ç§»åŠ¨çš„åˆ†åŒºã€‚é‚£ä¹ˆå¦‚æœåœ¨æ­¤æ—¶å‘é€æ•°æ®ç»™æ–°è´Ÿè´£çš„æœåŠ¡å™¨ç»„ï¼Œæ˜¯ä¸åŒ…å«è¿™äº›commitçš„æ•°æ®çš„ã€‚ä½†æ˜¯åœ¨ä¹‹åè¿™äº›logåˆä¼šè¢«applyï¼Œå¯¼è‡´ä¸¢å¤±æ•°æ®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦ä¸€ç§æƒ…æ™¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‡å¦‚groupä¸€å¼€å§‹ä¸è´Ÿè´£key=1ã€‚åœ¨æŸä¸ªæ—¶åˆ»ä¿®æ”¹é…ç½®ã€‚&lt;/li&gt;
&lt;li&gt;æ­¤æ—¶mapä¸­æ²¡æœ‰key=1çš„é”®å€¼å¯¹&lt;/li&gt;
&lt;li&gt;ä¸€ä¸ªæ–°è¯·æ±‚åˆ°è¾¾ï¼Œè¯·æ±‚get key=1&lt;/li&gt;
&lt;li&gt;è¿”å›å‡ºé”™ï¼Œå› ä¸ºå…¶ä»–groupå¯èƒ½è¿˜æ²¡æœ‰æ¥å¾—åŠå‘é€key=1çš„é”®å€¼å¯¹ç»™è¯¥groupã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦ä¸€ä¸ªé—®é¢˜ï¼šgroupä¸­çš„followeréœ€è¦è§‚å¯Ÿconfigå˜åŒ–å—ï¼Ÿ&lt;/p&gt;
&lt;p&gt;åº”è¯¥æ˜¯ä¸éœ€è¦çš„ã€‚leaderè§‚å¯Ÿï¼Œç„¶åé€šè¿‡logçš„æ–¹å¼åŒæ­¥å°±è¡Œäº†ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ShardKV&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;fetchNewConfig&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;newCfg&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Query&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;RLock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;newCfg&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Num&lt;/span&gt; &amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;cfg&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Num&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;RUnlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#75715e&#34;&gt;// é…ç½®å‘ç”Ÿäº†å˜åŒ–ï¼Œæ£€æŸ¥è‡ªå·±ä¸è´Ÿè´£å“ªäº›shardäº†ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;op&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Op&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;OpType&lt;/span&gt;: &lt;span style=&#34;color:#a6e22e&#34;&gt;NewConfig&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;Data&lt;/span&gt;:   &lt;span style=&#34;color:#a6e22e&#34;&gt;newCfg&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Lock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;_&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;isLeader&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;GetState&lt;/span&gt;(); &lt;span style=&#34;color:#a6e22e&#34;&gt;isLeader&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Start&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;op&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Unlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;RUnlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;æ”¹å˜åˆ†ç‰‡å­˜å‚¨æ–¹å¼&#34;&gt;æ”¹å˜åˆ†ç‰‡å­˜å‚¨æ–¹å¼&lt;/h4&gt;
&lt;p&gt;é‚£ä¹ˆåˆ†ç‰‡ç§»åŠ¨æ—¶ï¼Œåº”å½“åŒ…å«å“ªäº›æ•°æ®å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;è€ƒè™‘ä¸€ä¸ªæƒ…æ™¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å­˜åœ¨Group1,Group2ã€‚Group1ä¸€å¼€å§‹è´Ÿè´£åˆ†ç‰‡1.&lt;/li&gt;
&lt;li&gt;Clientå‘é€Appendç»™G1ï¼ŒG1æˆåŠŸå°†è¿™ä¸ªé”®å€¼å¯¹åº”ç”¨åˆ°KVDBä¸­ï¼Œä½†æ˜¯å›å¤ç»™Clientçš„ä¿¡æ¯ä¸¢åŒ…äº†ã€‚&lt;/li&gt;
&lt;li&gt;åˆ†ç‰‡1ä»G1è½¬ç§»åˆ°G2ã€‚&lt;/li&gt;
&lt;li&gt;Clientå†æ¬¡å°è¯•Putï¼ŒG1å›å¤ERR_GROUPã€‚äºæ˜¯Clientæ›´æ–°é…ç½®ã€‚å¹¶ä¸”å‘é€Appendæ“ä½œç»™G2ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœä¸æ”¹è¿›æˆ‘ä»¬çš„Serverçš„è¯ï¼Œå°±å‡ºç°é‡å¤Appendçš„é—®é¢˜äº†ã€‚&lt;/li&gt;
&lt;li&gt;æ‰€ä»¥åˆ†ç‰‡æ•°æ®ä¹Ÿåº”å½“åŒ…å«å¯¹å®¢æˆ·ç«¯çš„å›å¤ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ShardData&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;ShardNum&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;                      &lt;span style=&#34;color:#75715e&#34;&gt;// shardçš„ç¼–å·
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;KvDB&lt;/span&gt;        &lt;span style=&#34;color:#a6e22e&#34;&gt;KvDataBase&lt;/span&gt;               &lt;span style=&#34;color:#75715e&#34;&gt;// æ•°æ®åº“
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;ClientReply&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;map&lt;/span&gt;[&lt;span style=&#34;color:#66d9ef&#34;&gt;int64&lt;/span&gt;]&lt;span style=&#34;color:#a6e22e&#34;&gt;CommandContext&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// è¯¥shardä¸­ï¼Œç¼“å­˜å›å¤clientçš„å†…å®¹ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰€ä»¥å½“åˆ†ç‰‡ç§»åŠ¨æ—¶ï¼Œä¸ä»…ä»…æ˜¯é”®å€¼å¯¹ï¼Œä¿å­˜çš„å›å¤ä¹Ÿåº”å½“ç§»åŠ¨åˆ°æ–°çš„groupã€‚&lt;/p&gt;
&lt;h4 id=&#34;åˆ†ç‰‡è¿ç§»&#34;&gt;åˆ†ç‰‡è¿ç§»&lt;/h4&gt;
&lt;p&gt;è¿™é‡Œæˆ‘ä»¬åªå…ˆè€ƒè™‘ï¼š Group Açš„æŸä¸ªåˆ†ç‰‡ï¼ˆè¿™é‡Œå«ä½œs1ï¼‰éœ€è¦è¿ç§»åˆ°Group Bã€‚å¹¶ä¸”Group Aä¸ä¼šæ¸…ç†s1ã€‚&lt;/p&gt;
&lt;p&gt;ä¹¦æ¥**apply æ–°config **, æ­¤æ—¶ï¼Œä¸å†å±äºAçš„åˆ†ç‰‡å·²ç»å¯¹å¤–ä¸å¯ç”¨äº†ã€‚å¦‚æœBå‘ç°äº†è‡ªå·±åº”è¯¥åº”ç”¨è¯¥åˆ†ç‰‡ï¼Œä¹Ÿæš‚æ—¶ä¸èƒ½å†æä¾›è¯¥åˆ†ç‰‡ï¼Œç›´åˆ°Aå‘é€S1ç»™Bã€‚&lt;/p&gt;
&lt;p&gt;æ­¤æ—¶æˆ‘ä»¬æœ‰ä¸¤ç§æ€è·¯ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;A.leader&lt;/code&gt;å¯åŠ¨ä¸€ä¸ªdaemonï¼Œå‘ç°äº†åº”å½“å‘é€çš„S1ï¼Œå¹¶&lt;strong&gt;push&lt;/strong&gt;ç»™B&lt;/li&gt;
&lt;li&gt;&lt;code&gt;B.leader&lt;/code&gt;çš„daemonå‘ç°è‡ªå·±ç¼ºå°‘S1ï¼Œå‘Aå‘é€&lt;strong&gt;pull&lt;/strong&gt;è¯·æ±‚ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ„Ÿè§‰è¿™ä¸¤ç§å…¶å®å·®ä¸å¤šçš„ã€‚ç¬¬ä¸€ç§ï¼Œå¦‚æœä¸€å¼€å§‹æ²¡æ‰¾åˆ°Bçš„leaderï¼Œä¼šå‘é€å¤šä¸ªåŒ…å«æ•°æ®çš„RPCã€‚ç¬¬äºŒç§ï¼Œå¦‚æœä¸€å¼€å§‹æ²¡Pullåˆ°Açš„leaderï¼Œå†æ¬¡å‘é€çš„RPCåŒ…åªåŒ…å«è¯·æ±‚çš„shardç¼–å·ä¿¡æ¯å’Œconfigç¼–å·ã€‚æ‰€ä»¥æˆ‘æ„Ÿè§‰pullçš„æ–¹å¼å¯èƒ½è¦å¥½äº›ã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œå…ˆè®¾è®¡äº†å‡ ä¸ªçŠ¶æ€ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;Serverç›®å‰è´Ÿè´£shard&lt;/th&gt;
&lt;th&gt;Serverç›®å‰ä¸è´Ÿè´£è¯¥shard&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Serverç›®å‰æ‹¥æœ‰shard&lt;/td&gt;
&lt;td&gt;æ­£å¸¸æœåŠ¡ã€‚&lt;/td&gt;
&lt;td&gt;configæ”¹å˜ï¼Œè¯¥serverç­‰å¾…è¢«pull&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Serverç›®å‰æ²¡æœ‰è¯¥shard&lt;/td&gt;
&lt;td&gt;å°è¯•Pullå…¶ä»–Server&lt;/td&gt;
&lt;td&gt;ä¸æˆ‘æ— å…³&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ç›®å‰è¿˜æ²¡æœ‰å¼•å…¥åƒåœ¾å›æ”¶ï¼Œæ‰€ä»¥Serveræš‚æ—¶ä¸éœ€è¦æ¸…ç†å·²ç»è¢«Pullçš„åˆ†ç‰‡ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ShardStatus&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; (
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;Invalid&lt;/span&gt;      &lt;span style=&#34;color:#a6e22e&#34;&gt;ShardStatus&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Invalid&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;Serving&lt;/span&gt;      &lt;span style=&#34;color:#a6e22e&#34;&gt;ShardStatus&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Serving&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;Pulling&lt;/span&gt;      &lt;span style=&#34;color:#a6e22e&#34;&gt;ShardStatus&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Pulling&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;WaitPull&lt;/span&gt;     &lt;span style=&#34;color:#a6e22e&#34;&gt;ShardStatus&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;WaitPull&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;ServingButGC&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ShardStatus&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;ServingButGC&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åPull Dataåç¨‹å®šæ—¶æŸ¥çœ‹ç›®å‰è¿˜æœ‰å“ªäº›åˆ†ç‰‡æ²¡æœ‰ï¼Œå‘å¯¹åº”çš„GIDå‘èµ·Pullè¯·æ±‚ã€‚æ³¨æ„ï¼ŒPullåˆ°ä¹‹åä¹Ÿåº”è¯¥å°†Dataé€šè¿‡Logçš„å½¢å¼å‘é€ç»™Raftã€‚Raft Applyè¿™ä¸ªåŒ…å«åˆ†åŒºçš„logä¹‹åï¼Œå°±å¯ä»¥å°†çŠ¶æ€ä»Pullingè½¬ç§»åˆ°Servingäº†ã€‚æ³¨æ„è¿™é‡Œåˆ†åŒºå‘é€ä½¿ç”¨æ·±æ‹·è´ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;srcData&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ShardData&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;clone&lt;/span&gt;() &lt;span style=&#34;color:#a6e22e&#34;&gt;ShardData&lt;/span&gt;  {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;copyData&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ShardData&lt;/span&gt;{}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;copyData&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;clientReply&lt;/span&gt; = make(&lt;span style=&#34;color:#66d9ef&#34;&gt;map&lt;/span&gt;[&lt;span style=&#34;color:#66d9ef&#34;&gt;int64&lt;/span&gt;]&lt;span style=&#34;color:#a6e22e&#34;&gt;CommandContext&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;copyData&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ShardNum&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;srcData&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ShardNum&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;copyData&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;KvDB&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;srcData&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;KvDB&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Clone&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;clinetId&lt;/span&gt;,&lt;span style=&#34;color:#a6e22e&#34;&gt;msg&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;range&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;srcData&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;clientReply&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;copyData&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;clientReply&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;clinetId&lt;/span&gt;] = &lt;span style=&#34;color:#a6e22e&#34;&gt;msg&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;copyData&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½†æ˜¯ä¹‹å‰æ‹¥æœ‰è¿™ä¸ªShardçš„Serverå¦‚ä½•å¤„ç†WaitPullçŠ¶æ€å‘¢ã€‚é¦–å…ˆï¼ŒWaitPullçš„shardè¢«å…¶ä»–æœåŠ¡å™¨Pullåï¼Œå› ä¸ºå¯èƒ½ä¸¢åŒ…ï¼Œä¸èƒ½ç›´æ¥ä»WaitPullçŠ¶æ€è½¬ç§»åˆ°InvalidçŠ¶æ€ã€‚è€Œæ˜¯åº”å½“ç­‰åˆ°Group B(å‘èµ·pullçš„Server)ç¡®è®¤å·²ç»åº”ç”¨æ–°åˆ†ç‰‡ï¼Œç„¶åå°±èƒ½å½»åº•æ¸…ç†è¿™ä¸ªåˆ†ç‰‡ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æ­¤æœŸé—´ï¼ŒGroup Bæ˜¯å¤„äº&lt;code&gt;ServingButGC&lt;/code&gt;çŠ¶æ€ï¼Œ è¡¨ç¤ºè™½ç„¶ç›®å‰å¯ä»¥ç”¨è¿™ä¸ªåˆ†ç‰‡äº†ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰é€šçŸ¥A ï¼šâ€œæˆ‘å·²ç»æ”¶åˆ°äº†â€ã€‚æ‰€ä»¥Group Bè¿˜è¦å®šæ—¶æ£€æŸ¥è¿™ä¸ªçŠ¶æ€çš„ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨Aæ”¶åˆ°äº†æ¸…ç†è¯·æ±‚ï¼Œå¹¶åœ¨RAFTä¸­Applyäº†ï¼Œé—®é¢˜æ¥äº†ï¼Œå¦‚ä½•å‘Šè¯‰Group Bå·²ç»æ¸…ç†æ‰äº†å‘¢ï¼Ÿå•çº¯å›å¤æ˜¯ä¸é è°±çš„ã€‚å› ä¸ºå¯èƒ½ä¸¢åŒ…ï¼ŒAä¹Ÿå¯èƒ½é‡å¤åƒåœ¾æ¸…ç†ã€‚åº”å½“ä½¿ç”¨ç±»ä¼¼äºå¯¹Clerkå»é‡çš„æœºåˆ¶ã€‚&lt;strong&gt;ä¿å­˜å¯¹å…¶ä»–Groupçš„æ¸…ç†è¯·æ±‚&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å†™çš„æ—¶å€™æƒ³åˆ°äº†ä¸€ä¸ªæ–°é—®é¢˜ï¼šè¢«Pull Dataçš„leaderæ˜¯ç›´æ¥è¿”å›æ•°æ®ï¼Œè¿˜æ˜¯å°†Pull Dataçš„è¯·æ±‚æ”¾è¿›RAFTï¼Œå¹¶é€šè¿‡ä¸€ä¸ªé€šé“ç­‰å¾…å‘¢ï¼Ÿæˆ‘çš„çœ‹æ³•æ˜¯ï¼šå¦‚æœæ»¡è¶³æ¡ä»¶å¯ä»¥ç›´æ¥è¿”å›ã€‚æ”¾è¿›RAFTæ˜¯ä¸ºäº†ä¿è¯çº¿æ€§æ€§ï¼Œä½†æ˜¯å½“åº”ç”¨æ–°é…ç½®åï¼Œæ‰€æœ‰å‘ç”Ÿæ”¹å˜çš„åˆ†åŒºéƒ½è¢«é”ä½äº†ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// å®ˆæŠ¤è¿›ç¨‹ï¼Œè´Ÿè´£è·å–æ–°configçš„åˆ†åŒº
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ShardKV&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;pullData&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;wg&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sync&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;WaitGroup&lt;/span&gt;{}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;RLock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;pullingShards&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;getTargetGidAndShardsByStatus&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;Pulling&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;shards&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;range&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;pullingShards&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;wg&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Add&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;go&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;config&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;shardctrler&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Config&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;shards&lt;/span&gt; []&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;configNum&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;wg&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Done&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;servers&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;config&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Groups&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;PullDataArgs&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#a6e22e&#34;&gt;PulledShard&lt;/span&gt;: &lt;span style=&#34;color:#a6e22e&#34;&gt;shards&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#a6e22e&#34;&gt;ConfigNum&lt;/span&gt;:   &lt;span style=&#34;color:#a6e22e&#34;&gt;config&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Num&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#a6e22e&#34;&gt;Gid&lt;/span&gt;:         &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;me&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;_&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;server&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;range&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;servers&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;PullDataReply&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ok&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;makeEnd&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;server&lt;/span&gt;).&lt;span style=&#34;color:#a6e22e&#34;&gt;Call&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;ShardKV.PullData&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;); &lt;span style=&#34;color:#a6e22e&#34;&gt;ok&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ErrMsg&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;OK&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;					&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Start&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;Op&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;						&lt;span style=&#34;color:#a6e22e&#34;&gt;OpType&lt;/span&gt;: &lt;span style=&#34;color:#a6e22e&#34;&gt;PullNewData&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;						&lt;span style=&#34;color:#a6e22e&#34;&gt;Data&lt;/span&gt;:   &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;					})
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		}(&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;prevCfg&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;shards&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;cfg&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Num&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;RUnlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;wg&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Wait&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;PullDataArgs&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;PulledShard&lt;/span&gt; []&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// éœ€è¦æ‹‰å–çš„shards
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;ConfigNum&lt;/span&gt;   &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;   &lt;span style=&#34;color:#75715e&#34;&gt;// è¯·æ±‚groupçš„ç‰ˆæœ¬å·ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;Gid&lt;/span&gt;         &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;   &lt;span style=&#34;color:#75715e&#34;&gt;// è¯·æ±‚groupçš„id
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;PullDataReply&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;Data&lt;/span&gt;      []&lt;span style=&#34;color:#a6e22e&#34;&gt;ShardData&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;ConfigNum&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// è¯·æ±‚groupçš„ç‰ˆæœ¬å·ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;ErrMsg&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;Err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ShardKV&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;PullData&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;PullDataArgs&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;PullDataReply&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;RLock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;RUnlock&lt;/span&gt;() &lt;span style=&#34;color:#75715e&#34;&gt;// todo è¿™é‡Œèƒ½å¦ä¼˜åŒ–ä¸ºç»†ç²’åº¦é”?
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;_&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;isleader&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;GetState&lt;/span&gt;(); !&lt;span style=&#34;color:#a6e22e&#34;&gt;isleader&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ErrMsg&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;ErrWrongLeader&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ConfigNum&lt;/span&gt; &amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;cfg&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Num&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ErrMsg&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;ErrNotReady&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ConfigNum&lt;/span&gt; &amp;lt; &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;cfg&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Num&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#75715e&#34;&gt;// ä¸å¤ªå¯èƒ½å‘ç”Ÿè¿™ç§æƒ…å†µï¼Œå› ä¸ºå¦‚æœshardæ²¡æœ‰å®Œå…¨åŒæ­¥ï¼Œä¸ä¼šåˆ‡æ¢ä¸ºä¸‹ä¸€ä¸ªconfig
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;		panic(&lt;span style=&#34;color:#a6e22e&#34;&gt;ErrOutDate&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;_&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;shard&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;range&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;PulledShard&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Data&lt;/span&gt; = append(&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Data&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;shardData&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;shard&lt;/span&gt;].&lt;span style=&#34;color:#a6e22e&#34;&gt;clone&lt;/span&gt;())
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ErrMsg&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;OK&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ConfigNum&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;cfg&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Num&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨è·å–äº†åˆ†ç‰‡æ•°æ®åï¼Œå°†åˆ†ç‰‡æ•°æ®æ”¾åˆ°RAFTä¸­ã€‚ç­‰å¾…applieræ‰§è¡Œã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„è¿™é‡Œæœ‰ä¸€ä¸ªå°è®¾è®¡ï¼špull dataä¸­ä¼ configéœ€è¦ä¼ å‰ä¸€ä¸ªã€‚å› ä¸ºserver leaveåï¼Œæˆ‘çš„è®¾è®¡æ˜¯configä¸­ä¼šåˆ é™¤ç›¸å…³ä¿¡æ¯ã€‚æ‰€ä»¥æ–°çš„configå¯èƒ½æ‰¾ä¸åˆ°è¦pullçš„serverï¼Œéœ€è¦ä»å‰ä¸€ä¸ªconfigå¯»æ‰¾ã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œä¸€å®šè¦ä¿è¯è¿›å…¥wait pullçŠ¶æ€åï¼Œè¯¥GROUPå°±ä¸èƒ½æœåŠ¡æ–°çš„Keyäº†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/mit6.824/lab4/blogimage-20231020144944121.png&#34;
	width=&#34;1444&#34;
	height=&#34;766&#34;
	srcset=&#34;https://antio2.cn/tech/mit6.824/lab4/blogimage-20231020144944121_hu89bda5c7c0942bcc502bfec13452e980_300556_480x0_resize_box_3.png 480w, https://antio2.cn/tech/mit6.824/lab4/blogimage-20231020144944121_hu89bda5c7c0942bcc502bfec13452e980_300556_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20231020144944121&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;188&#34;
		data-flex-basis=&#34;452px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘åœ¨è°ƒè¯•æ—¶å°±å‘ç°äº†è¿™æ ·çš„ä¸€ä¸ªåœºæ™¯ï¼š&lt;/p&gt;
&lt;p&gt;å‡å¦‚Group102 åœ¨æŸä¸ªæ—¶åˆ»pulläº†ä¸€ä¸ªæ–°configï¼Œå¹¶æ”¾å…¥raft,ä¹‹ååœ¨apply configä¹‹å‰åˆæ”¾å…¥äº†ä¸€ä¸ªæ–°çš„Put Append Log, groupä¼šè®¤ä¸ºè‡ªå·±å¯¹è¯¥keyè´Ÿè´£ï¼ˆä½†å®é™…ä¸Šåœ¨æ–°configä¸­å·²ç»ä¸è´Ÿè´£äº†ï¼‰ã€‚ç„¶ååœ¨configä¹‹åï¼Œè¯¥putappendä¹‹å‰ï¼Œåˆå‘é€äº†è¯¥shardç»™æ–°çš„groupï¼Œå†åœ¨102ä¸­è¿›è¡ŒputAppendæ“ä½œå¹¶è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå¯¼è‡´missæ‰è¿™ä¸ªæ“ä½œã€‚è¿™æ˜¯å› ä¸ºåœ¨æ”¾å…¥logä¹‹åï¼Œapplyä¹‹å‰ï¼ŒgroupçŠ¶æ€å¯èƒ½æ”¹å˜ï¼Œè¿™ä¸ªè¿‡ç¨‹å¹¶ä¸æ˜¯ä¸€ç›´holdé”å¯¼è‡´çš„ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡åœ¨è¯»å†™æ“ä½œæ—¶ï¼Œå†æ¬¡åˆ¤æ–­èƒ½å¦æœåŠ¡è¯¥shardï¼Œè§£å†³äº†é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/mit6.824/lab4/blogimage-20231020145959808.png&#34;
	width=&#34;922&#34;
	height=&#34;534&#34;
	srcset=&#34;https://antio2.cn/tech/mit6.824/lab4/blogimage-20231020145959808_hu600e21e00884f65e92fcfda48f809b12_48364_480x0_resize_box_3.png 480w, https://antio2.cn/tech/mit6.824/lab4/blogimage-20231020145959808_hu600e21e00884f65e92fcfda48f809b12_48364_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20231020145959808&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;172&#34;
		data-flex-basis=&#34;414px&#34;
	
&gt;&lt;/p&gt;
&lt;h4 id=&#34;åƒåœ¾å›æ”¶&#34;&gt;åƒåœ¾å›æ”¶&lt;/h4&gt;
&lt;p&gt;ç›®å‰Group B ä»Group Aæ‹‰å–åˆ°äº†åˆ†ç‰‡å¹¶ä¸”apply, æ›´æ–°äº†æ–°åˆ†ç‰‡çš„çŠ¶æ€ä¸º&lt;code&gt;ServingButGC&lt;/code&gt;,è¡¨ç¤ºè¿˜æ²¡æœ‰åƒåœ¾å›æ”¶ã€‚æ­¤æ—¶éœ€è¦ä¸€ä¸ªåç¨‹å¾ªç¯æ£€æŸ¥&lt;code&gt;ServingButGC&lt;/code&gt;çš„åˆ†ç‰‡ï¼Œå¹¶ä¸”å°è¯•é€šçŸ¥Group Aåˆ é™¤åˆ†ç‰‡ï¼ˆå…¶å®ä¹Ÿä¸ç”¨çœŸçš„åˆ é™¤ï¼ŒGroup Aå°†åˆ†ç‰‡çŠ¶æ€æ›´æ–°ä¸º&lt;code&gt;Invalid&lt;/code&gt;å°±è¡Œï¼‰&lt;/p&gt;
&lt;p&gt;æ³¨æ„åˆ†ç‰‡çŠ¶æ€éƒ½æ˜¯çŠ¶æ€æœºçš„ä¸€éƒ¨åˆ†ï¼Œæ‰€æœ‰çŠ¶æ€çš„æ›´æ”¹éƒ½è¦é€šè¿‡apply logæ¥è¿›è¡Œã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// å®ˆæŠ¤è¿›ç¨‹ï¼Œè´Ÿè´£é€šçŸ¥éœ€è¦garbage collectåˆ†åŒºçš„æœåŠ¡å™¨ç»„ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ShardKV&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;garbageCollector&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;wg&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sync&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;WaitGroup&lt;/span&gt;{}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;RLock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;gcShards&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;getTargetGidAndShardsByStatus&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;ServingButGC&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;shards&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;range&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;gcShards&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;wg&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Add&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;go&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;config&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;shardctrler&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Config&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;shards&lt;/span&gt; []&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;cfgNum&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;wg&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Done&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;servers&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;config&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Groups&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;GCArgs&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#a6e22e&#34;&gt;GCShard&lt;/span&gt;:   &lt;span style=&#34;color:#a6e22e&#34;&gt;shards&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#a6e22e&#34;&gt;ConfigNum&lt;/span&gt;: &lt;span style=&#34;color:#a6e22e&#34;&gt;cfgNum&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#a6e22e&#34;&gt;Gid&lt;/span&gt;:       &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;me&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;_&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;server&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;range&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;servers&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;GCReply&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ok&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;makeEnd&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;server&lt;/span&gt;).&lt;span style=&#34;color:#a6e22e&#34;&gt;Call&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;ShardKV.GCHandler&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;); &lt;span style=&#34;color:#a6e22e&#34;&gt;ok&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ErrMsg&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;OK&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;					&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Start&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;Op&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;						&lt;span style=&#34;color:#a6e22e&#34;&gt;OpType&lt;/span&gt;: &lt;span style=&#34;color:#a6e22e&#34;&gt;ConfirmGC&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;						&lt;span style=&#34;color:#a6e22e&#34;&gt;Data&lt;/span&gt;:   &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;					})
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;					&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		}(&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;prevCfg&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;shards&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;cfg&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Num&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;RUnlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;wg&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Wait&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;GCArgs&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;GCShard&lt;/span&gt;   []&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// éœ€è¦gcçš„shards
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;ConfigNum&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;   &lt;span style=&#34;color:#75715e&#34;&gt;// è¯·æ±‚groupçš„ç‰ˆæœ¬å·ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;Gid&lt;/span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;   &lt;span style=&#34;color:#75715e&#34;&gt;// è¯·æ±‚groupçš„id
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;GCReply&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;ConfigNum&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// è¯·æ±‚groupçš„ç‰ˆæœ¬å·ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;ErrMsg&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;Err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ShardKV&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;GCHandler&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;GCArgs&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;GCReply&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Lock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;prevReply&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;ok&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;gcReplyMap&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Gid&lt;/span&gt;]; &lt;span style=&#34;color:#a6e22e&#34;&gt;ok&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;prevReply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ErrMsg&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;OK&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;prevReply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ConfigNum&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ConfigNum&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ErrMsg&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;OK&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ConfigNum&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ConfigNum&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Unlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;_&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;isleader&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;GetState&lt;/span&gt;(); !&lt;span style=&#34;color:#a6e22e&#34;&gt;isleader&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ErrMsg&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;ErrWrongLeader&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Unlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ConfigNum&lt;/span&gt; &amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;cfg&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Num&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ErrMsg&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;ErrNotReady&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Unlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ConfigNum&lt;/span&gt; &amp;lt; &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;cfg&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Num&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#75715e&#34;&gt;// ä¸å¤ªå¯èƒ½å‘ç”Ÿè¿™ç§æƒ…å†µï¼Œå› ä¸ºå¦‚æœshard groupæ²¡æœ‰å®Œå…¨åŒæ­¥ï¼Œä¸ä¼šåˆ‡æ¢ä¸ºä¸‹ä¸€ä¸ªconfig
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;		&lt;span style=&#34;color:#75715e&#34;&gt;// å¯èƒ½å‡ºç°åœ¨é‡å¯çš„æƒ…å†µä¸­ï¼Ÿ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ErrMsg&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;ErrOutDate&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Unlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;index&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;currentTerm&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;isleader&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Start&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;Op&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;OpType&lt;/span&gt;: &lt;span style=&#34;color:#a6e22e&#34;&gt;ConfirmPull&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;Data&lt;/span&gt;:   &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	})
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; !&lt;span style=&#34;color:#a6e22e&#34;&gt;isleader&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ErrMsg&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;ErrWrongLeader&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Unlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;applyCh&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; make(&lt;span style=&#34;color:#66d9ef&#34;&gt;chan&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ApplyResult&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;replyChMap&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;index&lt;/span&gt;] = &lt;span style=&#34;color:#a6e22e&#34;&gt;applyCh&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Unlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;select&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;replyMsg&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;applyCh&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;currentTerm&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;replyMsg&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Term&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#75715e&#34;&gt;// å·²ç»è¿›å…¥ä¹‹åçš„termï¼Œleaderæ”¹å˜ï¼ˆå½“å‰serverå¯èƒ½ä»ç„¶æ˜¯leaderï¼Œä½†æ˜¯å·²ç»æ˜¯å‡ ä¸ªtermä¹‹åäº†ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;				&lt;span style=&#34;color:#75715e&#34;&gt;// è¯´æ˜æ‰§è¡Œçš„ç»“æœä¸æ˜¯åŒä¸€ä¸ªlogçš„
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;				&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ErrMsg&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;ErrWrongLeader&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			} &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ConfigNum&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ConfigNum&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ErrMsg&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;OK&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;After&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;500&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Millisecond&lt;/span&gt;):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ErrMsg&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;ErrWrongLeader&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;go&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;CloseIndexCh&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;index&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ShardKV&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;applyConfirmGC&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;msg&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;raft&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ApplyMsg&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Lock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Unlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;op&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;msg&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Command&lt;/span&gt;.(&lt;span style=&#34;color:#a6e22e&#34;&gt;Op&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;op&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Data&lt;/span&gt;.(&lt;span style=&#34;color:#a6e22e&#34;&gt;GCArgs&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ConfigNum&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ConfigNum&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;_&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;shard&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;range&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;GCShard&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;shardStatus&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;shard&lt;/span&gt;] = &lt;span style=&#34;color:#a6e22e&#34;&gt;Serving&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;DPrintf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;[%d.%d] ConfirmGC Config: [%d], Status:[%v]&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;me&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ConfigNum&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;shardStatus&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;DPrintf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Try To Apply OutDated Config [%d]&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ConfigNum&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/*
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;*
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;shard ä»wait pullçŠ¶æ€åˆ°invalid
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ShardKV&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;applyConfirmPull&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;msg&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;raft&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ApplyMsg&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Lock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Unlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;msg&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Command&lt;/span&gt;.(&lt;span style=&#34;color:#a6e22e&#34;&gt;Op&lt;/span&gt;).&lt;span style=&#34;color:#a6e22e&#34;&gt;Data&lt;/span&gt;.(&lt;span style=&#34;color:#a6e22e&#34;&gt;GCArgs&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;gcReplyMap&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Gid&lt;/span&gt;].&lt;span style=&#34;color:#a6e22e&#34;&gt;ConfigNum&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ConfigNum&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;DPrintf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Try Apply OutDated Confirm Pull&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;_&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;shard&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;range&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;GCShard&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;shardStatus&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;shard&lt;/span&gt;] = &lt;span style=&#34;color:#a6e22e&#34;&gt;Invalid&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;result&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ApplyResult&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;ErrMsg&lt;/span&gt;: &lt;span style=&#34;color:#a6e22e&#34;&gt;OK&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;Value&lt;/span&gt;:  &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;Term&lt;/span&gt;:   &lt;span style=&#34;color:#a6e22e&#34;&gt;msg&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;CommandTerm&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ch&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;ok&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;replyChMap&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;msg&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;CommandIndex&lt;/span&gt;]; &lt;span style=&#34;color:#a6e22e&#34;&gt;ok&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;ch&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;result&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;lastAppliedIndex&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;msg&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;CommandIndex&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;gcReplyMap&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Gid&lt;/span&gt;] = &lt;span style=&#34;color:#a6e22e&#34;&gt;GCReply&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;ConfigNum&lt;/span&gt;: &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ConfigNum&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;ErrMsg&lt;/span&gt;:    &lt;span style=&#34;color:#a6e22e&#34;&gt;OK&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;DPrintf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;[%d.%d] Confirm Pull: [%d], Status:[%v]&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;me&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ConfigNum&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;shardStatus&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨å®Œæˆäº†å‰ä¸¤ä¸ªæµ‹è¯•ã€‚&lt;/p&gt;
&lt;h3 id=&#34;snapshot&#34;&gt;Snapshot&lt;/h3&gt;
&lt;p&gt;é¦–å…ˆï¼Œä»KVServerè¿ç§»è¿‡æ¥åŸå§‹çš„Snapshotå®ç°ã€‚&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥è¦è€ƒè™‘ï¼šä»€ä¹ˆçŠ¶æ€éœ€è¦æ”¾åœ¨Snapshotä¸­å‘¢ï¼Ÿæ‰€æœ‰é€šè¿‡Raft Logæ”¹å˜çš„çŠ¶æ€ï¼Œéœ€è¦è¿›è¡Œå¿«ç…§ã€‚&lt;/p&gt;
&lt;p&gt;åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ShardData&lt;/li&gt;
&lt;li&gt;Config&lt;/li&gt;
&lt;li&gt;PrevConfig&lt;/li&gt;
&lt;li&gt;ShardStatus&lt;/li&gt;
&lt;li&gt;åƒåœ¾å›æ”¶çš„å›å¤ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç„¶åæˆ‘åœ¨è¿™é‡Œå‘ç°äº†ä¹‹å‰çš„ä¸€ä¸ªé”™è¯¯ï¼šå¦‚æœGroup Aä»config1è½¬æ¢åˆ°config2,ä½†æ˜¯Group Bæ­¤æ—¶åˆè§‚å¯Ÿåˆ°äº†æ–°çš„å˜åŒ–ï¼Œä»config1æ—¶è·å–åˆ°äº†config3,å°±ä¼šå‘ç”Ÿé”™è¯¯ï¼Œå› ä¸ºå¯èƒ½Group Aå’ŒGroup Båœ¨ä¸åŒçš„Configä¸­å¯¹åŒä¸€ä¸ªshardè´Ÿè´£ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘çš„è§£å†³æ–¹æ³•æ˜¯æ¯æ¬¡è·å–æ–°Configåº”è¯¥å°è¯•è·å–å½“å‰é…ç½®çš„ä¸‹ä¸€ä¸ªï¼Œè€Œä¸æ˜¯ç›´æ¥&lt;code&gt;Query(-1)&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;ç„¶åæ˜¯åˆ›å»ºå¿«ç…§çš„ä»£ç ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ShardKV&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;makeSnapshot&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; !&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;killed&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Sleep&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Millisecond&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;100&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Lock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;sizeNow&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;GetRaftStateSize&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#75715e&#34;&gt;// DPrintf(&amp;#34;Server[%d] Raft Size Is [%d] LastIncludeIndex [%d]&amp;#34;, kv.me, sizeNow, kv.rf.GetLastIncludeIndex())
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sizeNow&lt;/span&gt; &amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;maxraftstate&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;maxraftstate&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;DPrintf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Server[%d.%d] Start to Make Snapshot&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;me&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Snapshot&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;lastAppliedIndex&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;GenSnapshot&lt;/span&gt;())
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;DPrintf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Server[%d.%d] Raft Size Is [%d] After Snapshot&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;gid&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;me&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;GetRaftStateSize&lt;/span&gt;())
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Unlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ShardKV&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;GenSnapshot&lt;/span&gt;() []&lt;span style=&#34;color:#66d9ef&#34;&gt;byte&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;w&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; new(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Buffer&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;encode&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;gob&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;NewEncoder&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;w&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;encode&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Encode&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;cfg&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;||&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;encode&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Encode&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;prevCfg&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;||&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;encode&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Encode&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;shardStatus&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;||&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;encode&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Encode&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;gcReplyMap&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       panic(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Can&amp;#39;t Generate Snapshot&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;_&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;data&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;range&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;shardData&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;encode&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Encode&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;data&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;clone&lt;/span&gt;()) &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          panic(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Can&amp;#39;t Generate Snapshot&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;w&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Bytes&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ShardKV&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;ReadSnapshot&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;snapshot&lt;/span&gt; []&lt;span style=&#34;color:#66d9ef&#34;&gt;byte&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;snapshot&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;||&lt;/span&gt; len(&lt;span style=&#34;color:#a6e22e&#34;&gt;snapshot&lt;/span&gt;) &amp;lt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; { &lt;span style=&#34;color:#75715e&#34;&gt;// bootstrap without any state?
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;r&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;NewBuffer&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;snapshot&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;decode&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;gob&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;NewDecoder&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;r&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;decode&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Decode&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;cfg&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;||&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;decode&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Decode&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;prevCfg&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;||&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;decode&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Decode&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;shardStatus&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;||&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;decode&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Decode&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;gcReplyMap&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       panic(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Can&amp;#39;t Read Snapshot&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;_&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;range&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;shardData&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;decode&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Decode&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;shardData&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;]) &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          panic(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Can&amp;#39;t Read Snapshot&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ShardKV&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;applySnapshot&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;msg&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;raft&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ApplyMsg&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Lock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Unlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;CondInstallSnapshot&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;msg&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;SnapshotTerm&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;msg&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;SnapshotIndex&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;msg&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Snapshot&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;lastAppliedIndex&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;msg&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;SnapshotIndex&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ReadSnapshot&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;msg&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Snapshot&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™é‡Œåœ¨è°ƒè¯•çš„æ—¶å€™å‘ç°çš„é—®é¢˜ï¼šå› ä¸ºå¿«ç…§ä¼šé˜»å¡ä½applyã€‚å¦‚æœapplyçš„é€Ÿåº¦æ…¢çš„è¯ï¼Œä¼šå¯¼è‡´makesnapshotçš„é€Ÿåº¦èµ¶ä¸ä¸Šå¢é•¿logçš„é€Ÿåº¦ã€‚å°±å‡ºç°äº†ä¸€ä¸ªæƒ…æ™¯ï¼šlogsä¸­å…¨éƒ½æ˜¯å·²ç»commit,ä½†è¿˜æ²¡æœ‰applyçš„new config logã€‚å¯¼è‡´ä¸€ç›´ä¸èƒ½å‹ç¼©æ—¥å¿—ã€‚&lt;/p&gt;
&lt;p&gt;è§£å†³æ–¹æ³•ï¼šå¦‚æœfetchNewConfigå‘ç°äº†æ–°çš„é…ç½®ï¼Œå°±æš‚åœä¸€ä¼šï¼ˆæˆ‘è®¾ç½®çš„1sï¼‰,é˜²æ­¢Logæš´æ¶¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;challenge&#34;&gt;Challenge&lt;/h2&gt;
&lt;h3 id=&#34;1garbage-collection-of-state&#34;&gt;1:Garbage collection of state&lt;/h3&gt;
&lt;p&gt;å› ä¸ºæˆ‘ä»¬ä¸€å¼€å§‹å°±è®¾è®¡äº†ï¼šå¦‚æœGroupå¤±å»äº†shardçš„æ‹¥æœ‰æƒï¼Œä¸ä¼šç«‹å³åˆ é™¤ï¼Œè€Œæ˜¯è½¬åˆ°Wait PullçŠ¶æ€ï¼Œå¹¶ä¸”ç¡®è®¤äº†æ•°æ®è¢«Pullåˆ°ï¼Œå†è½¬å…¥InvalidçŠ¶æ€ã€‚æ•°æ®åˆ é™¤å°±å¯ä»¥æ”¾åˆ°InvalidçŠ¶æ€çš„åŒæ—¶åšã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯æˆ‘åœ¨æµ‹è¯•æ—¶æ€»ä¼šè¶…è¿‡é¢„æœŸå­—èŠ‚ä¸€ç‚¹ã€‚è¿™é‡Œä¸€å¼€å§‹æ²¡æƒ³åˆ°æœ‰ä»€ä¹ˆé—®é¢˜ã€‚åæ¥è°ƒè¯•æ‰çœ‹åˆ°ã€‚&lt;/p&gt;
&lt;p&gt;ï¼ˆè¿™é‡Œå‡å®šåˆ†åŒºå¯¹åº”keyï¼‰å› ä¸ºä¸åŒçš„åˆ†ç‰‡æ•°æ®ä¸­å­˜æ”¾å›å¤å®¢æˆ·ç«¯çš„ä¿¡æ¯ã€‚å¯èƒ½å‡ºç°è¿™ç§æƒ…å†µï¼šClient1 åœ¨command1æ—¶ï¼Œè¯·æ±‚åˆ†ç‰‡1ï¼Œåˆ†ç‰‡1å­˜å‚¨å›å¤åœ¨åˆ†ç‰‡æ•°å‰§ä¸­ï¼Œç„¶ååœ¨command2æ—¶ï¼Œè¯·æ±‚åˆ†ç‰‡2ã€‚æ­¤æ—¶ä¸¤ä¸ªåˆ†ç‰‡éƒ½å­˜å‚¨äº†å›å¤ä¿¡æ¯ï¼Œä½†æ˜¯å®é™…ä¸Šç¬¬ä¸€ä¸ªå·²ç»æ²¡ç”¨äº†ã€‚&lt;/p&gt;
&lt;p&gt;è§£å†³æ–¹æ³•ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ¯æ¬¡å­˜å‚¨æ–°å›å¤æ—¶ï¼Œæ£€æŸ¥å…¶ä»–åˆ†ç‰‡ã€‚&lt;/li&gt;
&lt;li&gt;å›å¤ä¸åˆ†ç‰‡ï¼Œæ”¾åœ¨ä¸€ä¸ªå¤§mapé‡Œé¢ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è¿™é‡Œé€‰ç”¨ç¬¬äºŒç§ã€‚æ³¨æ„è¦ä¿®æ”¹Pull Dataå’ŒApply Pull Dataã€Snapshotç­‰çš„å†…å®¹ã€‚&lt;/p&gt;
&lt;p&gt;æ€»ä¹‹æ ¸å¿ƒå°±æ˜¯ä¸è¦ä¿å­˜è¿‡æœŸçš„å®¢æˆ·ç«¯ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/mit6.824/lab4/blogimage-20231020020457285.png&#34;
	width=&#34;1590&#34;
	height=&#34;445&#34;
	srcset=&#34;https://antio2.cn/tech/mit6.824/lab4/blogimage-20231020020457285_hub92dda49a4c44d6f842a5e8608243b49_66710_480x0_resize_box_3.png 480w, https://antio2.cn/tech/mit6.824/lab4/blogimage-20231020020457285_hub92dda49a4c44d6f842a5e8608243b49_66710_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20231020020457285&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;357&#34;
		data-flex-basis=&#34;857px&#34;
	
&gt;&lt;/p&gt;
&lt;h3 id=&#34;2client-requests-during-configuration-changes&#34;&gt;2.Client requests during configuration changes&lt;/h3&gt;
&lt;p&gt;å› ä¸ºä¸€å¼€å§‹è®¾è®¡å°±æ˜¯åˆ†ç‰‡å¤„ç†çš„ï¼Œæ‰€ä»¥æ²¡ä¿®æ”¹å°±è¿‡äº†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¸€ç‚¹å»ºè®®&#34;&gt;ä¸€ç‚¹å»ºè®®&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;åœ¨æœ€å¼€å§‹ï¼Œå…ˆä¸è¦è€ƒè™‘å¤ªå¤šã€‚æ¯”å¦‚ä¸€å¼€å§‹å°±æƒ³ç½‘ç»œåˆ†åŒºä¼šæ€ä¹ˆåŠï¼Œå»¶è¿Ÿä¼šæ€ä¹ˆåŠï¼Œé‡å¯ä¼šæ€ä¹ˆåŠï¼ŸåŒæ—¶æ€è€ƒä¼šå¯¼è‡´æ€è·¯æŒºä¹±ã€‚ä¸è¦æ€•ä»£ç é‡æ„ã€‚&lt;/li&gt;
&lt;li&gt;æ¯å®Œæˆä¸€ç‚¹ä»£ç ï¼Œå¯èƒ½ä¹‹å‰æµ‹è¯•é€šè¿‡çš„åŠŸèƒ½ä¼šå‡ºç°bugï¼Œå…ˆä¿è¯ä¹‹å‰çš„æ­£ç¡®ã€‚&lt;/li&gt;
&lt;li&gt;ä»”ç»†æ€è€ƒç¨‹åºçš„æ‰§è¡Œé¡ºåºã€‚æƒ³ä¸€ä¸‹ä»€ä¹ˆæ“ä½œæ˜¯åŸå­çš„ï¼Œä»€ä¹ˆä¸æ˜¯ï¼Ÿ&lt;/li&gt;
&lt;li&gt;ä»£ç ï¼š&lt;a class=&#34;link&#34; href=&#34;https://github.com/AntiO2/MIT6.824/tree/master/src/shardkv&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;MIT6.824/src/shardkv at master Â· AntiO2/MIT6.824 (github.com)&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
</description>
        </item>
        <item>
        <title>MIT6.824 | åˆ†å¸ƒå¼äº‹åŠ¡,ä»¥Spannerä¸ºä¾‹</title>
        <link>https://antio2.cn/tech/mit6.824/spanner/</link>
        <pubDate>Fri, 06 Oct 2023 00:57:21 +0800</pubDate>
        
        <guid>https://antio2.cn/tech/mit6.824/spanner/</guid>
        <description>&lt;p&gt;&lt;strong&gt;Atomicity: All-or-Nothing and Before-or-After&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;ä¸»é¢˜&#34;&gt;ä¸»é¢˜&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;distributed transactions = concurrency control + atomic commit&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨å¤šä¸ªæœåŠ¡å™¨ä¸Šçš„åˆ†ç‰‡å¤§é‡æ•°æ®è®°å½•ï¼Œå¤§é‡çš„å®¢æˆ·ç«¯&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºæ“ä½œé€šå¸¸æ¶‰åŠå¤šæ¬¡è¯»å–å’Œå†™å…¥     ä¾‹å¦‚ï¼š
&lt;ul&gt;
&lt;li&gt;é“¶è¡Œè½¬è´¦ï¼šå€Ÿè®°å¡å’Œè´·è®°å¡&lt;/li&gt;
&lt;li&gt;voteï¼šæ£€æŸ¥æ˜¯å¦å·²ç»æŠ•ç¥¨ï¼Œè®°å½•æŠ•ç¥¨ï¼Œå¢åŠ è®¡æ•°&lt;/li&gt;
&lt;li&gt;åœ¨ç¤¾äº¤å›¾ä¸­å®‰è£…åŒå‘é“¾æ¥&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æˆ‘ä»¬å¸Œæœ›å¯¹åº”ç”¨ç¨‹åºç¼–å†™è€…éšè—äº¤é”™å’Œå¤±è´¥ ã€‚è¿™æ˜¯ä¸€ä¸ªä¼ ç»Ÿçš„æ•°æ®åº“é—®é¢˜&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœç†Ÿæ‚‰æ•°æ®åº“çš„è¯ï¼Œåº”è¯¥æŒºç†Ÿæ‚‰2PLã€ACIDè¿™äº›æ¦‚å¿µçš„ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;distributed transactions have two big components:
concurrency control (to provide isolation/serializability)
atomic commit (to provide atomicity despite failure)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åœ¨å•æœºä¸Šå®ç°åŸå­æ“ä½œï¼Œä½†æ˜¯åœ¨å¤šä¸ªæœºå™¨ä¸Šè¿›è¡ŒåŸå­æ“ä½œæ˜¯å›°éš¾çš„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¯ä¸²è¡ŒåŒ–&#34;&gt;å¯ä¸²è¡ŒåŒ–&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;What does serializable mean?
you execute some concurrent transactions, which yield results
&amp;ldquo;results&amp;rdquo; means both output and changes in the DB
the results are serializable if:
- there exists a serial execution order of the transaction that yields the same results as the actual execution
(serial means one at a time &amp;ndash; no parallel execution)
(this definition should remind you of linearizability)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¯ä¸²è¡ŒåŒ–å®šä¹‰ï¼šå­˜åœ¨æŸç§é¡ºåºï¼Œé€ä¸€æ‰§è¡Œäº‹åŠ¡èƒ½å¤Ÿè·å¾—ç›¸åŒçš„ç»“æœã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„ï¼šå¯ä¸²è¡ŒåŒ–å¯ä»¥é‡æ’äº‹åŠ¡çš„é¡ºåºï¼Œè€Œå¯çº¿æ€§åŒ–å¿…é¡»æŒ‰ç…§æ“ä½œçš„é¡ºåºè·å–ä¸€è‡´çš„ç»“æœã€‚æ‰€ä»¥è¿™æ ·æ¥çœ‹ï¼Œå¯ä¸²è¡ŒåŒ–è¦æ¯”å¯çº¿æ€§åŒ–å¼±ä¸€äº›ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¹¶å‘æ§åˆ¶&#34;&gt;å¹¶å‘æ§åˆ¶&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;æ‚²è§‚ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½¿ç”¨é”è¿›è¡Œæ§åˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;å¸¸è§æ–¹å¼ï¼š2PL lockingã€‚&lt;/p&gt;
&lt;p&gt;ä¸¥æ ¼é”ï¼šåœ¨äº‹åŠ¡å¼€å§‹å°±ç”³è¯·æ‰€æœ‰æ‰€éœ€è¦çš„é”ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¹è§‚ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;optimistic(no locks)&lt;/p&gt;
&lt;p&gt;abort if not serializable&lt;/p&gt;
&lt;h2 id=&#34;two-phase-commit-2pc&#34;&gt;Two-phase Commit (2PC)&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/mit6.824/spanner/blogimage-20231008235236389.png&#34;
	width=&#34;864&#34;
	height=&#34;479&#34;
	srcset=&#34;https://antio2.cn/tech/mit6.824/spanner/blogimage-20231008235236389_hud67e0433f05678907fdd5ea2d46b5e6a_241393_480x0_resize_box_3.png 480w, https://antio2.cn/tech/mit6.824/spanner/blogimage-20231008235236389_hud67e0433f05678907fdd5ea2d46b5e6a_241393_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20231008235236389&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;180&#34;
		data-flex-basis=&#34;432px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;å‡å¦‚æœåŠ¡å™¨Aæœ‰æ•°æ®Xï¼ŒæœåŠ¡å™¨Bä¸Šæœ‰æ•°æ®y.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;TC sends put(), get(), &amp;amp;c RPCs to A, B
The modifications are tentative, only to be installed if commit.
TC gets to the end of the transaction.
TC sends PREPARE messages to A and B.
If A is willing to commit,
A responds YES.
then A is in &amp;ldquo;prepared&amp;rdquo; state.
otherwise, A responds NO.
Same for B.
If both A and B say YES, TC sends COMMIT messages to A and B.
If either A or B says NO, TC sends ABORT messages.
A/B commit if they get a COMMIT message from the TC.
I.e. they write tentative records to the real DB.
And release the transaction&amp;rsquo;s locks on their records.
A/B acknowledge COMMIT message.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;TCå‘é€PUTæ“ä½œç»™Aå’ŒBæ—¶ï¼ŒAå’ŒBå…ˆå†™å…¥logã€‚å½“TCå‡†å¤‡æäº¤ï¼Œå…ˆå‘Aå’ŒBå‘é€prepareä¿¡æ¯ï¼Œå¦‚æœAå’ŒBéƒ½å‡†å¤‡å¥½äº†æäº¤å¹¶è¿”å›ç»™TCï¼ŒTCå°±å‘é€COMMITä¿¡æ¯ï¼Œå¦åˆ™å‘é€ABORTä¿¡æ¯ã€‚A/Bæ”¶åˆ°COMMITæ¶ˆæ¯ï¼Œå°†æ•°æ®å†™å…¥æ•°æ®åº“ï¼Œå¹¶é‡Šæ”¾æŒæœ‰çš„é”ã€‚&lt;/p&gt;
&lt;p&gt;æ€»ä¹‹ï¼Œè¿˜æ˜¯ä½¿ç”¨WALä¿è¯äº†å¯ä»¥æ­£ç¡®åœ°æ¢å¤ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœBå‡†å¤‡å¥½äº†æäº¤ï¼ˆå›åº”commitç»™prepare RPCï¼‰ï¼Œä½†æ˜¯åœ¨ä¹‹åå´©æºƒäº†ã€‚ æ­¤æ—¶TCå¯èƒ½éƒ½æ”¶åˆ°äº†Aå’ŒBçš„æäº¤æ¶ˆæ¯ï¼Œå¹¶ä¸”å‘é€commitç»™Aå’ŒBï¼ŒAè¿›è¡Œäº†å®‰è£…ã€‚æ‰€ä»¥Båœ¨æ¢å¤åå¿…é¡»è¿›è¡Œcommitã€‚ï¼ˆé€šè¿‡TCé‡è¯•ï¼‰ &lt;strong&gt;if B voted YES, it must &amp;ldquo;block&amp;rdquo;: wait for TC decision.&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨COMMITä¹‹ååè°ƒå™¨å´©æºƒã€‚å°†å†³å®šçš„COMMIT IDä¹Ÿå†™å…¥ç¨³å®šå­˜å‚¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¯ä»¥é€šè¿‡raftæ¥åšåè°ƒè€…å®¹é”™ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¯¹æ¯”ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;åè®®&lt;/th&gt;
&lt;th&gt;RAFT&lt;/th&gt;
&lt;th&gt;2PC&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;å¦‚ä½•ç¡®ä¿æäº¤&lt;/td&gt;
&lt;td&gt;å¤šæ•°è·å¾—log&lt;/td&gt;
&lt;td&gt;æ‰€æœ‰çš„æ•°æ®åˆ†ç‰‡æœåŠ¡å™¨å‘åè°ƒå™¨å›å¤prepare yesä¿¡æ¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å·¥ä½œçš„ç›®æ ‡&lt;/td&gt;
&lt;td&gt;æ‰€æœ‰çš„raft peerå¤åˆ¶ç›¸åŒçš„logs&lt;/td&gt;
&lt;td&gt;ä¸åŒçš„æœåŠ¡å™¨ä¸Šæœ‰ä¸åŒçš„æ•°æ®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ä¸è¶³&lt;/td&gt;
&lt;td&gt;RAFTä¸èƒ½ç¡®ä¿æ‰€æœ‰æœåŠ¡å™¨éƒ½åœ¨å¹²äº‹ã€‚ï¼ˆå› ä¸ºå¤§å¤šæ•°åœ¨åšç›¸åŒçš„äº‹å°±è¡Œï¼‰&lt;/td&gt;
&lt;td&gt;ä¸ä¿è¯å¯ç”¨æ€§ã€‚å› ä¸ºéœ€è¦ç¡®ä¿æ‰€æœ‰çš„æœåŠ¡å™¨éƒ½åšå®Œäº†äº‹&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;spanner&#34;&gt;Spanner&lt;/h2&gt;
&lt;p&gt;Spannerçš„ä¸»è¦ç›®æ ‡æ˜¯ç®¡ç†åœ¨ä¸åŒæ•°æ®ä¸­å¿ƒçš„å¤åˆ¶æ•°æ®ã€‚Spannerå¯ä»¥åŠ¨æ€åœ°æ§åˆ¶é…ç½®ï¼Œå¹¶ä¸”åœ¨ä¸åŒçš„æ•°æ®ä¸­å¿ƒä¹‹å‰æ— æ„ŸçŸ¥åœ°ç§»åŠ¨æ•°æ®ï¼Œå®ç°èµ„æºå¹³è¡¡ã€‚&lt;/p&gt;
&lt;p&gt;R/Wè¯»å†™äº‹åŠ¡é€šè¿‡2PC,2PL, Paxos Groupså®ç°&lt;/p&gt;
&lt;p&gt;R/O åªè¯»äº‹åŠ¡åœ¨æ•°æ®ä¸­å¿ƒè¯»ã€‚æä¾›å¤–éƒ¨è¯»å†™çš„ä¸€è‡´æ€§ï¼Œå½“åœ¨æŸä¸€ä¸ªå‰¯æœ¬ä¸Šè¯»æ—¶ï¼Œåº”å½“è¯»åˆ°æœ€æ–°çš„æ•°æ®ã€‚&lt;/p&gt;
&lt;h2 id=&#34;organization&#34;&gt;Organization&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;å‡è®¾æœ‰3ä¸ªæ•°æ®ä¸­å¿ƒï¼ŒAæœ‰æ•°æ®åˆ†ç‰‡a-m,å¹¶è¿è¡Œåœ¨ä¸€ç»„paxosä¸Šå¤åˆ¶ç»™Bå’ŒCã€‚å¦ä¸€ç»„åˆ†ç‰‡n-zå¯èƒ½ç”±å¦å¤–ä¸€ç»„paxoså¤„ç†ã€‚æˆ–è€…æ˜¯é€šè¿‡RAFTå¤„ç†ï¼ˆç±»ä¼¼äºLab3ä¸­çš„kvserverï¼‰ã€‚è¿è¡Œå¤šç»„paxoså¯ä»¥æé«˜å¹¶è¡Œæ€§ã€‚&lt;/li&gt;
&lt;li&gt;å› ä¸ºâ€œå¤§å¤šæ•°â€çš„è§„åˆ™ï¼Œå¯ä»¥å¾ˆè½»æ¾çš„å¤„ç†æŸä¸ªæ•°æ®ä¸­å¿ƒè¿‡æ…¢æˆ–è€…æŸä¸ªæ•°æ®ä¸­å¿ƒå®•æœºçš„æƒ…å†µï¼Œå› ä¸ºå¤§å¤šæ•°raft peerå›å¤æˆåŠŸå°±è¡Œã€‚&lt;/li&gt;
&lt;li&gt;ä¼˜å…ˆè®¿é—®&lt;em&gt;Replica close to clients&lt;/em&gt;ï¼Œè¿™é‡Œçš„clientså°±æ˜¯å›¾ä¸Šçš„Sç¬¦å·ï¼ˆserverï¼‰ï¼Œå› ä¸ºå¯¹äºspannerè¿™ä¸ªåŸºç¡€æ¶æ„ï¼Œè®¿é—®å®ƒçš„clientå¯èƒ½æ˜¯æ›´ä¸Šå±‚çš„serviceï¼Œæ¯”å¦‚è¯¾ä¸Šæåˆ°çš„gmailã€‚åŒæ—¶ï¼ŒgmailæœåŠ¡å™¨å¯èƒ½å’ŒæŸä¸ªæ•°æ®ä¸­å¿ƒåœ¨åŒä¸€ä¸ªæœºæˆ¿ï¼ˆæˆ–è€…åŒä¸€ä¸ªåŸå¸‚ï¼‰é‡Œé¢ï¼Œé€šè¿‡è®¿é—®æœ€è¿‘çš„replicaï¼Œè·å–R/Oäº‹åŠ¡çš„é«˜æ€§èƒ½ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;challenges&#34;&gt;Challenges&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Read of local replica must yield fresh data.
&lt;ul&gt;
&lt;li&gt;But local replica may not reflect latest Paxos writes!&lt;/li&gt;
&lt;li&gt;è¯»æœ€è¿‘çš„replica,ä¿è¯è¯»åˆ°æœ€æ–°çš„å†™ç»“æœ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;A transaction may involve multiple shards -&amp;gt; multiple Paxos groups.
&lt;ul&gt;
&lt;li&gt;æ”¯æŒè·¨åˆ†ç‰‡çš„äº‹åŠ¡ï¼Œå…·æœ‰ACIDè¯­ä¹‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Transactions that read multiple records must be serializable.
&lt;ul&gt;
&lt;li&gt;But local shards may reflect different subsets of committed transactions!&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;rwè¯»å†™äº‹åŠ¡&#34;&gt;R/Wè¯»å†™äº‹åŠ¡&lt;/h2&gt;
&lt;p&gt;è¯»å†™äº‹åŠ¡ä½¿ç”¨ä¹‹å‰æåˆ°è¿‡çš„2PLå’Œ2PCã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/mit6.824/spanner/blogimage-20231009154427436.png&#34;
	width=&#34;734&#34;
	height=&#34;359&#34;
	srcset=&#34;https://antio2.cn/tech/mit6.824/spanner/blogimage-20231009154427436_hu2f1035746916b94ca76b7a3ea12c19d7_69420_480x0_resize_box_3.png 480w, https://antio2.cn/tech/mit6.824/spanner/blogimage-20231009154427436_hu2f1035746916b94ca76b7a3ea12c19d7_69420_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20231009154427436&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;204&#34;
		data-flex-basis=&#34;490px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;è¿˜æ˜¯ä¹‹å‰çš„è½¬è´¦ä¾‹å­ã€‚&lt;/p&gt;
&lt;p&gt;Cç”Ÿæˆä¸€ä¸ªTID(äº‹åŠ¡ç¼–å·)ï¼Œå¹¶å‘é€read xç»™SAï¼Œread yç»™SBã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„è¿™é‡Œçš„SAå’ŒSBéƒ½æ˜¯ä¹‹å‰æåˆ°è¿‡çš„åˆ†ç‰‡ï¼Œå¹¶ä¸æ˜¯å•ä¸€æœåŠ¡å™¨ï¼Œè€Œæ˜¯ä¸€ç»„Paxos(æˆ–è€…raft)ã€‚Céœ€è¦è®¿é—®SAå’ŒSBçš„leader, åœ¨leaderæœåŠ¡å™¨ä¸Šç»´æŠ¤é”è¡¨ã€‚å¦‚æœåœ¨æ­¤æœŸé—´leaderæ•…éšœï¼Œäº‹åŠ¡å°±abortäº†ï¼Œå› ä¸ºé”çš„ä¿¡æ¯ä¸ä¼šç»è¿‡raftï¼Œè€Œæ˜¯åœ¨leaderä¸Šå•æœºå­˜å‚¨ï¼Œleaderæ•…éšœï¼Œé”ä¿¡æ¯ä¸¢å¤±ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/mit6.824/spanner/blogimage-20231009155139841.png&#34;
	width=&#34;831&#34;
	height=&#34;481&#34;
	srcset=&#34;https://antio2.cn/tech/mit6.824/spanner/blogimage-20231009155139841_hufe3e2b9a8f64a1422e9bee8d8c9a8b72_221217_480x0_resize_box_3.png 480w, https://antio2.cn/tech/mit6.824/spanner/blogimage-20231009155139841_hufe3e2b9a8f64a1422e9bee8d8c9a8b72_221217_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20231009155139841&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;172&#34;
		data-flex-basis=&#34;414px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;ä¹‹åï¼ŒCåœ¨æœ¬åœ°è¿›è¡Œå†™æ“ä½œï¼Œåœ¨å®Œæˆåï¼ŒæŠŠæ•°æ®å‘é€ç»™TCæœåŠ¡å™¨ç»„ (transaction coordinator)ã€‚TCè¿›è¡Œ2PCã€‚&lt;/p&gt;
&lt;h2 id=&#34;read-only-transactions&#34;&gt;Read-only transactions&lt;/h2&gt;
&lt;p&gt;ç›®æ ‡ï¼šåœ¨æœ¬åœ°è¿›è¡Œå¿«é€Ÿçš„åªè¯»äº‹åŠ¡ã€‚no lock, no 2PC, consistencyã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ä¿è¯äº‹åŠ¡çš„å¯ä¸²è¡ŒåŒ–ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¤–éƒ¨ä¸€è‡´æ€§ï¼šExternal Consistency&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœT2åœ¨T1æäº¤ä¹‹åå¼€å§‹ï¼Œé‚£ä¹ˆT2&lt;strong&gt;å¿…é¡»&lt;/strong&gt;çœ‹åˆ°T1çš„ä¿®æ”¹&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;snapshot-isolation&#34;&gt;Snapshot Isolation&lt;/h3&gt;
&lt;p&gt;å¿«ç…§éš”ç¦»ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº‹åŠ¡åˆ†é…æ—¶é—´æˆ³ï¼ˆTSï¼‰&lt;/p&gt;
&lt;p&gt;å¯¹äºR/W, ä¸ºCommitå¼€å§‹çš„æ—¶é—´åˆ†é…TS&lt;/p&gt;
&lt;p&gt;å¯¹äºR/O, ä¸ºStartçš„æ—¶é—´åˆ†é…TS.&lt;/p&gt;
&lt;p&gt;ç„¶åæŒ‰ç…§TSé¡ºåºå®è¡Œäº‹åŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;æ¯ä¸ªReplicaä¿å­˜å¤šä¸ªé”®çš„å€¼å’Œå¯¹åº”çš„æ—¶é—´æˆ³ï¼ˆå¤šç‰ˆæœ¬ï¼‰&lt;/p&gt;
&lt;p&gt;R/Oçš„äº‹åŠ¡å¯èƒ½æŒç»­ä¸€æ®µæ—¶é—´ï¼Œä½†æ˜¯éƒ½åº”å½“è¯»å–äº‹åŠ¡å¼€å§‹çš„æ—¶é—´æˆ³ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/mit6.824/spanner/blogimage-20231009165558642.png&#34;
	width=&#34;748&#34;
	height=&#34;438&#34;
	srcset=&#34;https://antio2.cn/tech/mit6.824/spanner/blogimage-20231009165558642_hu0431f1cdf25bff92b2b4ee96f721da26_187477_480x0_resize_box_3.png 480w, https://antio2.cn/tech/mit6.824/spanner/blogimage-20231009165558642_hu0431f1cdf25bff92b2b4ee96f721da26_187477_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20231009165558642&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;170&#34;
		data-flex-basis=&#34;409px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;T2çš„Read yåœ¨ç°å®æ—¶é—´ä¸­å‘ç”Ÿåœ¨T3 Wyä¹‹åï¼Œä½†æ˜¯å®ƒåº”å½“è¯»å–T2å¼€å§‹æ—¶æ—¶é—´æˆ³yçš„å€¼ï¼Œä¹Ÿå³æ˜¯T1 Write yçš„å€¼ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è§£å†³åœ¨T2å¼€å§‹è¯»å–æ—¶ï¼Œreplicaè¿˜æ²¡æœ‰çœ‹åˆ°T1å†™å…¥çš„é—®é¢˜ï¼ˆå¯èƒ½å› ä¸ºå»¶è¿Ÿï¼Œæˆ–è€…ä¸¢åŒ…ï¼Œç½‘ç»œåˆ†åŒºä¹‹ç±»çš„ï¼‰é‡‡ç”¨äº†Safe Timeæœºåˆ¶ã€‚Replicaå¿…é¡»çœ‹åˆ°T2å¼€å§‹ä¹‹åçš„å†™å…¥ï¼Œè¿™æ ·å°±èƒ½ä¿è¯çœ‹åˆ°åº”è¯¥è¯»åˆ°çš„å€¼ã€‚&lt;/p&gt;
&lt;p&gt;ä¹Ÿåº”å½“ç­‰å¾…å‡†å¤‡å¥½ä½†è¿˜æ²¡æœ‰æäº¤çš„äº‹åŠ¡å®Œæˆã€‚&lt;/p&gt;
&lt;p&gt;åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œ&lt;strong&gt;å¿…é¡»ä¿è¯æ‰€æœ‰æ—¶é’Ÿéƒ½æ˜¯å‡†ç¡®çš„&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è¿™å¯¹r/oå¾ˆé‡è¦ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœTSåç§»åœ°è¿‡å¤§ï¼ˆæ¯”å¦‚æœ¬åœ°æ—¶é’Ÿå¿«äº†ä¸€ä¸ªå°æ—¶ï¼‰ï¼Œ ç”±äºsafe time,éœ€è¦ç­‰å¾…å¾ˆä¹…æ‰èƒ½è¿›è¡Œè¯»å–ï¼ˆæ¯”å¦‚å…¶ä»–æœåŠ¡å™¨æ—¶é—´æ­£å¸¸ï¼Œéœ€è¦ç­‰å¾…ä¸€ä¸ªå°æ—¶æ‰èƒ½çœ‹åˆ°safe timeï¼‰&lt;/li&gt;
&lt;li&gt;TS è¿‡å°ã€‚ç ´åå¤–éƒ¨ä¸€è‡´æ€§ï¼Œæ¯”å¦‚æ…¢äº†ä¸€ä¸ªå°æ—¶ï¼Œå¯èƒ½è¯»å–åˆ°ä¸€ä¸ªå°æ—¶ä¹‹å‰çš„å€¼ï¼Œè€Œä¸ä¼šçœ‹åˆ°æœ€æ–°æäº¤çš„å€¼ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Spanneré€šè¿‡åŸå­é’Ÿã€å‘¨æœŸæ€§å’Œå…¨çƒæ—¶é—´åŒæ­¥ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/mit6.824/spanner/blogimage-20231009172605514.png&#34;
	width=&#34;1920&#34;
	height=&#34;1021&#34;
	srcset=&#34;https://antio2.cn/tech/mit6.824/spanner/blogimage-20231009172605514_hu9725df84e573e3221d2e70bfcde1eb7b_728764_480x0_resize_box_3.png 480w, https://antio2.cn/tech/mit6.824/spanner/blogimage-20231009172605514_hu9725df84e573e3221d2e70bfcde1eb7b_728764_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20231009172605514&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;188&#34;
		data-flex-basis=&#34;451px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯æ—¶é’Ÿä¸å¯èƒ½ä¿è¯ç»å¯¹ç²¾å‡†ï¼Œäºæ˜¯å¼•å…¥äº†æ—¶é—´æˆ³é—´éš”ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆï¼Œå‘åŸå­é’Ÿè¯¢é—®å½“å‰æ—¶é—´ï¼Œç„¶ååŠ å‡ä¸€ä¸ªå¯èƒ½çš„è¯¯å·®å€¼ï¼Œå¾—åˆ°ä¸€ä¸ªåŒºé—´[earliest,latest],åè®®ä¿è¯true timeåœ¨è¿™ä¸ªåŒºé—´å†…ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Start Rule: å¼€å§‹äº‹åŠ¡æˆ–è€…RWæäº¤äº‹åŠ¡çš„æ—¶é—´æˆ³é€‰ç”¨latest&lt;/li&gt;
&lt;li&gt;Commit Wait å½“æäº¤äº‹åŠ¡çš„æ—¶é—´æˆ³ å°äº now.earliestæ‰èƒ½è¿›è¡Œæäº¤ã€‚&lt;/li&gt;
&lt;/ul&gt;
</description>
        </item>
        <item>
        <title>MIT6.824 | Lab 3: Fault-tolerant Key/Value Service</title>
        <link>https://antio2.cn/tech/mit6.824/lab3/</link>
        <pubDate>Fri, 06 Oct 2023 00:49:02 +0800</pubDate>
        
        <guid>https://antio2.cn/tech/mit6.824/lab3/</guid>
        <description>&lt;h2 id=&#34;ç›®æ ‡&#34;&gt;ç›®æ ‡&lt;/h2&gt;
&lt;p&gt;é€šè¿‡åœ¨Lab2ä¸­å®ç°çš„Raftåº“ï¼Œæ„å»ºä¸€ä¸ªå¯å®¹ç¾çš„KVæ•°æ®åº“ã€‚&lt;/p&gt;
&lt;p&gt;éœ€è¦å®ç°çš„æœåŠ¡æœ‰ä¸‰ç§æ“ä½œ:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;Put(key, value)&lt;/code&gt; keyå’Œvalueéƒ½æ˜¯stringï¼Œputè®¾ç½®æŒ‡å®škeyçš„value.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;Append(key, arg)&lt;/code&gt; å°†arg appendåˆ°keyå¯¹åº”çš„valueã€‚ä¸Šï¼Œå¦‚æœæ²¡æœ‰è¯¥keyï¼Œç›¸å½“äºputæ“ä½œã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;Get(key)&lt;/code&gt; è¿”å›å€¼ï¼Œå¦‚æœæ²¡æœ‰è¯¥keyï¼Œè¿”å›ç©ºå­—ç¬¦ä¸²ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;strong consistency&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;If called one at a time, the Get/Put/Append methods should act as if the system had only one copy of its state, and each call should observe the modifications to the state implied by the preceding sequence of calls.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;éœ€è¦å®ç°linearizability.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å®éªŒä»‹ç»ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;This lab has two parts. In part A, you will implement the service without worrying that the Raft log can grow without bound. In part B, you will implement snapshots&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åœ¨Aä¸­å®ç°åŸºæœ¬åŠŸèƒ½ï¼Œ Bä¸­å®ç°å¿«ç…§ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;We supply you with skeleton code and tests in &lt;code&gt;src/kvraft&lt;/code&gt;. You will need to modify &lt;code&gt;kvraft/client.go&lt;/code&gt;, &lt;code&gt;kvraft/server.go&lt;/code&gt;, and perhaps &lt;code&gt;kvraft/common.go&lt;/code&gt;.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;part-a-keyvalue-service-without-snapshots&#34;&gt;Part A: Key/value service without snapshots&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;Each of your key/value servers (&amp;ldquo;kvservers&amp;rdquo;) will have an associated Raft peer.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ¯ä¸ªkvæœåŠ¡å™¨å¯¹åº”ä¸€ä¸ªraft peerã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Clerks send &lt;code&gt;Put()&lt;/code&gt;, &lt;code&gt;Append()&lt;/code&gt;, and &lt;code&gt;Get()&lt;/code&gt; RPCs to the kvserver whose associated Raft is the leader.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;clerk å°†è¯·æ±‚å‘é€ç»™raft leaderä¹‹ä¸Šçš„kvserverã€‚ç„¶åkvserverå°†operationçš„logäº¤ç»™raft leaderï¼ˆé€šè¿‡ä¹‹å‰çš„startï¼‰ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;All of the kvservers execute operations from the Raft log in order, applying the operations to their key/value databases&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å›æƒ³ä¹‹å‰çš„applymsgï¼Œkvserveré€šè¿‡raftï¼Œè·å–applyçš„logï¼Œå¹¶åº”ç”¨åˆ°kvæ•°æ®åº“ä¸­ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;A &lt;code&gt;Clerk&lt;/code&gt; sometimes doesn&amp;rsquo;t know which kvserver is the Raft leader. If the &lt;code&gt;Clerk&lt;/code&gt; sends an RPC to the wrong kvserver, or if it cannot reach the kvserver, the &lt;code&gt;Clerk&lt;/code&gt; should re-try by sending to a different kvserver.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Clerkå¯èƒ½åˆ¤æ–­é”™è¯¯è°æ˜¯raftçš„leaderï¼Œå¦‚æœå‘é”™äº†rpcï¼Œåº”å½“å……å®ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;If the key/value service commits the operation to its Raft log (and hence applies the operation to the key/value state machine), the leader reports the result to the &lt;code&gt;Clerk&lt;/code&gt; by responding to its RPC.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;éœ€è¦commitæ‰èƒ½è¿”å›clerkçš„RPC.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;If the operation failed to commit (for example, if the leader was replaced), the server reports an error, and the &lt;code&gt;Clerk&lt;/code&gt; retries with a different server.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¦‚æœæ²¡æœ‰commitï¼Œåº”å½“report error(æˆ‘è®¤ä¸ºæ­¤å¤„æ˜¯RPCæºå¸¦é”™è¯¯ä¿¡æ¯)ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Your kvservers should not directly communicate; they should only interact with each other through Raft.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;kvserverä¹‹å‰ä¸åº”å½“ç›´æ¥äº¤æµï¼Œè€Œæ˜¯é€šè¿‡Raftåº“ã€‚ï¼ˆç±»ä¼¼äºç½‘ç»œåˆ†å±‚ï¼‰ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;You&amp;rsquo;ll need to add RPC-sending code to the Clerk Put/Append/Get methods in &lt;code&gt;client.go&lt;/code&gt;, and implement&lt;code&gt; PutAppend()&lt;/code&gt; and &lt;code&gt;Get()&lt;/code&gt; RPC handlers in &lt;code&gt;server.go&lt;/code&gt;. These handlers should enter an &lt;code&gt;Op&lt;/code&gt; in the Raft log using &lt;code&gt;Start()&lt;/code&gt;;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åœ¨&lt;code&gt;server.go&lt;/code&gt;ä¸­å®ç°RPCçš„handlerã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;you should fill in the &lt;code&gt;Op&lt;/code&gt; struct definition in &lt;code&gt;server.go&lt;/code&gt; so that it describes a Put/Append/Get operation. Each server should execute &lt;code&gt;Op&lt;/code&gt; commands as Raft commits them, i.e. as they appear on the &lt;code&gt;applyCh&lt;/code&gt;. An RPC handler should notice when Raft commits its &lt;code&gt;Op&lt;/code&gt;, and then reply to the RPC.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å½“raftæäº¤opæ—¶ï¼Œè¿”å›ç»™RPCã€‚&lt;/p&gt;
&lt;h3 id=&#34;client&#34;&gt;Client&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;You have completed this task when you &lt;strong&gt;reliably&lt;/strong&gt; pass the first test in the test suite: &amp;ldquo;One client&amp;rdquo;.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åœ¨æ²¡æœ‰ç½‘ç»œé—®é¢˜çš„æƒ…å†µä¸‹ï¼Œé¦–å…ˆå¼€å§‹å®ç°åªæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯çš„æµ‹è¯•äº†=ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆçœ‹æµ‹è¯•ç”¨ä¾‹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;TestBasic3A&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;t&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;testing&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;T&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#75715e&#34;&gt;// Test: one client (3A) ...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;GenericTest&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;t&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;3A&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}		
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¼€å¯ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œ5ä¸ªæœåŠ¡å™¨ï¼Œæ²¡æœ‰RPC failçš„æƒ…å†µï¼ŒæœåŠ¡å™¨ä¸ä¼šå´©æºƒï¼Œæ²¡æœ‰ç½‘ç»œåˆ†åŒºï¼Œä¸éœ€è¦å¿«ç…§ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æµ‹è¯•é‡Œé¢ï¼Œé€šè¿‡&lt;code&gt;Append&lt;/code&gt;ï¼Œ&lt;code&gt;Get()&lt;/code&gt;,&lt;code&gt;Put()&lt;/code&gt;å‡½æ•°è°ƒç”¨clerkçš„å¯¹åº”å‡½æ•°ï¼Œå¹¶è®°å½•ç›¸åº”çš„log.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Get&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;cfg&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;config&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Clerk&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;OpLog&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;cli&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;) &lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;start&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Now&lt;/span&gt;().&lt;span style=&#34;color:#a6e22e&#34;&gt;UnixNano&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;v&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Get&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;end&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Now&lt;/span&gt;().&lt;span style=&#34;color:#a6e22e&#34;&gt;UnixNano&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;cfg&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;op&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Append&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;porcupine&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Operation&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;Input&lt;/span&gt;:    &lt;span style=&#34;color:#a6e22e&#34;&gt;models&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;KvInput&lt;/span&gt;{&lt;span style=&#34;color:#a6e22e&#34;&gt;Op&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;Key&lt;/span&gt;: &lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt;},
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;Output&lt;/span&gt;:   &lt;span style=&#34;color:#a6e22e&#34;&gt;models&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;KvOutput&lt;/span&gt;{&lt;span style=&#34;color:#a6e22e&#34;&gt;Value&lt;/span&gt;: &lt;span style=&#34;color:#a6e22e&#34;&gt;v&lt;/span&gt;},
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;Call&lt;/span&gt;:     &lt;span style=&#34;color:#a6e22e&#34;&gt;start&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;Return&lt;/span&gt;:   &lt;span style=&#34;color:#a6e22e&#34;&gt;end&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;ClientId&lt;/span&gt;: &lt;span style=&#34;color:#a6e22e&#34;&gt;cli&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       })
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;v&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é‚£ä¹ˆé¦–å…ˆå®ç°&lt;code&gt;client.go/Clerk&lt;/code&gt;ä¸­çš„å¯¹åº”æ¥å£ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Clerk&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;Get&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;) &lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// You will have to modify this function.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;commandId&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;lastAppliedCommandId&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;GetArgs&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;Key&lt;/span&gt;:       &lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;ClientId&lt;/span&gt;:  &lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;clientId&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;CommandId&lt;/span&gt;: &lt;span style=&#34;color:#a6e22e&#34;&gt;commandId&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;serverId&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;lastFoundLeader&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;serverNum&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; len(&lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;servers&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; ; ; &lt;span style=&#34;color:#a6e22e&#34;&gt;serverId&lt;/span&gt; = (&lt;span style=&#34;color:#a6e22e&#34;&gt;serverId&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;%&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;serverNum&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;GetReply&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;ok&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;servers&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;serverId&lt;/span&gt;].&lt;span style=&#34;color:#a6e22e&#34;&gt;Call&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;KVServer.Get&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; !&lt;span style=&#34;color:#a6e22e&#34;&gt;ok&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;||&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ErrWrongLeader&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;||&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ErrTimeout&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;continue&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;lastFoundLeader&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;serverId&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;ck&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;lastAppliedCommandId&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;commandId&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ErrNoKey&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Value&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å› ä¸ºä¸ç¡®å®šè°æ˜¯leaderï¼Œè¿™é‡Œé‡‡ç”¨äº†å¾ªç¯çš„æ–¹å¼ã€‚å¦‚æœå“åº”è¶…æ—¶ï¼Œæˆ–è€…ä¸æ˜¯leaderï¼Œå°è¯•ä¸‹ä¸€ä¸ªæœåŠ¡å™¨ã€‚&lt;/p&gt;
&lt;p&gt;clerkè°ƒç”¨äº†&amp;quot;KVServer.Get&amp;quot;,æ¥ä¸‹æ¥åº”å½“å®ç°&lt;code&gt;KVServer.Get&lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&#34;kvserver&#34;&gt;KVServer&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Op&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// Your definitions here.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// Field names must start with capital letters,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// otherwise RPC will break.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;OpType&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;Key&lt;/span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;Value&lt;/span&gt;     &lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;ClientId&lt;/span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;int64&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;CommandId&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™é‡Œçš„Opç”¨äºäº¤ç»™Raftçš„logã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ApplyResult&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;ErrMsg&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;Value&lt;/span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;Term&lt;/span&gt;   &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ApplyResultæ˜¯KVå±‚æäº¤æ‰€è¿”å›çš„æ¶ˆæ¯ã€‚termç”¨äºåˆ¤æ–­è¯¥msgæ˜¯å¦æœ‰æ•ˆã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;CommandContext&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;CommandId&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;Reply&lt;/span&gt;     &lt;span style=&#34;color:#a6e22e&#34;&gt;ApplyResult&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;CommandContextä¸­ï¼ŒCommandIdæŒ‡ç¤ºè¿”å›æ¶ˆæ¯çš„æŒ‡ä»¤åºåˆ—å·ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨KVServerä¸­ï¼Œå…ˆæ·»åŠ äº†ä¸‰ä¸ªå­—æ®µ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;KVServer&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sync&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Mutex&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;me&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;raft&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Raft&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;applyCh&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;chan&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;raft&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ApplyMsg&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;dead&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;int32&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// set by Kill()
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;maxraftstate&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// snapshot if log grows this big
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// Your definitions here.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;clientReply&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;map&lt;/span&gt;[&lt;span style=&#34;color:#66d9ef&#34;&gt;int64&lt;/span&gt;]&lt;span style=&#34;color:#a6e22e&#34;&gt;CommandContext&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;replyChMap&lt;/span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;map&lt;/span&gt;[&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;]&lt;span style=&#34;color:#66d9ef&#34;&gt;chan&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ApplyResult&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// logçš„indexå¯¹åº”çš„è¿”å›ä¿¡æ¯ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;lastApplied&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…¶ä¸­ï¼ŒclientReplyå­˜å‚¨æ¯ä¸ªclientä¸Šä¸€ä¸ªå·²ç»æ‰§è¡Œå®Œæˆæ“ä½œçš„ç»“æœã€‚&lt;/p&gt;
&lt;p&gt;replyChMapçš„keyæ˜¯æ“ä½œçš„indexï¼Œå¯¹åº”ä¸€ä¸ªæ¥å—æ¶ˆæ¯çš„é€šé“ã€‚&lt;/p&gt;
&lt;p&gt;lastAppliedæ˜¯å½“å‰æœåŠ¡å™¨çš„æ•°æ®åº“ä¸Šæœ€åä¸€æ¬¡æ‰§è¡Œå‘½ä»¤çš„indexã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œå…ˆåˆ¤æ–­Get Rpcä¸­çš„Commandæ˜¯å¦å·²ç»è¢«æ‰§è¡Œè¿‡ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;KVServer&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;Get&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;GetArgs&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;GetReply&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;clientReply&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;ok&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;clientReply&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ClientId&lt;/span&gt;]; &lt;span style=&#34;color:#a6e22e&#34;&gt;ok&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;CommandId&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;clientReply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;CommandId&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Value&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;clientReply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Value&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Err&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;clientReply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ErrMsg&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       } &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;CommandId&lt;/span&gt; &amp;lt; &lt;span style=&#34;color:#a6e22e&#34;&gt;clientReply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;CommandId&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Err&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;ErrOutDate&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// å·²ç»æ²¡æœ‰äº†ä¹‹å‰æ‰§è¡Œçš„è®°å½•ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;       }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åæ„é€ ä¸€ä¸ªopï¼Œäº¤ç»™raft&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;op&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Op&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;OpType&lt;/span&gt;:    &lt;span style=&#34;color:#a6e22e&#34;&gt;GetOperation&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;Key&lt;/span&gt;:       &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Key&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;Value&lt;/span&gt;:     &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;CommandId&lt;/span&gt;: &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;CommandId&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;ClientId&lt;/span&gt;:  &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ClientId&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;index&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;term&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;isLeader&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Start&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;op&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; !&lt;span style=&#34;color:#a6e22e&#34;&gt;isLeader&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Err&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;ErrWrongLeader&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¥ä¸‹æ¥æ€è€ƒï¼Œraftçš„startæ˜¯ç«‹å³è¿”å›çš„ï¼Œå¦‚ä½•çŸ¥é“è¯¥opå·²ç»applyå‘¢ï¼Ÿè¿™å°±è¦ä½¿ç”¨channelæ¥ç­‰å¾…äº†ã€‚å¯ä»¥å…ˆåˆ›å»ºä¸€ä¸ªgoroutineï¼Œç”¨äºåœ¨kvserverå±‚æ¥æ”¶raftå±‚çš„applyæ¶ˆæ¯ï¼Œç„¶åé€šè¿‡è¯¥applyçš„indexæ¶ˆæ¯ï¼Œä¼ ç»™åœ¨Handlerä¸­å¼€å¯çš„channel&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;replyCh&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; make(&lt;span style=&#34;color:#66d9ef&#34;&gt;chan&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ApplyMsg&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;replyChMap&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;index&lt;/span&gt;] = &lt;span style=&#34;color:#a6e22e&#34;&gt;replyCh&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;select&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;replyMsg&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;replyCh&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;term&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;replyMsg&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Term&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#75715e&#34;&gt;// å·²ç»è¿›å…¥ä¹‹åçš„termï¼Œleaderæ”¹å˜ï¼ˆå½“å‰serverå¯èƒ½ä»ç„¶æ˜¯leaderï¼Œä½†æ˜¯å·²ç»æ˜¯å‡ ä¸ªtermä¹‹åäº†ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Err&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;ErrWrongLeader&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       } &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Value&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;replyMsg&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Value&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;After&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;KVTimeOut&lt;/span&gt;):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Err&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;ErrTimeout&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™é‡Œè§£é‡Šä¸ºä»€ä¹ˆä¸èƒ½æ¥å—&lt;code&gt;term != replyMsg.Term&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;è€ƒè™‘è¿™ä¹ˆä¸€ç§æƒ…å†µï¼šæœ‰ä¸‰ä¸ªæœåŠ¡å™¨ï¼šAã€Bã€C&lt;/p&gt;
&lt;p&gt;é¦–å…ˆAåœ¨Term1æ”¶åˆ°GetAè¯·æ±‚ï¼Œå¹¶äº¤ç»™RAFTå±‚ï¼Œindex=1ã€‚ä½†æ˜¯æ­¤æ—¶leaderä»Aå˜åˆ°Bï¼Œç¬¬ä¸€ä¸ªè¯·æ±‚å¯èƒ½å·²ç»commitäº†ï¼Œä¹Ÿå¯èƒ½æ²¡æœ‰å‘é€ç»™Bï¼ŒBå—åˆ°å¦å¤–ä¸€ä¸ªå®¢æˆ·ç«¯çš„è¯·æ±‚Put(A,1),å¹¶ä¸”åœ¨term2æˆåŠŸæäº¤ã€‚æ­¤æ—¶Açš„ç®¡é“æ¥æ”¶åˆ°index=1çš„æäº¤ä¿¡æ¯ï¼Œä½†æ˜¯termæ”¹å˜äº†ã€‚RAFTåªèƒ½ä¿è¯termå’Œindexéƒ½ç›¸åŒæ—¶logç›¸åŒï¼Œæ‰€ä»¥æ­¤æ—¶å‘ç”Ÿé”™è¯¯ã€‚&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥è€ƒè™‘ï¼šä»€ä¹ˆæ—¶å€™åœ¨handlerä¸­åˆ›å»ºçš„ç®¡é“åº”å½“æ¥æ”¶åˆ°ä¿¡æ¯å‘¢ï¼Ÿåº”è¯¥æ˜¯åœ¨raftå‘é€applyChçš„æ—¶å€™ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨KVæœåŠ¡å™¨å¼€å§‹æ—¶åº”å½“kick outä¸€ä¸ªåç¨‹ï¼Œä¸“é—¨ç”¨äºå¤„ç†applyChçš„ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;KVServer&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;handleApplyMsg&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; !&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;killed&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;applyMsg&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;applyCh&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;applyMsg&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;CommandValid&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;go&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;applyCommand&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;applyMsg&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;applyMsg&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;SnapshotValid&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;go&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;applySnapshot&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;applyMsg&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;_&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;DPrintf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Error Apply Msg: [%v]&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;applyMsg&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;KVServer&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;applyCommand&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;msg&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;raft&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ApplyMsg&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;KVServer&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;applySnapshot&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;msg&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;raft&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ApplyMsg&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¥ä¸‹æ¥å®ç°applycommand&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;KVServer&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;applyCommand&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;msg&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;raft&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ApplyMsg&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;applyResult&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ApplyResult&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;op&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;msg&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Command&lt;/span&gt;.(&lt;span style=&#34;color:#a6e22e&#34;&gt;Op&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;applyResult&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Term&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;msg&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;CommandTerm&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;commandContext&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;ok&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;clientReply&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;op&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ClientId&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ok&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;commandContext&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;CommandId&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;op&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;CommandId&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#75715e&#34;&gt;// è¯¥æŒ‡ä»¤å·²ç»è¢«åº”ç”¨è¿‡ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;       &lt;span style=&#34;color:#75715e&#34;&gt;// applyResult = commandContext.Reply
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;switch&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;op&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;OpType&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;GetOperation&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;value&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;ok&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;kvdb&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Get&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;op&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Key&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ok&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#a6e22e&#34;&gt;applyResult&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Value&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;value&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          } &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#a6e22e&#34;&gt;applyResult&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Value&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#a6e22e&#34;&gt;applyResult&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ErrMsg&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;ErrNoKey&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;PutOperation&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;value&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;kvdb&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Put&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;op&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Key&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;op&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Value&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;applyResult&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Value&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;value&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;AppendOperation&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;value&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;kvdb&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Append&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;op&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Key&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;op&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Value&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;applyResult&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Value&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;value&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;default&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;DPrintf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Error Op Type %s&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;op&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;OpType&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;ch&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;ok&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;replyChMap&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;msg&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;CommandIndex&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ok&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;ch&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;applyResult&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;clientReply&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;op&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ClientId&lt;/span&gt;] = &lt;span style=&#34;color:#a6e22e&#34;&gt;CommandContext&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;CommandId&lt;/span&gt;: &lt;span style=&#34;color:#a6e22e&#34;&gt;op&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;CommandId&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;Reply&lt;/span&gt;:     &lt;span style=&#34;color:#a6e22e&#34;&gt;applyResult&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…¶ä¸­ï¼Œkvdbå°±æ˜¯ç”¨mapæ“ä½œå®ç°çš„kvå†…å­˜æ•°æ®åº“ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è°ƒè¯•&#34;&gt;è°ƒè¯•&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;å…³äºå¿ƒè·³é€‰æ‹©&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åœ¨[&lt;a class=&#34;link&#34; href=&#34;https://blog.antio2.cn/index.php/archives/178/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;MIT6.824] Spring2021 Lab 2: Raft - AntiO2&amp;rsquo;s Blog&lt;/a&gt;ä¸­ï¼Œæˆ‘çš„RAFTå†™æ³•æ˜¯å½“æ”¶åˆ°logæ—¶ä¸è§¦å‘å¿ƒè·³ï¼Œè€Œæ˜¯åœ¨ç­‰å¾…å›ºå®šé—´éš”æ—¶å‘é€å¿ƒè·³ã€‚è¿™æ ·å°±ä¼šå¯¼è‡´&lt;code&gt;TestSpeed3A&lt;/code&gt;ä¸­çš„æ“ä½œè¿‡æ…¢ï¼Œå› ä¸ºå®¢æˆ·ç«¯åœ¨ä¸Šä¸€æ¡æ“ä½œæˆåŠŸåæ‰ä¼šè¿›è¡Œä¸‹ä¸€æ¡ï¼Œå¯¼è‡´ä½†å®¢æˆ·ç«¯æ—¶ä¸€æ¡æ“ä½œçš„æ—¶é—´å¿…ç„¶å¤§äºå¿ƒè·³é—´éš”ï¼Œä½†æ˜¯æµ‹è¯•ä¸­è¦æ±‚ä¸€ä¸ªå¿ƒè·³é—´éš”è‡³å°‘è¿›è¡Œ3æ¬¡æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥è¿˜æ˜¯éœ€è¦åœ¨æ”¶åˆ°logæ—¶å‘é€ä¸€æ¡ä¿¡æ¯,ä½†æ˜¯è¿™æ ·åˆä¼šå¯¼è‡´å¤šä¸ªclientåŒæ—¶append logæ—¶ï¼Œå‘é€çš„RPCè¿‡å¤šã€‚&lt;/p&gt;
&lt;p&gt;äºæ˜¯æˆ‘æƒ³äº†å¦‚ä¸‹ä¼˜åŒ–ï¼š&lt;/p&gt;
&lt;p&gt;é¦–å…ˆæ˜¯åœ¨TestPersistConcurrent3Aæµ‹è¯•ä¸­ï¼Œé‡‡ç”¨æ¯æ¬¡æ¥æ”¶æ–°logéƒ½è¦å‘é€ä¸€è½®æ–°æ¶ˆæ¯çš„å½¢å¼ï¼Œå…±å‘é€32104æ¡log&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&amp;hellip; Passed &amp;ndash;  21.7  5 32104 1379&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åœ¨raftçš„tickerä¸­ä¿®æ”¹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Raft&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;ticker&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Lock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;setElectionTime&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Unlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#75715e&#34;&gt;// for append new log
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;go&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;killed&lt;/span&gt;() &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Sleep&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;heartBeat&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;30&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Lock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;status&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;leader&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#75715e&#34;&gt;// å¦‚æœæ˜¯leaderçŠ¶æ€,å‘é€ç©ºåŒ…
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;				&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;setElectionTime&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Unlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;appendEntries&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#66d9ef&#34;&gt;continue&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Unlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;killed&lt;/span&gt;() &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#75715e&#34;&gt;// Your code here to check if a leader election should
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;		&lt;span style=&#34;color:#75715e&#34;&gt;// be started and to randomize sleeping time using
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;		&lt;span style=&#34;color:#75715e&#34;&gt;// time.Sleep().
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Sleep&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;heartBeat&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Lock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;status&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;leader&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#75715e&#34;&gt;// å¦‚æœæ˜¯leaderçŠ¶æ€,å‘é€ç©ºåŒ…
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;setElectionTime&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Unlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;appendEntries&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#66d9ef&#34;&gt;continue&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Now&lt;/span&gt;().&lt;span style=&#34;color:#a6e22e&#34;&gt;After&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;electionTime&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#75715e&#34;&gt;// å¦‚æœå·²ç»è¶…æ—¶ï¼Œ å¼€å§‹é€‰ä¸¾
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;			&lt;span style=&#34;color:#66d9ef&#34;&gt;go&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;startElection&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Unlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç›¸å½“äºæ–°å¢åŠ äº†ä¸€ä¸ªé—´éš”ä¸ºheartbeat/5çš„æ£€æµ‹ï¼Œå¦‚æœæœ‰æ–°çš„logå°±å‘é€RPCè¯·æ±‚ï¼Œæ²¡æœ‰å°±ä¸å‘é€RPCï¼ˆæ­£å¸¸çš„heartbeatæ˜¯æ— è®ºæœ‰æ— æ–°logéƒ½è¦å‘é€ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;å†æ¬¡è¿›è¡Œæµ‹è¯•ï¼Œ&lt;/p&gt;
&lt;blockquote&gt;
&lt;pre&gt;&lt;code&gt;... Passed --  21.5  5 25873 1623
&lt;/code&gt;&lt;/pre&gt;
&lt;/blockquote&gt;
&lt;p&gt;å‘é€çš„RPCå‡å°‘äº†ï¼Œè€Œä¸”è¿›è¡Œçš„æ“ä½œæ•°é‡ä¹Ÿæœ‰æ‰€æå‡ã€‚ï¼ˆç›¸å½“äºè¿›è¡Œäº†æ›´é«˜é¢‘çš„å¿ƒè·³ï¼Œä½†æ˜¯åªæœ‰åœ¨æœ‰æ–°logæœªåŒæ­¥æ—¶ï¼Œæ‰ä¼šè§¦å‘è¿™ç§é«˜é¢‘å¿ƒè·³ï¼‰&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å…³äºData Race&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åœ¨å¤šå®¢æˆ·ç«¯æ—¶,å› ä¸ºæ”¶åˆ°apply msgæ—¶,ä¼šå¯åŠ¨ä¸€ä¸ªapply commandçš„goç¨‹,å¦‚æœå¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶getæˆ–putä¸€ä¸ªkey,ä¼šå¯¼è‡´data race.&lt;/p&gt;
&lt;p&gt;è§£å†³æ–¹æ³•ï¼šå› ä¸ºè¦ä¸¥æ ¼æŒ‰ç…§logé¡ºåºapplyï¼Œæ‰€ä»¥åº”å½“æ˜¯ç›´æ¥è°ƒç”¨apply commandå‡½æ•°ï¼Œè€Œä¸æ˜¯å¯åŠ¨goç¨‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;part-b-keyvalue-service-with-snapshots&#34;&gt;Part B: Key/value service with snapshots&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;The tester passes &lt;code&gt;maxraftstate&lt;/code&gt; to your &lt;code&gt;StartKVServer()&lt;/code&gt;. &lt;code&gt;maxraftstate&lt;/code&gt; indicates the maximum allowed size of your persistent Raft state in bytes (including the log, but not including snapshots).&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;maxraftstateæŒ‡ç¤ºäº†Raftæœ€å¤§çš„logså¤§å°ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;You should compare &lt;code&gt;maxraftstate&lt;/code&gt; to &lt;code&gt;persister.RaftStateSize()&lt;/code&gt;. Whenever your key/value server detects that the Raft state size is approaching this threshold, it should save a snapshot using &lt;code&gt;Snapshot&lt;/code&gt;, which in turn uses &lt;code&gt;persister.SaveRaftState()&lt;/code&gt;. If &lt;code&gt;maxraftstate&lt;/code&gt; is -1, you do not have to snapshot. &lt;code&gt;maxraftstate&lt;/code&gt; applies to the GOB-encoded bytes your Raft passes to &lt;code&gt;persister.SaveRaftState()&lt;/code&gt;.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å½“raftçš„statesize&lt;strong&gt;å¿«è¦æ¥è¿‘&lt;/strong&gt;maxraftstateæ—¶ï¼Œä½¿ç”¨snapshotåˆ¶ä½œå¿«ç…§ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆå®ç°çŠ¶æ€æœºï¼ˆKVæ•°æ®åº“ï¼‰ç”Ÿæˆå’Œå®‰è£…å¿«ç…§&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;KvDataBase&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;GenSnapshot&lt;/span&gt;() []&lt;span style=&#34;color:#66d9ef&#34;&gt;byte&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;w&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; new(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Buffer&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;encode&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;gob&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;NewEncoder&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;w&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;encode&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Encode&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;KvData&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;w&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Bytes&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;KvDataBase&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;InstallSnapshot&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;data&lt;/span&gt; []&lt;span style=&#34;color:#66d9ef&#34;&gt;byte&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;data&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;||&lt;/span&gt; len(&lt;span style=&#34;color:#a6e22e&#34;&gt;data&lt;/span&gt;) &amp;lt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; { &lt;span style=&#34;color:#75715e&#34;&gt;// bootstrap without any state?
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;r&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;NewBuffer&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;data&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;encode&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;gob&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;NewDecoder&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;r&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;encode&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Decode&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;KvData&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       panic(&lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Error&lt;/span&gt;())
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨kvserveræ”¶åˆ°raftå±‚çš„å¿«ç…§æ¶ˆæ¯åï¼Œå°è¯•å°†å¿«ç…§çŠ¶æ€ä¼ é€’ç»™raft,å‘Šè¯‰å®ƒï¼šæˆ‘å‡†å¤‡åº”ç”¨äº†ã€‚ï¼ˆå¦‚æœæ˜¯è¿‡æœŸå¿«ç…§å°±ä¸ä¼šåº”ç”¨ï¼‰ï¼Œç„¶åå¦‚æœraftåº”ç”¨è¯¥å¿«ç…§ï¼Œå°±å®‰è£…ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;KVServer&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;applySnapshot&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;msg&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;raft&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ApplyMsg&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;CondInstallSnapshot&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;msg&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;SnapshotTerm&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;msg&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;SnapshotIndex&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;msg&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Snapshot&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;lastAppliedIndex&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;msg&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;SnapshotIndex&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;kvdb&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;InstallSnapshot&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;msg&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Snapshot&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é¦–å…ˆåœ¨å†…å­˜çš„KVæ•°æ®åº“ä¸­åº”ç”¨å¿«ç…§ï¼Œç„¶åå‘Šè¯‰raftå·²ç»åº”ç”¨äº†å¿«ç…§ã€‚&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥å°±è¦è€ƒè™‘ç”Ÿæˆå¿«ç…§çš„æ—¶æœºäº†ã€‚å› ä¸ºappend logæ˜¯å¹¶å‘çš„ï¼Œåœ¨Start Opæ—¶åˆ¤æ–­æ˜¯å¦ç”Ÿæˆå¿«ç…§æ„Ÿè§‰ä¸å¤ªå¥½ï¼Œå› ä¸ºæ­¤æ—¶æ–°çš„æ“ä½œè¿˜æ²¡æœ‰è¢«åº”ç”¨åˆ°æ•°æ®åº“é‡Œé¢ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœåœ¨applyé‡Œé¢ç”Ÿæˆå¿«ç…§ï¼Œè¿˜èƒ½èµ·åˆ°é˜»å¡æ–°çš„æ“ä½œçš„ä½œç”¨ã€‚æ„Ÿè§‰æ˜¯ä¸ªæŒºå¥½çš„é€‰æ‹©ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬è¿˜éœ€è¦ç»´æŠ¤ä¸€ä¸ªæ–°çš„&lt;code&gt;lastApplied int&lt;/code&gt;ï¼Œ è¡¨ç¤ºåˆ¶ä½œå¿«ç…§æ—¶å·²ç»åº”ç”¨çš„&lt;strong&gt;raftç´¢å¼•&lt;/strong&gt;ã€‚kvserveråœ¨åˆå§‹åŒ–æ—¶ï¼Œåº”å½“å°†lastAppliedåˆå§‹åŒ–ä¸ºsnapshotæ‰€åŒ…å«çš„æœ€åä¸€æ¡ç´¢å¼•ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;kvdb&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Init&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;persister&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ReadSnapshot&lt;/span&gt;())
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;lastAppliedIndex&lt;/span&gt; = int(&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;GetLastIncludeIndex&lt;/span&gt;())
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶ååœ¨ApplyCommandä¸­ï¼Œå¢åŠ åˆ¶ä½œå¿«ç…§ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;lastAppliedIndex&lt;/span&gt; = max(&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;lastAppliedIndex&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;msg&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;CommandIndex&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;GetRaftStateSize&lt;/span&gt;() &amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;maxraftstate&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Snapshot&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;msg&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;CommandIndex&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;kvdb&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;GenSnapshot&lt;/span&gt;())
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;è°ƒè¯•-1&#34;&gt;è°ƒè¯•&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;å…³äºç”Ÿæˆsnapshotçš„æ—¶æœº&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä¸Šé¢çš„å‡ è¡Œä»£ç å·²ç»è¶³å¤Ÿé€šè¿‡3Bçš„å‰å‡ ä¸ªæµ‹è¯•ï¼Œä½†æ˜¯åœ¨TestSnapshotRecoverManyClients3Bä¸­å‡ºç°äº†é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;æŠ¥é”™&lt;code&gt;test_test.go:362: logs were not trimmed (56767 &amp;gt; 8*1000)&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;åœ¨å¤šä¸ªå®¢æˆ·ç«¯æ—¶ï¼Œè™½ç„¶æˆåŠŸç”Ÿæˆäº†å¿«ç…§ï¼Œä½†æ˜¯å‡ºç°äº†è¿™ä¹ˆä¸€ç§æƒ…å†µï¼š&lt;/p&gt;
&lt;p&gt;åœ¨applyä¸€ä¸ªæ–°çš„æ“ä½œåï¼Œå‘ç°raftçš„sizeè¿‡å¤§ï¼Œæ¯”å¦‚æ˜¯10000ï¼Œè¿™ä¸ªæ—¶å€™ç”Ÿæˆå¿«ç…§ï¼Œä½†æ˜¯æ–°applyçš„indexå¯èƒ½åªå¾€å‰æ¨äº†å‡ æ¡ï¼Œæ¯”å¦‚æ—§logæœ‰167æ¡ï¼Œå…¶ä¸­åªæœ‰5æ¡è¢«ç¡®è®¤applyäº†ï¼Œç”Ÿæˆå¿«ç…§åè¿˜æœ‰162æ¡åœ¨raft stateä¸­ã€‚&lt;/p&gt;
&lt;p&gt;å‡ºç°è¿™ç§æƒ…å†µï¼Œå¯èƒ½æ˜¯applyè¿‡æ…¢, å› ä¸ºsnapshotæœ¬èº«è¦å¯¹æ•°æ®åº“ç¼–ç å­˜å‚¨ï¼Œéœ€è¦è€—è´¹æ¯”è¾ƒé•¿çš„æ—¶é—´ï¼Œæ‰€ä»¥ä¸èƒ½æ¯æ¬¡applyéƒ½è¿›è¡Œä¸€æ¬¡snapshotæ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥åº”å½“æ¯éš”ä¸€æ®µæ—¶é—´è¿›è¡Œsnapshotæ“ä½œï¼Œè€Œä¸æ˜¯æ¯æ¬¡applycommandéƒ½è¿›è¡Œã€‚æ¯”å¦‚ç›®å‰commit indexæ˜¯100ï¼ˆå‡è®¾è¶…è¿‡äº†è®¾å®šçš„max stateï¼‰ï¼Œapply index æ˜¯0ï¼Œä½¿ç”¨å®šæ—¶å™¨ï¼Œå°±å¯ä»¥è®©kvserverå¿«é€Ÿapply commandã€‚è€Œä¸æ˜¯åœ¨æ¯æ¬¡applyä¹‹åè¿›è¡Œsnapshotæ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;éœ€è¦ä¿®æ”¹raftä»£ç &lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å› ä¸ºæ‰€æœ‰çš„kvserveréƒ½èƒ½ç‹¬ç«‹ç”Ÿæˆsnapshot,æ‰€ä»¥å¯èƒ½å‡ºç°leaderå°è¯•å‘é€çš„logå·²ç»ä¸å­˜åœ¨äºfollowerçš„logä¸­çš„æƒ…å†µï¼Œè¿™ç§æ—¶å€™å°±éœ€è¦åˆ¤æ–­å“ªäº›logsæ˜¯æœ‰ç”¨çš„ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;PrevLogIndex&lt;/span&gt; &amp;lt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lastIncludeIndex&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// è¿™é‡Œå¯èƒ½å‡ºç°args.PrevLogIndex &amp;lt; lastIncludeIndexçš„æƒ…å†µ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// å¦‚æœæ‰€æœ‰çš„logséƒ½å¾ˆè¿‡æ—¶ï¼ˆå·²ç»åŒ…å«åœ¨å½“å‰å¿«ç…§é‡Œé¢ï¼‰ï¼Œå°±éƒ½ä¸éœ€è¦ï¼Œå¦åˆ™ä¿ç•™æ–°çš„ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;entryLen&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; len(&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Entries&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;PrevLogIndex&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;IndexT&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;entryLen&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lastIncludeIndex&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logger&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Printf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;[%d] receive outdated logs before snapshot&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;me&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Success&lt;/span&gt; = &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Conflict&lt;/span&gt; = &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logLatch&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;RUnlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;trim&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lastIncludeIndex&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;PrevLogIndex&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// å¤šä½™çš„éƒ¨åˆ†
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// args.PrevLogIndex+IndexT(entryLen) &amp;gt; lastIncludeIndex
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;//     IndexT(entryLen) &amp;gt; trim
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;PrevLogIndex&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Entries&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;trim&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;].&lt;span style=&#34;color:#a6e22e&#34;&gt;Index&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;PrevLogTerm&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Entries&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;trim&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;].&lt;span style=&#34;color:#a6e22e&#34;&gt;Term&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Entries&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Entries&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;trim&lt;/span&gt;:]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å› ä¸ºè¿™ä¸ªé—®é¢˜åœ¨Lab2Dä¸­æ²¡æœ‰å‡ºç°ï¼Œæ‰€ä»¥å½“æ—¶æ²¡æœ‰å‘ç°è¿™ä¸ªbugã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;snapshotçš„å†…å®¹ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä¿å­˜å¯¹clientçš„å†å²å›å¤ä¹Ÿåº”å½“è¢«ä¿å­˜åœ¨snapshotçš„å¿«ç…§ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å…³äºé‡å¤çš„Put/Append&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å½“putappendé‡å¤æ—¶ï¼Œä¹Ÿåº”å½“è¿”å›ã€‚è¿™æ ·clientæ‰èƒ½æ›´æ–°commandid&lt;/p&gt;
&lt;p&gt;å› ä¸ºåœ¨ä¸å¯é ç½‘ç»œç¯å¢ƒä¸‹ï¼Œå¯èƒ½å·²ç»è¿›è¡Œäº†æ›´æ–°æ“ä½œï¼Œä½†æ˜¯æ²¡æœ‰åŠæ—¶è¿”å›ï¼Œclerkå†æ¬¡å°è¯•è¯·æ±‚ï¼Œæ­¤æ—¶ç»“æœå·²ç»å­˜æ”¾å¥½äº†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/mit6.824/lab3/blogimage-20231006164207915.png&#34;
	width=&#34;1920&#34;
	height=&#34;1021&#34;
	srcset=&#34;https://antio2.cn/tech/mit6.824/lab3/blogimage-20231006164207915_huc279c0c9ce868bde0874e32765ac52d6_1797123_480x0_resize_box_3.png 480w, https://antio2.cn/tech/mit6.824/lab3/blogimage-20231006164207915_huc279c0c9ce868bde0874e32765ac52d6_1797123_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20231006164207915&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;188&#34;
		data-flex-basis=&#34;451px&#34;
	
&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>MIT6.824|Chain Replication</title>
        <link>https://antio2.cn/tech/mit6.824/chain_replication/</link>
        <pubDate>Sun, 01 Oct 2023 00:44:32 +0800</pubDate>
        
        <guid>https://antio2.cn/tech/mit6.824/chain_replication/</guid>
        <description>&lt;img src="https://antio2.cn/tech/mit6.824/chain_replication/blogimage-20230929225932240.png" alt="Featured image of post MIT6.824|Chain Replication" /&gt;&lt;h1 id=&#34;é“¾å¼å¤åˆ¶ç³»ç»Ÿlectureç¬”è®°&#34;&gt;é“¾å¼å¤åˆ¶ç³»ç»Ÿlectureç¬”è®°&lt;/h1&gt;
&lt;h2 id=&#34;æ„å»ºå¤åˆ¶çŠ¶æ€æœº&#34;&gt;æ„å»ºå¤åˆ¶çŠ¶æ€æœº&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;æ–¹æ¡ˆä¸€ï¼šRun all ops through Raft/Paxos&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€šè¿‡å…±è¯†ç®—æ³•è¿›è¡Œæ“ä½œ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ–¹æ¡ˆ2ï¼šConfiguration service + P/B replication&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é…ç½®æœåŠ¡å™¨åº•å±‚é€šè¿‡Raftæˆ–è€…å…¶ä»–å…±è¯†æ€§ç®—æ³•å®ç°ã€‚&lt;/p&gt;
&lt;h3 id=&#34;é“¾å¼å¤åˆ¶æ¦‚è§ˆ&#34;&gt;é“¾å¼å¤åˆ¶æ¦‚è§ˆ&lt;/h3&gt;
&lt;p&gt;å¯¹äºå¾ˆå¤§é‡çš„æ“ä½œï¼Œæ¯”å¦‚ä¸Šäº¿çº§åˆ«çš„kvå¯¹ï¼Œ&lt;em&gt;Run all ops through Raft&lt;/em&gt; çš„æ€§èƒ½ä¼šå¾ˆä½ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€èˆ¬é€‰æ‹©å…±è¯†æ€§ç®—æ³•+ä¸»ä»å¤‡ä»½ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç‰¹è‰²ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Read ops&lt;/li&gt;
&lt;li&gt;Simple recovery plan&lt;/li&gt;
&lt;li&gt;å¼ºçº¿æ€§å‹&lt;/li&gt;
&lt;li&gt;influential&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/mit6.824/chain_replication/blogimage-20230929212637720.png&#34;
	width=&#34;1182&#34;
	height=&#34;663&#34;
	srcset=&#34;https://antio2.cn/tech/mit6.824/chain_replication/blogimage-20230929212637720_huda539a0f4d2e83a1603aaff33bd7ea6b_399625_480x0_resize_box_3.png 480w, https://antio2.cn/tech/mit6.824/chain_replication/blogimage-20230929212637720_huda539a0f4d2e83a1603aaff33bd7ea6b_399625_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20230929212637720&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;178&#34;
		data-flex-basis=&#34;427px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;é…ç½®ä½¿ç”¨RAFTåè®®ï¼Œåè°ƒæœåŠ¡å™¨è®°å½•é“¾å¼æœåŠ¡å™¨æœ‰å“ªäº›ç»“ç‚¹ã€‚C1å‘S1å‘é€å†™è¯·æ±‚ï¼Œç„¶åè¿›è¡Œé“¾å¼å¤åˆ¶ï¼Œç›´åˆ°S3ï¼ˆå°¾ç»“ç‚¹ï¼‰å‘é€ACKï¼Œæ­¤æ—¶Commitæ“ä½œã€‚æ‰€æœ‰çš„è¯»å–éƒ½å‘S3è¯·æ±‚ã€‚è¿™æ ·å°±ä¿è¯äº†çº¿æ€§ä¸€è‡´æ€§ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¤±è´¥çš„æƒ…å†µ&#34;&gt;å¤±è´¥çš„æƒ…å†µï¼š&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;å¤´éƒ¨æœåŠ¡å™¨ï¼ˆS1ï¼‰å´©æºƒ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é…ç½®æœåŠ¡å™¨é€‰ç”¨ä¸‹ä¸€ä¸ªç»“ç‚¹S2å½“ä½œå¤´éƒ¨ã€‚S2ä¸èƒ½è‡ªå·±è¯´è‡ªå·±æ˜¯å¤´éƒ¨ã€‚è¿™æ ·å°±é¿å…äº†è„‘è£‚ã€‚å› ä¸ºå¤´éƒ¨é€‰ç”¨éƒ½æ˜¯ç”±é…ç½®æœåŠ¡å™¨å†³å®šçš„ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸­éƒ¨æœåŠ¡å™¨ï¼ˆS2ï¼‰å´©æºƒ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é…ç½®æœåŠ¡å™¨é€šçŸ¥å½¢æˆæ–°çš„é“¾ã€‚S1é‡å‘æœªå‘é€åˆ°S3çš„ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å°¾éƒ¨æœåŠ¡å™¨ï¼ˆS3ï¼‰å´©æºƒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é…ç½®æœåŠ¡å™¨é€šçŸ¥&lt;strong&gt;å®¢æˆ·ç«¯&lt;/strong&gt;ï¼Œæ–°çš„å°¾éƒ¨æ˜¯S2&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/mit6.824/chain_replication/blogimage-20230929225932240.png&#34;
	width=&#34;833&#34;
	height=&#34;480&#34;
	srcset=&#34;https://antio2.cn/tech/mit6.824/chain_replication/blogimage-20230929225932240_hub039b5ce7f446947424e31e9744f0a23_228447_480x0_resize_box_3.png 480w, https://antio2.cn/tech/mit6.824/chain_replication/blogimage-20230929225932240_hub039b5ce7f446947424e31e9744f0a23_228447_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20230929225932240&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;173&#34;
		data-flex-basis=&#34;416px&#34;
	
&gt;&lt;/p&gt;
&lt;h3 id=&#34;add-replica&#34;&gt;Add Replica&lt;/h3&gt;
&lt;p&gt;å°†æ–°çš„æœåŠ¡å™¨åˆ›å»ºä¸ºæ–°çš„å°¾éƒ¨ï¼Œå¼€å§‹ä»æ—§å°¾éƒ¨å¤åˆ¶çŠ¶æ€åˆ°æ–°çš„æœåŠ¡å™¨ã€‚è¿™ä¸ªè¿‡ç¨‹å¯èƒ½æŒç»­å¾ˆä¹…ï¼Œå½“å®Œå…¨å®Œæˆæ—§å°¾éƒ¨çš„å¤åˆ¶ï¼Œå°±å¯ä»¥æˆä¸ºæ–°çš„å°¾éƒ¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å’Œraftçš„æ¯”è¾ƒ&#34;&gt;å’ŒRAFTçš„æ¯”è¾ƒ&lt;/h2&gt;
&lt;p&gt;ä¼˜ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å°†è¯»å†™æ“ä½œåˆ†æ‹†åˆ°å¤´éƒ¨å’Œå°¾éƒ¨ã€‚&lt;/li&gt;
&lt;li&gt;å¤´éƒ¨åªä¼šå‘é€ä¸€ä¸ªRPCï¼ˆåˆ°é“¾ä¸Šä¸‹ä¸€ä¸ªç»“ç‚¹ï¼‰&lt;/li&gt;
&lt;li&gt;åªä¼šä»å°¾éƒ¨è¯»å–&lt;/li&gt;
&lt;li&gt;Simple Crash Recovery&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¼ºç‚¹:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åªè¦æœ‰ä¸€å°æœåŠ¡å™¨failï¼Œå°±ä¼šé‡æ–°é…ç½®ï¼ˆå¯¹äºraftæ¥è¯´ï¼Œå°‘æ•°æœåŠ¡å™¨å®•æœºä¸ä¼šé€ æˆæ•´ä¸ªæœåŠ¡åœæ­¢ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å¢åŠ å¹¶å‘é‡&#34;&gt;å¢åŠ å¹¶å‘é‡&lt;/h2&gt;
&lt;p&gt;è¿™é‡ŒåŒæ—¶é…ç½®äº†ä¸‰æ¡é“¾ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‰ä¸ªåˆ†ç‰‡ä½¿ç”¨ç›¸åŒçš„æœåŠ¡å™¨ï¼Œå´æœ‰ä¸åŒçš„é“¾ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ ·å°±è¿›è¡Œäº†ä¸€å®šçš„è´Ÿè½½å‡è¡¡&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/mit6.824/chain_replication/blogimage-20230929230655103.png&#34;
	width=&#34;837&#34;
	height=&#34;479&#34;
	srcset=&#34;https://antio2.cn/tech/mit6.824/chain_replication/blogimage-20230929230655103_hu59f71ea60aaca819e312bd170112e51a_220515_480x0_resize_box_3.png 480w, https://antio2.cn/tech/mit6.824/chain_replication/blogimage-20230929230655103_hu59f71ea60aaca819e312bd170112e51a_220515_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20230929230655103&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;174&#34;
		data-flex-basis=&#34;419px&#34;
	
&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>MIT6.824 | ZooKeeperé˜…è¯»</title>
        <link>https://antio2.cn/tech/mit6.824/zookeeper/</link>
        <pubDate>Fri, 29 Sep 2023 00:41:14 +0800</pubDate>
        
        <guid>https://antio2.cn/tech/mit6.824/zookeeper/</guid>
        <description>&lt;img src="https://antio2.cn/tech/mit6.824/zookeeper/blogimage-20230926230921979.png" alt="Featured image of post MIT6.824 | ZooKeeperé˜…è¯»" /&gt;&lt;h2 id=&#34;æ¦‚è§ˆ&#34;&gt;æ¦‚è§ˆ&lt;/h2&gt;
&lt;p&gt;ZooKeeperæ˜¯å®ç°åˆ†å¸ƒå¼åè°ƒçš„æœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘é¦–å…ˆé€šè¿‡&lt;a class=&#34;link&#34; href=&#34;https://zhuanlan.zhihu.com/p/72902467&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ZooKeeper è¯¦è§£ - çŸ¥ä¹ (zhihu.com)&lt;/a&gt;äº†è§£äº†ä»¥ä¸‹Zookeeperæ˜¯ä»€ä¹ˆï¼Œè¯¥å¦‚ä½•ä½¿ç”¨ï¼Œè¿™æ ·å°±å¯¹æ¥ä¸‹æ¥åº•å±‚å®ç°è¦å¹²ä»€ä¹ˆæœ‰äº†ä¸€å®šçš„äº†è§£ã€‚&lt;/p&gt;
&lt;h2 id=&#34;the-zookeeper-service&#34;&gt;&lt;strong&gt;The ZooKeeper service&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/mit6.824/zookeeper/blogimage-20230926230921979.png&#34;
	width=&#34;359&#34;
	height=&#34;194&#34;
	srcset=&#34;https://antio2.cn/tech/mit6.824/zookeeper/blogimage-20230926230921979_hu6291db000fa3b259178aef3c90beb5dd_12677_480x0_resize_box_3.png 480w, https://antio2.cn/tech/mit6.824/zookeeper/blogimage-20230926230921979_hu6291db000fa3b259178aef3c90beb5dd_12677_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20230926230921979&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;185&#34;
		data-flex-basis=&#34;444px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;zookeeperä½¿ç”¨åˆ†å±‚ç»“ç‚¹çš„å½¢å¼æä¾›æ•°æ®ç»“ç‚¹ã€‚è¿™äº›ç»“ç‚¹å°±æ˜¯å®¢æˆ·ç«¯é€šè¿‡APIè¿›è¡Œæ“ä½œçš„æ•°æ®å¯¹è±¡ã€‚&lt;/p&gt;
&lt;p&gt;Znodeæœ‰ä¸¤ç§ç±»å‹ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Regular:&lt;/strong&gt; Clients manipulate regular znodes by creating&lt;/p&gt;
&lt;p&gt;and deleting them explicitly;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Ephemeral:&lt;/strong&gt; Clients create such znodes, and they ei&lt;/p&gt;
&lt;p&gt;ther delete them explicitly, or let the system remove&lt;/p&gt;
&lt;p&gt;them automatically when the session that creates&lt;/p&gt;
&lt;p&gt;them terminates (deliberately or due to a failure).&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æœ‰æ™®é€šæˆ–æš‚æ—¶çš„ä¸¤ç§ç»“ç‚¹ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Additionally, when creating a new znode, a client can&lt;/p&gt;
&lt;p&gt;set a &lt;em&gt;sequential&lt;/em&gt; flag. Nodes created with the sequen&lt;/p&gt;
&lt;p&gt;tial flag set have the value of a monotonically(å•è°ƒçš„) increas&lt;/p&gt;
&lt;p&gt;ing counter appended to its name. If &lt;em&gt;n&lt;/em&gt; is the new znode&lt;/p&gt;
&lt;p&gt;and &lt;em&gt;p&lt;/em&gt; is the parent znode, then the sequence value of &lt;em&gt;n&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;is never smaller than the value in the name of any other&lt;/p&gt;
&lt;p&gt;sequential znode ever created under p.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è¿™å°±æ˜¯è¯´ï¼Œå®¢æˆ·ç«¯å¯ä»¥ç»™åˆ›å»ºç»“ç‚¹ä¸€ä¸ªé¡ºåºã€‚æ¯”å¦‚æœ‰çˆ¶ç»“ç‚¹Pï¼Œç„¶åæœ‰ä¸€ä¸ªå•è°ƒé€’å¢çš„è®¡æ•°å™¨ï¼Œæ¯”å¦‚Pä¸‹æœ‰ç»“ç‚¹Z1,Z3,Z5,ä¸‹ä¸€ä¸ªåˆ›å»ºçš„é¡ºåºç»“ç‚¹ç¼–å·ä¸€å®šå¤§äº5ã€‚ï¼ˆæˆ‘è®¤ä¸ºè¿™é‡Œä¸ä¸€å®šæ˜¯è¿ç»­çš„è®¡æ•°å™¨ï¼Œå¯èƒ½æœ‰ä¸´æ—¶ç»“ç‚¹è·å–è®¡æ•°å™¨ï¼Œç„¶ååœ¨ä¼šè¯ç»“æŸæ—¶æ¶ˆå¤±ï¼‰ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ZooKeeper implements watches to allow clients to&lt;/p&gt;
&lt;p&gt;receive timely notifications of changes without requir&lt;/p&gt;
&lt;p&gt;ing polling.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å®¢æˆ·ç«¯åœ¨ä½¿ç”¨watchæ ‡è¯†è¿›è¡Œæ“ä½œæ—¶ï¼ˆgetï¼‰,å¦‚æœå¾—åˆ°çš„å€¼åœ¨ä¹‹åè¢«æ”¹å˜ï¼Œå®¢æˆ·ç«¯ä¼šè¢«é€šçŸ¥ï¼Œä½†æ˜¯ä¸ä¼šçŸ¥é“ä¿®æ”¹åçš„å€¼ã€‚å°±æ˜¯è¯´ï¼ŒæœåŠ¡å™¨å‘Šè¯‰å®¢æˆ·ç«¯ï¼šâ€œä½ ä¹‹å‰æŸ¥æ‰¾çš„å€¼è¢«ä¿®æ”¹äº†ï¼Œä½†æ˜¯ä¿®æ”¹æˆå¤šå°‘æˆ‘ä¸è¯´â€ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Watches are one-time triggers associated with a session;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;watchesåªä¼šè¢«è§¦å‘ä¸€æ¬¡ï¼ˆé€šè¿‡ä¸€æ¬¡æ›´æ”¹è§¦å‘ï¼‰ï¼Œå¹¶ä¸”æ˜¯å…³è”å½“å‰ä¼šè¯çš„ï¼Œå¦‚æœä¼šè¯è¢«å…³é—­äº†ï¼Œwatchä¹Ÿåº”è¯¥è¢«æ³¨é”€ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Session events, such as connection loss events, are also sent&lt;/p&gt;
&lt;p&gt;to watch callbacks so that clients know that watch events&lt;/p&gt;
&lt;p&gt;may be delayed.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æœ‰ç‚¹æ²¡ç†è§£åˆ°è¿™ä¸ª&lt;code&gt;so that clients know that watch events may be delayed.&lt;/code&gt; çš„delayedæŒ‡ä»€ä¹ˆæ„æ€&lt;/p&gt;
&lt;h3 id=&#34;zookeeper-guarantees&#34;&gt;&lt;strong&gt;ZooKeeper guarantees&lt;/strong&gt;&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Linearizable writes:&lt;/strong&gt; ä¿è¯å†™æ“ä½œçº¿æ€§åŒ–&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;FIFO client order:&lt;/strong&gt; åŒä¸€ä¸ªå®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚ä¿è¯å…ˆåˆ°å…ˆæœåŠ¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™é‡Œçš„çº¿æ€§æ€§æ˜¯&lt;em&gt;A-linearizability&lt;/em&gt; (asynchronous linearizabil&lt;/p&gt;
&lt;p&gt;ityã€‚å¼‚æ­¥çº¿æ€§åŒ–ã€‚å…è®¸ä¸€ä¸ªå®¢æˆ·ç«¯åœ¨åŒä¸€æ—¶åˆ»ï¼Œæ‹¥æœ‰å¤šä¸ªæœªå®Œæˆçš„æ“ä½œã€‚æ»¡è¶³å¼‚æ­¥çº¿æ€§åŒ–çš„ç³»ç»Ÿä¹Ÿå…·æœ‰çº¿æ€§åŒ–çš„ç‰¹ç‚¹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;åˆ†å¸ƒå¼é”&#34;&gt;åˆ†å¸ƒå¼é”&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Simple Lock&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;The simplest lock implementation uses â€œlock filesâ€.&lt;/p&gt;
&lt;p&gt;The lock is represented by a znode. To acquire a lock,&lt;/p&gt;
&lt;p&gt;a client tries to create the designated znode with the&lt;/p&gt;
&lt;p&gt;EPHEMERAL flag. If the create succeeds, the client&lt;/p&gt;
&lt;p&gt;holds the lock. Otherwise, the client can read the zn&lt;/p&gt;
&lt;p&gt;ode with the watch flag set to be notified if the current&lt;/p&gt;
&lt;p&gt;leader dies. A client releases the lock when it dies or ex&lt;/p&gt;
&lt;p&gt;plicitly deletes the znode. Other clients that are waiting&lt;/p&gt;
&lt;p&gt;for a lock try again to acquire a lock once they observe&lt;/p&gt;
&lt;p&gt;the znode being deleted.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å°±æ˜¯ä¸åŒçš„clientå»å°è¯•åˆ›å»ºä¸€ä¸ªç‰¹å®šçš„ä¸´æ—¶ç»“ç‚¹ï¼ˆå½“æˆé”ï¼‰ã€‚å¦‚æœåˆ›å»ºæˆåŠŸï¼Œå°±è·å–åˆ°äº†é”ã€‚æ­¤æ—¶å…¶ä»–ç»“ç‚¹å°±ä¸èƒ½åˆ›å»ºè¿™ä¸ªç»“ç‚¹äº†ã€‚ä½†æ˜¯å½“è¿™ä¸ªé”ç»“ç‚¹è¢«ä¸»åŠ¨åˆ é™¤æˆ–è€…éšå®¢æˆ·ç«¯ä¼šè¯ç»“æŸè€Œæ¶ˆå¤±ï¼ˆä¸´æ—¶ç»“ç‚¹çš„ç‰¹æ€§ï¼‰ï¼Œwatchä¼šé€šçŸ¥æ­£åœ¨ç›‘è§†çš„æ‰€æœ‰å®¢æˆ·ç«¯ï¼Œç„¶åå®¢æˆ·ç«¯å†å»äº‰æŠ¢åˆ›å»ºè¿™ä¸ªé”ã€‚&lt;/p&gt;
&lt;p&gt;ç¼ºç‚¹å°±æ˜¯æœ‰æƒŠç¾¤æ•ˆåº”ï¼šå‡å¦‚æœ‰äº”ä¸ªclientåœ¨ç­‰å¾…é”ï¼Œå¹¶ä¸”è¢«watché€šçŸ¥ï¼Œè¿™ä¸ªæ—¶å€™å°±éƒ½ä¼šå»å°è¯•è·å–é”ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Simple Locks without Herd Effect&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/mit6.824/zookeeper/blogimage-20230927164054661.png&#34;
	width=&#34;346&#34;
	height=&#34;144&#34;
	srcset=&#34;https://antio2.cn/tech/mit6.824/zookeeper/blogimage-20230927164054661_hu6ed4fdd9198d59d5bd50b29fa943aa52_10670_480x0_resize_box_3.png 480w, https://antio2.cn/tech/mit6.824/zookeeper/blogimage-20230927164054661_hu6ed4fdd9198d59d5bd50b29fa943aa52_10670_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20230927164054661&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;240&#34;
		data-flex-basis=&#34;576px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;ç®€å•æ¥è¯´ï¼Œå°±æ˜¯åœ¨ä¸€ä¸ªæŒ‡å®šç»“ç‚¹ä¸‹å½¢æˆäº†åŠ é”çš„é˜Ÿåˆ—ã€‚æŒ‰ç…§é˜Ÿåˆ—åŠ é”ã€‚ä¸€ä¸ªclientæƒ³è¦è·å–é”ï¼Œåªwatchè‡ªå·±å‰é¢çš„è¯·æ±‚ï¼Œå½“å‰é¢çš„è¯·æ±‚æ¶ˆå¤±ï¼Œå†è¢«å”¤é†’ã€‚&lt;/p&gt;
&lt;p&gt;æ„Ÿè§‰è¿™é‡Œå°±æ˜¯ä¸€ä¸ªæ¡ä»¶å˜é‡ã€‚ç±»ä¼¼äºä¹‹å‰åœ¨æ•°æ®åº“ä¸­å®ç°çš„é”è¡¨ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Read/Write Locks&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/mit6.824/zookeeper/blogimage-20230927164315766.png&#34;
	width=&#34;591&#34;
	height=&#34;336&#34;
	srcset=&#34;https://antio2.cn/tech/mit6.824/zookeeper/blogimage-20230927164315766_hub95371a6709dc0daf76216215b248b55_44450_480x0_resize_box_3.png 480w, https://antio2.cn/tech/mit6.824/zookeeper/blogimage-20230927164315766_hub95371a6709dc0daf76216215b248b55_44450_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20230927164315766&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;175&#34;
		data-flex-basis=&#34;422px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;é€šè¿‡é˜Ÿåˆ—å®ç°RWé”ã€‚&lt;/p&gt;
&lt;h2 id=&#34;zookeeperå®ç°&#34;&gt;ZooKeeperå®ç°&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;The replicated database is an &lt;em&gt;in-memory&lt;/em&gt; database con&lt;/p&gt;
&lt;p&gt;taining the entire data tree. Each znode in the tree stores a&lt;/p&gt;
&lt;p&gt;maximum of 1MB of data by default, but this maximum&lt;/p&gt;
&lt;p&gt;value is a configuration parameter that can be changed in&lt;/p&gt;
&lt;p&gt;specific cases. For recoverability, we efficiently log up&lt;/p&gt;
&lt;p&gt;dates to disk, and we force writes to be on the disk media&lt;/p&gt;
&lt;p&gt;before they are applied to the in-memory database.In&lt;/p&gt;
&lt;p&gt;fact, as Chubby [8], we keep a replay log (a write-ahead&lt;/p&gt;
&lt;p&gt;log, in our case) of committed operations and generate&lt;/p&gt;
&lt;p&gt;periodic snapshots of the in-memory database.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä½¿ç”¨WALè®°å½•ã€‚å¹¶ä¸”ä¿ç•™äº†REDOæ—¥å¿—ã€‚ä»¥åŠæœ‰ç”Ÿæˆå¿«ç…§çš„åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;å†™è¯·æ±‚è¢«è½¬å‘åˆ°Leaderï¼Œå…¶ä½™çš„éƒ½å¯ä»¥åœ¨followerä¸Šå¤„ç†ã€‚&lt;/p&gt;
&lt;p&gt;ZooKeeperä½¿ç”¨Zabä¼ æ’­æ¶ˆæ¯ã€‚è¿™é‡Œæˆ‘çš„ç†è§£æ˜¯:ZooKeeperæ„å»ºåœ¨ä¸€ç§ç±»ä¼¼äºRAFTçš„åˆ†å¸ƒå¼æ—¥å¿—ç³»ç»Ÿä¸Šï¼Œå¯ä»¥é€šè¿‡WALä¿è¯äº‹åŠ¡çš„æŒä¹…æ€§å’Œä¸€è‡´æ€§ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ZXIDï¼š&lt;a class=&#34;link&#34; href=&#34;https://www.jianshu.com/p/68b45694026c&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Zookeeperçš„zxid - ç®€ä¹¦ (jianshu.com)&lt;/a&gt; ZXIDç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼štermå’Œäº‹åŠ¡ç¼–å·&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å®¢æˆ·ç«¯åœ¨Wæ—¶ï¼Œä¼šè·å–ä¸€ä¸ªZXIDï¼Œæ¯”å¦‚å†™put(a,value)ï¼Œè·å¾—ä¸€ä¸ªzxid=1133ï¼ˆç¡®ä¿è¯¥å†™æ“ä½œå·²ç»è¢«commitï¼‰ï¼Œä¸‹ä¸€æ¬¡åœ¨getæ—¶ï¼Œä¼šæºå¸¦è¯¥zxidï¼Œå·²ç¡®ä¿è®¿é—®çš„æœåŠ¡å™¨è‡³å°‘æœ‰æ–°çš„æ•°æ®ã€‚&lt;/p&gt;
</description>
        </item>
        <item>
        <title>MIT6.824 | Frangipaniç¬”è®° ç¼“å­˜ä¸€è‡´æ€§ã€åˆ†å¸ƒå¼é”ã€å´©æºƒæ¢å¤</title>
        <link>https://antio2.cn/tech/mit6.824/frangipani/</link>
        <pubDate>Thu, 21 Sep 2023 00:51:55 +0800</pubDate>
        
        <guid>https://antio2.cn/tech/mit6.824/frangipani/</guid>
        <description>&lt;img src="https://antio2.cn/tech/mit6.824/frangipani/blogimage-20231007213337091.png" alt="Featured image of post MIT6.824 | Frangipaniç¬”è®° ç¼“å­˜ä¸€è‡´æ€§ã€åˆ†å¸ƒå¼é”ã€å´©æºƒæ¢å¤" /&gt;&lt;h1 id=&#34;frangipaniç¬”è®°-ç¼“å­˜ä¸€è‡´æ€§åˆ†å¸ƒå¼é”å´©æºƒæ¢å¤&#34;&gt;Frangipaniç¬”è®° ç¼“å­˜ä¸€è‡´æ€§ã€åˆ†å¸ƒå¼é”ã€å´©æºƒæ¢å¤&lt;/h1&gt;
&lt;h2 id=&#34;ç ”ç©¶å†…å®¹&#34;&gt;ç ”ç©¶å†…å®¹&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Network file systems&lt;/li&gt;
&lt;li&gt;ç›®æ ‡ï¼š
&lt;ul&gt;
&lt;li&gt;åœ¨ç”¨æˆ·ä¹‹å‰å…±äº«æ–‡ä»¶&lt;/li&gt;
&lt;li&gt;ç¼“å­˜ä¸€è‡´æ€§åè®® cache coherence&lt;/li&gt;
&lt;li&gt;åˆ†å¸ƒå¼é” distributed lock&lt;/li&gt;
&lt;li&gt;åˆ†å¸ƒå¼å´©æºƒæ¢å¤ distributed crash recovery&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;NFS&lt;/th&gt;
&lt;th&gt;Frangipani&lt;/th&gt;
&lt;th&gt;AFS&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;ç»“æ„&lt;/td&gt;
&lt;td&gt;&lt;img src=&#34;https://antio2.cn/tech/mit6.824/frangipani/blogimage-20231007213337091.png&#34;
	width=&#34;556&#34;
	height=&#34;650&#34;
	srcset=&#34;https://antio2.cn/tech/mit6.824/frangipani/blogimage-20231007213337091_hu349e8a48a3b21e32152fd1d6b817747b_43875_480x0_resize_box_3.png 480w, https://antio2.cn/tech/mit6.824/frangipani/blogimage-20231007213337091_hu349e8a48a3b21e32152fd1d6b817747b_43875_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20231007213337091&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;85&#34;
		data-flex-basis=&#34;205px&#34;
	
&gt;&lt;/td&gt;
&lt;td&gt;&lt;img src=&#34;https://antio2.cn/tech/mit6.824/frangipani/blogimage-20231007213051935.png&#34;
	width=&#34;679&#34;
	height=&#34;480&#34;
	srcset=&#34;https://antio2.cn/tech/mit6.824/frangipani/blogimage-20231007213051935_hu838baabd6eabfca381f485eaf5b4ebb5_93035_480x0_resize_box_3.png 480w, https://antio2.cn/tech/mit6.824/frangipani/blogimage-20231007213051935_hu838baabd6eabfca381f485eaf5b4ebb5_93035_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20231007213051935&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;141&#34;
		data-flex-basis=&#34;339px&#34;
	
&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å®¢æˆ·ç«¯&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å®¢æˆ·ç«¯æœ¬èº«&lt;/strong&gt;è¿è¡Œæ–‡ä»¶æœåŠ¡å™¨ä»£ç ã€‚&lt;/td&gt;
&lt;td&gt;å°†æ“ä½œå‘é€ç»™æ–‡ä»¶æœåŠ¡å™¨ï¼ˆFSï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æœåŠ¡å™¨&lt;/td&gt;
&lt;td&gt;é€šè¿‡Petalå®ç°çš„ä¸€ä¸ªè™šæ‹Ÿç£ç›˜ï¼Œåœ¨ç½‘ç»œä¸Šæä¾›é©±åŠ¨ã€‚çœ‹èµ·æ¥åƒä¸€å—åˆå¤§åˆæ™®é€šçš„ç£ç›˜&lt;/td&gt;
&lt;td&gt;è¿›è¡Œopen,read,close,writeç­‰æ“ä½œ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å®‰å…¨æ€§&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;å®¢æˆ·ç«¯å¯ä»¥ä¸å¯é ï¼Œå› ä¸ºæ–‡ä»¶æ“ä½œéƒ½åœ¨æœåŠ¡å™¨ä¸Šè¿›è¡Œ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ‰©å±•&lt;/td&gt;
&lt;td&gt;å¯ä»¥é€šè¿‡å¢åŠ clientæ¥æå‡ï¼Œå› ä¸ºæ–‡ä»¶æœåŠ¡å™¨æœ¬èº«æ˜¯åœ¨clientä¸Šè¿è¡Œçš„ã€‚&lt;/td&gt;
&lt;td&gt;æ€§èƒ½ç“¶é¢ˆå‡ºç°åœ¨æ–‡ä»¶æœåŠ¡å™¨ä¸­ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;ç”¨ä¾‹&#34;&gt;ç”¨ä¾‹&lt;/h2&gt;
&lt;p&gt;æ¯”å¦‚åœ¨ä¸€ä¸ªLabä¸­ï¼Œæ‰€æœ‰ç ”ç©¶äººå‘˜çš„ç”µè„‘éƒ½æ˜¯å¯ä¿¡ä»»çš„ã€‚å¹¶ä¸”ä»–ä»¬çš„æ–‡ä»¶å¯èƒ½éœ€è¦é«˜æ€§èƒ½ã€å¤§å®¹é‡çš„ç£ç›˜è®¿é—®ï¼Œè¿˜èƒ½è¿›è¡Œä¸€å®šçš„å…±äº«ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªç”¨æˆ·æƒ³è®¿é—®å¤šä¸ªå·¥ä½œç«™ã€‚è¿™ç§æƒ…å†µä¸‹Frangipaniå°±å¯ä»¥å‘æŒ¥ä½œç”¨ã€‚&lt;/p&gt;
&lt;p&gt;è®¾è®¡ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç ”ç©¶äººå‘˜å¯èƒ½åœ¨æœ¬åœ°é«˜æ€§èƒ½ä¿®æ”¹æ–‡ä»¶ï¼Œè€Œä¸æ˜¯éƒ½åœ¨Petalä¸Šè®¿é—®ã€‚æ‰€ä»¥å¯èƒ½åœ¨æœ¬åœ°ï¼ˆclientï¼‰ä¸Šåˆ›å»ºç¼“å­˜ã€‚&lt;/li&gt;
&lt;li&gt;ä¿®æ”¹åçš„ç¼“å­˜é€æ¸å†™å›Petal&lt;/li&gt;
&lt;li&gt;strong consistency.&lt;/li&gt;
&lt;li&gt;performance&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;GFSç›¸æ¯”èµ·æ¥ï¼Œæ²¡æœ‰æ•°æ®ç¼“å­˜ï¼Œæ˜¯ä¸ºäº†mapreduceç¨‹åºè®¾è®¡ã€‚ä½†æ˜¯Frangipaniä¸Šï¼Œå¯ä»¥åƒå•æœºç³»ç»Ÿä¸€æ ·è¿è¡ŒUnixç¨‹åºã€‚ä¸åŒçš„å·¥ä½œéœ€æ±‚æ¨åŠ¨äº†ä¸åŒçš„ç³»ç»Ÿè®¾è®¡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æŒ‘æˆ˜&#34;&gt;æŒ‘æˆ˜&lt;/h2&gt;
&lt;p&gt;å‡å¦‚æœ‰å¤šä¸ªä¸»æœºä½¿ç”¨è¯¥æ–‡ä»¶ç³»ç»Ÿã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¸€äº›work station(ws)åœ¨å†™ï¼Œå…¶ä»–ä¸»æœºåœ¨è¯»ã€‚å…¶ä»–ä¸»æœºåº”å½“çœ‹åˆ°æœ€åä¸€æ¬¡å†™å…¥çš„æ•°æ®ã€‚cache coherence&lt;/li&gt;
&lt;li&gt;ws1åˆ›å»ºç›®å½•d/f,ws2åŒæ—¶åˆ›å»ºç›®å½•d/gã€‚åº”å½“ç¡®ä¿æ–‡ä»¶ä¹‹é—´ä¸ä¼šäº’ç›¸å´©æºƒã€‚åŸå­æ€§ï¼šatomicity&lt;/li&gt;
&lt;li&gt;WS1 å´©æºƒã€‚æŒ‘æˆ˜ï¼šcrash recoveryã€‚ç¡®ä¿æ•°æ®ç»“æ„çš„ä¸€è‡´æ€§ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ¥ä¸‹æ¥ä»‹ç»Frangipaniå¦‚ä½•è§£å†³è¿™äº›é—®é¢˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç¼“å­˜ä¸€è‡´æ€§&#34;&gt;ç¼“å­˜ä¸€è‡´æ€§&lt;/h2&gt;
&lt;p&gt;Frangipaniä½¿ç”¨ä¸€ä¸ªé”è¡¨ã€‚é”æœ¬èº«æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æœåŠ¡ï¼ˆç±»ä¼¼äºZooKeeperï¼‰ï¼Œåœ¨Frangipaniä¸­ä½¿ç”¨Paxoså®ç°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/mit6.824/frangipani/blogimage-20231007215832724.png&#34;
	width=&#34;737&#34;
	height=&#34;408&#34;
	srcset=&#34;https://antio2.cn/tech/mit6.824/frangipani/blogimage-20231007215832724_hu5ef7d52a03fa99305b946ec30b8566f1_103260_480x0_resize_box_3.png 480w, https://antio2.cn/tech/mit6.824/frangipani/blogimage-20231007215832724_hu5ef7d52a03fa99305b946ec30b8566f1_103260_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20231007215832724&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;180&#34;
		data-flex-basis=&#34;433px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;åœ¨é”æœåŠ¡å™¨ä¸Šï¼Œç»´æŠ¤ä¸€ä¸ªé”è¡¨ï¼Œè®°å½•åŠ é”å¯¹è±¡å’Œé”çš„æŒæœ‰è€…ã€‚&lt;/p&gt;
&lt;p&gt;WS(å®¢æˆ·ç«¯)æœ¬èº«ä¹Ÿè¦ç»´æŠ¤ä¸€ä¸ªé”è¡¨ï¼Œè®°å½•è‡ªå·±å½“å‰æŒæœ‰é”çš„å¯¹è±¡å·²ç»çŠ¶æ€ã€‚&lt;/p&gt;
&lt;p&gt;è§„åˆ™ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¸ºäº†ç¼“å­˜ä¸€ä¸ªæ–‡ä»¶,é¦–å…ˆéœ€è¦è·å–é”ã€‚&lt;/li&gt;
&lt;li&gt;æ“ä½œï¼šè¯·æ±‚é”ï¼Œæˆäºˆé”ï¼Œé‡Šæ”¾é”ï¼Œæ’¤é”€(revoke)é”ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/mit6.824/frangipani/blogimage-20231007220732106.png&#34;
	width=&#34;699&#34;
	height=&#34;431&#34;
	srcset=&#34;https://antio2.cn/tech/mit6.824/frangipani/blogimage-20231007220732106_hu3657951b4df50debfae66084282bb961_125601_480x0_resize_box_3.png 480w, https://antio2.cn/tech/mit6.824/frangipani/blogimage-20231007220732106_hu3657951b4df50debfae66084282bb961_125601_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20231007220732106&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;162&#34;
		data-flex-basis=&#34;389px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªä½¿ç”¨äº†ä¸Šè¿°å››ç§æ“ä½œçš„ä¾‹å­å¦‚ä¸Šå›¾ã€‚&lt;/p&gt;
&lt;p&gt;WS1æƒ³è¦è¯»å–æˆ–è€…ä¿®æ”¹fï¼Œé¦–å…ˆå‘LS(Lock Service)ç”³è¯·Fçš„é”ï¼ŒLSå‘ç°æ­¤æ—¶æ²¡æœ‰WSå ç”¨Fï¼Œå°±æˆäºˆWS1 Fçš„é”ï¼Œå¹¶åœ¨è‡ªå·±çš„é”è¡¨ä¸­è®°å½•ã€‚WS1æ­¤æ—¶å°±å¯ä»¥è¯»å†™Fäº†ã€‚åœ¨å†™ï¼ˆbusyçŠ¶æ€ï¼‰åï¼ŒWS1å¹¶ä¸ä¸»åŠ¨é‡Šæ”¾é”ï¼Œè€Œæ˜¯è¯¥é”è¿›å…¥idleçŠ¶æ€ï¼Œä¸‹æ¬¡ä½¿ç”¨åˆå¯ä»¥ç«‹å³è¿›å…¥busyçŠ¶æ€è€Œä¸éœ€è¦å‘LSç”³è¯·ã€‚æ­¤æ—¶WS2æƒ³è¦è¯»å–Fï¼Œäºæ˜¯ç”³è¯·Fçš„é”ï¼ŒLSå‘ç°é”è¡¨ä¸­æœ‰Fçš„é¡¹ï¼Œäºæ˜¯å‘WS1å‘èµ·æ’¤é”€(revoke)é”ï¼ŒWS1æ”¶åˆ°æ’¤é”€å‘½ä»¤ï¼Œå¼€å§‹å°†ç¼“å­˜ä¸­çš„å†…å®¹å†™å›Petalï¼Œå†™å®Œä¹‹åå‘Šè¯‰LSé‡Šæ”¾äº†é”ã€‚æ­¤æ—¶ï¼ŒLSå°±å¯ä»¥æˆäºˆ(grant f)WS2 fçš„é”äº†ã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„ï¼ŒWS1é‡Šæ”¾é”æ˜¯å°†é”ç”±busyçŠ¶æ€è½¬åŒ–ä¸ºidleã€‚ä½¿ç”¨äº†æ›´å¤æ‚çš„æœºåˆ¶ï¼Œè€Œä¸æ˜¯ç›´æ¥åˆ é™¤é”ã€‚&lt;/p&gt;
&lt;p&gt;å¯ä»¥çœ‹å‡ºæ¥ï¼Œå¦‚æœè·å–äº†é”ï¼Œä¸€å®šèƒ½è¯»åˆ°æœ€åå†™å…¥çš„æ•°æ®ã€‚ä¿è¯äº†ä¸€è‡´æ€§ã€‚&lt;/p&gt;
&lt;h2 id=&#34;crash-recovery&#34;&gt;Crash Recovery&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨WALã€‚&lt;/p&gt;
&lt;p&gt;Clientæµç¨‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨æ“ä½œä¹‹å‰é¦–å…ˆå†™å…¥æ—¥å¿—ã€‚&lt;/li&gt;
&lt;li&gt;ç„¶åï¼Œinstall updating&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœåœ¨å†™å…¥æ—¥å¿—åå´©æºƒï¼Œåº”ç”¨æ›´æ–°å‰å´©æºƒï¼Œdaemonå¯ä»¥æ ¹æ®logæ¢å¤ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡checksumæ ¡éªŒå†™å…¥æ—¥å¿—æ˜¯å¦æ˜¯åŸå­çš„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/mit6.824/frangipani/blogimage-20231008140458528.png&#34;
	width=&#34;726&#34;
	height=&#34;485&#34;
	srcset=&#34;https://antio2.cn/tech/mit6.824/frangipani/blogimage-20231008140458528_hud03167c85d7389e6812056677fee5b85_123272_480x0_resize_box_3.png 480w, https://antio2.cn/tech/mit6.824/frangipani/blogimage-20231008140458528_hud03167c85d7389e6812056677fee5b85_123272_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20231008140458528&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;149&#34;
		data-flex-basis=&#34;359px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Log RecordåŒ…å«LSNï¼Œæ‰€æ›´æ–°å—å·ï¼ˆæ¯”å¦‚inodeï¼‰ï¼ŒVersionç¼–å·ï¼Œä»¥åŠæºå¸¦çš„æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;å½“WSæ”¶åˆ°Revokeè¯·æ±‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å°†logså†™å…¥petal&lt;/li&gt;
&lt;li&gt;åº”ç”¨æ›´æ–°ï¼ˆå…ƒæ•°æ®æˆ–ç”¨æˆ·æ–‡ä»¶å†™å…¥ï¼‰&lt;/li&gt;
&lt;li&gt;release lock&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ•°æ®å†™å…¥ï¼ˆæ¯”å¦‚ä¸€ä¸ªç…§ç‰‡æ–‡ä»¶ï¼‰ä¸ä¼šåŒ…å«åœ¨logä¸­ï¼Œè€Œæ˜¯ç›´æ¥å†™å…¥Petalã€‚ä¸Šè¿°çš„Logæ˜¯é’ˆå¯¹å…ƒæ•°æ®çš„ï¼Œæ¯”å¦‚æ–‡ä»¶æœ¬èº«çš„ä¿¡æ¯ï¼Œç›®å½•æ•°æ®ï¼Œinodeç­‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªå¸¸è§çš„æ“ä½œï¼šåœ¨ä¼ è¾“å¤§æ–‡ä»¶æ—¶ï¼Œç›´æ¥å†™å…¥ç£ç›˜ä¸Šçš„æŸä¸ªä¸´æ—¶æ–‡ä»¶ã€‚åœ¨ä¼ è¾“æ–‡ä»¶å®Œæˆåï¼Œè¿›è¡Œä¸€æ¬¡åŸå­æ“ä½œï¼Œå°†ä¸´æ—¶æ–‡ä»¶åæ”¹ä¸ºåŸæ–‡ä»¶åã€‚&lt;/p&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´ï¼Œæ—¥å¿—ç³»ç»Ÿèƒ½å¤Ÿä¿è¯çš„æ˜¯æ–‡ä»¶ç³»ç»Ÿæ•°æ®ç»“æ„çš„ä¸€è‡´æ€§ï¼Œè€Œä¸èƒ½ä¿è¯ç”¨æˆ·æ•°æ®å†™å…¥ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/mit6.824/frangipani/blogimage-20231008141838060.png&#34;
	width=&#34;1132&#34;
	height=&#34;630&#34;
	srcset=&#34;https://antio2.cn/tech/mit6.824/frangipani/blogimage-20231008141838060_huabf07587dd740c60c8e2d474cc67449d_397744_480x0_resize_box_3.png 480w, https://antio2.cn/tech/mit6.824/frangipani/blogimage-20231008141838060_huabf07587dd740c60c8e2d474cc67449d_397744_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20231008141838060&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;179&#34;
		data-flex-basis=&#34;431px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;è¿™é‡Œè®¨è®ºäº†å´©æºƒçš„3ç§æƒ…å†µ&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åœ¨WALå†™å…¥ä¹‹å‰ã€‚è¿™ç§æ—¶å€™æ•°æ®è‚¯å®šä¸¢å¤±äº†ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨WALå®Œå…¨å†™å…¥ä¹‹åï¼Œä½†æ˜¯è¿˜æ²¡æœ‰æ›´æ–°æ•°æ®ã€‚è¿™ä¸ªæ—¶å€™é¦–å…ˆæœåŠ¡å™¨ç­‰å¾…æ¶‰åŠæ•°æ®çš„ç§Ÿçº¦è¿‡æœŸï¼Œç„¶ådaemonè¿›è¡Œæ¢å¤å·¥ä½œã€‚&lt;/li&gt;
&lt;li&gt;åœ¨WALå†™å…¥çš„è¿‡ç¨‹ä¸­å´©æºƒ ï¼Œå¯ä»¥é€šè¿‡checksumæ£€éªŒï¼Œæ­¤æ—¶å¹¶éå…¨éƒ¨ä¸¢å¼ƒã€‚è€Œæ˜¯æ£€æŸ¥æœ‰å“ªäº›å·²ç»å®Œæ•´å†™å…¥çš„å‰ç¼€ã€‚ç„¶ådaemonå°±å¯ä»¥è¿›è¡Œå‰ç¼€æ“ä½œã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;ç‰ˆæœ¬é—®é¢˜&#34;&gt;ç‰ˆæœ¬é—®é¢˜&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/mit6.824/frangipani/blogimage-20231008143059770.png&#34;
	width=&#34;838&#34;
	height=&#34;489&#34;
	srcset=&#34;https://antio2.cn/tech/mit6.824/frangipani/blogimage-20231008143059770_hu8ae4c70b0232eedd8e0e5b6031bb09ff_163039_480x0_resize_box_3.png 480w, https://antio2.cn/tech/mit6.824/frangipani/blogimage-20231008143059770_hu8ae4c70b0232eedd8e0e5b6031bb09ff_163039_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20231008143059770&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;171&#34;
		data-flex-basis=&#34;411px&#34;
	
&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è€ƒè™‘è¿™ä¹ˆä¸€ä¸ªé—®é¢˜ï¼šWS1é¦–å…ˆåˆ é™¤d/f,WS2ç„¶ååˆ›å»ºd/fã€‚æ­¤æ—¶WS1å´©æºƒï¼ŒWS3çš„daemonå¯åŠ¨ redo WS1 delete d/fã€‚é€ æˆäº†d/fè¢«åˆ é™¤ã€‚ä½†æ˜¯æŒ‰ç…§å®é™…é¡ºåºï¼ŒWS2åˆ›å»ºæ˜¯åœ¨WS1ä¹‹åçš„ã€‚&lt;/li&gt;
&lt;li&gt;ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½¿ç”¨äº†ä¹‹å‰æåˆ°è¿‡çš„ï¼ŒLogä¸­çš„Version Numberã€‚&lt;/li&gt;
&lt;li&gt;é”åè®®ç¡®ä¿Version NumberæŒ‰ç…§é¡ºåºé€’å¢ã€‚daemonä¸ä¼šredo ä¹‹å‰çš„version numberã€‚åœ¨inodeä¸­ä¼šè®°å½•å½“å‰æ˜¯å“ªä¸ªversionã€‚&lt;/li&gt;
&lt;li&gt;æ¯”å¦‚è¦ä¿®æ”¹fçš„inodeã€‚è¯¥inodeçš„version numberæ˜¯14ï¼Œé‚£ä¹ˆåœ¨æ—¥å¿—ä¸­ï¼Œè¯¥inodeä¿®æ”¹åçš„Logä¸­çš„version numberå°±åº”è¯¥æ˜¯15ã€‚&lt;/li&gt;
&lt;/ol&gt;
</description>
        </item>
        <item>
        <title>MIT6.824 | Lab 2: Raft</title>
        <link>https://antio2.cn/tech/mit6.824/lab2/</link>
        <pubDate>Mon, 11 Sep 2023 00:32:17 +0800</pubDate>
        
        <guid>https://antio2.cn/tech/mit6.824/lab2/</guid>
        <description>&lt;h2 id=&#34;0x1-reading-paper&#34;&gt;0x1 Reading Paper&lt;/h2&gt;
&lt;p&gt;Raftåè®®æ„Ÿè§‰ç›®æ ‡å¾ˆç®€å•ï¼šä¿è¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸€è‡´æ€§å’Œå¯ç”¨æ€§ï¼Œåœ¨é˜…è¯»æ—¶ï¼Œæˆ‘è”æƒ³åˆ°ä¹‹å‰çœ‹çš„ARIESè®ºæ–‡ï¼Œæ„Ÿè§‰æ€ç»´æœ‰å¾ˆå¤šå…±é€šä¹‹å¤„ï¼Œæ¯”å¦‚å¦‚ä½•é€šè¿‡éæ˜“å¤±æ€§å­˜å‚¨æ¥ä¿è¯æŒä¹…æ€§ã€‚ä½†æ˜¯ARIESä¸­æ˜¯å•ä¸ªæœºå™¨å´©æºƒå¯¼è‡´å†…å­˜å†…å®¹ä¸¢å¤±ï¼Œé€šè¿‡ç¡¬ç›˜ä¸Šçš„LOGsæ¥é‡åšæ•°æ®åº“ï¼Œå¹¶ä¸”ABORTæ‰æœªæäº¤çš„è®°å½•å¹¶å†™å…¥CLRã€‚Raftä¸­ï¼Œå¯èƒ½æ˜¯å¤šå°æœºå™¨å´©æºƒï¼Œè¿™ä¸ªæ—¶å€™å°±è¦è€ƒè™‘åœ¨å´©æºƒæœŸé—´ï¼Œå…¶ä»–æœºå™¨å¢åŠ logçš„æ“ä½œäº†ï¼Œå› ä¸ºé›†ç¾¤ä¸ä¼šå› ä¸ºå°‘æ•°å‡ å°æœºå™¨å´©æºƒè€Œæ•´ä½“ä¸å¯ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ARIESä¸­ï¼Œé€šè¿‡Commitç±»å‹çš„è®°å½•æ ‡è¯†ä¸€ä¸ªäº‹åŠ¡çš„æäº¤ï¼Œåªè¦è¯¥commit logå†™å…¥ï¼Œæ— è®ºæ˜¯å¦è½ç›˜ï¼Œå°±èƒ½å‘Šè¯‰å®¢æˆ·ç«¯ï¼šæˆ‘å·²ç»å°†ä½ çš„æ“ä½œcommit(æŒä¹…åŒ–)äº†ã€‚è€Œåœ¨RAFTé‡Œé¢ï¼Œåœ¨å½“æœŸTERMä¸­ï¼ŒMajorityçš„æœºå™¨appendäº†è¿™æ¡log,å°±èƒ½ç®—åšå·²ç»æäº¤äº†ã€‚&lt;/p&gt;
&lt;h3 id=&#34;0x11-ä¸€äº›ç–‘é—®&#34;&gt;0x11 ä¸€äº›ç–‘é—®&lt;/h3&gt;
&lt;p&gt;ä½†æ˜¯åœ¨é˜…è¯»æ—¶ï¼Œæœ‰å‡ ä¸ªé—®é¢˜æ²¡æœ‰ç†è§£åˆ°ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä»€ä¹ˆå«åšæäº¤ï¼Ÿ&lt;img src=&#34;https://antio2.cn/tech/mit6.824/lab2/blog20230911162249.png&#34;
	width=&#34;723&#34;
	height=&#34;301&#34;
	srcset=&#34;https://antio2.cn/tech/mit6.824/lab2/blog20230911162249_hue6a78e52a72b35a305c5ebb792d5bbe4_156083_480x0_resize_box_3.png 480w, https://antio2.cn/tech/mit6.824/lab2/blog20230911162249_hue6a78e52a72b35a305c5ebb792d5bbe4_156083_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;240&#34;
		data-flex-basis=&#34;576px&#34;
	
&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ¯”å¦‚ä¸Šå›¾ä»c-&amp;gt;eçš„ çŠ¶æ€ï¼Œterm 4è¢«æäº¤æ˜¯å¾ˆå¥½ç†è§£çš„ï¼Œä½†æ˜¯2ä¹Ÿä¼šè¢«é—´æ¥commitï¼Œå®¢æˆ·ç«¯æ€ä¹ˆçŸ¥é“2è¢«commitäº†å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;è²Œä¼¼ç­”æ¡ˆæ˜¯å®¢æˆ·ç«¯å¹¶ä¸åœ¨ä¹æ˜¯å¦æäº¤ï¼Œæˆ–è€…æ˜¯å¯ä»¥å°†Commitçš„æ—¥å¿—å‘é€ç»™clientã€‚&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªæ–¹å¼æ˜¯clientå¯ä»¥é‡ä¼ å¤±è´¥çš„æ“ä½œï¼Œå¹¶ä¸”ç»™è¿™ä¸ªæ“ä½œä¸€ä¸ªå”¯ä¸€çš„ç¼–å·ã€‚æ¯”å¦‚åœ¨(e)çš„æƒ…å†µé‡Œé¢ï¼Œ2æ˜¯è¢«commitäº†ã€‚åœ¨(d)ä¸­ï¼Œ2æ²¡æœ‰commitã€‚å®¢æˆ·ç«¯åœ¨æ²¡æœ‰æ”¶åˆ°2è¢«commitçš„æ¶ˆæ¯è¶…æ—¶ä¹‹åï¼Œå¯ä»¥å°è¯•é‡ä¼ 2çš„æ“ä½œã€‚æ¯”å¦‚è¿™ä¸ªæ“ä½œæœ‰ä¸€ä¸ªå”¯ä¸€çš„åºåˆ—å·ï¼š23234ï¼ŒRaftåœ¨æ”¶åˆ°è¯¥åºåˆ—å·åï¼Œåœ¨(e)çš„æƒ…å†µä¸‹ï¼Œæ£€æŸ¥åˆ°è¯¥åºåˆ—å·²ç»è¢«commitäº†ï¼Œå°±ä¸ä¼šå†åšè¿™ä¸ªæ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;è¯¦ç»†çš„è§£é‡Šå…¶å®åœ¨guideä¸­æœ‰-&amp;gt;https://thesquareplanet.com/blog/students-guide-to-raft/#applying-client-operations&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;One simple way to solve this problem is to record where in the Raft log the clientâ€™s operation appears when you insert it. Once the operation at that index is sent to &lt;code&gt;apply()&lt;/code&gt;, you can tell whether or not the clientâ€™s operation succeeded based on whether the operation that came up for that index is in fact the one you put there. If it isnâ€™t, a failure has happened and an error can be returned to the client.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ¯”å¦‚clientä¸€å¼€å§‹è¿çš„æ˜¯leader-A, leader-Aéœ€è¦åœ¨æ’å…¥æ—¶è®°å½•å®¢æˆ·ç«¯æ“ä½œåœ¨Raft logä¸­çš„å“ªé‡Œã€‚å½“è¿™ä¸ªæ“ä½œå°†è¦è¢«applyçš„æ—¶å€™ï¼Œé€šè¿‡åˆ¤æ–­è¯¥ç´¢å¼•ä½ç½®çš„æ“ä½œæ˜¯ä¸æ˜¯ä½ æ”¾çš„ï¼ˆæ¯”å¦‚è¿™ä¸ªæ—¶å€™ç´¢å¼•å·²ç»å˜æˆLeader-Bå¼ºåˆ¶Leader-AåŒæ­¥çš„äº†ï¼‰ï¼Œå¦‚æœæ“ä½œæ¥æºä¸åŒ¹é…ï¼Œè¿”å›å®¢æˆ·ç«¯ä¸€ä¸ªé”™è¯¯ã€‚&lt;/p&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;åœ¨é€‰ä¸¾æ—¶ï¼Œå¦‚æœæœ‰æ¯”è¾ƒé«˜termçš„followeræ‹’ç»æŠ•ç¥¨ï¼Œcandidateæ˜¯å¦ç«‹é©¬é€€å‡ºé€‰ä¸¾ï¼Ÿ&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å‚è€ƒäº†&lt;a class=&#34;link&#34; href=&#34;https://zhuanlan.zhihu.com/p/306110683&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;rafté€‰ä¸¾ç­–ç•¥ - çŸ¥ä¹ (zhihu.com)&lt;/a&gt;ã€‚ç­”æ¡ˆåº”è¯¥æ˜¯å¦‚æœcandidateæˆ–è€…leaderå‘ç°äº†å­˜åœ¨termæ›´é«˜çš„èŠ‚ç‚¹ï¼Œä¼šç«‹å³æ‰å…¥followerçŠ¶æ€ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/mit6.824/lab2/blogv2-9396d411668ae75ab83379236cecaa39_r.jpg&#34;
	width=&#34;554&#34;
	height=&#34;429&#34;
	srcset=&#34;https://antio2.cn/tech/mit6.824/lab2/blogv2-9396d411668ae75ab83379236cecaa39_r_hu01afa3e4268c0f646eb78db6b966bcf2_17371_480x0_resize_q75_box.jpg 480w, https://antio2.cn/tech/mit6.824/lab2/blogv2-9396d411668ae75ab83379236cecaa39_r_hu01afa3e4268c0f646eb78db6b966bcf2_17371_1024x0_resize_q75_box.jpg 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;img&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;129&#34;
		data-flex-basis=&#34;309px&#34;
	
&gt;&lt;/p&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;å¦‚ä½•ä¿è¯termä¸é‡å¤ï¼Ÿ&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ¯å½“ä¸€ä¸ªserveræ”¶åˆ°çš„RPCï¼ˆæ¥æ”¶æˆ–è€…å›å¤å¾—åˆ°çš„æ¶ˆæ¯ï¼‰ï¼Œè§‚å¯Ÿåˆ°äº†ä¸€ä¸ªæ›´æ–°çš„Termï¼Œéƒ½ä¼šç«‹å³è¿›å…¥followerçŠ¶æ€å¹¶æ›´æ–°çŠ¶æ€ã€‚å³ä½¿å‡ºç°ç½‘ç»œåˆ†åŒºï¼Œä¹Ÿä¸ä¼šå‡ºç°ç›¸åŒçš„termï¼Œå´å‡ºç°ç›¸åŒIndexçš„Logä¸åŒçš„æƒ…å†µã€‚è¯•æƒ³ï¼šè¦å‡ºç°ä¸€ä¸ªLeaderï¼Œå¤§å¤šæ•°çš„séƒ½ä¼šè¿›å…¥æœ€æ–°çš„Termï¼Œæ¥ä¸‹æ¥æœ‰ä¸¤ç§æƒ…å†µï¼šå¤§å¤šæ•°ä¸­çš„ä¸€ä¸ªå½“é€‰ï¼Œæ­¤æ—¶çš„currentTermå·²ç»å¤§äºTermã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬äºŒç§æƒ…å†µï¼Œä¹Ÿå°±æ˜¯æˆ‘æ‹…å¿ƒçš„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/mit6.824/lab2/blog70CAF0083930B67F78D016635098C259.jpg&#34;
	width=&#34;1390&#34;
	height=&#34;1920&#34;
	srcset=&#34;https://antio2.cn/tech/mit6.824/lab2/blog70CAF0083930B67F78D016635098C259_hub26904794577d054314e7c8a8752d828_79795_480x0_resize_q75_box.jpg 480w, https://antio2.cn/tech/mit6.824/lab2/blog70CAF0083930B67F78D016635098C259_hub26904794577d054314e7c8a8752d828_79795_1024x0_resize_q75_box.jpg 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;70CAF0083930B67F78D016635098C259&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;72&#34;
		data-flex-basis=&#34;173px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;S1åœ¨Term2å½“é€‰Leader,S2å·²ç»è§‚å¯Ÿåˆ°Term2ï¼ŒS3çŸ­æš‚ä¸èƒ½æ¥æ”¶RPCã€‚å¹¶ä¸”S1æ”¶åˆ°ä¸€æ¡Logä½†è¿˜æ²¡æœ‰æ¥å¾—åŠä¼ ç»™S2å’ŒS3ã€‚æ­¤æ—¶S3 Timeoutå¼€å§‹é€‰ä¸¾ï¼Œå¢åŠ è‡ªå·±çš„Termä¸º2ï¼Œè‹¥S3èµ¢å¾—é€‰ä¸¾ï¼Œå†æ”¶åˆ°ä¸€æ¡logã€‚&lt;/p&gt;
&lt;p&gt;æ­¤æ—¶é—®é¢˜æ¥äº†ï¼šS1å’ŒS3éƒ½æœ‰Term=2ï¼ŒIndex=2çš„logï¼Œä½†æ˜¯ä¸¤æ¡Logå´æ˜¯å†…å®¹ä¸ä¸€æ ·çš„ï¼è¿åäº†å®‰å…¨æ€§ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘è®¤ä¸ºåº”è¯¥candidateTerm&amp;lt;=currentTermï¼Œéƒ½è¿”å›false,è€Œä¸æ˜¯åªæœ‰candidateTerm &amp;lt; currentTermæ—¶è¿”å›false&lt;/p&gt;
&lt;h3 id=&#34;0x12-ä¸€äº›ç»†èŠ‚&#34;&gt;0x12 ä¸€äº›ç»†èŠ‚&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;Make sure you reset your election timer &lt;em&gt;exactly&lt;/em&gt; when Figure 2 says you should. Specifically, you should &lt;em&gt;only&lt;/em&gt; restart your election timer if a) you get an &lt;code&gt;AppendEntries&lt;/code&gt; RPC from the &lt;em&gt;current&lt;/em&gt; leader (i.e., if the term in the &lt;code&gt;AppendEntries&lt;/code&gt; arguments is outdated, you should &lt;em&gt;not&lt;/em&gt; reset your timer); b) you are starting an election; or c) you &lt;em&gt;grant&lt;/em&gt; a vote to another peer.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;é‡è®¾è¶…æ—¶æ—¶é—´ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä»å½“å‰leaderæ¥å—ä¿¡æ¯&lt;/li&gt;
&lt;li&gt;æŠ•ç¥¨ç»™å…¶ä»–candidate&lt;/li&gt;
&lt;li&gt;å¼€å§‹é€‰ä¸¾&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;If you get an &lt;code&gt;AppendEntries&lt;/code&gt; RPC with a &lt;code&gt;prevLogIndex&lt;/code&gt; that points beyond the end of your log, you should handle it the same as if you did have that entry but the term did not match (i.e., reply false).&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;followeréœ€è¦æ£€æŸ¥indexæ˜¯å¦åŒ¹é…&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;If a leader sends out an &lt;code&gt;AppendEntries&lt;/code&gt; RPC, and it is rejected, but &lt;em&gt;not because of log inconsistency&lt;/em&gt; (this can only happen if our term has passed), then you should immediately step down, and &lt;em&gt;not&lt;/em&gt; update &lt;code&gt;nextIndex&lt;/code&gt;. If you do, you could race with the resetting of &lt;code&gt;nextIndex&lt;/code&gt; if you are re-elected immediately.&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¦‚æœleaderè¢«æ‹’ç»ï¼Œç«‹é©¬ä¸‹å°ï¼ˆè¿›å…¥é€‰ä¸¾çŠ¶æ€ï¼‰&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;From experience, we have found that by far the simplest thing to do is to first record the term in the reply (it may be higher than your current term), and then to compare the current term with the term you sent in your original RPC. If the two are different, drop the reply and return. &lt;em&gt;Only&lt;/em&gt; if the two terms are the same should you continue processing the reply.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¦‚æœæ”¶åˆ°ä¸€ä¸ªä¸åŒTerm RPCçš„å›å¤ï¼ˆ&lt;strong&gt;æ³¨æ„ä¸æ˜¯è¯·æ±‚&lt;/strong&gt;ï¼‰ï¼Œä¸è¦ç»§ç»­å¤„ç†&lt;/p&gt;
&lt;h2 id=&#34;0x2-é˜…è¯»ä»£ç &#34;&gt;0x2 é˜…è¯»ä»£ç &lt;/h2&gt;
&lt;p&gt;è¿˜æ˜¯æŒ‰ç…§BFSçš„æ–¹å¼é˜…è¯»labä¸­Raftæ¡†æ¶çš„æºç &lt;/p&gt;
&lt;h3 id=&#34;0x21-labrpc&#34;&gt;0x21 labrpc&lt;/h3&gt;
&lt;p&gt;labrpcæ¨¡æ‹Ÿäº†å¯èƒ½ä¸¢åŒ…ã€å»¶è¿Ÿçš„ç½‘ç»œç¯å¢ƒã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;net := MakeNetwork() &amp;ndash; holds network, clients, servers. åˆ›å»ºç½‘ç»œ&lt;/p&gt;
&lt;p&gt;net.AddServer(servername, server) &amp;ndash; adds a named server to network. æ·»åŠ ä¸€ä¸ªæœåŠ¡å™¨
net.DeleteServer(servername) &amp;ndash; eliminate the named server. åˆ é™¤æœåŠ¡å™¨
net.Connect(endname, servername) &amp;ndash; connect a client to a server.
net.Enable(endname, enabled) &amp;ndash; enable/disable a client.
net.Reliable(bool) &amp;ndash; false means drop/delay messages&lt;/p&gt;
&lt;p&gt;end := net.MakeEnd(endname) &amp;ndash; create a client end-point, to talk to one server.
end.Call(&amp;ldquo;Raft.AppendEntries&amp;rdquo;, &amp;amp;args, &amp;amp;reply) &amp;ndash; send an RPC, wait for reply.
the &amp;ldquo;Raft&amp;rdquo; is the name of the server struct to be called.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å…¶ä¸­ï¼ŒServerå’ŒServiceæ˜¯ä¸¤ä¸ªæ¦‚å¿µ&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;srv := MakeServer()
srv.AddService(svc) &amp;ndash; a server can have multiple services, e.g. Raft and k/v
pass srv to net.AddServer()&lt;/p&gt;
&lt;p&gt;svc := MakeService(receiverObject) &amp;ndash; obj&amp;rsquo;s methods will handle RPCs
much like Go&amp;rsquo;s rpcs.Register()
pass svc to srv.AddService()&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ„Ÿè§‰Serviceæ›´å¤šçš„æŒ‡ä¸€ç»„APIæ¥å£ï¼Œè€ŒServerç±»ä¼¼ä¸€å°ä¸»æœºï¼Œä¸Šé¢å¯èƒ½è¿è¡Œå¤šä¸ªservice&lt;/p&gt;
&lt;h3 id=&#34;0x22-raft&#34;&gt;0x22 Raft&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;A service calls &lt;code&gt;Make(peers,me,â€¦)&lt;/code&gt; to create a Raft peer. The peers argument is an array of network identifiers of the Raft peers (including this one), for use with RPC. The &lt;code&gt;me&lt;/code&gt; argument is the index of this peer in the peers array.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å…¶ä¸­ï¼Œé€šè¿‡é˜…è¯»&lt;code&gt;Persister&lt;/code&gt;ä»£ç ï¼Œå…¶ä¸­æœ‰åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ–¹æ³•ã€‚&lt;/p&gt;
&lt;h2 id=&#34;0x31-lab2aå®ç°&#34;&gt;0x31 Lab2aå®ç°&lt;/h2&gt;
&lt;p&gt;ç›®æ ‡ï¼šå®ç°Leaderé€‰ä¸¾ã€‚ä¸éœ€è¦æºå¸¦log(ç©ºappend entry)&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/mit6.824/lab2/blogimage-20230913222616047.png&#34;
	width=&#34;831&#34;
	height=&#34;541&#34;
	srcset=&#34;https://antio2.cn/tech/mit6.824/lab2/blogimage-20230913222616047_hu0f23d3202918cd77f3b06739a39a54e7_101501_480x0_resize_box_3.png 480w, https://antio2.cn/tech/mit6.824/lab2/blogimage-20230913222616047_hu0f23d3202918cd77f3b06739a39a54e7_101501_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20230913222616047&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;153&#34;
		data-flex-basis=&#34;368px&#34;
	
&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;RequestVoteArgs&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#75715e&#34;&gt;// Your data here (2A, 2B).
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;candidateTerm&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;termT&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;candidateId&lt;/span&gt;   &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;lastLogEntry&lt;/span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;indexT&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;lastLogTerm&lt;/span&gt;   &lt;span style=&#34;color:#a6e22e&#34;&gt;termT&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// RequestVoteReply example RequestVote RPC reply structure.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// field names must start with capital letters!
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;RequestVoteReply&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#75715e&#34;&gt;// Your data here (2A).
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;term&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;termT&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;voteGranted&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™é‡Œæˆ‘ä¸ç¡®å®štermå’Œindexçš„æ•°æ®ç±»å‹ã€‚æ„Ÿè§‰Indexåº”è¯¥ç”¨uintï¼ˆå› ä¸ºæœ‰æ•ˆçš„indexä»1å¼€å§‹ï¼Œå¯ä»¥ç”¨0è¡¨ç¤ºæ— æ•ˆçš„indexï¼‰,ä½†æ˜¯ç»™çš„ä»£ç ä¸­termå’Œindexéƒ½æ˜¯int.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Modify &lt;code&gt;Make()&lt;/code&gt; to create a background goroutine that will kick off leader election periodically by sending out &lt;code&gt;RequestVote&lt;/code&gt; RPCs when it hasn&amp;rsquo;t heard from another peer for a while. This way a peer will learn who is the leader, if there is already a leader, or become the leader itself. Implement the &lt;code&gt;RequestVote()&lt;/code&gt; RPC handler so that servers will vote for one another.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è¿™é‡Œé¦–å…ˆå®ç°tickeré‡Œé¢çš„ä»£ç ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;func (rf &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;Raft) ticker() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    rf.setElectionTime()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; rf.killed() &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; false {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#75715e&#34;&gt;// Your code here to check if a leader election should
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;       &lt;span style=&#34;color:#75715e&#34;&gt;// be started and to randomize sleeping time using
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;       &lt;span style=&#34;color:#75715e&#34;&gt;// time.Sleep().
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;       time.Sleep(rf.heartBeat)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       rf.mu.Lock()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; rf.status &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; leader {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#75715e&#34;&gt;// å¦‚æœæ˜¯leaderçŠ¶æ€,å‘é€ç©ºåŒ…
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;       }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; time.Now().After(rf.electionTime) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#75715e&#34;&gt;// å¦‚æœå·²ç»è¶…æ—¶ï¼Œ å¼€å§‹é€‰ä¸¾
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;       }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       rf.mu.Unlock()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åæ˜¯å®ç°candidateéƒ¨åˆ†çš„ä»£ç ï¼š&lt;/p&gt;
&lt;p&gt;å‚è€ƒ5.2 Leader electionä¸­çš„æè¿°ä¸€æ­¥ä¸€æ­¥åš&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;To begin an election, a follower increments its current&lt;/p&gt;
&lt;p&gt;term and transitions to candidate state.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Raft&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;startElection&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;setElectionTime&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;status&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;candidate&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;currentTerm&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;It then votes for&lt;/p&gt;
&lt;p&gt;itself and issues RequestVote RPCs in parallel to each of&lt;/p&gt;
&lt;p&gt;the other servers in the cluster.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;votedFor&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;me&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;persist&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;convert&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sync&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Once&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;range&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;peers&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;me&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;RequestVoteReply&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;request&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;RequestVoteArgs&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;candidateTerm&lt;/span&gt;: &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;currentTerm&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;candidateId&lt;/span&gt;:   &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;me&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;lastLogEntry&lt;/span&gt;:  &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;getLastLogIndex&lt;/span&gt;(),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;lastLogTerm&lt;/span&gt;:   &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;getLastLogTerm&lt;/span&gt;(),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;go&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;sendRequestVote&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;request&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;convert&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç»§ç»­å¾€ä¸‹é˜…è¯»&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;A candidate continues in&lt;/p&gt;
&lt;p&gt;this state until one of three things happens:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;(a) it wins theelection&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;(b) another server establishes itself as leader, or&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;(c) a period of time goes by with no winner.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;å…¶ä¸­ï¼Œ(c) é€šè¿‡tickerå‡½æ•°è§£å†³è¶…æ—¶æœªé€‰ä¸¾é—®é¢˜&lt;/p&gt;
&lt;p&gt;(b) åœ¨æ¥å—å¿ƒè·³ä¿¡æ¯ä¸­å®ç°&lt;/p&gt;
&lt;p&gt;(a) åœ¨æ¯æ¬¡æ”¶åˆ°&lt;strong&gt;æœ‰æ•ˆçš„&lt;/strong&gt;é€‰ç¥¨åï¼Œç»Ÿè®¡è‡ªå·±æ˜¯å¦èµ¢å¾—é€‰ä¸¾&lt;/p&gt;
&lt;p&gt;é¦–å…ˆå®ç°a&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Raft&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;sendRequestVote&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;server&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;RequestVoteArgs&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;RequestVoteReply&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;convert&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;sync&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Once&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;countVote&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;) &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;ok&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;peers&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;server&lt;/span&gt;].&lt;span style=&#34;color:#a6e22e&#34;&gt;Call&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Raft.RequestVote&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; !&lt;span style=&#34;color:#a6e22e&#34;&gt;ok&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ok&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Lock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Unlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Term&lt;/span&gt; &amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;currentTerm&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;setTerm&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Term&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#75715e&#34;&gt;// rf.setElectionTime()
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;status&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;follower&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Term&lt;/span&gt; &amp;lt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;currentTerm&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#75715e&#34;&gt;// è¿‡æœŸå¾—rpc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; !&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;VoteGranted&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;countVote&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;countVote&lt;/span&gt; &amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;peerNum&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;status&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;candidate&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;currentTerm&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;CandidateTerm&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#75715e&#34;&gt;// æŠ•ç¥¨æˆåŠŸï¼Œè½¬ä¸ºleader
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;convert&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Do&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Printf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;[%d] become leader in term [%d]&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;me&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;currentTerm&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#75715e&#34;&gt;/**
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;			nextIndex for each server, Index of the next log entry to send to that server (initialized to leader last log Index + 1)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;			*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;nextIndex&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;getLastLogIndex&lt;/span&gt;() &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;status&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;leader&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &amp;lt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;votedFor&lt;/span&gt;; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;nextIndex&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;] = &lt;span style=&#34;color:#a6e22e&#34;&gt;nextIndex&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;matchIndex&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;] = &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;matchIndex&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;] = &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;appendEntries&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		})
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ok&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç›¸å¯¹åº”çš„ï¼Œå®ç°æŠ•ç¥¨è§„åˆ™ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœåœ¨è¯¥termæŠ•äº†ç¥¨ï¼Œå¹¶ä¸”ä¸æ˜¯è¯¥candidateId, åˆ™æ‹’ç»è¯¥æ¬¡æŠ•ç¥¨&lt;/li&gt;
&lt;li&gt;å¦‚æœterm &amp;lt; currentTerm  æ‹’ç»æŠ•ç¥¨&lt;/li&gt;
&lt;li&gt;å¦‚æœcandidateçš„å‚æ•°è‡³å°‘å’Œå½“å‰followerä¸€æ ·æ–°ï¼Œåˆ™æŠ•ç¥¨&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// RequestVote RPC handler.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Raft&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;RequestVote&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;RequestVoteArgs&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;RequestVoteReply&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#75715e&#34;&gt;// Your code here (2A, 2B).
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Lock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Unlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;candidateTerm&lt;/span&gt; &amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;currentTerm&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;setTerm&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;candidateTerm&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;term&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;currentTerm&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;currentTerm&lt;/span&gt; &amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;candidateTerm&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;voteGranted&lt;/span&gt; = &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;lastLogTerm&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;getLastLogTerm&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;lastLogIndex&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;getLastLogIndex&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;votedFor&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;||&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;votedFor&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;candidateId&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		(&lt;span style=&#34;color:#a6e22e&#34;&gt;lastLogTerm&lt;/span&gt; &amp;lt; &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;lastLogTerm&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;||&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lastLogIndex&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;lastLogEntry&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;voteGranted&lt;/span&gt; = &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;votedFor&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;candidateId&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;persist&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;setElectionTime&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	} &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;voteGranted&lt;/span&gt; = &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¥ä¸‹æ¥ï¼Œå®ç°å‘é€å¿ƒè·³ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆå®ç°appendEntryéœ€è¦çš„æ•°æ®ç»“æ„&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ype&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;appendEntryArgs&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;term&lt;/span&gt;         &lt;span style=&#34;color:#a6e22e&#34;&gt;termT&lt;/span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;//leaderâ€™s term
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;leaderId&lt;/span&gt;     &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// so follower can redirect clients
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;prevLogIndex&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;indexT&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;//index of log entry immediately preceding new ones
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;prevLogTerm&lt;/span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;termT&lt;/span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;// term of prevLogIndex entry
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;entries&lt;/span&gt;      []&lt;span style=&#34;color:#a6e22e&#34;&gt;Log&lt;/span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;// log entries to store (empty for heartbeat; may send more than one for efficiency)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;leaderCommit&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;indexT&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// leaderâ€™s commitIndex
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;appendEntryReply&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;term&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;termT&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// currentTerm, for leader to update itself
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;success&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;// true if follower contained entry matching prevLogIndex and prevLogTerm
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Raft&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;AppendEntriesRPC&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;appendEntryArgs&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;appendEntryReply&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å®ç°leaderå‘é€å¿ƒè·³ä¿¡æ¯(åœ¨lab2Aä¸­ï¼ŒprevLogçš„å‚æ•°éƒ½è¿˜ä¸å¯¹)&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Raft&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;appendEntries&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;heartBeat&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;range&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;peers&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;me&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;appendEntryArgs&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#a6e22e&#34;&gt;Term&lt;/span&gt;:         &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;currentTerm&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#a6e22e&#34;&gt;LeaderId&lt;/span&gt;:     &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;me&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#a6e22e&#34;&gt;PrevLogIndex&lt;/span&gt;: &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;getLastLogIndex&lt;/span&gt;(),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#a6e22e&#34;&gt;PrevLogTerm&lt;/span&gt;:  &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;getLastLogTerm&lt;/span&gt;(),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#a6e22e&#34;&gt;Entries&lt;/span&gt;:      &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#a6e22e&#34;&gt;LeaderCommit&lt;/span&gt;: &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;commitIndex&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;heartBeat&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#66d9ef&#34;&gt;go&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Raft&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;appendEntryArgs&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;peerId&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;					&lt;span style=&#34;color:#a6e22e&#34;&gt;client&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;peers&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;peerId&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;					&lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;appendEntryReply&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;					&lt;span style=&#34;color:#a6e22e&#34;&gt;client&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Call&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Raft.AppendEntriesRPC&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;					&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Lock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;					&lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Unlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;					&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Term&lt;/span&gt; &amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;currentTerm&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;						&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;setTerm&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Term&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;						&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;setElectionTime&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;						&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;status&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;follower&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;						&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;					}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				}(&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ€åæ ¹æ®Figure2 å®ç°RPC Handler(ä¸åŒ…å«Log,ä»…å¿ƒè·³)&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Receiver implementation:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Reply false if term &amp;lt; currentTerm (Â§5.1)&lt;/li&gt;
&lt;li&gt;Reply false if log doesnâ€™t contain an entry at prevLogIndex&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;whose term matches prevLogTerm (Â§5.3)&lt;/p&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;If an existing entry conflicts with a new one (same index&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;but different terms), delete the existing entry and all that&lt;/p&gt;
&lt;p&gt;follow it (Â§5.3)&lt;/p&gt;
&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;Append any new entries not already in the log&lt;/li&gt;
&lt;li&gt;If leaderCommit &amp;gt; commitIndex, set commitIndex =&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;min(leaderCommit, index of last new entry)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Raft&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;AppendEntriesRPC&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;appendEntryArgs&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;appendEntryReply&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Lock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Unlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Success&lt;/span&gt; = &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Term&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;currentTerm&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Term&lt;/span&gt; &amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;currentTerm&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;status&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;follower&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;setElectionTime&lt;/span&gt;() &lt;span style=&#34;color:#75715e&#34;&gt;// check(AntiO2)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;setTerm&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Term&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Term&lt;/span&gt; &amp;lt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;currentTerm&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;setElectionTime&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;status&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;candidate&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;status&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;follower&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Entries&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;||&lt;/span&gt; len(&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Entries&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#75715e&#34;&gt;// do heartBeat
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Success&lt;/span&gt; = &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è®°å¾—å®ŒæˆGetState()ï¼Œç”¨äºæ£€æµ‹çŠ¶æ€ã€‚&lt;/p&gt;
&lt;p&gt;Debugæ—¶é‡åˆ°çš„å‘ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æ— è®ºæ˜¯æ”¶åˆ°AppendEntryçš„RPCæ—¶ï¼Œå‘ç°äº†æ›´é«˜çš„termï¼Œè¿˜æ˜¯RPCå›å¤ä¸­çš„å‚æ•°å‘ç°äº†æ›´é«˜çš„termï¼Œéƒ½è¦ç«‹å³è½¬å…¥followerçŠ¶æ€ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;The tester requires that the leader send heartbeat RPCs no more than ten times per second.&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¥½åƒå¿ƒè·³æ—¶é—´ä¸€ç§’ä¸èƒ½è¶…è¿‡10æ¬¡ã€‚å½“æˆ‘ä¸€ç§’å‘é€100æ¬¡å¿ƒè·³ï¼Œèƒ½ç»´æŠ¤åªæœ‰ä¸€ä¸ªLeaderï¼Œä½†æ˜¯æ¯éš”100mså°±ä¼šå‡ºç°å¤šä¸ªLeaderçš„æƒ…å†µã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ¯”å¦‚åœ¨æµ‹è¯•ä¸­å‡ºç°çš„è¿™ç§æƒ…å†µï¼šs3åœ¨term8æ–­å¼€è¿æ¥ï¼Œåœ¨ä¹‹åè¿˜è‡ªç§°leader.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/mit6.824/lab2/blogimage-20230915164048988.png&#34;
	width=&#34;665&#34;
	height=&#34;726&#34;
	srcset=&#34;https://antio2.cn/tech/mit6.824/lab2/blogimage-20230915164048988_hud3cf35ecce4140958a8f072fe69e1a45_118174_480x0_resize_box_3.png 480w, https://antio2.cn/tech/mit6.824/lab2/blogimage-20230915164048988_hud3cf35ecce4140958a8f072fe69e1a45_118174_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20230915164048988&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;91&#34;
		data-flex-basis=&#34;219px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/mit6.824/lab2/blogimage-20230915164454972.png&#34;
	width=&#34;675&#34;
	height=&#34;590&#34;
	srcset=&#34;https://antio2.cn/tech/mit6.824/lab2/blogimage-20230915164454972_hu8b511b5c7e6d63224272e619a8238623_98490_480x0_resize_box_3.png 480w, https://antio2.cn/tech/mit6.824/lab2/blogimage-20230915164454972_hu8b511b5c7e6d63224272e619a8238623_98490_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20230915164454972&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;114&#34;
		data-flex-basis=&#34;274px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;å†çœ‹æç¤ºï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;The paper&amp;rsquo;s Section 5.2 mentions election timeouts in the range of 150 to 300 milliseconds. Such a range only makes sense if the leader sends heartbeats considerably more often than once per 150 milliseconds. Because the tester limits you to 10 heartbeats per second, you will have to use an election timeout larger than the paper&amp;rsquo;s 150 to 300 milliseconds, but not too large, because then you may fail to elect a leader within five seconds.&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;å› ä¸ºLeaderæ¯100mså‘é€ä¸€æ¬¡è¶…æ—¶ä¿¡æ¯ï¼Œæ¥ä¸åŠåœ¨Followerè¿›å…¥è¶…æ—¶é€‰ä¸¾çŠ¶æ€ä¹‹å‰æ›´æ–°ï¼Œæ‰€ä»¥è¦å¢å¤§è¶…æ—¶é€‰ä¸¾çš„æ—¶é—´ã€‚ï¼ˆè¦æ±‚åœ¨è¶…æ—¶æ—¶é—´ä¸­ï¼Œå‘é€more often than onceï¼‰ è¿™é‡Œæˆ‘å°†è¶…æ—¶æ—¶é—´è®¾ç½®æˆäº†300~500ms.&lt;/p&gt;
&lt;p&gt;å†ä»”ç»†æ£€æŸ¥ï¼Œå‘ç°å¿½ç•¥äº†ä¸€ç§æƒ…å†µï¼šå°±æ˜¯æ”¶åˆ°æŠ•ç¥¨è¯·æ±‚æ—¶ï¼Œå‘ç°äº†æ›´é«˜çš„termï¼Œå¿˜äº†è½¬å˜ä¸ºfollowerçŠ¶æ€ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å½“æˆ‘åœ¨Windowsç¯å¢ƒä¸‹ï¼Œä½¿ç”¨&lt;code&gt;-race&lt;/code&gt;æµ‹è¯•ï¼Œä¼šæŠ¥é”™ã€‚ä¸Šç½‘çœ‹äº†ä¸‹Issueå¥½åƒamdä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ã€‚&lt;/li&gt;
&lt;li&gt;å‘ç°äº†æ²¡æœ‰æ”¶åˆ°å¤šæ•°ç¥¨ä¹Ÿèƒ½èµ¢å¾—é€‰ä¸¾çš„é—®é¢˜ï¼Œç„¶åæ‰æ£€æŸ¥åˆ°åˆ¤å®šå¤šæ•°æ´¾çš„é€‰ç¥¨æ•°åº”è¯¥è‡³å°‘æ˜¯&lt;code&gt;(peerNum+2)/2&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/mit6.824/lab2/blogimage-20230915172619453.png&#34;
	width=&#34;799&#34;
	height=&#34;280&#34;
	srcset=&#34;https://antio2.cn/tech/mit6.824/lab2/blogimage-20230915172619453_hub207d8dd4eae94911d7979b83d8e1277_224266_480x0_resize_box_3.png 480w, https://antio2.cn/tech/mit6.824/lab2/blogimage-20230915172619453_hub207d8dd4eae94911d7979b83d8e1277_224266_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20230915172619453&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;285&#34;
		data-flex-basis=&#34;684px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;åœ¨æµ‹è¯•æ—¶å‘ç°ä¸€æ¬¡é”™è¯¯Logå¦‚ä¸‹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-tex&#34; data-lang=&#34;tex&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:20 Disconnect : [2] [5] [3]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:21 [4] Time Out,Start Election Term [4]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:21 [3] Time Out,Start Election Term [4]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:21 [1] Time Out,Start Election Term [4]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:21 [0] Time Out,Start Election Term [4]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:21 [6] Vote To [4] In term [4]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:21 [2] Time Out,Start Election Term [4]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:21 [4] Time Out,Start Election Term [5]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:21 [1] Time Out,Start Election Term [5]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:21 [0] Time Out,Start Election Term [5]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:21 [6] Vote To [1] In term [5]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:21 [3] Time Out,Start Election Term [5]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:21 [2] Time Out,Start Election Term [5]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:22 [3] Time Out,Start Election Term [6]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:22 [0] Time Out,Start Election Term [6]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:22 [4] Time Out,Start Election Term [6]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:22 [1] Vote To [0] In term [6]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:22 [6] Vote To [0] In term [6]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:22 [2] Time Out,Start Election Term [6]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:22 [4] Time Out,Start Election Term [7]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:22 [6] Time Out,Start Election Term [7]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:22 [0] Time Out,Start Election Term [7]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:22 [1] Vote To [4] In term [7]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:22 [3] Time Out,Start Election Term [7]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:22 [2] Time Out,Start Election Term [7]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:22 [4] Time Out,Start Election Term [8]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:22 [1] Time Out,Start Election Term [8]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:22 [6] Vote To [1] In term [8]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:22 [0] Vote To [1] In term [8]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:22 [3] Time Out,Start Election Term [8]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:23 [2] Time Out,Start Election Term [8]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:23 [4] Time Out,Start Election Term [9]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:23 [0] Time Out,Start Election Term [9]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:23 [6] Vote To [0] In term [9]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:23 [1] Vote To [0] In term [9]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:23 [3] Time Out,Start Election Term [9]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:23 [0] Time Out,Start Election Term [10]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:23 [6] Time Out,Start Election Term [10]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:23 [2] Time Out,Start Election Term [9]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:23 [1] Vote To [0] In term [10]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:23 [4] Vote To [6] In term [10]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:23 [3] Time Out,Start Election Term [10]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:24 [0] Time Out,Start Election Term [11]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:24 [6] Time Out,Start Election Term [11]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:24 [4] Vote To [0] In term [11]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:24 [1] Vote To [0] In term [11]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:24 [2] Time Out,Start Election Term [10]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:24 [3] Time Out,Start Election Term [11]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:24 [0] Time Out,Start Election Term [12]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:24 [1] Time Out,Start Election Term [12]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:24 [6] Vote To [0] In term [12]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:24 [4] Vote To [0] In term [12]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:24 [2] Time Out,Start Election Term [11]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:24 [3] Time Out,Start Election Term [12]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:24 [1] Time Out,Start Election Term [13]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:24 [0] Time Out,Start Election Term [13]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:24 [6] Vote To [1] In term [13]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:24 [4] Vote To [1] In term [13]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:25 [2] Time Out,Start Election Term [12]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:25 [0] Time Out,Start Election Term [14]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:25 [3] Time Out,Start Election Term [13]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:25 [6] Time Out,Start Election Term [14]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:25 [4] Time Out,Start Election Term [14]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:25 [1] Vote To [6] In term [14]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:25 [2] Time Out,Start Election Term [13]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:25 [1] Time Out,Start Election Term [15]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:25 [0] Time Out,Start Election Term [15]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:25 [3] Time Out,Start Election Term [14]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:25 [6] Vote To [0] In term [15]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:25 [4] Vote To [1] In term [15]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:03:25 [2] Time Out,Start Election Term [14]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;--- FAIL: TestManyElections2A (6.33s)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    config.go:398: expected one leader, got none
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™é‡Œå¥½åƒéƒ½æˆäº†candidateï¼Œç„¶åæ²¡æœ‰åœ¨5sæŠ•ç¥¨å‡ºæ¥æœ‰æ•ˆçš„leaderã€‚ä»Logçœ‹çš„å‡ºæ¥ï¼Œè¿™é‡Œ2ã€5ã€3éƒ½ä¸‹çº¿äº†ï¼Œåœ¨é›†ç¾¤é‡Œé¢åªæœ‰0,1,4,6æœåŠ¡å™¨åœ¨çº¿ã€‚ä¹Ÿå°±æ˜¯è¯´0ï¼Œ1ï¼Œ4ï¼Œ6ä¸­ï¼Œå¿…é¡»æœ‰ä¸€ä¸ªæœåŠ¡å™¨å¾—åˆ°4ç¥¨ï¼ˆå…¨ç¥¨ï¼‰æ‰èƒ½å½“é€‰ã€‚&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚å‡ºç°äº†è¿™ç§æƒ…å†µï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2023&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;15&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;18&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;03&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;21&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;] &lt;span style=&#34;color:#a6e22e&#34;&gt;Time&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Out&lt;/span&gt;,&lt;span style=&#34;color:#a6e22e&#34;&gt;Start&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Election&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Term&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2023&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;15&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;18&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;03&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;21&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] &lt;span style=&#34;color:#a6e22e&#34;&gt;Time&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Out&lt;/span&gt;,&lt;span style=&#34;color:#a6e22e&#34;&gt;Start&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Election&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Term&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2023&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;15&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;18&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;03&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;21&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;6&lt;/span&gt;] &lt;span style=&#34;color:#a6e22e&#34;&gt;Vote&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;To&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;] &lt;span style=&#34;color:#a6e22e&#34;&gt;In&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;term&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;1å’Œ0å‡ ä¹åŒæ—¶å¼€å§‹æ–°çš„é€‰ä¸¾ã€‚åœ¨6æŠ•ç¥¨ç»™1ä¹‹å‰ï¼Œ0ä¹Ÿå¼€å§‹é€‰ä¸¾ï¼Œå°±ä¼šå‡ºç°åˆ†ç¥¨çš„æƒ…å†µã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†çœ‹çš„æ›´æ¸…æ¥šï¼Œå°†logçš„æ—¶é—´æ ¼å¼æ”¹ä¸ºæ¯«ç§’çº§åˆ«&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-tex&#34; data-lang=&#34;tex&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:17 Disconnect : [6] [4] [5]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:17.497307 [5] Time Out,Start Election Term [8]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:17.497370 [3] Time Out,Start Election Term [8]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:17.497607 [1] Time Out,Start Election Term [8]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:17.498068 [0] Vote To [3] In term [8]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:17.498081 [2] Vote To [1] In term [8]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:17.900286 [3] Time Out,Start Election Term [9]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:17.900529 [5] Time Out,Start Election Term [9]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:17.900757 [2] Time Out,Start Election Term [9]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:17.900814 [0] Vote To [3] In term [9]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:17.900904 [1] Time Out,Start Election Term [9]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:18.302221 [2] Time Out,Start Election Term [10]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:18.302400 [0] Time Out,Start Election Term [10]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:18.302467 [3] Time Out,Start Election Term [10]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:18.302693 [1] Time Out,Start Election Term [10]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:18.403276 [5] Time Out,Start Election Term [10]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:18.703948 [3] Time Out,Start Election Term [11]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:18.704030 [1] Time Out,Start Election Term [11]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:18.704036 [0] Time Out,Start Election Term [11]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:18.704627 [2] Vote To [3] In term [11]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:18.904608 [5] Time Out,Start Election Term [11]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:19.206448 [3] Time Out,Start Election Term [12]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:19.206490 [0] Time Out,Start Election Term [12]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:19.206784 [2] Time Out,Start Election Term [12]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:19.207301 [1] Time Out,Start Election Term [12]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:19.306922 [5] Time Out,Start Election Term [12]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:19.608320 [0] Time Out,Start Election Term [13]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:19.608388 [3] Time Out,Start Election Term [13]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:19.608350 [1] Time Out,Start Election Term [13]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:19.611556 [2] Vote To [1] In term [13]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:19.708899 [5] Time Out,Start Election Term [13]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:20.010722 [0] Time Out,Start Election Term [14]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:20.011113 [3] Time Out,Start Election Term [14]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:20.011701 [1] Time Out,Start Election Term [14]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:20.011758 [2] Vote To [0] In term [14]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:20.111205 [5] Time Out,Start Election Term [14]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:20.413353 [1] Time Out,Start Election Term [15]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:20.413558 [2] Time Out,Start Election Term [15]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:20.414091 [3] Vote To [1] In term [15]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:20.414073 [0] Vote To [2] In term [15]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:20.514419 [5] Time Out,Start Election Term [15]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:20.816345 [1] Time Out,Start Election Term [16]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:20.816657 [3] Time Out,Start Election Term [16]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:20.816823 [0] Time Out,Start Election Term [16]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:20.819032 [2] Vote To [1] In term [16]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:21.017935 [5] Time Out,Start Election Term [16]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:21.218446 [1] Time Out,Start Election Term [17]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:21.218512 [0] Time Out,Start Election Term [17]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:21.218845 [2] Time Out,Start Election Term [17]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:21.219796 [3] Vote To [1] In term [17]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:21.419438 [5] Time Out,Start Election Term [17]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:21.620428 [0] Time Out,Start Election Term [18]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:21.620592 [2] Time Out,Start Election Term [18]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:21.620687 [3] Time Out,Start Election Term [18]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:21.622159 [1] Vote To [0] In term [18]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:21.821781 [5] Time Out,Start Election Term [18]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;--- FAIL: TestManyElections2A (8.43s)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    config.go:398: expected one leader, got none
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™æ¬¡æ˜¯0ï¼Œ1ï¼Œ2ï¼Œ3å¿…é¡»æŠ•ç¥¨ç»™åŒä¸€ä¸ªServerã€‚&lt;/p&gt;
&lt;p&gt;ç„¶åå‘ç°äº†ä¸€äº›ä¸å¯¹çš„åœ°æ–¹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-tex&#34; data-lang=&#34;tex&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:20.011701 [1] Time Out,Start Election Term [14]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:20.011758 [2] Vote To [0] In term [14]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:20.413353 [1] Time Out,Start Election Term [15]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;2023/09/15 18:15:20.413558 [2] Time Out,Start Election Term [15]
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼Œ1çš„è¶…æ—¶é€‰ä¸¾æ—¶é—´é‡è®¾ä¸ºäº†401.652ms,2çš„è¶…æ—¶é€‰ä¸¾æ—¶é—´é‡è®¾ä¸ºäº†401.800ms,ä¸¤è€…å¤ªç›¸è¿‘äº†ã€‚åªè¦è¿™ç§æƒ…å†µå‘ç”Ÿï¼Œå°±ä¼šå‡ºç°ä¸€ç›´åˆ†ç¥¨çš„æƒ…å†µã€‚è¿™å¤§æ¦‚æ˜¯ä¸å¤Ÿéšæœºçš„åŸå› ï¼Œ300-500msçš„è¶…æ—¶é—´éš”å¤ªè¿‘äº†ã€‚ç„¶åæˆ‘å°è¯•å°†è¶…æ—¶æ—¶é—´åœ¨$[300,900]ms$ ï¼Œè§£å†³äº†è¿™ä¸ªé—®é¢˜&lt;/p&gt;
&lt;p&gt;æœ€åï¼Œä½¿ç”¨&lt;code&gt;go test -run TestManyElections2A -race -count 100 -timeout 1800s &lt;/code&gt;ï¼Œè¿è¡Œ100æ¬¡æµ‹è¯•ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/mit6.824/lab2/blogimage-20230915200039030.png&#34;
	width=&#34;1920&#34;
	height=&#34;1021&#34;
	srcset=&#34;https://antio2.cn/tech/mit6.824/lab2/blogimage-20230915200039030_hucc94d3756e8d2d57cd8ac7670446e4df_1836294_480x0_resize_box_3.png 480w, https://antio2.cn/tech/mit6.824/lab2/blogimage-20230915200039030_hucc94d3756e8d2d57cd8ac7670446e4df_1836294_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20230915200039030&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;188&#34;
		data-flex-basis=&#34;451px&#34;
	
&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;è¡¥å……è¯´æ˜ï¼š&lt;/strong&gt; åœ¨Leaderå½“é€‰ä¹‹åï¼Œåº”å½“ç«‹å³å¢åŠ ä¸€æ¡ç©ºè®°å½•ã€‚&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logLatch&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Lock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logs&lt;/span&gt; = append(&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logs&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;Log&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;Term&lt;/span&gt;:    &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;currentTerm&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;Index&lt;/span&gt;:   &lt;span style=&#34;color:#a6e22e&#34;&gt;nextIndex&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;Command&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;})
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;persist&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// rf.logger.Printf(&amp;#34;Leader [%d] \nLog [%v]\n&amp;#34;, rf.me, rf.logs)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logLatch&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Unlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½†æ˜¯Lab2Bçš„ä»£ç é€»è¾‘ä¼šæ£€æµ‹Indexå€¼ï¼Œç¬¬ä¸€æ¡Logçš„Indexå¿…é¡»ä¸º1è€Œä¸æ˜¯2ã€‚å¯¼è‡´é€šè¿‡ä¸äº†æµ‹è¯•ã€‚&lt;/p&gt;
&lt;h2 id=&#34;0x32-lab2b&#34;&gt;0x32 Lab2B&lt;/h2&gt;
&lt;h3 id=&#34;åˆæ­¥å®ç°&#34;&gt;åˆæ­¥å®ç°&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt; ï¼š è¿™ä¸€å°èŠ‚çš„ä»£ç è¿˜æ²¡æœ‰debugï¼Œæ˜¯ç¬”è®°ã€‚å…·ä½“ä¿®æ”¹åçš„çœ‹ä¸‹ä¸€å°èŠ‚&lt;/p&gt;
&lt;p&gt;lab2bé€šè¿‡æµ‹è¯•çš„ä»£ç ï¼š[&lt;a class=&#34;link&#34; href=&#34;https://github.com/AntiO2/6.824/blob/5f1e191a4c18751527122c289e4a0549261f04b6/src/raft/raft.go&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;6.824/src/raft/raft.go at 5f1e191a4c18751527122c289e4a0549261f04b6 Â· AntiO2/6.824 (github.com)&lt;/a&gt;](&lt;a class=&#34;link&#34; href=&#34;https://github.com/AntiO2/6.824/commit/d969343dadf3aeb8c167cf36bc600e0b0b1e01ec&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://github.com/AntiO2/6.824/commit/d969343dadf3aeb8c167cf36bc600e0b0b1e01ec&lt;/a&gt;)&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Start by implementing &lt;code&gt;Start()&lt;/code&gt;, then write the code to send and receive new log entries via &lt;code&gt;AppendEntries&lt;/code&gt; RPCs, following Figure 2.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;é¦–å…ˆå®ç°&lt;code&gt;Start()&lt;/code&gt;å‡½æ•°&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;the service using Raft (e.g. a k/v server) wants to start
agreement on the next Command to be appended to Raft&amp;rsquo;s log. if this
server isn&amp;rsquo;t the leader, returns false. otherwise start the
agreement and return immediately. there is no guarantee that this
Command will ever be committed to the Raft log, since the leader
may fail or lose an election. even if the Raft instance has been killed,
this function should return gracefully.&lt;/p&gt;
&lt;p&gt;the first return value is the Index that the Command will appear at
if it&amp;rsquo;s ever committed. the second return value is the current
Term. the third return value is true if this server believes it is
the leader.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¦‚æœè¯¥serverä¸æ˜¯leaderï¼Œç›´æ¥è¿”å›&lt;code&gt;false&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;index&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Your code here (2B).
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;term&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;isLeader&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;GetState&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; !&lt;span style=&#34;color:#a6e22e&#34;&gt;isLeader&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;index&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;term&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;isLeader&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æœè¯¥Serveræ˜¯Leaderï¼Œç›´æ¥è¿”å›Indexã€‚å°†æ–°çš„Commandä½œä¸ºLogå†™å…¥logsä¸­ã€‚è¯¥æ¡logç­‰å¾…ä¸‹ä¸€æ¬¡å¿ƒè·³ç»Ÿä¸€å‘é€ï¼ˆä¸€æ¬¡å‘é€å¤šæ¡ï¼‰&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Raft&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;Start&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;command&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;interface&lt;/span&gt;{}) (&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;index&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;indexT&lt;/span&gt; = &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#75715e&#34;&gt;// Your code here (2B).
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;term&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;isLeader&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;GetState&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; !&lt;span style=&#34;color:#a6e22e&#34;&gt;isLeader&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; int(&lt;span style=&#34;color:#a6e22e&#34;&gt;index&lt;/span&gt;), &lt;span style=&#34;color:#a6e22e&#34;&gt;term&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;isLeader&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logger&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Printf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Leader [%d] Receive Log [%v]\n&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;me&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;command&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logLatch&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Lock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; len(&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logs&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;index&lt;/span&gt; = &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	} &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;index&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logs&lt;/span&gt;[len(&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logs&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;].&lt;span style=&#34;color:#a6e22e&#34;&gt;Index&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;index&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logs&lt;/span&gt; = append(&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logs&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;Log&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;Term&lt;/span&gt;:    &lt;span style=&#34;color:#a6e22e&#34;&gt;termT&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;term&lt;/span&gt;),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;Index&lt;/span&gt;:   &lt;span style=&#34;color:#a6e22e&#34;&gt;index&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;Command&lt;/span&gt;: &lt;span style=&#34;color:#a6e22e&#34;&gt;command&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	})
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;persist&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#75715e&#34;&gt;// rf.logger.Printf(&amp;#34;Leader [%d] \nLog [%v]\n&amp;#34;, rf.me, rf.logs)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logLatch&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Unlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#75715e&#34;&gt;// rf.appendEntries(false)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; int(&lt;span style=&#34;color:#a6e22e&#34;&gt;index&lt;/span&gt;), &lt;span style=&#34;color:#a6e22e&#34;&gt;term&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;isLeader&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¥ä¸‹æ¥è¦åšçš„å°±æ˜¯ä¿®æ”¹AppendEntryçš„é€»è¾‘ï¼ˆå®ç°figure2ï¼‰&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Receiver implementation:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Reply false if term &amp;lt; currentTerm (Â§5.1)&lt;/li&gt;
&lt;li&gt;Reply false if log doesnâ€™t contain an entry at prevLogIndex&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;whose term matches prevLogTerm (Â§5.3)&lt;/p&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;If an existing entry conflicts with a new one (same index&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;but different terms), delete the existing entry and all that&lt;/p&gt;
&lt;p&gt;follow it (Â§5.3)&lt;/p&gt;
&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;Append any new entries not already in the log&lt;/li&gt;
&lt;li&gt;If leaderCommit &amp;gt; commitIndex, set commitIndex =&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;min(leaderCommit, index of last new entry)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å…¶ä¸­&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;é€‰ä¸¾å°±å·²ç»å®ç°&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Success&lt;/span&gt; = &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Term&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;currentTerm&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Term&lt;/span&gt; &amp;lt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;currentTerm&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;
&lt;p&gt;&lt;em&gt;Reply false if log doesnâ€™t contain an entry at prevLogIndex whose term matches prevLogTerm (Â§5.3)&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;æ³¨æ„ï¼Œè¦å…ˆæ‰¾åˆ°ç›¸åŒIndexçš„ä½ç½®ï¼ˆè¿™é‡Œæ•°ç»„ä¸èƒ½è¶Šç•Œï¼‰ï¼Œå¹¶ä¸”è¯¥ä½ç½®çš„Logåº”è¯¥å…·æœ‰ç›¸åŒçš„term&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Success&lt;/span&gt; = &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;PrevLogIndex&lt;/span&gt; &amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;getLastLogIndex&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logLatch&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;RLock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logs&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;PrevLogIndex&lt;/span&gt;].&lt;span style=&#34;color:#a6e22e&#34;&gt;Term&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;PrevLogTerm&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logLatch&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;RUnlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;&lt;em&gt;If an existing entry conflicts with a new one (same index but different terms), delete the existing entry and all that follow it (Â§5.3)&lt;/em&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è¿™å¥è¯æˆ‘ä¸€å¼€å§‹æ²¡ç†è§£åˆ°ï¼Œsame index but different termsçš„æƒ…å†µä¸æ˜¯åœ¨2é‡Œé¢å°±è¢«returnäº†å—ï¼Ÿå…¶å®æ˜¯ï¼Œå½“prevLogåŒ¹é…ä¸Šäº†ï¼Œå°±å¯ä»¥å¼€å§‹åšLog Replicationï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå¯èƒ½åé¢çš„logå­˜åœ¨termå†²çªçš„æƒ…å†µï¼Œè¿™ä¸ªæ—¶å€™è¦†ç›–å°±è¡Œäº†ã€‚&lt;/p&gt;
&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;
&lt;blockquote&gt;
&lt;p&gt;Append any new entries not already in the log&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å®ç°3å’Œ4(è¿™é‡Œæ˜¯é”™è¯¯çš„æƒ³æ³•ï¼Œå…·ä½“ä¿®æ”¹çœ‹ä¸‹ä¸€å°èŠ‚)ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logLatch&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Lock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logLatch&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Unlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logs&lt;/span&gt; = append(&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logs&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;PrevLogIndex&lt;/span&gt;:], &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Entries&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;...&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Success&lt;/span&gt; = &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;5&#34;&gt;
&lt;li&gt;If leaderCommit &amp;gt; commitIndex, set commitIndex =min(leaderCommit, index of last new entry)&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;LeaderCommit&lt;/span&gt; &amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;commitIndex&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;commitIndex&lt;/span&gt; = min(&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;LeaderCommit&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;getLastLogIndex&lt;/span&gt;())
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;go&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;apply&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»¥ä¸Šæ˜¯followerçš„é€»è¾‘ã€‚&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥åº”å½“ä¿®æ”¹Leaderå‘é€RPCçš„é€»è¾‘&lt;/p&gt;
&lt;p&gt;é¦–å…ˆæ ¹æ®&lt;code&gt;nextIndex&lt;/code&gt;æ‰¾åˆ°prevLOg,è·å–è¯·æ±‚å‚æ•°ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;range&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;peers&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;me&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;heartBeat&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;||&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lastIndex&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;nextIndex&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;]) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;prevLog&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logs&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;nextIndex&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;]]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;appendEntryArgs&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;Term&lt;/span&gt;:         &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;currentTerm&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;LeaderId&lt;/span&gt;:     &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;me&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;PrevLogIndex&lt;/span&gt;: &lt;span style=&#34;color:#a6e22e&#34;&gt;prevLog&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Index&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;PrevLogTerm&lt;/span&gt;:  &lt;span style=&#34;color:#a6e22e&#34;&gt;prevLog&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Term&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;LeaderCommit&lt;/span&gt;: &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;commitIndex&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       copy(&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Entries&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logs&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;nextIndex&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;]:])
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åå‘é€RPC&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;go&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Raft&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;appendEntryArgs&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;peerId&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;client&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;peers&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;peerId&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;appendEntryReply&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;client&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Call&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Raft.AppendEntriesRPC&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Lock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Unlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Term&lt;/span&gt; &amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;currentTerm&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;setTerm&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Term&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;setElectionTime&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;status&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;follower&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; !&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Success&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;nextIndex&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;--&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    } &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;matchIndex&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;] = &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;nextIndex&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}(&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¥ä¸‹æ¥ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰æ–°çš„Logå¯ä»¥è½¬ä¸ºæäº¤çŠ¶æ€&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;If there exists an N such that N &amp;gt; commitIndex, a majority&lt;/p&gt;
&lt;p&gt;of matchIndex[i] â‰¥ N, and log[N].term == currentTerm:&lt;/p&gt;
&lt;p&gt;set commitIndex = N (Â§5.3, Â§5.4).&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Raft&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;checkCommit&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Lock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Unlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;status&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;leader&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;lastIndex&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;getLastLogIndex&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logLatch&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;RLock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logLatch&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;RUnlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;commitIndex&lt;/span&gt;; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lastIndex&lt;/span&gt;; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logs&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;].&lt;span style=&#34;color:#a6e22e&#34;&gt;Term&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;currentTerm&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#75715e&#34;&gt;// 5.4.2 Committing entries from previous terms
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;continue&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;count&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;j&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#a6e22e&#34;&gt;j&lt;/span&gt; &amp;lt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;peerNum&lt;/span&gt;; &lt;span style=&#34;color:#a6e22e&#34;&gt;j&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;j&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;me&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#a6e22e&#34;&gt;count&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          } &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;matchIndex&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;j&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#a6e22e&#34;&gt;count&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;count&lt;/span&gt; &amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;peerNum&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;commitIndex&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;apply&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å®ç°Applyã€‚è¿™é‡Œæœ‰æç¤ºï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Your code may have loops that repeatedly check for certain events. Don&amp;rsquo;t have these loops execute continuously without pausing, since that will slow your implementation enough that it fails tests. Use Go&amp;rsquo;s &lt;a class=&#34;link&#34; href=&#34;https://golang.org/pkg/sync/#Cond&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;condition variables&lt;/a&gt;, or insert a &lt;code&gt;time.Sleep(10 * time.Millisecond)&lt;/code&gt; in each loop iteration.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä½¿ç”¨æ¡ä»¶å˜é‡ã€‚&lt;/p&gt;
&lt;h3 id=&#34;debug-lab2a&#34;&gt;debug-lab2a&lt;/h3&gt;
&lt;p&gt;ç„¶åæ˜¯è®©äººå¿ƒç¢çš„æµ‹è¯•ç¯èŠ‚ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;go test -run TestBasicAgree2B -race -count &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;go test -run TestRPCBytes2B -race -count &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;go test -run TestFailAgree2B -race -count &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;go test -run TestFailNoAgree2B -race -count &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;go test -run TestConcurrentStarts2B -race -count &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;go test -run TestRejoin2B -race -count &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;go test -run TestBackup2B -race -count &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;go test -run TestCount2B -race -count &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol&gt;
&lt;li&gt;Goè¯­è¨€copyçš„ä½¿ç”¨ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;åœ¨å¤åˆ¶åˆ‡ç‰‡æ—¶ï¼Œargs.entriesä¸€ç›´æ˜¯nil&lt;/p&gt;
&lt;p&gt;æŸ¥æ‰¾èµ„æ–™æ‰çŸ¥é“ï¼Œdstå¿…é¡»èƒ½å¤Ÿæœ‰è¶³å¤Ÿå¤§çš„å®¹é‡å¤åˆ¶è¿›å»&lt;/p&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´ï¼Œè¦åˆå§‹åŒ–&lt;code&gt;Entries: make([]Log, lastIndex - rf.nextIndex[i] + 1)&lt;/code&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;refï¼š&lt;a class=&#34;link&#34; href=&#34;http://c.biancheng.net/view/29.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Goè¯­è¨€copy()ï¼šåˆ‡ç‰‡å¤åˆ¶ï¼ˆåˆ‡ç‰‡æ‹·è´ï¼‰ (biancheng.net)&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;å‘ç°Followerä¸€ç›´åœ¨æ·»åŠ log&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;åŸå› ï¼šå¿˜è®°åœ¨æˆåŠŸæ—¶æ›´æ–°NextIndex&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;nextIndex&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;] = &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;nextIndex&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;indexT&lt;/span&gt;(len(&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Entries&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;å‘ç°logså˜æ›´é”™è¯¯&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logs&lt;/span&gt; = append(&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logs&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;PrevLogIndex&lt;/span&gt;:], &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Entries&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;...&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™é‡Œé€»è¾‘æœ‰é—®é¢˜ï¼Œåº”è¯¥æ˜¯æˆªå–ä»[0,PrevLogIndex+1)&lt;/p&gt;
&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;&lt;img src=&#34;https://antio2.cn/tech/mit6.824/lab2/blogimage-20230916233749597.png&#34;
	width=&#34;637&#34;
	height=&#34;737&#34;
	srcset=&#34;https://antio2.cn/tech/mit6.824/lab2/blogimage-20230916233749597_hu993e6d2001cc4b844583906b905863cb_101282_480x0_resize_box_3.png 480w, https://antio2.cn/tech/mit6.824/lab2/blogimage-20230916233749597_hu993e6d2001cc4b844583906b905863cb_101282_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20230916233749597&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;86&#34;
		data-flex-basis=&#34;207px&#34;
	
&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;åœ¨ä¹‹å‰çš„LeaderæŒ‚æ‰ä¹‹åï¼Œå‡ºç°ä¸€ç›´append çš„æƒ…å†µï¼Œæ˜¯å› ä¸ºæœåŠ¡å™¨åœ¨å˜ä¸ºLeaderä¹‹åæ²¡æœ‰æ›´æ–°å¥½matchIndexå’ŒnextIndexçš„åŸå› &lt;/p&gt;
&lt;ol start=&#34;5&#34;&gt;
&lt;li&gt;æ— é™å¾ªç¯ï¼Ÿ&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¹‹å‰CheckCommitä¸­&lt;/p&gt;
&lt;p&gt;å¾ªç¯æ˜¯ä»rf.commitIndexå¼€å§‹çš„ï¼Œè«åå…¶å¦™ä¼šå¡ä½&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;commitIndex&lt;/span&gt;; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lastIndex&lt;/span&gt;; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ”¹æˆ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;commitIndex&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;;&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lastIndex&lt;/span&gt;; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å°±ä¸å¡äº†ã€‚&lt;/p&gt;
&lt;p&gt;åæ¥æ£€æŸ¥åˆ°ï¼Œæ˜¯å‘ç”Ÿäº†æ­»é”ã€‚&lt;/p&gt;
&lt;p&gt;å› ä¸ºæˆ‘çš„applyé€»è¾‘æ˜¯ï¼š&lt;/p&gt;
&lt;p&gt;æœåŠ¡å™¨å¯åŠ¨æ—¶ï¼Œå¯åŠ¨ä¸€ä¸ªgoç¨‹doApply()ï¼Œè´Ÿè´£apply command&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Raft&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;apply&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;applySign&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Raft&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;doApply&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; !&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;killed&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;applySign&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Lock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨CheckCommitä¸­ï¼Œé¦–å…ˆè·å–äº†&lt;code&gt;rf.mu.Lock()&lt;/code&gt;ã€‚æ‰€ä»¥å¯¼è‡´äº†æ­»é”&lt;/p&gt;
&lt;ol start=&#34;6&#34;&gt;
&lt;li&gt;
&lt;p&gt;åº”è¯¥èƒ½å¤Ÿæ”¯æŒRPCçš„å¹¶å‘å‘é€ã€‚æ³¨æ„ä¸è¦æŠŠCalléƒ½æ”¾åœ¨ä¸´ç•ŒåŒºé‡Œé¢&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ³¨æ„æ·»åŠ Logæ—¶ï¼Œè¦ä¿è¯Indexçš„æ­£ç¡®æ€§ï¼Œä¹‹å‰å¹¶å‘åŠ é”ç­–ç•¥å‡ºé”™ï¼Œåœ¨è¿™é‡Œé”™äº†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è¿˜æœ‰ä¸€ä¸ªéœ€è¦è®¨è®ºçš„ï¼šå°±æ˜¯Leaderåœ¨æ·»åŠ ä¸€æ¡logï¼Œéœ€è¦ç«‹å³å‘é€RPCå—ï¼Ÿ&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æˆ‘åœ¨ä¹‹å‰ï¼Œæ˜¯æ”¶åˆ°ä¸€æ¡logå°±ç«‹å³å‘é€RPCã€‚ä½†æ˜¯åœ¨æµ‹è¯•ä¸­ï¼Œæ‰æ„è¯†åˆ°ä¼šå‘é€å¦‚ä¸‹æƒ…æ™¯çš„é—®é¢˜ï¼š&lt;/p&gt;
&lt;p&gt;å‡å¦‚Leaderåœ¨2mså†…æ”¶åˆ°äº†100æ¡logï¼Œå¦‚æœé‡‡ç”¨ç«‹å³è§¦å‘çš„æ–¹å¼ï¼Œå°±ä¼šå¯¼è‡´å‘é€100*followeræ•°é‡çš„RPCï¼Œåˆ†åˆ«æºå¸¦&lt;code&gt;1~1,1~2,1~3,1~4...1~100&lt;/code&gt;çš„logã€‚å› ä¸ºleaderåœ¨å‘é€RPCä¹‹åï¼Œä¸ä¼šç«‹å³æ”¶åˆ°followerçš„å›å¤ã€‚è€Œfolloweræ”¶åˆ°çš„RPCå®é™…ä¸Šæ˜¯å¾ˆå†—ä½™çš„ã€‚æ¯”å¦‚æ”¶åˆ°$1\sim 50$ çš„logsï¼Œä¸‹ä¸€æ¡æ”¶åˆ°çš„$1\sim 100$ çš„logsï¼Œä¼šé‡å¤copyå‰50æ¡ã€‚&lt;/p&gt;
&lt;ol start=&#34;9&#34;&gt;
&lt;li&gt;ä¹‹å‰followerçš„&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logs&lt;/span&gt; = append(&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logs&lt;/span&gt;[:&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;PrevLogIndex&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;], &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Entries&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;...&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å®é™…ä¸Šè¿åäº†leaderè§„åˆ™4&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Append any new entries not already in the log&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ¥ç¬¬8æ¡ï¼Œæ¯”å¦‚å…ˆæ”¶åˆ°$1\sim 100$çš„RPC,å†æ”¶åˆ°$1\sim 50$çš„RPCã€‚ è™½ç„¶å³ä½¿è¿™æ ·ï¼ŒLeaderä¼šåœ¨å‡ ä¸ªRPCä¹‹åè¿›è¡Œå›é€€é‡ä¼ ï¼Œä½†è¿˜æ˜¯è¿åäº†è§„åˆ™ï¼Œå› ä¸ºéƒ½æ˜¯Term1çš„Index(æ³¨æ„ï¼šç›¸åŒtermå¹¶ä¸”ç›¸åŒindexçš„logä¸€å®šç›¸åŒ)ï¼Œæ‰€ä»¥åé¢çš„RPCå³ä½¿æ²¡æœ‰å†²çªä¹Ÿå¹¶ä¸ä¼šæ›´æ–°Logs&lt;/p&gt;
&lt;p&gt;é‡å†™appendé€»è¾‘ï¼Œä½¿å…¶ç¬¦åˆè§„åˆ™4&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logLatch&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Lock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Entries&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; len(&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Entries&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logger&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Printf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;[%d] append [%d] logs\nprev rf&amp;#39;s logs: [%v]\nnew logs: [%v]&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;me&lt;/span&gt;, len(&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Entries&lt;/span&gt;), &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logs&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Entries&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;entry&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;range&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Entries&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;entry&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Index&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;getLastLogIndexWriteMode&lt;/span&gt;() &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;entry&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Term&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logs&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;entry&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Index&lt;/span&gt;].&lt;span style=&#34;color:#a6e22e&#34;&gt;Term&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#75715e&#34;&gt;// conflict
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logs&lt;/span&gt; = append(&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logs&lt;/span&gt;[:&lt;span style=&#34;color:#a6e22e&#34;&gt;entry&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Index&lt;/span&gt;], &lt;span style=&#34;color:#a6e22e&#34;&gt;entry&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;persist&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;entry&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Index&lt;/span&gt; &amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;getLastLogIndexWriteMode&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#75715e&#34;&gt;// Append any new entries not already in the log
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logs&lt;/span&gt; = append(&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logs&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Entries&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;:]&lt;span style=&#34;color:#f92672&#34;&gt;...&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#66d9ef&#34;&gt;break&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Entries&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; len(&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Entries&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logger&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Printf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;[%d] append [%d] logs\nrf&amp;#39;s logs: [%v]\nnew logs: [%v]&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;me&lt;/span&gt;, len(&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Entries&lt;/span&gt;), &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logs&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Entries&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;persist&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logLatch&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Unlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;10&#34;&gt;
&lt;li&gt;ä¸€ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹ï¼šlogsçš„é•¿åº¦å¹¶ä¸ç­‰äºæœ€åä¸€æ¡logçš„indexï¼å³ä½¿æˆ‘ä»¬ä¸€å¼€å§‹ä¼šè§‚å¯Ÿåˆ°æ˜¯è¿™æ ·ï¼ˆå› ä¸ºæˆ‘çš„å®ç°ä¸­ç¬¬0æ¡logæ°¸è¿œæ˜¯ä¸€ä¸ªç©ºlogï¼‰ã€‚å› ä¸ºä¹‹åä¼šæ¸…é™¤æ‰ä¸éœ€è¦çš„logï¼Œæ‰€ä»¥è¿™æ¡ç»éªŒä¸æˆç«‹ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;0x33-lab2c&#34;&gt;0x33 Lab2C&lt;/h2&gt;
&lt;h3 id=&#34;å®ç°persister&#34;&gt;å®ç°Persister&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;Your implementation won&amp;rsquo;t use the disk; instead, it will save and restore persistent state from a &lt;code&gt;Persister&lt;/code&gt; object (see &lt;code&gt;persister.go&lt;/code&gt;).&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å°±æ˜¯æŠŠRaftæœåŠ¡å™¨çš„çŠ¶æ€é€šè¿‡PersisteræŒä¹…åŒ–ï¼ˆè€Œéç›´æ¥å†™åœ¨ç£ç›˜ä¸Šï¼‰ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Complete the functions &lt;code&gt;persist()&lt;/code&gt; and &lt;code&gt;readPersist()&lt;/code&gt; in &lt;code&gt;raft.go&lt;/code&gt; by adding code to save and restore persistent state. You will need to encode (or &amp;ldquo;serialize&amp;rdquo;) the state as an array of bytes in order to pass it to the &lt;code&gt;Persister&lt;/code&gt;. Use the &lt;code&gt;labgob&lt;/code&gt; encoder; see the comments in &lt;code&gt;persist()&lt;/code&gt; and &lt;code&gt;readPersist()&lt;/code&gt;. &lt;code&gt;labgob&lt;/code&gt; is like Go&amp;rsquo;s &lt;code&gt;gob&lt;/code&gt; encoder but prints error messages if you try to encode structures with lower-case field names.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è¯´å®è¯ï¼Œå°±æ˜¯å°†Figure2ä¸­æŒ‡æ˜éœ€è¦æŒä¹…åŒ–çš„æ•°æ®è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/mit6.824/lab2/blogimage-20230918213352819.png&#34;
	width=&#34;619&#34;
	height=&#34;281&#34;
	srcset=&#34;https://antio2.cn/tech/mit6.824/lab2/blogimage-20230918213352819_hu386a49b2978cd94746a1fdb516a008b8_47654_480x0_resize_box_3.png 480w, https://antio2.cn/tech/mit6.824/lab2/blogimage-20230918213352819_hu386a49b2978cd94746a1fdb516a008b8_47654_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20230918213352819&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;220&#34;
		data-flex-basis=&#34;528px&#34;
	
&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Raft&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;persist&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// Your code here (2C).
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// Example:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;w&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; new(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Buffer&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;e&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;labgob&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;NewEncoder&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;w&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;e&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Encode&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;currentTerm&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;e&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Encode&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;votedFor&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;e&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Encode&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logs&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;persister&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;SaveRaftState&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;w&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Bytes&lt;/span&gt;())
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// restore previously persisted state.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Raft&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;readPersist&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;data&lt;/span&gt; []&lt;span style=&#34;color:#66d9ef&#34;&gt;byte&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;data&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;||&lt;/span&gt; len(&lt;span style=&#34;color:#a6e22e&#34;&gt;data&lt;/span&gt;) &amp;lt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; { &lt;span style=&#34;color:#75715e&#34;&gt;// bootstrap without any state?
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// Your code here (2C).
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// Example:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;r&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;NewBuffer&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;data&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;d&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;labgob&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;NewDecoder&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;r&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;currentTerm&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;termT&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;votedFor&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;logs&lt;/span&gt; []&lt;span style=&#34;color:#a6e22e&#34;&gt;Log&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;d&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Decode&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;currentTerm&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;||&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;d&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Decode&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;votedFor&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;||&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;d&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Decode&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;logs&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Fatalln&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Error Occur When Deserialize Raft State&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    } &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;currentTerm&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;currentTerm&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;votedFor&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;votedFor&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logs&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;logs&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åšäº†è¿™ä¸ªä¹‹åï¼Œå¹¶ä¸”æ³¨æ„åœ¨æ¯æ¬¡éœ€è¦æŒä¹…åŒ–çš„çŠ¶æ€æ”¹å˜æ—¶éƒ½ä½¿ç”¨&lt;code&gt;rf.persist()&lt;/code&gt;è¿›è¡ŒæŒä¹…åŒ–ï¼Œå‰ä¸¤ä¸ªæµ‹è¯•ç‚¹åº”è¯¥å°±å¯ä»¥é€šè¿‡äº†ã€‚&lt;/p&gt;
&lt;h3 id=&#34;fast-rollback&#34;&gt;Fast Rollback&lt;/h3&gt;
&lt;p&gt;æ¥ä¸‹æ¥çš„ç›®æ ‡æ˜¯å¯¹åŒæ­¥è¿›è¡Œä¼˜åŒ–ï¼š&lt;/p&gt;
&lt;p&gt;å› ä¸ºæˆ‘ç›®å‰æ˜¯æ¯50mså‘é€ä¸€æ¬¡å¿ƒè·³ï¼Œå‡è®¾ä¸€ä¸ªfollowerè½å100æ¡log,æ¯æ¬¡å›é€€ä¸€æ¡nextIndexçš„è¯ï¼Œéœ€è¦100æ¬¡å¿ƒè·³æ‰èƒ½åŒæ­¥ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/mit6.824/lab2/blogimage-20230919142710891.png&#34;
	width=&#34;1724&#34;
	height=&#34;952&#34;
	srcset=&#34;https://antio2.cn/tech/mit6.824/lab2/blogimage-20230919142710891_hudf474624832591e8262a8d8dc9d8ebc3_572523_480x0_resize_box_3.png 480w, https://antio2.cn/tech/mit6.824/lab2/blogimage-20230919142710891_hudf474624832591e8262a8d8dc9d8ebc3_572523_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20230919142710891&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;181&#34;
		data-flex-basis=&#34;434px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;S2å½“é€‰Leaderåï¼Œå‘é€å¿ƒè·³ç»™S1,prevLogIndex=5,prevLogTerm=6ã€‚S1å‘ç°äº†Termå†²çªï¼Œäºæ˜¯XTerm=5(å†²çªçš„Termç¼–å·)ï¼ŒXIndex=2(è¯¥å†²çªTermçš„ç¬¬ä¸€ä¸ªIndex)è¿”å›ç»™S2,S2å¿«é€Ÿå›é€€ã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œå‚è€ƒç¬”è®°ï¼š&lt;a class=&#34;link&#34; href=&#34;https://zhuanlan.zhihu.com/p/203483680&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;7.3 å¿«é€Ÿæ¢å¤ï¼ˆFast Backupï¼‰ - çŸ¥ä¹ (zhihu.com)&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;XTermï¼šè¿™ä¸ªæ˜¯Followerä¸­ä¸Leaderå†²çªçš„Logå¯¹åº”çš„ä»»æœŸå·ã€‚åœ¨ä¹‹å‰ï¼ˆ7.1ï¼‰æœ‰ä»‹ç»Leaderä¼šåœ¨prevLogTermä¸­å¸¦ä¸Šæœ¬åœ°Logè®°å½•ä¸­ï¼Œå‰ä¸€æ¡Logçš„ä»»æœŸå·ã€‚å¦‚æœFolloweråœ¨å¯¹åº”ä½ç½®çš„ä»»æœŸå·ä¸åŒ¹é…ï¼Œå®ƒä¼šæ‹’ç»Leaderçš„AppendEntriesæ¶ˆæ¯ï¼Œå¹¶å°†è‡ªå·±çš„ä»»æœŸå·æ”¾åœ¨XTermä¸­ã€‚å¦‚æœFolloweråœ¨å¯¹åº”ä½ç½®æ²¡æœ‰Logï¼Œé‚£ä¹ˆè¿™é‡Œä¼šè¿”å› -1ã€‚&lt;/li&gt;
&lt;li&gt;XIndexï¼šè¿™ä¸ªæ˜¯Followerä¸­ï¼Œå¯¹åº”ä»»æœŸå·ä¸ºXTermçš„ç¬¬ä¸€æ¡Logæ¡ç›®çš„æ§½ä½å·ã€‚&lt;/li&gt;
&lt;li&gt;XLenï¼šå¦‚æœFolloweråœ¨å¯¹åº”ä½ç½®æ²¡æœ‰Logï¼Œé‚£ä¹ˆXTermä¼šè¿”å›-1ï¼ŒXLenè¡¨ç¤ºç©ºç™½çš„Logæ§½ä½æ•°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;è¿™é‡Œæˆ‘ç†è§£çš„XLenæ˜¯followerå½“å‰çš„&lt;code&gt;len(rf.logs)&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆfolloweråœ¨æ¥æ”¶logsä¿¡æ¯æœ‰å¦‚ä¸‹çš„çŠ¶æ€ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;pTermå’ŒpIndexåŒ¹é…ï¼šè¯´æ˜ä¸ç”¨å›é€€ï¼Œå¯ä»¥ç›´æ¥å¢åŠ ï¼ˆæˆ–è¦†ç›–ï¼‰logs&lt;/li&gt;
&lt;li&gt;pIndex &amp;gt; å½“å‰logsçš„é•¿åº¦ã€‚è¿”å›XLen = len(rf.logs&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;PrevLogIndex&lt;/span&gt; &amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lastIndex&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logger&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Printf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;[%d] receive beyond conflict logs&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;me&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Conflict&lt;/span&gt; = &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;XTerm&lt;/span&gt; = &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;XLen&lt;/span&gt; = len(&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logs&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logLatch&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;RUnlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;pTermä¸åŒ¹é…ï¼Œè¿”å›XTerm = followerå‘ç”Ÿå†²çªçš„Termï¼ŒXIndex = followerä¸Šè¯¥Termç¬¬ä¸€æ¡logçš„Index&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;getIthIndex&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;PrevLogIndex&lt;/span&gt;).&lt;span style=&#34;color:#a6e22e&#34;&gt;Term&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;PrevLogTerm&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logger&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Printf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;[%d] receive prev term conflict logs&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;me&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Conflict&lt;/span&gt; = &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;XTerm&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;getIthIndex&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;PrevLogIndex&lt;/span&gt;).&lt;span style=&#34;color:#a6e22e&#34;&gt;Term&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;XIndex&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;getFirstLogIndexInXTerm&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;XTerm&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;PrevLogIndex&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logLatch&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;RUnlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Raft&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;getFirstLogIndexInXTerm&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;xTerm&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;termT&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;prevIndex&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;indexT&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;indexT&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#75715e&#34;&gt;// rf.logger.Printf(&amp;#34;In Get FirstLogIndexInXTerm\nS[%d]\nlogs: %v&amp;#34;, rf.me, rf.logs)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;idx&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; min(&lt;span style=&#34;color:#a6e22e&#34;&gt;prevIndex&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;getLastLogIndexLockFreeMode&lt;/span&gt;())
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;getIthIndex&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;idx&lt;/span&gt;).&lt;span style=&#34;color:#a6e22e&#34;&gt;Term&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;xTerm&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Fatalln&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Error Use getFirstLogIndexInXTerm&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#75715e&#34;&gt;// åˆå§‹çŠ¶æ€ä¸‹ï¼Œlogs[idx]ä¸€å®šç­‰äºxTerm
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; int(&lt;span style=&#34;color:#a6e22e&#34;&gt;idx&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logOffset&lt;/span&gt; &amp;gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;getIthIndex&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;idx&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;).&lt;span style=&#34;color:#a6e22e&#34;&gt;Term&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;xTerm&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#66d9ef&#34;&gt;break&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;idx&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;--&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;idx&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å½“Leaderæ¥æ”¶åˆ°RPCçš„Replyæ—¶ï¼Œåšä»¥ä¸‹å¤„ç†&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;è‹¥Success==true,æ›´æ–°NextIndex&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è‹¥å‘ç”Ÿå†²çª&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;è‹¥XTerm=-1,è¯´æ˜followerçš„logsæ¯”è¾ƒçŸ­ï¼Œå°†NextIndexè®¾ä¸ºXLen&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è‹¥XTerm!=-1, è¿™ä¸ªæ—¶å€™éœ€è¦æ‰¾åˆ°leaderåœ¨XTermä¸­æœ€åä¸€æ¡log&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è‹¥æ²¡æœ‰æ‰¾åˆ°è¯¥log&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ¯”å¦‚è¿™ç§æƒ…å†µï¼ŒXTerm=5,éœ€è¦å°†nextIndexå›é€€åˆ°XIndex(2)çš„ä½ç½®&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/mit6.824/lab2/blogblogimage-20230919151757424.png&#34;
	width=&#34;1920&#34;
	height=&#34;1020&#34;
	srcset=&#34;https://antio2.cn/tech/mit6.824/lab2/blogblogimage-20230919151757424_hu3a37df6d5d7dbe2b702e7495866d5fa5_128717_480x0_resize_box_3.png 480w, https://antio2.cn/tech/mit6.824/lab2/blogblogimage-20230919151757424_hu3a37df6d5d7dbe2b702e7495866d5fa5_128717_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20230919151757424&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;188&#34;
		data-flex-basis=&#34;451px&#34;
	
&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è‹¥Leaderæœ‰éƒ¨åˆ†Term=5çš„log&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/mit6.824/lab2/blogimage-20230919152045101.png&#34;
	width=&#34;1920&#34;
	height=&#34;1020&#34;
	srcset=&#34;https://antio2.cn/tech/mit6.824/lab2/blogimage-20230919152045101_hu70f4b2986bc8f9884292cdf223eef027_135134_480x0_resize_box_3.png 480w, https://antio2.cn/tech/mit6.824/lab2/blogimage-20230919152045101_hu70f4b2986bc8f9884292cdf223eef027_135134_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20230919152045101&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;188&#34;
		data-flex-basis=&#34;451px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;æ­¤æ—¶Leaderæ‰¾åˆ°è‡ªå·±æœ€åä¸€ä¸ªåœ¨XTermçš„ä½ç½®ä¸º3ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨3ä¹‹å‰ï¼ˆindexç›¸åŒå¹¶ä¸”termç›¸åŒï¼‰çš„logséƒ½æ˜¯å®Œå…¨ç›¸åŒçš„ï¼Œå¯ä»¥å°†nextIndexç§»åˆ°4è¿™ä¸ªä½ç½®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Conflict&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;					&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;XTerm&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;						&lt;span style=&#34;color:#a6e22e&#34;&gt;lastIndexInXTerm&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;getLastLogIndexInXTerm&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;XTerm&lt;/span&gt;, int(&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;XIndex&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;						&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logger&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Printf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Leader[%d] Logs:[\n%v]\n LastIndex In X Term: %d&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;me&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logs&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;lastIndexInXTerm&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;						&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logger&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Term Conflict&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;						&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lastIndexInXTerm&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;							&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;nextIndex&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;peerId&lt;/span&gt;] = &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;XIndex&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;						} &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;							&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;nextIndex&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;peerId&lt;/span&gt;] = &lt;span style=&#34;color:#a6e22e&#34;&gt;indexT&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;lastIndexInXTerm&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;						}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;					} &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;						&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logger&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Follower Too Short&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;						&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logger&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Printf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Leader[%d] XLen: %d\n&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;me&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;XLen&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;						&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;nextIndex&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;peerId&lt;/span&gt;] = &lt;span style=&#34;color:#a6e22e&#34;&gt;indexT&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;XLen&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;					}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;					&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logger&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Printf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Leader[%d] NextIndex Of [%d] Update To [%d]\n&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;me&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;peerId&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;nextIndex&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;peerId&lt;/span&gt;])
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				} &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Success&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; len(&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Entries&lt;/span&gt;) &amp;gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;					&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logger&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Success Update&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;					&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;matchIndex&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;peerId&lt;/span&gt;] = max(&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;PrevLogIndex&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;indexT&lt;/span&gt;(len(&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Entries&lt;/span&gt;)), &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;matchIndex&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;peerId&lt;/span&gt;])
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;					&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;nextIndex&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;peerId&lt;/span&gt;] = max(&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;nextIndex&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;peerId&lt;/span&gt;], &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;matchIndex&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;peerId&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;					&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logger&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Printf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Leader[%d] NextIndex Of [%d] Update To [%d]\n&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;me&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;peerId&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;nextIndex&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;peerId&lt;/span&gt;])
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;					&lt;span style=&#34;color:#66d9ef&#34;&gt;go&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;checkCommit&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// getLastLogIndexInXTerm è¿”å›rf.logsåœ¨xTermä¸­æœ€åä¸€æ¡logçš„ä¸‹æ ‡
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// å¦‚æœå®Œå…¨æ²¡æœ‰xTerm,è¿”å›-1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Raft&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;getLastLogIndexInXTerm&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;xTerm&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;termT&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;xIndex&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;) &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;idx&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logOffset&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;xIndex&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logs&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;idx&lt;/span&gt;].&lt;span style=&#34;color:#a6e22e&#34;&gt;Term&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;xTerm&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;idx&lt;/span&gt; &amp;lt; len(&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logs&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logs&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;idx&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;].&lt;span style=&#34;color:#a6e22e&#34;&gt;Term&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;xTerm&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;idx&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;idx&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;idx&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;0x34-lab2d-log-compaction&#34;&gt;0x34 Lab2D log compaction&lt;/h2&gt;
&lt;p&gt;å®ç°å¿«ç…§ã€‚å…¶å®ç±»ä¼¼Checkpoint,è¦æ±‚ServeræŒä¹…åŒ–å·²æœ‰Logçš„çŠ¶æ€ï¼Œç„¶ååªéœ€è¦é€šè¿‡snapshotå°±èƒ½æ¢å¤ï¼Œä¸ç”¨ä¸€ä¸ªä¸€ä¸ªLogå†æ¥redoã€‚&lt;/p&gt;
&lt;p&gt;Leaderå¹¶ä¸æ˜¯é€šè¿‡è®¡ç®—å»åˆ¤æ–­æ˜¯å¦å‘é€å¿«ç…§ï¼Œè€Œæ˜¯é€šè¿‡åˆ¤æ–­å½“å‰çš„Nextå»å‘é€Snapshotã€‚æ¯”å¦‚ä¸€ä¸ªLeaderæœ‰äº†1-10000çš„Logï¼Œç„¶ååˆ¶ä½œäº†å¿«ç…§ï¼Œæ­¤æ—¶Logsä¸­æœ‰10001â€”20000çš„Logsã€‚æ­¤æ—¶ä¸€å°åŒ…å«1-5000çš„æœåŠ¡å™¨å¯åŠ¨äº†ï¼Œç„¶åæ”¶åˆ°äº†Leaderçš„append entry rpc, ç„¶ååœ¨ä¹‹å‰çš„é€»è¾‘ä¸­ï¼Œfollowerçš„logsè¾ƒçŸ­ï¼Œä¼šå›å¤Xlen=5000,è¿™é‡Œéœ€è¦åšç‚¹æ”¹åŠ¨ï¼Œåº”å½“å‘é€followeræœ€ååŒ…å«çš„Indexã€‚Leaderæ¥æ”¶åˆ°RPCå›å¤ï¼Œå‘ç°NextIndexåº”å½“å›é€€åˆ°Index=5000, ä½†æ˜¯ï¼ŒLeaderä¸­å‰1wçš„Logéƒ½è¢«æ¸…ç†æ‰äº†ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦å‘é€å¿«ç…§å®‰è£…çš„RPCã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/mit6.824/lab2/blogimage-20230920201413103.png&#34;
	width=&#34;583&#34;
	height=&#34;775&#34;
	srcset=&#34;https://antio2.cn/tech/mit6.824/lab2/blogimage-20230920201413103_hu5800a65bc9153a83724ac0d6f4d2f284_125140_480x0_resize_box_3.png 480w, https://antio2.cn/tech/mit6.824/lab2/blogimage-20230920201413103_hu5800a65bc9153a83724ac0d6f4d2f284_125140_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20230920201413103&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;75&#34;
		data-flex-basis=&#34;180px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;åœ¨Followeræ¥æ”¶åˆ°ç›¸åº”çš„å¿«ç…§ï¼Œè¿›è¡Œå®‰è£…ã€‚å¹¶ä¸”ä¸¢å¼ƒæ‰è‡ªå·±çš„æ‰€æœ‰Logsã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœFolloweræ¥æ”¶åˆ°å¿«ç…§ï¼Œå¹¶ä¸”åœ¨å¿«ç…§ä¹‹åè¿˜æœ‰Logï¼Œä¼šä¿ç•™ä¹‹åçš„Logs, æˆ‘æœ‰ç‚¹æ²¡æœ‰æƒ³é€šä¸ºä»€ä¹ˆä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚æŒ‰ç†è¯´æ ¹æ®å¿«é€Ÿå›é€€ï¼Œæ˜¯å› ä¸ºFolloweræ²¡æœ‰ä¹‹å‰çš„Logæ‰ä¼šæ¥æ”¶åˆ°snapshot,ä½†æ˜¯ç°åœ¨åˆå‡ºç°äº†å¿«ç…§ä¹‹åçš„log.&lt;/p&gt;
&lt;p&gt;è¦æ³¨æ„ï¼Œå½“CommitIndex &amp;gt; Snapshot.LastIndexï¼Œå°±ä¸èƒ½å†å®‰è£…è¯¥å¿«ç…§äº†ï¼Œå› ä¸ºçŠ¶æ€æœºå·²ç»åº”ç”¨äº†å¿«ç…§ä¹‹åçš„Logï¼Œå¦‚æœæ­¤æ—¶å®‰è£…å¿«ç…§ä¼šå‘ç”Ÿè¦†ç›–ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;æ¥ä¸‹æ¥æ˜¯ä»£ç éƒ¨åˆ†ï¼Œé¦–å…ˆå®ç°Snapshotã€‚æ³¨æ„ï¼Œæ¯”å¦‚æŒ‰ç…§ä¸€ä¸ªKVæ•°æ®åº“ï¼Œé€šè¿‡Applyä¿¡æ¯ï¼Œå¾—åˆ°äº†x,0;y,9è¿™ä¸¤ä¸ªé”®å€¼å¯¹ï¼Œè€ŒRAFTæœ¬èº«æ˜¯ä¸éœ€è¦é€šè¿‡Logæ„å»ºçŠ¶æ€æœºçš„ä¿¡æ¯çš„ã€‚snapshotæ˜¯serviceæä¾›çš„ï¼Œæˆ‘ä»¬æ˜¯ä¸éœ€è¦å»ç”Ÿæˆsnapshotçš„ï¼Œç”¨å°±å¥½äº†ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Raft&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;Snapshot&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;index&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;snapshot&lt;/span&gt; []&lt;span style=&#34;color:#66d9ef&#34;&gt;byte&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#75715e&#34;&gt;// Your code here (2D).
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;idx&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;indexT&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;index&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Lock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Unlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logLatch&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Lock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logLatch&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Unlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;idx&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;getLastIncludeIndex&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logger&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Outdated Snapshot&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;w&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; new(&lt;span style=&#34;color:#a6e22e&#34;&gt;bytes&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Buffer&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;e&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;labgob&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;NewEncoder&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;w&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;l&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;range&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logs&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;l&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Index&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;idx&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;tmpLogs&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; make([]&lt;span style=&#34;color:#a6e22e&#34;&gt;Log&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;tmpLogs&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] = &lt;span style=&#34;color:#a6e22e&#34;&gt;Log&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#a6e22e&#34;&gt;Term&lt;/span&gt;:    &lt;span style=&#34;color:#a6e22e&#34;&gt;l&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Term&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#a6e22e&#34;&gt;Index&lt;/span&gt;:   &lt;span style=&#34;color:#a6e22e&#34;&gt;idx&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#a6e22e&#34;&gt;Command&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logs&lt;/span&gt; = append(&lt;span style=&#34;color:#a6e22e&#34;&gt;tmpLogs&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logs&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;:]&lt;span style=&#34;color:#f92672&#34;&gt;...&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;e&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Encode&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;currentTerm&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;||&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;e&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Encode&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;votedFor&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;||&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;e&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Encode&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logs&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logger&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Fatalln&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Error When Encode State&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;persister&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;SaveStateAndSnapshot&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;w&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Bytes&lt;/span&gt;(), &lt;span style=&#34;color:#a6e22e&#34;&gt;snapshot&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;RPCéƒ¨åˆ†ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;é¦–å…ˆæ ¹æ®Figure13,åˆ›å»ºå‚æ•°&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;InstallSnapshotArgs&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;Term&lt;/span&gt;              &lt;span style=&#34;color:#a6e22e&#34;&gt;termT&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;LeaderId&lt;/span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;LastIncludedIndex&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;indexT&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;LastIncludedTerm&lt;/span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;termT&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#75715e&#34;&gt;// offset int
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;Data&lt;/span&gt; []&lt;span style=&#34;color:#66d9ef&#34;&gt;byte&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#75715e&#34;&gt;// done bool
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;InstallSnapshotReply&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;Term&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;termT&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ³¨æ„åœ¨Labä¸­è¿›è¡Œäº†ç®€åŒ–ï¼Œä¸€æ¬¡æ€§å‘é€æ‰€æœ‰å¿«ç…§ã€‚&lt;/p&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;followeræ¥æ”¶å¿«ç…§ï¼Œæ³¨æ„æ­¤æ—¶è¿˜æ²¡æœ‰å®‰è£…ã€‚å› ä¸ºå®‰è£…æ“ä½œæ˜¯çŠ¶æ€æœºåœ¨è¿›è¡Œ&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Raft&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;InstallSnapshot&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;InstallSnapshotArgs&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;InstallSnapshotReply&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;debug&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logger&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Printf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;[%d] Receive Snapshot\n&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;me&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Lock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Unlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Term&lt;/span&gt; &amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;currentTerm&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;becomeFollower&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Term&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Term&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;currentTerm&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logLatch&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;RLock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Term&lt;/span&gt; &amp;lt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;currentTerm&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;||&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;LastIncludedIndex&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;getLastIncludeIndex&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logLatch&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;RUnlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;setElectionTime&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;apply&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ApplyMsg&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;CommandValid&lt;/span&gt;:  &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;Command&lt;/span&gt;:       &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;CommandIndex&lt;/span&gt;:  &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;SnapshotValid&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;Snapshot&lt;/span&gt;:      &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Data&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;SnapshotTerm&lt;/span&gt;:  int(&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;LastIncludedTerm&lt;/span&gt;),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;SnapshotIndex&lt;/span&gt;: int(&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;LastIncludedIndex&lt;/span&gt;),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logLatch&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;RUnlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;go&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;() { &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;applyCh&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;apply&lt;/span&gt; }()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;go&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;apply&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç­‰å¾…å®‰è£…å¿«ç…§å®Œæˆåï¼ŒRAFTéœ€è¦æ›´æ–°ä¿¡æ¯ï¼Œæ­¤æ—¶éœ€è¦è°ƒç”¨CondInstallSnapshotæ¥æ›´æ–°RAFTçš„ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Raft&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;CondInstallSnapshot&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;lastIncludedTerm&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;lastIncludedIndex&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;snapshot&lt;/span&gt; []&lt;span style=&#34;color:#66d9ef&#34;&gt;byte&lt;/span&gt;) &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// Your code here (2D).
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;lastIncludedIndex2&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;indexT&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;lastIncludedIndex&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Lock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Unlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lastIncludedIndex2&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;commitIndex&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logLatch&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Lock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logLatch&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Unlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lastIncludedIndex2&lt;/span&gt; &amp;lt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;getLastLogIndex&lt;/span&gt;() &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;getLastLogTerm&lt;/span&gt;() &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;termT&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;lastIncludedTerm&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#75715e&#34;&gt;//     If existing log entry has same index and term as snapshotâ€™s
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;       &lt;span style=&#34;color:#75715e&#34;&gt;// last included entry, retain log entries following it and reply
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logs&lt;/span&gt; = append([]&lt;span style=&#34;color:#a6e22e&#34;&gt;Log&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;), &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logs&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;getLogOffset&lt;/span&gt;()&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;lastIncludedTerm&lt;/span&gt;:]&lt;span style=&#34;color:#f92672&#34;&gt;...&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    } &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#75715e&#34;&gt;// Discard the entire log
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logs&lt;/span&gt; = append([]&lt;span style=&#34;color:#a6e22e&#34;&gt;Log&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;), &lt;span style=&#34;color:#a6e22e&#34;&gt;Log&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;Term&lt;/span&gt;:    &lt;span style=&#34;color:#a6e22e&#34;&gt;termT&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;lastIncludedTerm&lt;/span&gt;),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;Index&lt;/span&gt;:   &lt;span style=&#34;color:#a6e22e&#34;&gt;lastIncludedIndex2&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;Command&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       })
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;snapshot&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;snapshot&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;commitIndex&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;lastIncludedIndex2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;applyIndex&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;lastIncludedIndex2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;saveRaftStateAndSnapshot&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;æ¥ä¸‹æ¥æ˜¯Leaderå¦‚ä½•è°ƒç”¨å®‰è£…å¿«ç…§çš„RPC&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å½“&lt;code&gt;nextIndex[i]&amp;lt;= rf.getLastIncludeIndex()&lt;/code&gt;ï¼Œ ä¹Ÿå°±æ˜¯è¯´leaderä¸åŒ…å«éœ€è¦å‘é€çš„Logæ—¶ï¼Œå‘é€å¿«ç…§ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logLatch&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;RLock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;nextIndex&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;] &amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lastIndex&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;nextIndex&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;] = &lt;span style=&#34;color:#a6e22e&#34;&gt;lastIndex&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;nextIndex&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;getLastIncludeIndex&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logLatch&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;RUnlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// å·²ç»ä¸åŒ…å«éœ€è¦çš„Logäº†
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;go&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Raft&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;peerId&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#75715e&#34;&gt;// å‘é€å¿«ç…§
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Lock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logLatch&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;RLock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;InstallSnapshotArgs&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;term&lt;/span&gt;:              &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;currentTerm&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;leaderId&lt;/span&gt;:          &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;me&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;lastIncludedIndex&lt;/span&gt;: &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;getLastIncludeIndex&lt;/span&gt;(),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;lastIncludedTerm&lt;/span&gt;:  &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;getLastIncludeTerm&lt;/span&gt;(),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;data&lt;/span&gt;:              &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;snapshot&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;logLatch&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;RUnlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Unlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;InstallSnapshotReply&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;peers&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;peerId&lt;/span&gt;].&lt;span style=&#34;color:#a6e22e&#34;&gt;Call&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Raft. InstallSnapshot&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Lock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Unlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;term&lt;/span&gt; &amp;lt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;currentTerm&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Receive Outdated Install Snapshot RPC reply&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;term&lt;/span&gt; &amp;gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;currentTerm&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;becomeFollower&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;term&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;nextIndex&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;peerId&lt;/span&gt;] = &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;lastIncludedIndex&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;matchIndex&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;peerId&lt;/span&gt;] = &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;lastIncludedIndex&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }(&lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;rf&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mu&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Unlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;continue&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;æœ€åå°±æ˜¯è¦è¿›è¡Œdebugç¯èŠ‚äº†ï¼Œå› ä¸ºä¹‹å‰çš„logsä¸‹æ ‡éƒ½ç­‰äºIndexï¼Œå¯èƒ½ä¼šå‡ºç°å¾ˆå¤šæ··ç”¨çš„æƒ…å†µã€‚æ¯”å¦‚åœ¨ä¹‹å‰æ£€æŸ¥èƒ½å¦commit logä¸­ï¼Œå°±ä½¿ç”¨ä¸‹æ ‡è¿›è¡Œäº†éå†ã€‚è¿™é‡Œå»ºè®®åœ¨ä»£ç ä¸­æœç´¢ä½¿ç”¨äº†&lt;code&gt;rf.logs&lt;/code&gt;çš„åœ°æ–¹ï¼Œæˆ–è€…é€šè¿‡IDEæŸ¥çœ‹ç”¨æ³•ã€‚åˆæ¯”å¦‚è¯´å½“followerçš„logså¤ªçŸ­æ—¶è¿”å›çš„XLen,æˆ‘è®¤ä¸ºåº”è¯¥æ”¹æˆè¿”å›followeræœ€åçš„Indexå·XIndexï¼Œç„¶åLeaderçš„Nextindex=XIndex+1&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;0x4-æ€»ç»“&#34;&gt;0x4 æ€»ç»“&lt;/h2&gt;
&lt;p&gt;æ€»ä½“æ¥è¯´ï¼Œåªçœ‹lectureå¯¹raftè¿˜æ˜¯æœ‰äº›è®¤çŸ¥ä¸åˆ°ä½çš„ï¼Œå°±åƒæˆ‘è¯´æˆ‘çš„ç–‘é—®é‚£é‡Œï¼Œè¿˜æœ‰å¾ˆå¤šä¸æ¸…æ™°çš„åœ°æ–¹ã€‚ä½†æ˜¯ä¸€æ—¦ä¸Šæ‰‹åšäº†ä»£ç ï¼Œå°±æŠŠç»†èŠ‚çš„éƒ¨åˆ†æ°å¼€å¼„æ¸…æ¥šäº†ã€‚åŠ ä¸Šç½‘ä¸Šå¥½å¿ƒäººå†™çš„åšå®¢å¾ˆå¤šï¼ŒçŸ¥ä¹ä¹Ÿæœ‰å„ç§ç»†èŠ‚é—®é¢˜çš„è®¨è®ºï¼Œæœ€ç»ˆè¿˜æ˜¯é¡ºåˆ©å®Œæˆäº†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/mit6.824/lab2/blogimage-20230921235039060.png&#34;
	width=&#34;350&#34;
	height=&#34;125&#34;
	srcset=&#34;https://antio2.cn/tech/mit6.824/lab2/blogimage-20230921235039060_huf707260c534c414072f8aa43e3bf7402_26327_480x0_resize_box_3.png 480w, https://antio2.cn/tech/mit6.824/lab2/blogimage-20230921235039060_huf707260c534c414072f8aa43e3bf7402_26327_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20230921235039060&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;280&#34;
		data-flex-basis=&#34;672px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/mit6.824/lab2/blogimage-20230921235000534.png&#34;
	width=&#34;528&#34;
	height=&#34;891&#34;
	srcset=&#34;https://antio2.cn/tech/mit6.824/lab2/blogimage-20230921235000534_hu7918613410c84c6698ff072a2ae58513_529680_480x0_resize_box_3.png 480w, https://antio2.cn/tech/mit6.824/lab2/blogimage-20230921235000534_hu7918613410c84c6698ff072a2ae58513_529680_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20230921235000534&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;59&#34;
		data-flex-basis=&#34;142px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;æœ€åå°±æ˜¯ä¸€èµ·æµ‹è¯•äº†ã€‚è¿™é‡Œçš„è¶…æ—¶é€‰ä¸¾æ—¶é—´éƒ½æ˜¯$300\sim900ms$&lt;/p&gt;
&lt;p&gt;å›¾ä¸€æ˜¯æ¯50mså‘é€ä¸€æ¬¡å¿ƒè·³ï¼Œå›¾2æ˜¯æ¯100mså‘é€ä¸€æ¬¡å¿ƒè·³ã€‚å¯ä»¥çœ‹åˆ°ç¬¬ä¸€æ¬¡çš„æ€»æ—¶é—´è¾ƒçŸ­ï¼Œä½†CPUç”¨æ—¶é«˜ã€‚å¿ƒè·³é—´éš”é•¿çš„æ€»æ—¶é—´è¾ƒé•¿ï¼Œä½†CPUç”¨çŸ­ï¼ˆå› ä¸ºç­‰å¾…æ—¶é—´å¤šï¼‰ã€‚æˆ‘è®¤ä¸ºå…·ä½“è®¾ç½®å°±åº”å½“çœ‹æƒ…æ™¯å–èˆäº†ã€‚å¦‚æœè¦å‡å°‘ç½‘ç»œæµé‡ï¼Œå¯ä»¥ç”¨è¾ƒé•¿é—´éš”ï¼›å¦‚æœè¦å‡å°‘å»¶è¿Ÿï¼Œå¯ä»¥ç”¨è¾ƒçŸ­é—´éš”ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;æºä»£ç å¯ä»¥å‚è€ƒ&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/AntiO2/6.824/blob/master/src/raft/raft.go&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;6.824/src/raft/raft.go at master Â· AntiO2/6.824 (github.com)&lt;/a&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>MIT6.824 | Lab 1 | MapReduce</title>
        <link>https://antio2.cn/tech/mit6.824/lab1/</link>
        <pubDate>Sun, 03 Sep 2023 00:18:37 +0800</pubDate>
        
        <guid>https://antio2.cn/tech/mit6.824/lab1/</guid>
        <description>&lt;h2 id=&#34;0x00-å‡†å¤‡&#34;&gt;0x00 å‡†å¤‡&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;é˜…è¯»MapReduceè®ºæ–‡&lt;/li&gt;
&lt;li&gt;é…ç½®GOç¯å¢ƒ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å› ä¸ºä¹‹å‰æ²¡ç”¨è¿‡GO,æ‰€ä»¥ å…ˆåœ¨ç½‘ä¸Šå­¦äº†ä¸€ä¸‹è¯­æ³•&lt;a class=&#34;link&#34; href=&#34;https://go.dev/tour/welcome/1&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;A Tour of Go&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æ„Ÿè§‰Goçš„æ¥å£å’Œæ–¹æ³•çš„è¯­æ³•å’ŒC++æŒºä¸ä¸€æ ·, å¹¶å‘ç¼–ç¨‹ä¹ŸæŒºæœ‰æ„æ€&lt;/p&gt;
&lt;h2 id=&#34;0x01-mapreduceç®€ä»‹&#34;&gt;0x01 MapReduceç®€ä»‹&lt;/h2&gt;
&lt;p&gt;éœ€è¦å®ç°masterå’Œcoordinatorã€‚&lt;/p&gt;
&lt;p&gt;MapReduceåˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µ:Mapå’ŒReduceé˜¶æ®µã€‚&lt;/p&gt;
&lt;p&gt;Mapé˜¶æ®µå‡½æ•°æä¾›Key,æ¯”å¦‚&lt;code&gt;pg-being_ernest.txt&lt;/code&gt;æ˜¯keyï¼Œç„¶åWorkeré€šè¿‡è¿™ä¸ªKeyè·å–Valueã€‚æ¯”å¦‚&lt;code&gt;pg-being_ernest.txt&lt;/code&gt;çš„å…·ä½“å†…å®¹ã€‚ç„¶åå°†Keyå’ŒValueï¼ˆåœ¨ä¾‹å­ä¸­æ˜¯æ–‡ç« çš„å†…å®¹ï¼‰ï¼Œä¼ é€’ç»™map functionã€‚è·å–ç»“æœï¼Œå¹¶å°†ç»“æœåˆ†æˆRä¸ªReduceå†…å®¹ã€‚&lt;/p&gt;
&lt;p&gt;ä¸¾ä¸ªä¾‹å­ã€‚å‡è®¾æˆ‘ä»¬è¦å¯¹&lt;code&gt;pg-being_ernest.txt&lt;/code&gt;å’Œ&lt;code&gt;pg-dorian_gray.txt&lt;/code&gt;ç»Ÿè®¡è¯é¢‘ã€‚é‚£ä¹ˆå°±è¦æœ‰ä¸¤ä¸ª&lt;code&gt;Map Task&lt;/code&gt;(ä¸ä¸€å®šæœ‰ä¸¤ä¸ªWorkerï¼Œæ¯”å¦‚æœ‰3ä¸ªWorkerï¼Œé‚£ä¹ˆå°±æ˜¯2ä¸ªWorkerå¹²æ´»ä¸€ä¸ªå›´è§‚ï¼›å¦‚æœåªæœ‰ä¸€ä¸ªWorkerï¼Œé‚£ä¹ˆè¯¥Workerä¼šè¢«å‰ååˆ†é…ä¸¤æ¬¡Mapæ“ä½œ)ã€‚å‡è®¾æœ‰3ä¸ªReduceæ“ä½œï¼Œé‚£ä¹ˆ&lt;code&gt;Map&lt;/code&gt;çš„ä¸­é—´æ“ä½œå°±ä¼šæŒ‰ç…§keyè¢«åˆ†ä¸º3ä¸ªæ–‡ä»¶ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;pg-being_ernest.txt&lt;/code&gt;å¯¹åº”Map0 , Map0æ“ä½œçš„kvè¢«åˆ†è¿›&lt;code&gt;mr-0-0,mr-0-1,mr-0-2&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;pg-dorian_gray.txt&lt;/code&gt;å¯¹åº”Map0 , Map0æ“ä½œçš„kvè¢«åˆ†è¿›&lt;code&gt;mr-1-0,mr-1-1,mr-1-2&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å½“æ‰€æœ‰çš„Mapfå·²ç»ç”Ÿæˆç»“æœï¼ŒWorkerå°±ä¼šè¢«æŒ‡æ´¾Reduceæ“ä½œã€‚æ¯”å¦‚è¢«æŒ‡æ´¾çš„Reduceæ“ä½œç¼–å·ä¸º2ï¼Œé‚£ä¹ˆReduceå°±ä¼šè¯»å–&lt;code&gt;mr-0-2&lt;/code&gt;,&lt;code&gt;mr-1-2&lt;/code&gt;ã€‚å¹¶ä¸”èšåˆç›¸åŒçš„Key,ä¼ é€’ç»™Reduceå‡½æ•°ã€‚&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚,&lt;code&gt;pg-being_ernest.txt&lt;/code&gt;ä¸­çš„mapæ“ä½œæœ‰kvï¼Œ&lt;code&gt;a 1 b 1 b 1&lt;/code&gt;è¾“å‡ºåˆ°&lt;code&gt;mr-0-2&lt;/code&gt;ã€‚&lt;code&gt;pg-dorian_gray.txt&lt;/code&gt;ä¸­çš„mapæ“ä½œæœ‰kvï¼Œ&lt;code&gt;c 1 b 1 c 1&lt;/code&gt;è¾“å‡ºåˆ°&lt;code&gt;mr-0-2&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶åTaskç¼–å·ä¸º2çš„Reduceä»»åŠ¡ä¼šè¯»å–æ‰€æœ‰å¯¹åº”çš„ä¸­é—´æ–‡ä»¶ã€‚å¾—åˆ°keyã€‚&lt;code&gt;a 1 b 1 b 1 c 1 b 1 c 1&lt;/code&gt;ã€‚ç„¶åå†å¯¹è¦å¤„ç†çš„keyè¿›è¡Œæ’åº,å¾—åˆ° &lt;code&gt;a 1  b 1 b 1 b 1  c 1 c 1&lt;/code&gt;ã€‚å†æŒ‰ç…§ç›¸åŒçš„keyè°ƒç”¨reduceå‡½æ•°ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ä¸Šé¢ä¾‹å­çš„è°ƒç”¨ä¸º&lt;/p&gt;
&lt;p&gt;&lt;code&gt;reducef(key:&amp;quot;a&amp;quot;,value:list[1])&lt;/code&gt;,å¾—åˆ°&amp;quot;1&amp;quot;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;reducef(key:&amp;quot;b&amp;quot;,value:list[1,1,1])&lt;/code&gt;,å¾—åˆ°&amp;quot;3&amp;quot;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;reducef(key:&amp;quot;c&amp;quot;,value:list[1,1])&lt;/code&gt;,å¾—åˆ°&amp;quot;2&amp;quot;&lt;/p&gt;
&lt;p&gt;æœ€åå°†kvs:[{&amp;ldquo;a&amp;rdquo;,&amp;ldquo;1&amp;rdquo;},{&amp;ldquo;b&amp;rdquo;,&amp;ldquo;3&amp;rdquo;},{&amp;ldquo;c&amp;rdquo;,&amp;ldquo;2&amp;rdquo;}]å†™å…¥è¯¥reduceç”Ÿæˆçš„æ–‡ä»¶&lt;code&gt;mr-out-2&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;0x02-rpc&#34;&gt;0x02 RPC&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨GOçš„RPCåº“ï¼Œå¯ä»¥ç®€å•åœ°å®ç°Server&lt;/p&gt;
&lt;p&gt;å­¦ä¹ æ—¶å‚è€ƒäº†&lt;a class=&#34;link&#34; href=&#34;https://zhuanlan.zhihu.com/p/139384493&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Go æ¯æ—¥ä¸€åº“ä¹‹ rpc - çŸ¥ä¹ (zhihu.com)&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;åœ¨MapReduceæ“ä½œæµç¨‹ä¸­å°±æ˜¯ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;é¦–å…ˆå¯åŠ¨å¤šä¸ªWorkerï¼ˆä»¥ä¸‹ç®€ç§°Cï¼‰å’Œä¸€ä¸ªCoordinatorï¼ˆä»¥ä¸‹ç®€ç§°Sï¼‰&lt;/li&gt;
&lt;li&gt;Cæ¯éš”ä¸€æ®µæ—¶é—´(æ¯”å¦‚1s)ä¼šå‘Så‘é€ä¸€ä¸ªä»»åŠ¡è¯·æ±‚
&lt;ol&gt;
&lt;li&gt;Sé¦–å…ˆæ£€æŸ¥Mapä»»åŠ¡è¿˜æœ‰æ²¡æœ‰åˆ†é…å®Œï¼ˆæ³¨æ„ä¸æ˜¯è¿è¡Œå®Œï¼‰ã€‚å¦‚æœæ²¡æœ‰ï¼Œåˆ†é…ä¸€ä¸ªMapä»»åŠ¡ç»™C&lt;/li&gt;
&lt;li&gt;å¦‚æœMapä»»åŠ¡åˆ†é…å®Œäº†ï¼Œå¹¶ä¸”è¿˜æ²¡æœ‰å·¥ä½œå®Œï¼ŒSè®©Cç­‰å¾…&lt;/li&gt;
&lt;li&gt;å¦‚æœMapå·¥ä½œå®Œäº†ã€‚Reduceè¿˜æ²¡åˆ†é…å®Œäº†ï¼ŒSç»™Cåˆ†é…ä¸€ä¸ªç©ºé—²çš„Reduceä»»åŠ¡&lt;/li&gt;
&lt;li&gt;å¦‚æœReduceéƒ½å·¥ä½œå®Œäº†ï¼Œæ‰€æœ‰ä»»åŠ¡ä¹Ÿéƒ½ç»“æŸäº†ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;å¦‚æœCå®Œæˆäº†ä»»åŠ¡ï¼Œä¼šå‘Så‘é€ä¸€ä¸ªè¯·æ±‚ã€‚SçŸ¥é“äº†æŸä¸ªä»»åŠ¡å®Œæˆï¼Œå°±ä¼šè¿›è¡Œç›¸åº”çš„æ“ä½œæ ‡è®°ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¸€äº›æ³¨æ„çš„ç‚¹:&lt;/p&gt;
&lt;p&gt;æ¯ä¸ªä»»åŠ¡æ˜¯æœ‰æ—¶é—´ä¸Šé™çš„ï¼ˆ10sï¼‰ã€‚æ¯åˆ†é…ä¸€ä¸ªä»»åŠ¡å°±ä¼šå¯åŠ¨ä¸€ä¸ªGOç¨‹ï¼Œç„¶åç­‰å¾…ç›¸åº”çš„æ—¶é—´ï¼Œæ£€æŸ¥æ˜¯å¦å®Œæˆäº†å·¥ä½œã€‚å¦‚æœæ²¡å®Œæˆï¼Œå°†è¯¥ä»»åŠ¡ç¼–å·é‡æ–°åŠ å…¥ç®¡é“ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªä»»åŠ¡æ˜¯å¦å®Œæˆå‘¢?&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚ç¬¬ä¸€ä¸ªWorkerç”³è¯·åˆ°äº†ä»»åŠ¡1ï¼Œè¿‡äº†10sé’Ÿè¿˜æ²¡æœ‰å®Œæˆï¼ŒSåˆå°†ä»»åŠ¡1åŠ å…¥å¾…å®Œæˆç®¡é“ã€‚æ­¤æ—¶ç¬¬2ä¸ªworkerç”³è¯·åˆ°äº†ä»»åŠ¡1ï¼Œåˆè¿‡äº†4sï¼Œç¬¬ä¸€ä¸ªWorkerå‘é€ä¸€ä¸ªMapDoneçš„è¯·æ±‚ç»™Sã€‚Så¦‚ä½•åˆ¤æ–­æ˜¯å¦å®Œæˆäº†è¯¥ä»»åŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘çš„å¤„ç†æ˜¯ç»´æŠ¤ä»»åŠ¡æ˜¯ç”±å“ªä¸ªWorkerè¿è¡Œçš„çŠ¶æ€ã€‚å…¶ä¸­Workerç”±RPCçš„æ—¶é—´æˆ³æ ‡è®°ã€‚æ¯”å¦‚worker1åœ¨ç¬¬ä¸€æ¬¡è¯·æ±‚æ—¶æ—¶é—´æˆ³ä¸º&lt;code&gt;13213123&lt;/code&gt;,Serverç»´æŠ¤maptask[1]æ˜¯ç”±&lt;code&gt;13213123&lt;/code&gt;æ­£åœ¨è¿è¡Œï¼Œå½“ç¬¬ä¸€æ¬¡è¶…æ—¶ï¼Œmaptask[1]å˜æˆäº†worker2è¯·æ±‚æ—¶çš„æ—¶é—´æˆ³``13219889&lt;code&gt;ã€‚åœ¨ç¬¬14s,æ”¶åˆ°MapDoneçš„è¯·æ±‚ï¼Œæ£€æŸ¥å…¶æ—¶é—´æˆ³ä¸º&lt;/code&gt;13213123`å’Œå½“å‰æ­£åœ¨è¿è¡Œçš„æ—¶é—´æˆ³ä¸åŒï¼Œæ‰€ä»¥ä¸¢å¼ƒæ‰è¯¥ç»“æœã€‚&lt;/p&gt;
&lt;p&gt;è¿˜æœ‰å°±æ˜¯å¹¶å‘å¤„ç†ï¼Œè¿™ä¸ªä½¿ç”¨é”å°±è¡Œäº†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;0x03-è°ƒè¯•&#34;&gt;0x03 è°ƒè¯•&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;å‘½ä»¤è¡Œçš„å‚æ•°ï¼šï¼ˆå› ä¸ºä¸ç”¨shellçš„è¯ä¸èƒ½ç”¨é€šé…ç¬¦pg*.txtä»£æ›¿ï¼Œåªèƒ½è¾“å…¥æ‰€æœ‰æ–‡ä»¶åï¼‰&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;pg-being_ernest.txt
pg-dorian_gray.txt
pg-frankenstein.txt
pg-grimm.txt
pg-huckleberry_finn.txt
pg-metamorphosis.txt
pg-sherlock_holmes.txt
pg-tom_sawyer.txt
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;åœ¨è°ƒè¯•æ—¶å‡ºç°æŠ¥é”™&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;code&gt;cannot load plugin ./wc.so err: plugin.Open(&amp;quot;./wc&amp;quot;): plugin was built with a different version of package internal/abi&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;æ˜¯å› ä¸º&lt;code&gt;build wc.so&lt;/code&gt;æ—¶çš„å‚æ•°å’Œè¿è¡Œmrå‚æ•°ä¸ä¸€è‡´å¯¼è‡´çš„ã€‚&lt;/p&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;ä½¿ç”¨&lt;code&gt;./test-mr-many.sh 3&lt;/code&gt;é‡å¤æµ‹è¯•3æ¬¡ã€‚é€šè¿‡æµ‹è¯•&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/mit6.824/lab1/blogimage-20230903010226505.png&#34;
	width=&#34;1483&#34;
	height=&#34;882&#34;
	srcset=&#34;https://antio2.cn/tech/mit6.824/lab1/blogimage-20230903010226505_hu94c74a3dc224800aa0b567affa83c581_1304266_480x0_resize_box_3.png 480w, https://antio2.cn/tech/mit6.824/lab1/blogimage-20230903010226505_hu94c74a3dc224800aa0b567affa83c581_1304266_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20230903010226505&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;168&#34;
		data-flex-basis=&#34;403px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;æ„Ÿè§‰Lab1åšä¸‹æ¥è¿˜æ˜¯æŒºé€šé€ã€‚åƒæ˜¯å¼•å…¥GOå’Œç›¸å…³æ¦‚å¿µã€‚é€šè¿‡lab,å­¦ä¹ åˆ°äº†GOè°ƒè¯•ã€‚&lt;/p&gt;
&lt;h2 id=&#34;0x04-ä»£ç &#34;&gt;0x04 ä»£ç &lt;/h2&gt;
&lt;h3 id=&#34;coordinatorgo&#34;&gt;coordinator.go&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;package&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;mr&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; (
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;log&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;sync&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;time&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;net&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;os&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;net/rpc&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;net/http&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;status&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// ç”¨äºæŒ‡ç¤ºworkerçš„çŠ¶æ€
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; (
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;notStart&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;status&lt;/span&gt; = &lt;span style=&#34;color:#66d9ef&#34;&gt;iota&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;running&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;taskDone&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;workMaxTime&lt;/span&gt; = &lt;span style=&#34;color:#ae81ff&#34;&gt;12&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Second&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Coordinator&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// Your definitions here.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;nReduce&lt;/span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// Reduceæ•°é‡
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;mMap&lt;/span&gt;             &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// Mapæ•°é‡
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;taskDone&lt;/span&gt;         &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;reduceTaskStatus&lt;/span&gt; []&lt;span style=&#34;color:#a6e22e&#34;&gt;status&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;mapTaskStatus&lt;/span&gt;    []&lt;span style=&#34;color:#a6e22e&#34;&gt;status&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// runningMap æ˜¯å½“å‰æ­£åœ¨runningçš„rpcId
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// æƒ³ä¸€ä¸‹è¿™ç§æƒ…å†µï¼šç¬¬ä¸€ä¸ªworkeræ²¡æœ‰åœ¨10ç§’å†…è¿”å›ç»“æœï¼Œäºæ˜¯masterå¼€å§‹æŠŠåŒæ ·çš„ä»»åŠ¡è¿”å›ç»™äº†ç¬¬äºŒä¸ªworker,æ­¤æ—¶åˆè¿‡äº†å‡ ç§’ï¼Œæ¯”å¦‚ä¸¤ç§’é’Ÿ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// é‚£ä¹ˆmasterå¦‚ä½•åˆ¤æ–­æ˜¯ç¬¬äºŒä¸ªworkerå®Œæˆäº†ä»»åŠ¡ï¼Œè¿˜æ˜¯ç¬¬ä¸€ä¸ªworkerå‘¢ï¼Ÿ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;runningMap&lt;/span&gt;    []&lt;span style=&#34;color:#a6e22e&#34;&gt;RpcIdT&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;runningReduce&lt;/span&gt; []&lt;span style=&#34;color:#a6e22e&#34;&gt;RpcIdT&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;mapTasks&lt;/span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;chan&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;TaskIdT&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// å¾…å¼€å§‹çš„map
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;reduceTasks&lt;/span&gt;   &lt;span style=&#34;color:#66d9ef&#34;&gt;chan&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;TaskIdT&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// å¾…å¼€å§‹çš„reduce
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;files&lt;/span&gt;         []&lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;     &lt;span style=&#34;color:#75715e&#34;&gt;// è¦è¿›è¡Œtaskçš„æ–‡ä»¶
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;mapCnt&lt;/span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;          &lt;span style=&#34;color:#75715e&#34;&gt;// å·²å®Œæˆçš„mapæ•°é‡
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;reduceCnt&lt;/span&gt;     &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;          &lt;span style=&#34;color:#75715e&#34;&gt;// å·²å®Œæˆçš„reduceæ•°é‡
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;latch&lt;/span&gt;         &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;sync&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Cond&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Your code here -- RPC handlers for the worker to call.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Example
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// an example RPC handler.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;//
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// the RPC argument and reply types are defined in rpc.go.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Coordinator&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;Example&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ExampleArgs&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ExampleReply&lt;/span&gt;) &lt;span style=&#34;color:#66d9ef&#34;&gt;error&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Y&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;X&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Appoint ç”¨äºworkerè¯·æ±‚ä¸€ä¸ªä»»åŠ¡
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Coordinator&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;Appoint&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;request&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ReqArgs&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ResArgs&lt;/span&gt;) &lt;span style=&#34;color:#66d9ef&#34;&gt;error&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ResId&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;request&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ReqId&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;MapNumM&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mMap&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ReduceNumN&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;nReduce&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;latch&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;L&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Lock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;done&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;taskDone&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;latch&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;L&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Unlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;done&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ResOp&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;WorkDone&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;switch&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;request&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ReqOp&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;WorkReq&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#75715e&#34;&gt;// è¯·æ±‚ä¸€ä¸ªä»»åŠ¡
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;latch&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;L&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Lock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; len(&lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mapTasks&lt;/span&gt;) &amp;gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#75715e&#34;&gt;// å¦‚æœmapä»»åŠ¡è¿˜æ²¡æœ‰å®Œå…¨åˆ†é… åˆ†é…ä¸€ä¸ªmap worker
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;             &lt;span style=&#34;color:#a6e22e&#34;&gt;taskId&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mapTasks&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ResTaskId&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;taskId&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ResContent&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;files&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;taskId&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ResOp&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;WorkMap&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;runningMap&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;taskId&lt;/span&gt;] = &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ResId&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mapTaskStatus&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;taskId&lt;/span&gt;] = &lt;span style=&#34;color:#a6e22e&#34;&gt;running&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;latch&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;L&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Unlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#66d9ef&#34;&gt;go&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;checkDone&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;WorkMap&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ResTaskId&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Printf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Assign map \t%d to \t%d\n&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ResTaskId&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ResId&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mapCnt&lt;/span&gt; &amp;lt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mMap&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#75715e&#34;&gt;// å¦‚æœmapä»»åŠ¡å·²ç»å…¨éƒ¨åˆ†é…å®Œäº†ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰è¿è¡Œå®Œæˆï¼Œè¿˜ä¸èƒ½å¼€å§‹reduce
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;             &lt;span style=&#34;color:#75715e&#34;&gt;// workeréœ€è¦æš‚æ—¶ç­‰å¾…ä¸€ä¸‹
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;             &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ResOp&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;WorkNothing&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;latch&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;L&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Unlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Map All assigned but not done&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; len(&lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;reduceTasks&lt;/span&gt;) &amp;gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#75715e&#34;&gt;// å·²ç»ç¡®å®šå®Œæˆäº†æ‰€æœ‰mapï¼Œè¿˜æ²¡æœ‰åˆ†é…å®Œreduce
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;             &lt;span style=&#34;color:#a6e22e&#34;&gt;taskId&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;reduceTasks&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ResTaskId&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;taskId&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ResOp&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;WorkReduce&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;runningReduce&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;taskId&lt;/span&gt;] = &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ResId&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;reduceTaskStatus&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;taskId&lt;/span&gt;] = &lt;span style=&#34;color:#a6e22e&#34;&gt;running&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;latch&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;L&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Unlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#66d9ef&#34;&gt;go&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;checkDone&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;WorkReduce&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ResTaskId&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Printf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Assign reduce \t%d to \t%d\n&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ResTaskId&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ResId&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#75715e&#34;&gt;// å¦‚æœåˆ†é…å®Œäº†æ‰€æœ‰çš„reduce,ä½†æ˜¯è¿˜æ²¡æœ‰done.workeréœ€è¦ç­‰å¾…
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ResOp&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;WorkNothing&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Reduce All assigned but not done&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;latch&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;L&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Unlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;WorkMapDone&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;latch&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;L&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Lock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;latch&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;L&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Unlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;runningMap&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;request&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ReqTaskId&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;request&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ReqId&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;||&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mapTaskStatus&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;request&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ReqTaskId&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;running&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#75715e&#34;&gt;// è¯´æ˜è¯¥mapå·²ç»è¢«abort
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;             &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ResOp&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;WorkTerminate&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Printf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Work Map \t%d done by \t%d\n&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;request&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ReqTaskId&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;request&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ReqId&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mapTaskStatus&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;request&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ReqTaskId&lt;/span&gt;] = &lt;span style=&#34;color:#a6e22e&#34;&gt;taskDone&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mapCnt&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;WorkReduceDone&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;latch&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;L&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Lock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;latch&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;L&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Unlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;runningReduce&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;request&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ReqTaskId&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;request&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ReqId&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;||&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;reduceTaskStatus&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;request&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ReqTaskId&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;running&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#75715e&#34;&gt;// è¯´æ˜è¯¥mapå·²ç»è¢«abort
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;             &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ResOp&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;WorkTerminate&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;reduceTaskStatus&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;request&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ReqTaskId&lt;/span&gt;] = &lt;span style=&#34;color:#a6e22e&#34;&gt;taskDone&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;reduceCnt&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Printf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Work Reduce \t%d done by \t%d\n&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;request&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ReqTaskId&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;request&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ReqId&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;reduceCnt&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;nReduce&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;taskDone&lt;/span&gt; = &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ResOp&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;WorkDone&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;default&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// start a thread that listens for RPCs from worker.go
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Coordinator&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;server&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Launching Server&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;e&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rpc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Register&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;e&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Fatal&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;register error:&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;e&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;rpc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;HandleHTTP&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;//l, e := net.Listen(&amp;#34;tcp&amp;#34;, &amp;#34;:1234&amp;#34;)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;sockname&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;coordinatorSock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;_&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;os&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Remove&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;sockname&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;l&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;e&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;net&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Listen&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;unix&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;sockname&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;go&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;l&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;net&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Listener&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Sleep&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Second&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Done&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;l&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Close&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Fatal&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;close error:&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }(&lt;span style=&#34;color:#a6e22e&#34;&gt;l&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;e&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Fatal&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;listen error:&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;e&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;go&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;http&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Serve&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;l&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Fatal&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;server error:&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Done main/mrcoordinator.go calls Done() periodically to find out
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// if the entire job has finished.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Coordinator&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;Done&lt;/span&gt;() &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;latch&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;L&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Lock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;latch&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;L&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Unlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// Your code here.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;taskDone&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// checkDone æ£€æŸ¥ä»»åŠ¡æ˜¯å¦å®Œæˆ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Coordinator&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;checkDone&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;workType&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;WorkType&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;t&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;TaskIdT&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Sleep&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;workMaxTime&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;latch&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;L&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Lock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;latch&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;L&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Unlock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;switch&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;workType&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;WorkMap&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mapTaskStatus&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;t&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;taskDone&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mapTaskStatus&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;t&lt;/span&gt;] = &lt;span style=&#34;color:#a6e22e&#34;&gt;notStart&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mapTasks&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;t&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;WorkReduce&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;reduceTaskStatus&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;t&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;taskDone&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#75715e&#34;&gt;// å¦‚æœæ²¡æœ‰å®Œæˆä»»åŠ¡
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;             &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;reduceTaskStatus&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;t&lt;/span&gt;] = &lt;span style=&#34;color:#a6e22e&#34;&gt;notStart&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;reduceTasks&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;t&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;default&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Panicf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Try Check Invalid WorkType %v\n&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;workType&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// MakeCoordinator create a Coordinator.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// main/mrcoordinator.go calls this function.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// nReduce is the number of reduce tasks to use.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;MakeCoordinator&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;files&lt;/span&gt; []&lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;nReduce&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Coordinator&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Launching Master Factory&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Coordinator&lt;/span&gt;{}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;nReduce&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;nReduce&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mMap&lt;/span&gt; = len(&lt;span style=&#34;color:#a6e22e&#34;&gt;files&lt;/span&gt;) &lt;span style=&#34;color:#75715e&#34;&gt;// æ¯ä¸ªfileå¯¹åº”ä¸€ä¸ªmap
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;taskDone&lt;/span&gt; = &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;files&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;files&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mapTasks&lt;/span&gt; = make(&lt;span style=&#34;color:#66d9ef&#34;&gt;chan&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;TaskIdT&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mMap&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mapTaskStatus&lt;/span&gt; = make([]&lt;span style=&#34;color:#a6e22e&#34;&gt;status&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mMap&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;runningMap&lt;/span&gt; = make([]&lt;span style=&#34;color:#a6e22e&#34;&gt;RpcIdT&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mMap&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;reduceTaskStatus&lt;/span&gt; = make([]&lt;span style=&#34;color:#a6e22e&#34;&gt;status&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;nReduce&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;reduceTasks&lt;/span&gt; = make(&lt;span style=&#34;color:#66d9ef&#34;&gt;chan&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;TaskIdT&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;nReduce&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;runningReduce&lt;/span&gt; = make([]&lt;span style=&#34;color:#a6e22e&#34;&gt;RpcIdT&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;nReduce&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;latch&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;sync&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;NewCond&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;sync&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Mutex&lt;/span&gt;{})
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &amp;lt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mMap&lt;/span&gt;; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mapTasks&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;TaskIdT&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;runningMap&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;] = &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;mapTaskStatus&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;] = &lt;span style=&#34;color:#a6e22e&#34;&gt;notStart&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &amp;lt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;nReduce&lt;/span&gt;; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;reduceTasks&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;TaskIdT&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;runningReduce&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;] = &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;reduceTaskStatus&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;] = &lt;span style=&#34;color:#a6e22e&#34;&gt;notStart&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;server&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;rpcgo&#34;&gt;rpc.go&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;package&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;mr&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;//
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// RPC definitions.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;//
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// remember to capitalize all names.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;//
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;os&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;strconv&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;//
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// example to show how to declare the arguments
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// and reply for an RPC.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;//
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ExampleArgs&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;X&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ExampleReply&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;Y&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;RpcIdT&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int64&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// RpcIdT æ˜¯é€šè¿‡æ—¶é—´æˆ³ç”Ÿæˆçš„, æŒ‡ç¤ºä¸€ä¸ªå”¯ä¸€çš„RpcId
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ReqArgs&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;ReqId&lt;/span&gt;     &lt;span style=&#34;color:#a6e22e&#34;&gt;RpcIdT&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;ReqOp&lt;/span&gt;     &lt;span style=&#34;color:#a6e22e&#34;&gt;WorkType&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;ReqTaskId&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;TaskIdT&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// ResArgs æ˜¯RPCçš„è¿”å›
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Response
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ResArgs&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;ResId&lt;/span&gt;      &lt;span style=&#34;color:#a6e22e&#34;&gt;RpcIdT&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;ResOp&lt;/span&gt;      &lt;span style=&#34;color:#a6e22e&#34;&gt;WorkType&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;ResTaskId&lt;/span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;TaskIdT&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// åˆ†é…çš„ä»»åŠ¡ç¼–å·
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;ResContent&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;ReduceNumN&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// æœ‰nä¸ªreduce
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;MapNumM&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// æœ‰Mä¸ªmapä»»åŠ¡
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;WorkType&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// TaskIdT æ˜¯å¯¹ä»»åŠ¡çš„ç¼–å·
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;TaskIdT&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// æšä¸¾å·¥ä½œç±»å‹
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; (
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;WorkNothing&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;WorkType&lt;/span&gt; = &lt;span style=&#34;color:#66d9ef&#34;&gt;iota&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;WorkReq&lt;/span&gt;                 &lt;span style=&#34;color:#75715e&#34;&gt;// workerç”³è¯·å·¥ä½œ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;WorkMap&lt;/span&gt;                 &lt;span style=&#34;color:#75715e&#34;&gt;// åˆ†é…workerè¿›è¡Œmapæ“ä½œ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;WorkReduce&lt;/span&gt;              &lt;span style=&#34;color:#75715e&#34;&gt;// åˆ†é…workerè¿›è¡Œreduceæ“ä½œ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;WorkDone&lt;/span&gt;                &lt;span style=&#34;color:#75715e&#34;&gt;// [[unused]]masteræ‰€æœ‰çš„å·¥ä½œå®Œæˆ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;WorkTerminate&lt;/span&gt;           &lt;span style=&#34;color:#75715e&#34;&gt;// å·¥ä½œä¸­æ­¢
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;WorkMapDone&lt;/span&gt;             &lt;span style=&#34;color:#75715e&#34;&gt;// Workerå®Œæˆäº†mapæ“ä½œ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;WorkReduceDone&lt;/span&gt;          &lt;span style=&#34;color:#75715e&#34;&gt;// Workerå®Œæˆäº†reduceæ“ä½œ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Rpc exports struct we need
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Rpc&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;Req&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ReqArgs&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;Res&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ResArgs&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Cook up a unique-ish UNIX-domain socket name
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// in /var/tmp, for the coordinator.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Can&amp;#39;t use the current directory since
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Athena AFS doesn&amp;#39;t support UNIX-domain sockets.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;coordinatorSock&lt;/span&gt;() &lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;s&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;/var/tmp/824-mr-&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;s&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;strconv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Itoa&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;os&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Getuid&lt;/span&gt;())
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;s&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;workergo&#34;&gt;worker.go&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;package&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;mr&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; (
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;encoding/json&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;io&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;os&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;sort&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;strconv&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;time&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;log&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;net/rpc&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;hash/fnv&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sleepTime&lt;/span&gt; = &lt;span style=&#34;color:#ae81ff&#34;&gt;500&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Millisecond&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// KeyValue
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Map functions return a slice of KeyValue
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;KeyValue&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;Key&lt;/span&gt;   &lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;Value&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ByKey&lt;/span&gt; []&lt;span style=&#34;color:#a6e22e&#34;&gt;KeyValue&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Len é€šè¿‡HashKeyè¿›è¡Œæ’åº
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;a&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ByKey&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;Len&lt;/span&gt;() &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;           { &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; len(&lt;span style=&#34;color:#a6e22e&#34;&gt;a&lt;/span&gt;) }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;a&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ByKey&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;Swap&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;j&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;)      { &lt;span style=&#34;color:#a6e22e&#34;&gt;a&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;], &lt;span style=&#34;color:#a6e22e&#34;&gt;a&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;j&lt;/span&gt;] = &lt;span style=&#34;color:#a6e22e&#34;&gt;a&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;j&lt;/span&gt;], &lt;span style=&#34;color:#a6e22e&#34;&gt;a&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;] }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;a&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ByKey&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;Less&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;j&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;) &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt; { &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ihash&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;a&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;].&lt;span style=&#34;color:#a6e22e&#34;&gt;Key&lt;/span&gt;) &amp;lt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ihash&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;a&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;j&lt;/span&gt;].&lt;span style=&#34;color:#a6e22e&#34;&gt;Key&lt;/span&gt;) }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// use ihash(key) % NReduce to choose the reduce
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// task number for each KeyValue emitted by Map.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ihash&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;) &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;h&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;fnv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;New32a&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;_&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;h&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Write&lt;/span&gt;([]byte(&lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; int(&lt;span style=&#34;color:#a6e22e&#34;&gt;h&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Sum32&lt;/span&gt;() &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x7fffffff&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Worker
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// main/mrworker.go calls this function.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Worker&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;mapf&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;) []&lt;span style=&#34;color:#a6e22e&#34;&gt;KeyValue&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;reducef&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;, []&lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;) &lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// Your worker implementation here.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;timeStamp&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Now&lt;/span&gt;().&lt;span style=&#34;color:#a6e22e&#34;&gt;Unix&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;rpcId&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;RpcIdT&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;timeStamp&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;req&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ReqArgs&lt;/span&gt;{}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;req&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ReqId&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;rpcId&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;req&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ReqOp&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;WorkReq&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// è¯·æ±‚ä¸€ä¸ªå·¥ä½œ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;res&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ResArgs&lt;/span&gt;{}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;ok&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;call&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Coordinator.Appoint&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;req&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;res&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; !&lt;span style=&#34;color:#a6e22e&#34;&gt;ok&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#75715e&#34;&gt;// å¦‚æœCallå‘ç”Ÿé”™è¯¯
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Maybe Coordinator Server has been closed&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;switch&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;res&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ResOp&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;WorkDone&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#75715e&#34;&gt;// æ‰€æœ‰å·¥ä½œå·²ç»å®Œæˆ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;WorkMap&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;doMap&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;rpcId&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;res&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;mapf&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;WorkReduce&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;doReduce&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;rpcId&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;res&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;reducef&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;WorkNothing&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#75715e&#34;&gt;// ç­‰å¾…
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Sleep&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;sleepTime&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;default&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;break&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;time&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Sleep&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;sleepTime&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;doMap&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;rpcId&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;RpcIdT&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;response&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ResArgs&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;mapf&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;) []&lt;span style=&#34;color:#a6e22e&#34;&gt;KeyValue&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// filename æ˜¯responseä¸­çš„æ–‡ä»¶å
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;filename&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;response&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ResContent&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;file&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;os&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Open&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;filename&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Fatalf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;cannot open %v&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;filename&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;file&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;os&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;File&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;_&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;file&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Close&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }(&lt;span style=&#34;color:#a6e22e&#34;&gt;file&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// contentè¯»å–è¯¥æ–‡ä»¶ä¸­çš„æ‰€æœ‰å†…å®¹
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;content&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;io&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ReadAll&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;file&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Fatalf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;cannot read %v&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;filename&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;kvs&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;mapf&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;filename&lt;/span&gt;, string(&lt;span style=&#34;color:#a6e22e&#34;&gt;content&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// éœ€è¦å°†kvè¾“å‡ºåˆ°nè·¯ ä¸­é—´æ–‡ä»¶ä¸­
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;ofiles&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; make([]&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;os&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;File&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;response&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ReduceNumN&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;encoders&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; make([]&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;json&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Encoder&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;response&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ReduceNumN&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &amp;lt; &lt;span style=&#34;color:#a6e22e&#34;&gt;response&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ReduceNumN&lt;/span&gt;; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#75715e&#34;&gt;// è¿™é‡Œè¾“å‡ºçš„åå­—æ˜¯mr-ResTaskId-reduceN
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;       &lt;span style=&#34;color:#75715e&#34;&gt;// å…¶ä¸­ï¼ŒResTaskIdæ˜¯0~mçš„æ•°å­—
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;oname&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;mr-&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;strconv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Itoa&lt;/span&gt;(int(&lt;span style=&#34;color:#a6e22e&#34;&gt;response&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ResTaskId&lt;/span&gt;)) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;strconv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Itoa&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;ofiles&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;], &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;os&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Create&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;oname&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Fatal&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Can&amp;#39;t Create Intermediate File: &amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;oname&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;file&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;os&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;File&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;oname&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;file&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Close&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Fatal&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Can&amp;#39;t Close Intermediate File&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;oname&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       }(&lt;span style=&#34;color:#a6e22e&#34;&gt;ofiles&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;], &lt;span style=&#34;color:#a6e22e&#34;&gt;oname&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;encoders&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;] = &lt;span style=&#34;color:#a6e22e&#34;&gt;json&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;NewEncoder&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;ofiles&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;])
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;_&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;range&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;kvs&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;ri&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ihash&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Key&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;%&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;response&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ReduceNumN&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;encoders&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;ri&lt;/span&gt;].&lt;span style=&#34;color:#a6e22e&#34;&gt;Encode&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Fatal&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Encode Error: &amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;req&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ReqArgs&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;ReqId&lt;/span&gt;:     &lt;span style=&#34;color:#a6e22e&#34;&gt;rpcId&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;ReqOp&lt;/span&gt;:     &lt;span style=&#34;color:#a6e22e&#34;&gt;WorkMapDone&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;ReqTaskId&lt;/span&gt;: &lt;span style=&#34;color:#a6e22e&#34;&gt;response&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ResTaskId&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;res&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ResArgs&lt;/span&gt;{}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;call&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Coordinator.Appoint&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;req&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;res&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;doReduce&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;rpcId&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;RpcIdT&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;response&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;ResArgs&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;reducef&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;, []&lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;) &lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;rid&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;response&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ResTaskId&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// å½“å‰reduceçš„ç¼–å·
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;kva&lt;/span&gt; []&lt;span style=&#34;color:#a6e22e&#34;&gt;KeyValue&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &amp;lt; &lt;span style=&#34;color:#a6e22e&#34;&gt;response&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;MapNumM&lt;/span&gt;; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#75715e&#34;&gt;// è¯»å–æ‰€æœ‰è¯¥ridçš„ä¸­é—´å€¼
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;mapId&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#75715e&#34;&gt;// è¯»å–m-ridçš„ä¸­é—´å€¼
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;inputName&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;mr-&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;strconv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Itoa&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;strconv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Itoa&lt;/span&gt;(int(&lt;span style=&#34;color:#a6e22e&#34;&gt;rid&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#75715e&#34;&gt;// åœ¨å½“å‰å¯¹åº”rçš„è¾“å‡ºä¸­ï¼Œè·å–æ‰€æœ‰key
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;ifile&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;os&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Open&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;inputName&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Fatal&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Can&amp;#39;t open file: &amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;inputName&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;file&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;os&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;File&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;file&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Close&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Fatal&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Can&amp;#39;t close file: &amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;inputName&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          }(&lt;span style=&#34;color:#a6e22e&#34;&gt;ifile&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;dec&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;json&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;NewDecoder&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;ifile&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;KeyValue&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;dec&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Decode&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;); &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#66d9ef&#34;&gt;break&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#a6e22e&#34;&gt;kva&lt;/span&gt; = append(&lt;span style=&#34;color:#a6e22e&#34;&gt;kva&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;kv&lt;/span&gt;) &lt;span style=&#34;color:#75715e&#34;&gt;//
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;          }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       }(&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// é€šè¿‡hashKeyæ’åº
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;sort&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Sort&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;ByKey&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;kva&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;intermediate&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;kva&lt;/span&gt;[:]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;oname&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;mr-out-&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;strconv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Itoa&lt;/span&gt;(int(&lt;span style=&#34;color:#a6e22e&#34;&gt;rid&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;ofile&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;os&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Create&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;oname&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Fatal&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Can&amp;#39;t create file: &amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;oname&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;ofile&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;os&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;File&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ofile&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Close&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Fatal&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Can&amp;#39;t close file: &amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;oname&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }(&lt;span style=&#34;color:#a6e22e&#34;&gt;ofile&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// log.Println(&amp;#34;Total kv len: &amp;#34;, len(intermediate))
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// cnt := 0
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &amp;lt; len(&lt;span style=&#34;color:#a6e22e&#34;&gt;intermediate&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;j&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;j&lt;/span&gt; &amp;lt; len(&lt;span style=&#34;color:#a6e22e&#34;&gt;intermediate&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;intermediate&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;j&lt;/span&gt;].&lt;span style=&#34;color:#a6e22e&#34;&gt;Key&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;intermediate&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;].&lt;span style=&#34;color:#a6e22e&#34;&gt;Key&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;j&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;values&lt;/span&gt; []&lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;k&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;; &lt;span style=&#34;color:#a6e22e&#34;&gt;k&lt;/span&gt; &amp;lt; &lt;span style=&#34;color:#a6e22e&#34;&gt;j&lt;/span&gt;; &lt;span style=&#34;color:#a6e22e&#34;&gt;k&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;values&lt;/span&gt; = append(&lt;span style=&#34;color:#a6e22e&#34;&gt;values&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;intermediate&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;k&lt;/span&gt;].&lt;span style=&#34;color:#a6e22e&#34;&gt;Value&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#75715e&#34;&gt;// cnt++
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;output&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;reducef&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;intermediate&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;].&lt;span style=&#34;color:#a6e22e&#34;&gt;Key&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;values&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#75715e&#34;&gt;// this is the correct format for each line of Reduce output.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;_&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;fprintf&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Fprintf&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;ofile&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;%v %v\n&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;intermediate&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt;].&lt;span style=&#34;color:#a6e22e&#34;&gt;Key&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;output&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;fprintf&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;i&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;j&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// log.Println(&amp;#34;Unique key count: &amp;#34;, cnt)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;req&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ReqArgs&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;ReqId&lt;/span&gt;:     &lt;span style=&#34;color:#a6e22e&#34;&gt;rpcId&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;ReqOp&lt;/span&gt;:     &lt;span style=&#34;color:#a6e22e&#34;&gt;WorkReduceDone&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;ReqTaskId&lt;/span&gt;: &lt;span style=&#34;color:#a6e22e&#34;&gt;response&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ResTaskId&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;res&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ResArgs&lt;/span&gt;{}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;call&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Coordinator.Appoint&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;req&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;res&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// CallExample
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// example function to show how to make an RPC call to the coordinator.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;//
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// the RPC argument and reply types are defined in rpc.go.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;CallExample&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// declare an argument structure.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ExampleArgs&lt;/span&gt;{}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// fill in the argument(s).
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;X&lt;/span&gt; = &lt;span style=&#34;color:#ae81ff&#34;&gt;99&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// declare a reply structure.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ExampleReply&lt;/span&gt;{}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// send the RPC request, wait for the reply.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;call&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Coordinator.Example&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// reply.Y should be 100.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Printf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;reply.Y %v\n&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Y&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// send an RPC request to the coordinator, wait for the response.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// usually returns true.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// returns false if something goes wrong.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;call&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;rpcName&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;interface&lt;/span&gt;{}, &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;interface&lt;/span&gt;{}) &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// c, err := rpc.DialHTTP(&amp;#34;tcp&amp;#34;, &amp;#34;127.0.0.1&amp;#34;+&amp;#34;:1234&amp;#34;)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;sockname&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;coordinatorSock&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;rpc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;DialHTTP&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;unix&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;sockname&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Fatal&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;dialing:&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;rpc&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Client&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Close&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Fatal&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Close Client Error When RPC Calling&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }(&lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Call&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;rpcName&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;args&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;reply&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
        </item>
        <item>
        <title>DB|å¯ä¸²è¡ŒåŒ–åŠ é”è§„åˆ™</title>
        <link>https://antio2.cn/tech/database/se/</link>
        <pubDate>Tue, 20 Jun 2023 21:54:53 +0800</pubDate>
        
        <guid>https://antio2.cn/tech/database/se/</guid>
        <description>&lt;h2 id=&#34;2plå°é”åè®®&#34;&gt;2PLå°é”åè®®&lt;/h2&gt;
&lt;p&gt;é”å‡çº§ï¼šä»å…±äº«é”å‡çº§ä¸ºæ’ä»–é”ã€‚å‘ç”Ÿåœ¨å…±äº«é˜¶æ®µã€‚&lt;/p&gt;
&lt;p&gt;é”é™çº§ï¼šä»æ’ä»–é”é™çº§ä¸ºå…±äº«é”ã€‚å‘ç”Ÿåœ¨ç¼©å‡é˜¶æ®µã€‚&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªäº‹åŠ¡é€šè¿‡lock-S(Q)è·å¾—Qä¸Šçš„å…±äº«é”ï¼Œé€šè¿‡lock-X(Q)è·å¾—Qä¸Šçš„æ’ä»–é”&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªç®€å•å¯ä¸²è¡ŒåŒ–çš„å®ç°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å½“è¦read(Q)æ—¶ï¼Œäº§ç”Ÿlock-S(Q)æŒ‡ä»¤ã€‚&lt;/li&gt;
&lt;li&gt;å½“è¦write(Q)æ—¶,æ£€æŸ¥æ˜¯å¦æœ‰Sé”ï¼Œå¦‚æœæœ‰ï¼Œè¿›è¡Œupgradeæ“ä½œã€‚åˆ é™¤è¯¥é”ï¼Œç„¶ååŠ åˆ°é˜Ÿåˆ—ç­‰å¾…å¤´éƒ¨ã€‚å¦åˆ™è¿›è¡Œlock-X(Q)&lt;/li&gt;
&lt;li&gt;äº‹åŠ¡æäº¤æˆ–ä¸­æ­¢åï¼Œé‡Šæ”¾æ‰€æœ‰é”ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;no-waitç­–ç•¥&#34;&gt;No-waitç­–ç•¥&lt;/h2&gt;
&lt;p&gt;å½“æœ‰ä¸€ä¸ªæ–°çš„åŠ é”è¯·æ±‚æ—¶ï¼Œå¦‚æœä¸å…¼å®¹ï¼Œé‚£ä¹ˆç›´æ¥abortè¯¥äº‹åŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚ï¼šäº‹åŠ¡T1å·²ç»åœ¨Iè¡¨ä¸Šæœ‰äº†Sé”ã€‚æ­¤æ—¶äº‹åŠ¡T2ç”³è¯·Sé”ï¼Œå¯ä»¥ç›´æ¥æˆäºˆã€‚è‹¥ç”³è¯·Xé”ï¼Œç›´æ¥abortã€‚&lt;/p&gt;
&lt;h2 id=&#34;å…·ä½“å®ç°&#34;&gt;å…·ä½“å®ç°&lt;/h2&gt;
&lt;h3 id=&#34;åŠ é”&#34;&gt;åŠ é”&lt;/h3&gt;
&lt;p&gt;å¯¹äºå¯ä¸²è¡ŒåŒ–äº‹åŠ¡ï¼Œé¦–å…ˆéœ€è¦åˆ¤æ–­æ˜¯å¦åœ¨æ”¶ç¼©é˜¶æ®µåŠ é”&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;get_state()&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;TransactionState&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;SHRINKING) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;set_state(TransactionState&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;ABORTED);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;// å¦‚æœåœ¨æ”¶ç¼©é˜¶æ®µåŠ é”ï¼ŒæŠ›å‡ºå¼‚å¸¸
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;throw&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;TransactionAbortException&lt;/span&gt;(txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;get_transaction_id(),AbortReason&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;LOCK_ON_SHRINKING);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶ååœ¨lock_managerä¸­å¯»æ‰¾åˆ°éœ€è¦åŠ é”é¡¹çš„lock request queueï¼Œéå†è¯¥è¯·æ±‚é˜Ÿåˆ—ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæœ‰å…¶ä»–äº‹åŠ¡æ‹¿åˆ°äº†è¯¥é”ï¼Œå¹¶ä¸”é”ä¸å…¼å®¹ï¼Œç›´æ¥abortæ‰è¯¥äº‹åŠ¡&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(request&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;txn_id_ &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; txn_id &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;!&lt;/span&gt;CheckCompatible(request&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;lock_mode_,lock_mode)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;// é‡‡ç”¨no-waitç­–ç•¥
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;set_state(TransactionState&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;ABORTED);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  lock_request_queue&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;latch_.unlock();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;throw&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;TransactionAbortException&lt;/span&gt;(txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;get_transaction_id(),AbortReason&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;DEADLOCK_PREVENTION);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æœè¯¥äº‹åŠ¡ï¼ˆé€šè¿‡txn_idç›¸åŒåˆ¤æ–­ï¼‰å·²ç»æœ‰äº†è¢«æˆäºˆçš„é”ï¼Œåˆ¤æ–­æ˜¯å¦æ˜¯åŒç§ç±»å‹çš„é”ï¼Œå¦‚æœä¸æ˜¯ï¼Œåšå‡ºå‡çº§è¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœè¯·æ±‚é˜Ÿåˆ—æ²¡æœ‰è¯¥äº‹åŠ¡ï¼Œåˆ™æ–°å¢ä¸€ä¸ªè¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥å°±æ˜¯åˆ¤æ–­åœ¨ä»€ä¹ˆæ—¶å€™åŠ é”ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºä¸€ä¸ªåŠ é”å¯¹è±¡çš„è¯·æ±‚é˜Ÿåˆ—æ¥è¯´ï¼Œæ¯”å¦‚å·²ç»æœ‰äº†äº”é¡¹å·²ç»æˆäºˆé”çš„è¯·æ±‚ï¼Œç¬¬å…­é¡¹è¦è¢«æˆäºˆé”ï¼Œå¿…é¡»å’Œå‰äº”é¡¹æ˜¯å…¼å®¹çš„ã€‚&lt;/p&gt;
&lt;p&gt;å†™ä¸€ä¸ªä¼ªä»£ç å¦‚ä¸‹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt;(request in queue)&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(request is granted) &lt;span style=&#34;color:#75715e&#34;&gt;// ä¹‹å‰è¢«æˆäºˆäº†é”çš„è¯·æ±‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;		check &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;å…¼å®¹æ€§çŸ©é˜µ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;//é‡åˆ°äº†ç¬¬ä¸€ä¸ªæ­£åœ¨ç­‰å¾…åŠ é”çš„è¯·æ±‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    	&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; request.txn&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;txn_now &lt;span style=&#34;color:#75715e&#34;&gt;// å¦‚æœåœ¨é˜Ÿåˆ—ä¸­ç¬¬ä¸€ä¸ªç­‰å¾…åŠ é”çš„æ˜¯å½“å‰äº‹åŠ¡ï¼Œæ‰èƒ½å¤ŸåŠ é”
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;è§£é”&#34;&gt;è§£é”&lt;/h3&gt;
&lt;p&gt;è§£é”æ“ä½œè¾ƒä¸ºç®€å•ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆè¦é€šè¿‡è§£é”å¯¹è±¡ï¼Œæ‰¾åˆ°é”è¡¨ä¸­å¯¹åº”çš„é˜Ÿåˆ—ã€‚ç„¶ååœ¨é˜Ÿåˆ—ä¸­ï¼Œå¯»æ‰¾åˆ°è¯¥äº‹åŠ¡çš„è¯·æ±‚ï¼Œå¦‚æœæ˜¯å¯ä¸²è¡ŒåŒ–ï¼Œè¿˜éœ€è¦å°†äº‹åŠ¡ä»growingå˜ä¸ºshrinkingçŠ¶æ€ã€‚&lt;/p&gt;
&lt;p&gt;æœ€åï¼Œä»é˜Ÿåˆ—ä¸­ç§»é™¤è¯¥è¯·æ±‚ã€‚å¹¶ä¸”ä»äº‹åŠ¡å¯¹è±¡ä¸­ç§»é™¤è¯¥é”ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœé˜Ÿåˆ—ä¸­æ²¡æœ‰æ‰¾åˆ°è¯¥è¯·æ±‚ï¼ŒæŠ›å‡ºå¼‚å¸¸ã€‚&lt;/p&gt;
</description>
        </item>
        <item>
        <title>CMU15-445|Project4|å¹¶å‘æ§åˆ¶</title>
        <link>https://antio2.cn/tech/database/lab4/</link>
        <pubDate>Thu, 01 Jun 2023 21:51:34 +0800</pubDate>
        
        <guid>https://antio2.cn/tech/database/lab4/</guid>
        <description>&lt;img src="https://antio2.cn/tech/database/lab4/blogimage-20230710185804351.png" alt="Featured image of post CMU15-445|Project4|å¹¶å‘æ§åˆ¶" /&gt;&lt;h2 id=&#34;task1-lock-manager&#34;&gt;Task1 Lock Manager&lt;/h2&gt;
&lt;h3 id=&#34;é˜…è¯»ä»£ç transcation&#34;&gt;ğŸ“±é˜…è¯»ä»£ç ï¼šTranscation&lt;/h3&gt;
&lt;p&gt;é¦–å…ˆé˜…è¯»&lt;code&gt;src/include/concurrency/transaction.h&lt;/code&gt; æä¾›çš„API&lt;/p&gt;
&lt;p&gt;é¦–å…ˆå®šä¹‰äº†2PLäº‹åŠ¡çš„å››ä¸ªçŠ¶æ€ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c++&#34; data-lang=&#34;c++&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;enum&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;TransactionState&lt;/span&gt; { GROWING, SHRINKING, COMMITTED, ABORTED };
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;éœ€è¦å®ç°ä¸‰ä¸ªéš”ç¦»çº§åˆ«:è¯»æœªæäº¤(è„è¯»é—®é¢˜)ã€è¯»æäº¤ï¼ˆä¸å¯é‡å¤è¯»é—®é¢˜,[è™½ç„¶è¯»å·²æäº¤ï¼Œä½†æ˜¯åœ¨åŒä¸€äº‹åŠ¡ä¸­å¤šæ¬¡è¯»å¯èƒ½å‡ºç°ä¸åŒç»“æœ]ï¼‰ã€å¯é‡å¤è¯»ï¼ˆå­˜åœ¨å¹»è¯»é—®é¢˜ï¼Œå¢åŠ äº†è®°å½•ï¼‰&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c++&#34; data-lang=&#34;c++&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;enum&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;IsolationLevel&lt;/span&gt; { READ_UNCOMMITTED, REPEATABLE_READ, READ_COMMITTED };
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸‰ç§å†™æ“ä½œï¼šæ’å…¥ï¼Œä¿®æ”¹ï¼Œåˆ é™¤&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c++&#34; data-lang=&#34;c++&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;enum&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;WType&lt;/span&gt; { INSERT &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, DELETE, UPDATE };
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;äº‹åŠ¡ç»ˆæ­¢åŸå› ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨æ”¶ç¼©é˜¶æ®µåŠ é”ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨æ”¶ç¼©é˜¶æ®µè§£é”æ—¶å‡ºé”™&lt;/li&gt;
&lt;li&gt;æ›´æ–°é”å†²çªï¼Œï¼ˆå¦ä¸€ä¸ªäº‹åŠ¡å·²ç»åœ¨ç­‰å¾…å‡çº§è¿™ä¸ªé”ï¼‰&lt;/li&gt;
&lt;li&gt;æ­»é”&lt;/li&gt;
&lt;li&gt;åœ¨è¯»æœªæäº¤ä¸ŠåŠ å…±äº«é”&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;enum&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;AbortReason&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  LOCK_ON_SHRINKING,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  UNLOCK_ON_SHRINKING,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  UPGRADE_CONFLICT,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  DEADLOCK,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  LOCKSHARED_ON_READ_UNCOMMITTED
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;};
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;ç±»ï¼šTableWriteRecord&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è®°å½•åœ¨è¡¨ä¸Šçš„æ“ä½œï¼ˆç”¨äºä¹‹åundoï¼‰&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç±»ï¼šIndexWriteRecord&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è®°å½•åœ¨ç´¢å¼•é¡¹ä¸Šçš„æ“ä½œ&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç±»ï¼šTransaction&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/** The current transaction state. */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;TransactionState state_{TransactionState&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;GROWING}; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;äº‹åŠ¡çŠ¶æ€&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/** The isolation level of the transaction. */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;IsolationLevel isolation_level_; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;äº‹åŠ¡çš„éš”ç¦»çº§åˆ«&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/** The thread ID, used in single-threaded transactions. */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;thread&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;id thread_id_; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;äº‹ç‰©çš„çº¿ç¨‹å·&lt;/span&gt;	
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/** The ID of this transaction. */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;txn_id_t txn_id_; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;äº‹åŠ¡ç¼–å·&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/** The undo set of table tuples. */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;shared_ptr&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;deque&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;TableWriteRecord&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt; table_write_set_; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;è®°å½•åœ¨è¡¨ä¸Šçš„æ“ä½œ&lt;/span&gt;,TableWriteRecord
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/** The undo set of indexes. */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;shared_ptr&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;deque&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;IndexWriteRecord&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt; index_write_set_; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;è®°å½•åœ¨ç´¢å¼•ä¸Šçš„æ“ä½œ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/** The LSN of the last record written by the transaction. */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;lsn_t prev_lsn_;  &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;æœ€åä¸€ä¸ª&lt;/span&gt;recordçš„lsn&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;ï¼ˆç”¨äºæ„å»ºä¸€ä¸ªå‘å‰é“¾è¡¨ï¼Œåœ¨&lt;/span&gt;undoæ—¶å¿«é€Ÿæ‰¾åˆ°ä¸Šä¸€æ¡è®°å½•&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;ï¼‰&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/** Concurrent index: the pages that were latched during index operation. */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;shared_ptr&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;deque&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;Page &lt;span style=&#34;color:#f92672&#34;&gt;*&amp;gt;&amp;gt;&lt;/span&gt; page_set_; &lt;span style=&#34;color:#75715e&#34;&gt;// ç”¨äºç´¢å¼•æ“ä½œæ—¶ï¼Œè®°å½•ä¸Šé”çš„é¡µï¼ˆB+æ ‘é‡Œé¢ç”¨åˆ°çš„ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/** Concurrent index: the page IDs that were deleted during index operation.*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;shared_ptr&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;unordered_set&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;page_id_t&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt; deleted_page_set_; &lt;span style=&#34;color:#75715e&#34;&gt;// ç”¨äºè®°å½•ç´¢å¼•æ“ä½œæ—¶ï¼Œåˆ é™¤çš„é¡µ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/** LockManager: the set of shared-locked tuples held by this transaction. */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;shared_ptr&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;unordered_set&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;RID&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt; shared_lock_set_; &lt;span style=&#34;color:#75715e&#34;&gt;// ç”¨äºè®°å½•è¢«å…±äº«é”ä¿æŠ¤çš„tuple
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;/** LockManager: the set of exclusive-locked tuples held by this transaction. */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;shared_ptr&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;unordered_set&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;RID&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt; exclusive_lock_set_; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;è¯¥äº‹åŠ¡ä¸­è¢«æ’ä»–é”ä¿æŠ¤çš„&lt;/span&gt;tuple
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;é˜…è¯»ä»£ç transactionmanager&#34;&gt;ğŸƒé˜…è¯»ä»£ç ï¼šTransactionManager&lt;/h3&gt;
&lt;p&gt;TransactionManagerä¸­ï¼Œæœ‰é”ç®¡ç†å™¨å’Œlog managerã€‚&lt;/p&gt;
&lt;p&gt;Transactionæä¾›äº†ä»¥ä¸‹çš„API:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;begin&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; TransactionManager&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;Begin(Transaction &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;txn, IsolationLevel isolation_level) &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt; Transaction &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;// Acquire the global transaction latch in shared mode.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  global_txn_latch_.RLock();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (txn &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nullptr&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    txn &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; Transaction(next_txn_id_&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt;, isolation_level);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (enable_logging) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    LogRecord record &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; LogRecord(txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetTransactionId(), txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetPrevLSN(), LogRecordType&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;BEGIN);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    lsn_t lsn &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; log_manager_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;AppendLogRecord(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;record);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;SetPrevLSN(lsn);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;unique_lock&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;shared_mutex&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; l(txn_map_mutex);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  txn_map[txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetTransactionId()] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; txn;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; txn;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¼€å§‹ä¸€ä¸ªäº‹åŠ¡ã€‚å¦‚æœtxnä¸ºnullptråˆ™æ–°å»ºä¸€ä¸ªäº‹åŠ¡ï¼ˆå¦åˆ™è¿™ä¸ªäº‹åŠ¡æ˜¯å·²ç»è¢«ç”Ÿæˆå¥½çš„ï¼‰ã€‚ç„¶åè®°å½•è¯¥äº‹åŠ¡id-&amp;gt;äº‹åŠ¡çš„æ˜ å°„ã€‚&lt;/p&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;&lt;strong&gt;Commit&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; TransactionManager&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;Commit(Transaction &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;txn) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;SetState(TransactionState&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;COMMITTED);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;// Perform all deletes before we commit.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; write_set &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetWriteSet();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt; (&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;write_set&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;empty()) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;item &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; write_set&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;back();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; table &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; item.table_;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (item.wtype_ &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; WType&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;DELETE) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#75715e&#34;&gt;// Note that this also releases the lock when holding the page latch.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;      table&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;ApplyDelete(item.rid_, txn);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    write_set&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;pop_back();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  write_set&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;clear();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;// Release all the locks.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  ReleaseLocks(txn);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;// Release the global transaction latch.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  global_txn_latch_.RUnlock();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨æäº¤é˜¶æ®µï¼Œå®Œæˆæ‰€æœ‰çš„åˆ é™¤æ“ä½œï¼Œç„¶åæ¶‰åŠRIDçš„é‡Šæ”¾é”&lt;/p&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;&lt;strong&gt;Abort&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; TransactionManager&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;Abort(Transaction &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;txn) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;SetState(TransactionState&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;ABORTED);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;// Rollback before releasing the lock.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; table_write_set &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetWriteSet();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt; (&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;table_write_set&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;empty()) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;item &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; table_write_set&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;back();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; table &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; item.table_;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (item.wtype_ &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; WType&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;DELETE) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      table&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;RollbackDelete(item.rid_, txn);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    } &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;if&lt;/span&gt; (item.wtype_ &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; WType&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;INSERT) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#75715e&#34;&gt;// Note that this also releases the lock when holding the page latch.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;      table&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;ApplyDelete(item.rid_, txn);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    } &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;if&lt;/span&gt; (item.wtype_ &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; WType&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;UPDATE) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      table&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;UpdateTuple(item.tuple_, item.rid_, txn);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    table_write_set&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;pop_back();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  table_write_set&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;clear();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;// Rollback index updates
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; index_write_set &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetIndexWriteSet();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt; (&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;index_write_set&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;empty()) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;item &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; index_write_set&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;back();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; catalog &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; item.catalog_;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// Metadata identifying the table that should be deleted from.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    TableInfo &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;table_info &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; catalog&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetTable(item.table_oid_);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    IndexInfo &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;index_info &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; catalog&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetIndex(item.index_oid_);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; new_key &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; item.tuple_.KeyFromTuple(table_info&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;schema_, &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;(index_info&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;index_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetKeySchema()),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                            index_info&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;index_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetKeyAttrs());
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (item.wtype_ &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; WType&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;DELETE) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      index_info&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;index_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;InsertEntry(new_key, item.rid_, txn);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    } &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;if&lt;/span&gt; (item.wtype_ &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; WType&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;INSERT) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      index_info&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;index_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;DeleteEntry(new_key, item.rid_, txn);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    } &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;if&lt;/span&gt; (item.wtype_ &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; WType&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;UPDATE) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#75715e&#34;&gt;// Delete the new key and insert the old key
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;      index_info&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;index_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;DeleteEntry(new_key, item.rid_, txn);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; old_key &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; item.old_tuple_.KeyFromTuple(table_info&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;schema_, &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;(index_info&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;index_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetKeySchema()),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                                  index_info&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;index_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetKeyAttrs());
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      index_info&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;index_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;InsertEntry(old_key, item.rid_, txn);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    index_write_set&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;pop_back();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  table_write_set&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;clear();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  index_write_set&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;clear();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;// Release all the locks.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  ReleaseLocks(txn);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;// Release the global transaction latch.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  global_txn_latch_.RUnlock();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¥é˜…è¯»äº‹åŠ¡ä¸­æ­¢çš„ä»£ç &lt;/p&gt;
&lt;p&gt;é¦–å…ˆæ£€æŸ¥table_write_set(å¯¹tupleçš„ä¿®æ”¹)&lt;/p&gt;
&lt;p&gt;ç„¶åä»åå¾€å‰ï¼Œè¿›è¡ŒUndoæ“ä½œ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœæ˜¯åˆ é™¤ï¼šRollbackDelete (è¿™é‡Œæ˜¯ä¿®æ”¹åˆ é™¤bit)&lt;/li&gt;
&lt;li&gt;å›æ»šæ’å…¥æ“ä½œï¼š è¿›è¡Œåˆ é™¤&lt;/li&gt;
&lt;li&gt;å›æ»šæ›´æ–°æ“ä½œã€‚è°ƒç”¨UpdateTupleï¼Œæ›´æ–°ä¸ºæ—§å€¼&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç„¶åå¯¹ç´¢å¼•è¿›è¡Œå›æ»šæ“ä½œã€‚ç´¢å¼•çš„å›æ»šè¿˜æ˜¯å’Œä¹‹å‰ç±»ä¼¼ï¼Œçœ‹ä»£ç å°±è¡Œï¼Œä¸å†èµ˜è¿°äº†ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ¦‚å¿µæ„å‘é”&#34;&gt;ğŸ”æ¦‚å¿µï¼šæ„å‘é”&lt;/h3&gt;
&lt;p&gt;æ³¨æ„ï¼Œè¿™é‡Œæ˜¯å¯¹è¡¨åŠ é”&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/database/lab4/blogimage-20230710185804351.png&#34;
	width=&#34;921&#34;
	height=&#34;620&#34;
	srcset=&#34;https://antio2.cn/tech/database/lab4/blogimage-20230710185804351_hu836a9554cfdf2104885dc55850f5a47f_145281_480x0_resize_box_3.png 480w, https://antio2.cn/tech/database/lab4/blogimage-20230710185804351_hu836a9554cfdf2104885dc55850f5a47f_145281_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20230710185804351&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;148&#34;
		data-flex-basis=&#34;356px&#34;
	
&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ä¸ºäº†è·å¾—Sæˆ–ISï¼ˆæ„å‘è¯»é”ï¼‰ï¼Œè‡³å°‘åœ¨çˆ¶ç»“ç‚¹æœ‰ISé”ã€‚ISå°±æ˜¯è¯´ï¼Œæˆ‘ä¸‹é¢å¯èƒ½è¦è¯»äº†ï¼ã€‚ISåªå’ŒXé”å†²çªï¼Œå› ä¸ºXè¡¨ç¤ºå…¨éƒ½è¦å†™ï¼Œè‚¯å®šä¼šå’Œè‡³å°‘ä¸€ä¸ªè¯»æ“ä½œå†²çªã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸ºäº†è·å¾—X,IX,SIXã€‚è‡³å°‘åœ¨çˆ¶ç»“ç‚¹æœ‰IXé”ã€‚IXæŒ‡ç¤ºï¼Œä¸‹é¢æˆ‘è‡³å°‘æœ‰ä¸€ä¸ªrecordè¦å†™ï¼ã€‚æ‰€ä»¥ï¼Œä¼šå’ŒSé”ï¼ˆè¯»å–æ•´å¼ è¡¨ï¼‰å†²çªã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.zhihu.com/question/437451897&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ä»€ä¹ˆæ˜¯å…±äº«æ„å‘æ’å®ƒé”ï¼Ÿå®ƒä¸IS IX S Xä¹‹é—´çš„ç›¸å®¹çŸ©é˜µæ˜¯æ€æ ·çš„ï¼Ÿ - çŸ¥ä¹ (zhihu.com)&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹è¡ŒåŠ é”å‰ï¼Œè¦å…ˆå¯¹è¡¨åŠ é”ã€‚&lt;/p&gt;
&lt;p&gt;æ„å‘é”å‡çº§[ä»…èƒ½åœ¨growingé˜¶æ®µ]&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;IS : S,X,IX,SIX&lt;/li&gt;
&lt;li&gt;S: X,SIX&lt;/li&gt;
&lt;li&gt;IX: X,SIX&lt;/li&gt;
&lt;li&gt;SIX: X&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;lockmanagerä»£ç å®ç°&#34;&gt;LockManagerä»£ç å®ç°&lt;/h3&gt;
&lt;h4 id=&#34;locktable&#34;&gt;LockTable&lt;/h4&gt;
&lt;p&gt;æˆ‘è¿™é‡Œåˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œæ£€æŸ¥åŠ é”æ˜¯å¦åˆæ³•ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c++&#34; data-lang=&#34;c++&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;enum&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;LockObject&lt;/span&gt;{ TABLE, ROW }; &lt;span style=&#34;color:#75715e&#34;&gt;//è¡¨ç¤ºåœ¨è¡¨è¿˜æ˜¯ROWä¸ŠåŠ é”
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; LockManager&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;CheckLock(Transaction &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;txn,  LockMode lock_mode, LockManager&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;LockObject lock_object) &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é¦–å…ˆé˜…è¯»ä»£ç ä¸­çš„&lt;strong&gt;NOTE&lt;/strong&gt;, äº†è§£ä¸åŒéš”ç¦»çº§åˆ«ä¸‹çš„åŠ é”è§„åˆ™ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;SUPPORTED LOCK MODES:&lt;/li&gt;
&lt;li&gt;Table locking should support all lock modes.&lt;/li&gt;
&lt;li&gt;Row locking should not support Intention locks. Attempting this should set the TransactionState as&lt;/li&gt;
&lt;li&gt;ABORTED and throw a TransactionAbortException (ATTEMPTED_INTENTION_LOCK_ON_ROW)&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c++&#34; data-lang=&#34;c++&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(lock_object&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;LockObject&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;ROW) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(lock_mode &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; LockMode&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;INTENTION_SHARED&lt;span style=&#34;color:#f92672&#34;&gt;||&lt;/span&gt; lock_mode &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; LockMode&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;INTENTION_EXCLUSIVE &lt;span style=&#34;color:#f92672&#34;&gt;||&lt;/span&gt;  lock_mode &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; LockMode&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;SHARED_INTENTION_EXCLUSIVE) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;SetState(TransactionState&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;ABORTED);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;throw&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;TransactionAbortException&lt;/span&gt;(txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetTransactionId(),AbortReason&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;ATTEMPTED_INTENTION_LOCK_ON_ROW);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;For instance S/IS/SIX locks are not required under READ_UNCOMMITTED, and any such attempt should set the&lt;/p&gt;
&lt;p&gt;TransactionState as ABORTED and throw a TransactionAbortException (LOCK_SHARED_ON_READ_UNCOMMITTED).&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ç›´æ¥æŒ‰ç…§æè¿°å®ç°äº‹åŠ¡ä¸­æ­¢æ¡ä»¶å³å¯&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetIsolationLevel()&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;IsolationLevel&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;READ_UNCOMMITTED) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(lock_mode &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; LockMode&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;SHARED &lt;span style=&#34;color:#f92672&#34;&gt;||&lt;/span&gt; lock_mode &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; LockMode&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;INTENTION_SHARED &lt;span style=&#34;color:#f92672&#34;&gt;||&lt;/span&gt;  lock_mode &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; LockMode&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;SHARED_INTENTION_EXCLUSIVE) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;SetState(TransactionState&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;ABORTED);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;throw&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;TransactionAbortException&lt;/span&gt;(txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetTransactionId(),AbortReason&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;LOCK_SHARED_ON_READ_UNCOMMITTED);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;Similarly, X/IX locks on rows are not allowed if the the Transaction State is SHRINKING, and any such attempt&lt;/li&gt;
&lt;li&gt;should set the TransactionState as ABORTED and throw a TransactionAbortException (LOCK_ON_SHRINKING).&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c++&#34; data-lang=&#34;c++&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetState()&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;TransactionState&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;SHRINKING) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(lock_mode&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;LockMode&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;EXCLUSIVE&lt;span style=&#34;color:#f92672&#34;&gt;||&lt;/span&gt;lock_mode &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; LockMode&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;INTENTION_EXCLUSIVE) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;SetState(TransactionState&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;ABORTED);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;throw&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;TransactionAbortException&lt;/span&gt;(txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetTransactionId(),AbortReason&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;LOCK_ON_SHRINKING);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;REPEATABLE_READ:
&lt;ul&gt;
&lt;li&gt;The transaction is required to take all locks.&lt;/li&gt;
&lt;li&gt;All locks are allowed in the GROWING state&lt;/li&gt;
&lt;li&gt;No locks are allowed in the SHRINKING state&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetIsolationLevel()&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;IsolationLevel&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;REPEATABLE_READ) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetState()&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;TransactionState&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;SHRINKING) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;SetState(TransactionState&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;ABORTED);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;throw&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;TransactionAbortException&lt;/span&gt;(txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetTransactionId(),AbortReason&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;LOCK_ON_SHRINKING);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; true;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;READ_COMMITTED:
&lt;ul&gt;
&lt;li&gt;The transaction is required to take all locks.&lt;/li&gt;
&lt;li&gt;All locks are allowed in the GROWING state&lt;/li&gt;
&lt;li&gt;Only IS, S locks are allowed in the SHRINKING state&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetIsolationLevel()&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;IsolationLevel&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;READ_COMMITTED) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetState()&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;TransactionState&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;SHRINKING) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(lock_mode&lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt;LockMode&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;INTENTION_SHARED&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt;lock_mode&lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt;LockMode&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;SHARED) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;SetState(TransactionState&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;ABORTED);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;throw&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;TransactionAbortException&lt;/span&gt;(txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetTransactionId(),AbortReason&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;LOCK_ON_SHRINKING);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; true;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;READ_UNCOMMITTED:
&lt;ul&gt;
&lt;li&gt;The transaction is required to take only IX, X locks.&lt;/li&gt;
&lt;li&gt;X, IX locks are allowed in the GROWING state.&lt;/li&gt;
&lt;li&gt;S, IS, SIX locks are never allowed&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;å’Œä¸Šé¢å·®ä¸å¤šï¼Œæ·»åŠ åˆ¤æ–­æ˜¯å¦åœ¨æ”¶ç¼©é˜¶æ®µåŠ é”å°±å¥½&lt;/p&gt;
&lt;p&gt;å®Œæˆæ£€æŸ¥å‡½æ•°åï¼Œåœ¨LockTableç¬¬ä¸€è¡Œæ·»åŠ &lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  CheckLock(txn,lock_mode,LockObject&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;TABLE);	
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æœå‡ºé”™ç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œç„¶åäº‹åŠ¡ä¸­æ­¢ã€‚&lt;/p&gt;
&lt;p&gt;æ£€æŸ¥å®Œéš”ç¦»ç­‰çº§åï¼Œæ£€æŸ¥è¯¥è¡¨æ˜¯å¦æœ‰è¯·æ±‚é˜Ÿåˆ—&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;  table_lock_map_latch_.lock();
  auto lock_request_queue_it =  table_lock_map_.find(oid);
  table_lock_map_latch_.unlock();
  if(lock_request_queue_it==table_lock_map_.end()) {
    table_lock_map_latch_.lock();
    table_lock_map_.emplace(oid,new LockRequestQueue());
    lock_request_queue_it = table_lock_map_.find(oid);
    table_lock_map_latch_.unlock();
  } else {

  }
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å¦‚æœè¯¥è¡¨æ²¡æœ‰è¯·æ±‚é˜Ÿåˆ—ï¼Œå°±é€ ä¸€ä¸ªã€‚&lt;/p&gt;
&lt;p&gt;ç„¶åéå†è¯·æ±‚é˜Ÿåˆ—ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœå·²å­˜åœ¨è¯¥äº‹åŠ¡&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å·²ç»è·å¾—å¯¹åº”é”ï¼šè¿”å›true&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æœªè·å¾—é”ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å·²ç»æœ‰å…¶ä»–äº‹åŠ¡åœ¨ç­‰å¾…å‡çº§ï¼šä¸­æ­¢äº‹åŠ¡&lt;/li&gt;
&lt;li&gt;æ£€æŸ¥&lt;strong&gt;æ˜¯å¦å¯ä»¥å‡çº§&lt;/strong&gt;ï¼ˆå‚è€ƒNoteï¼‰[æ£€æŸ¥è¿™é‡Œæ˜¯å¦åªæœ‰å¢é•¿é˜¶æ®µèƒ½å‡çº§é”]&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;While upgrading, only the following transitions should be allowed:
&lt;ul&gt;
&lt;li&gt;IS -&amp;gt; [S, X, IX, SIX]&lt;/li&gt;
&lt;li&gt;S -&amp;gt; [X, SIX]&lt;/li&gt;
&lt;li&gt;IX -&amp;gt; [X, SIX]&lt;/li&gt;
&lt;li&gt;SIX -&amp;gt; [X]&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;åˆ é™¤åŸæœ‰çš„é”æˆæƒã€‚è¿™é‡Œéœ€è¦ä¿®æ”¹äº‹åŠ¡ä¸­çš„å„ç§set.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åˆ›å»ºå‡çº§äº‹åŠ¡è¯·æ±‚ï¼Œå¹¶åŠ åˆ°é˜Ÿé¦–&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœæœªå­˜åœ¨è¯¥äº‹åŠ¡ï¼Œåˆ™å°†è¯¥è¯·æ±‚åŠ åˆ°ç­‰å¾…åˆ—è¡¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™é‡Œéœ€è¦é€šè¿‡&lt;strong&gt;å…¼å®¹çŸ©é˜µ&lt;/strong&gt;åˆ¤æ–­ï¼Œèƒ½å¦æˆäºˆè¯¥è¯·æ±‚é”ã€‚æˆ‘ä»¬éœ€è¦åˆ¤æ–­èƒ½å¦åŠ é”&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/database/lab4/blogimage-20230710185804351.png&#34;
	width=&#34;921&#34;
	height=&#34;620&#34;
	srcset=&#34;https://antio2.cn/tech/database/lab4/blogimage-20230710185804351_hu836a9554cfdf2104885dc55850f5a47f_145281_480x0_resize_box_3.png 480w, https://antio2.cn/tech/database/lab4/blogimage-20230710185804351_hu836a9554cfdf2104885dc55850f5a47f_145281_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20230710185804351&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;148&#34;
		data-flex-basis=&#34;356px&#34;
	
&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; LockManager&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;CheckGrant(&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;shared_ptr&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;LockRequest&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&amp;amp;&lt;/span&gt; checked_request, std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;shared_ptr&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;LockRequestQueue&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; request_queue) &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; lock_mode &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; checked_request&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;lock_mode_;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;request: request_queue&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;request_queue_) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(request&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;granted_) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;switch&lt;/span&gt; (request&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;lock_mode_) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; LockMode&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;SHARED:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(lock_mode&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;LockMode&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;INTENTION_SHARED&lt;span style=&#34;color:#f92672&#34;&gt;||&lt;/span&gt;lock_mode&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;LockMode&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;SHARED) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;break&lt;/span&gt; ;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          } &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; false;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; LockMode&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;EXCLUSIVE:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; false ;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; LockMode&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;INTENTION_SHARED:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(lock_mode&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;LockMode&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;EXCLUSIVE) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; false;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          } &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;break&lt;/span&gt; ;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; LockMode&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;INTENTION_EXCLUSIVE:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(lock_mode&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;LockMode&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;INTENTION_SHARED&lt;span style=&#34;color:#f92672&#34;&gt;||&lt;/span&gt;lock_mode&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;LockMode&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;INTENTION_EXCLUSIVE) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;break&lt;/span&gt; ;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          } &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; false;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; LockMode&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;SHARED_INTENTION_EXCLUSIVE:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(lock_mode&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;LockMode&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;INTENTION_SHARED) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;break&lt;/span&gt; ;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          } &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; false;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    } &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#75715e&#34;&gt;// é‡åˆ°äº†æœªæˆæƒçš„è¯·æ±‚ï¼Œ æŒ‰ç…§å…ˆè¿›å…ˆå‡ºçš„åŸåˆ™ï¼Œå¦‚æœä¸æ˜¯å½“å‰è¯·æ±‚ï¼Œè¿”å›falseï¼Œå¦åˆ™è¿”å›true
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; request&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;checked_request.get();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;// å¦‚æœå°±æ˜¯å½“å‰è¯·æ±‚ï¼Œå¯ä»¥æˆæƒ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;throw&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Exception&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;åœ¨æˆæƒé”ä¸­ï¼Œå‡ºç°æœªçŸ¥æƒ…å†µ&amp;#34;&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;// å½“å‰çš„è¯·æ±‚å¹¶ä¸åœ¨é˜Ÿåˆ—ä¸­
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åé€šè¿‡æ¡ä»¶å˜é‡ï¼Œç­‰å¾…å½“å‰çš„å‡çº§è¯·æ±‚è¢«æ»¡è¶³&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;unique_lock&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;mutex&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; lock(lock_request_queue&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;latch_, std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;adopt_lock);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;CheckGrant(upgrade_request,lock_request_queue)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    lock_request_queue&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;cv_.wait(lock);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetState()&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;TransactionState&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;ABORTED) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      lock_request_queue&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;request_queue_.erase(upgrade_request_iter);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      lock_request_queue&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;upgrading_&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;INVALID_TXN_ID;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      lock_request_queue&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;cv_.notify_all();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; false;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// è·å¾—é”
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;lock_request_queue&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;upgrading_&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;INVALID_TXN_ID;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;upgrade_request&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;granted_&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;true;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ModifyLockSet(txn, oid, lock_mode, LockObject&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;TABLE, ModifyMode&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;ADD);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(lock_mode&lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt;LockMode&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;EXCLUSIVE) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  lock_request_queue&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;cv_.notify_all(); &lt;span style=&#34;color:#75715e&#34;&gt;//è¿™é‡Œçš„ifæ˜¯ä¸ªå°ä¼˜åŒ–ï¼Œå› ä¸ºå¯¹äºXé”ï¼Œé€šçŸ¥äº†å…¶ä»–çº¿ç¨‹ä¹Ÿæ²¡æœ‰ç”¨ï¼Œå®ƒä»¬æ˜¯æ— æ³•æ»¡è¶³å¾—åˆ°é”çš„æ¡ä»¶çš„ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; true;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¤„ç†å®Œäº†å‡çº§è¯·æ±‚ï¼Œå†æ¥è€ƒè™‘æ–°å¢åŠ çš„åŠ é”è¯·æ±‚ã€‚æ­¤æ—¶ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„è¯·æ±‚åˆ°é˜Ÿåˆ—åé¢ï¼Œå¹¶ä¸”ç­‰å¾…å°±å¥½äº†ã€‚å½“ç­‰å¾…å®Œæˆï¼Œæˆäºˆå…¶æ–°é”ï¼Œå¹¶æ›´æ–°ä¿¡æ¯&lt;/p&gt;
&lt;h4 id=&#34;unlocktable&#34;&gt;UnLockTable&lt;/h4&gt;
&lt;p&gt;åŠŸèƒ½ï¼šæŒ‡å®šäº‹åŠ¡ï¼Œè§£é”å…¶ä¸Šçš„è¡¨é”ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;Both UnlockTable() and UnlockRow() should release the lock on the resource and return.
&lt;ul&gt;
&lt;li&gt;Both should ensure that the transaction currently holds a lock on the resource it is attempting to unlock.&lt;/li&gt;
&lt;li&gt;If not, LockManager should set the TransactionState as ABORTED and throw&lt;/li&gt;
&lt;li&gt;a TransactionAbortException (ATTEMPTED_UNLOCK_BUT_NO_LOCK_HELD)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;é¦–å…ˆæŸ¥çœ‹æ˜¯å¦å­˜åœ¨è¡¨ä¸Šçš„é”ï¼Œå¦‚æœä¸å­˜åœ¨ï¼ŒæŠ›å‡ºå¼‚å¸¸&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;table_lock_map_latch_.lock();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; lock_request_queue_it &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; table_lock_map_.find(oid);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;table_lock_map_latch_.unlock();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(lock_request_queue_it&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;table_lock_map_.end()) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;SetState(TransactionState&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;ABORTED);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;throw&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;TransactionAbortException&lt;/span&gt;(txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetTransactionId(),AbortReason&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;ATTEMPTED_UNLOCK_BUT_NO_LOCK_HELD);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;Additionally, unlocking a table should only be allowed if the transaction does not hold locks on anyrow on that table. If the transaction holds locks on rows of the table, Unlock should set the Transaction Stateas ABORTED and throw a TransactionAbortException (TABLE_UNLOCKED_BEFORE_UNLOCKING_ROWS).&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;åœ¨è§£é”ä¹‹å‰ï¼Œå¿…é¡»ä¿è¯æ²¡æœ‰ä»»ä½•è¡Œé”ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; row_s_lock_set &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetSharedRowLockSet()&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;find(oid);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; row_x_lock_set &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetExclusiveRowLockSet()&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;find(oid);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// åˆ¤æ–­è¡Œé”å¿…é¡»ä¸ºç©º
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;((row_s_lock_set&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetSharedRowLockSet()&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;end()&lt;span style=&#34;color:#f92672&#34;&gt;||&lt;/span&gt;row_s_lock_set&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;second.empty())&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      (row_x_lock_set&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetExclusiveRowLockSet()&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;end()&lt;span style=&#34;color:#f92672&#34;&gt;||&lt;/span&gt;row_x_lock_set&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;second.empty()) )) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;SetState(TransactionState&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;ABORTED);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;throw&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;TransactionAbortException&lt;/span&gt;(txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetTransactionId(),AbortReason&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;TABLE_UNLOCKED_BEFORE_UNLOCKING_ROWS);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¹‹åæ£€æŸ¥é˜Ÿåˆ—ï¼Œå¦‚æœå­˜åœ¨ï¼štxnç›¸åŒå¹¶ä¸”è¢«æˆäºˆé”ï¼Œé‚£ä¹ˆåˆ é™¤ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;TRANSACTION STATE UPDATE&lt;/li&gt;
&lt;li&gt;Unlock should update the transaction state appropriately (depending upon the ISOLATION LEVEL)&lt;/li&gt;
&lt;li&gt;Only unlocking S or X locks changes transaction state.
*&lt;/li&gt;
&lt;li&gt;REPEATABLE_READ:
&lt;ul&gt;
&lt;li&gt;Unlocking S/X locks should set the transaction state to SHRINKING
*&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;READ_COMMITTED:
&lt;ul&gt;
&lt;li&gt;Unlocking X locks should set the transaction state to SHRINKING.&lt;/li&gt;
&lt;li&gt;Unlocking S locks does not affect transaction state.
*&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;READ_UNCOMMITTED:
&lt;ul&gt;
&lt;li&gt;Unlocking X locks should set the transaction state to SHRINKING.&lt;/li&gt;
&lt;li&gt;S locks are not permitted under READ_UNCOMMITTED.&lt;/li&gt;
&lt;li&gt;The behaviour upon unlocking an S lock under this isolation level is undefined.
*&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;switch&lt;/span&gt;(txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetIsolationLevel()) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; IsolationLevel&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;REPEATABLE_READ:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;((&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;it)&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;lock_mode_&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;LockMode&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;EXCLUSIVE&lt;span style=&#34;color:#f92672&#34;&gt;||&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;it)&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;lock_mode_&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;LockMode&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;SHARED) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;SetState(TransactionState&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;SHRINKING);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;break&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; IsolationLevel&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;READ_COMMITTED:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;((&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;it)&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;lock_mode_&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;LockMode&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;EXCLUSIVE) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;SetState(TransactionState&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;SHRINKING);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;break&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; IsolationLevel&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;READ_UNCOMMITTED:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;((&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;it)&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;lock_mode_&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;LockMode&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;EXCLUSIVE) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;SetState(TransactionState&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;SHRINKING);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;((&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;it)&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;lock_mode_&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;LockMode&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;SHARED) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;SetState(TransactionState&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;ABORTED);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;throw&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Exception&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;æœªå®šä¹‰è¡Œä¸ºï¼Œåœ¨è¯»æœªæäº¤åŠ äº†è¯»é”&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;break&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨è¿™é‡Œæ³¨æ„è¿˜æœ‰ä¸€ä¸ªå‘ç‚¹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åœ¨Commité˜¶æ®µï¼Œä¼šå…ˆè®¾ç½®äº‹åŠ¡çŠ¶æ€ä¸ºcommitï¼Œå†éå†æ‰€æœ‰è¡¨ä¸Šçš„é”ï¼Œå¹¶è°ƒç”¨Unlock Table .&lt;/li&gt;
&lt;li&gt;å¦‚æœæ”¶ç¼©å˜æ¢è¿™é‡Œä¸åˆ¤æ–­äº‹åŠ¡çŠ¶æ€æ˜¯å¦ä¸ºgrowingï¼Œå°±ä¼šå¯¼è‡´ABORT/COMMITçŠ¶æ€åˆå˜å›SHRINKING&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;lock-row&#34;&gt;Lock Row&lt;/h4&gt;
&lt;p&gt;æˆ‘ä»¬é¦–å…ˆè¦å¢åŠ é”åˆ¤æ–­é€»è¾‘&lt;/p&gt;
&lt;p&gt;æ ¹æ®&lt;/p&gt;
&lt;p&gt;IS å‡çº§ä¸º S,X,IX,SIX&lt;/p&gt;
&lt;p&gt;IX å‡çº§ä¸º X,SIX&lt;/p&gt;
&lt;p&gt;å½“ä¸€ä¸ªè¡Œé”éœ€è¦Sé”ï¼Œè‡³å°‘éœ€è¦ISè¡¨é”ã€‚éœ€è¦Xè¡Œé”ï¼Œè‡³å°‘éœ€è¦IXè¡¨é”ã€‚&lt;/p&gt;
&lt;p&gt;å¢åŠ åˆ¤æ–­æ¡ä»¶&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; LockManager&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;CheckTableIntentionLock(Transaction &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;txn, &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; LockManager&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;LockMode &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;lockMode,table_oid_t oid) &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;switch&lt;/span&gt; (lockMode) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; LockMode&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;SHARED:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;IsTableIntentionSharedLocked(oid)&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;!&lt;/span&gt;txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;IsTableSharedLocked(oid)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;!&lt;/span&gt;txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;IsTableExclusiveLocked(oid)&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;!&lt;/span&gt;txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;IsTableIntentionExclusiveLocked(oid)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;!&lt;/span&gt;txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;IsTableSharedIntentionExclusiveLocked(oid)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;SetState(TransactionState&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;ABORTED);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;throw&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;TransactionAbortException&lt;/span&gt;(txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetTransactionId(),AbortReason&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;TABLE_LOCK_NOT_PRESENT);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;break&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; LockMode&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;EXCLUSIVE:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;IsTableExclusiveLocked(oid)&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;!&lt;/span&gt;txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;IsTableIntentionExclusiveLocked(oid)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;!&lt;/span&gt;txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;IsTableSharedIntentionExclusiveLocked(oid)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;SetState(TransactionState&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;ABORTED);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;throw&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;TransactionAbortException&lt;/span&gt;(txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetTransactionId(),AbortReason&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;TABLE_LOCK_NOT_PRESENT);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;break&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;default&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;break&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;// å…¶ä»–ä¸‰ç§æƒ…å†µä¹‹å‰å·²ç»æŠ›å‡ºã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™æ˜¯ä¸€ä¸ªç®€å•çš„DFSï¼Œå°±ä¸å†è®²äº†ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt; (HasCycle(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;txn_id)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#75715e&#34;&gt;// åˆ é™¤ç»“ç‚¹
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰¾åˆ°ç¯ä¹‹åï¼Œåˆ é™¤è¯¥äº‹åŠ¡çš„ç»“ç‚¹ï¼ˆåˆ é™¤ä»¥å…¶ä¸ºé¡¶ç‚¹çš„è¾¹ï¼‰&lt;/p&gt;
&lt;p&gt;ç„¶åå¯¹å®ƒè¯·æ±‚çš„é”é˜Ÿåˆ—éƒ½notifyä¸€é&lt;/p&gt;
&lt;p&gt;å¹¶å°†è¯¥äº‹åŠ¡Abort&lt;/p&gt;
&lt;h2 id=&#34;task2-deadlock-detection&#34;&gt;Task2 Deadlock Detection&lt;/h2&gt;
&lt;p&gt;é€šè¿‡æ£€æµ‹é”çš„ç­‰å¾…è¯·æ±‚å…³ç³»ï¼Œä¹Ÿå°±æ˜¯æ£€æµ‹ç¯æ¥æ£€æŸ¥æ˜¯å¦æœ‰æ­»é”ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Your background thread should build the graph on the fly every time it wakes up. You should &lt;strong&gt;not&lt;/strong&gt; be maintaining a graph, it should be built and destroyed every time the thread wakes up.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´ï¼Œæ£€æµ‹çº¿ç¨‹æ˜¯ä¸€ä¸ªå‘¨æœŸæ€§çš„åå°çº¿ç¨‹ï¼Œåœ¨å”¤é†’æ—¶ï¼Œå†æ„é€ è¾¹ã€‚ç›®å‰ï¼Œæˆ‘çš„æƒ³æ³•æ˜¯ï¼šå¯ä»¥é€šè¿‡éå†è¯·æ±‚é˜Ÿåˆ—ï¼Œæ¥æ£€æŸ¥æœ‰å“ªäº›è¾¹éœ€è¦è¢«æ·»åŠ ã€‚&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚éå†&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;std::unordered_map&amp;lt;table_oid_t, std::shared_ptr&amp;lt;LockRequestQueue&amp;gt;&amp;gt; table_lock_map_;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;é€šè¿‡éå†oidï¼Œæ‰¾å‡ºå“ªä¸ªé”Grantç»™å“ªä¸ªäº‹åŠ¡äº†ã€‚å› ä¸ºæˆ‘ä»¬çš„é”æ˜¯FIFOçš„ï¼Œæ‰€ä»¥å¯ä»¥å°†Queueåˆ†æˆä¸¤ä¸ªéƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†å·²ç»è¢«æˆäºˆäº†é”ï¼Œç¬¬äºŒéƒ¨åˆ†åœ¨ç­‰å¾…é”ã€‚&lt;/p&gt;
&lt;p&gt;è¯´å›å…·ä½“çš„å®ç°ï¼Œé¦–å…ˆå®ç°ç¯ï¼Œå†æ¥æƒ³å…¶ä»–çš„ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬é€šè¿‡ä¿å­˜èµ·ç‚¹å’Œå…¶åˆ°è¾¾çš„ç‚¹æ¥ä¿å­˜å›¾ï¼Œæˆ‘å®šä¹‰äº†ä¸‹é¢çš„æ•°æ®ç»“æ„ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;using&lt;/span&gt; edge_t &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;pair&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;txn_id_t,txn_id_t&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;using&lt;/span&gt; edge_list &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;vector&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;edge_t&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;using&lt;/span&gt; edge_map &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;unordered_map&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;txn_id_t, std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;unordered_map&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;txn_id_t, edge_list&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;iterator&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  edge_list edge_list_;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  edge_map edge_map_;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;edge_mapä»¥èµ·ç‚¹ä¸ºkeyï¼Œvalueå€¼ä¸ºä¸€ä¸ªvectorï¼Œä¿å­˜ç»ˆç‚¹å’Œåœ¨edge_listä¸­çš„è¿­ä»£å™¨ä½ç½®ï¼ˆç”¨äºå¿«é€Ÿç»´æŠ¤listï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶åå°±æ˜¯æ·»åŠ è¾¹å’Œç§»é™¤è¾¹çš„ä»£ç &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;è¿™é‡Œæˆ‘ç°åœ¨æƒ³äº†ä¸€ä¸‹ï¼Œå¦‚æœGetEdgeList()è°ƒç”¨é¢‘ç‡ä¸é«˜çš„è¯ï¼Œä¸ç”¨å†™è¿™ä¹ˆå¤æ‚ã€‚æ¯æ¬¡è°ƒç”¨æ—¶å†ä¸´æ—¶ç»´æŠ¤GetEdgeList()å°±è¡Œã€‚ç„¶åæˆ‘å‘ç°äº†é¢„å…ˆç»™äº†ä¸€ä¸ªwaits_for_ï¼Œäºæ˜¯æˆ‘å°±æ”¹å†™æ³•äº†ã€‚è¿™æ˜¯æˆ‘æœ€å¼€å§‹çš„å†™æ³•&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; LockManager&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;AddEdge(txn_id_t t1, txn_id_t t2) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; t1_map_iter &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; edge_map_.find(t1);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(t1_map_iter&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;edge_map_.end()) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// è¯´æ˜ä¹‹å‰æ²¡æœ‰t1èµ·ç‚¹çš„è¾¹
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt; t1_map_iter &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; edge_map_.emplace(t1, std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;unordered_map&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;txn_id_t, edge_list&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;iterator&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;{} ).first;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; t2_iter &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; t1_map_iter&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;second.find(t2);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(t2_iter &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; t1_map_iter&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;second.end()) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// è¯´æ˜ä¹‹å‰æ²¡æœ‰è¯¥è¾¹ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt; edge_list_.emplace_back(t1,t2);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; new_edge_list_iter &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;  std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;prev(edge_list_.end());
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; (t1_map_iter&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;second).emplace(t2,new_edge_list_iter); &lt;span style=&#34;color:#75715e&#34;&gt;// æ’å…¥mapä¸­
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; LockManager&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;RemoveEdge(txn_id_t t1, txn_id_t t2) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; t1_map_iter &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; edge_map_.find(t1);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(t1_map_iter&lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt;edge_map_.end()) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; t2_iter &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; t1_map_iter&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;second.find(t2);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(t2_iter &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; t1_map_iter&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;second.end()) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   &lt;span style=&#34;color:#75715e&#34;&gt;// æ‰¾åˆ°äº†æ”¹å˜ï¼Œå…ˆä»listä¸­åˆ é™¤ï¼Œç„¶åå†ä»mapä¸­åˆ é™¤
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;   edge_list_.erase(t2_iter&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;second);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   t1_map_iter&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;second.erase(t2_iter);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; LockManager&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;HasCycle(txn_id_t &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;txn_id) &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt; { &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; false; }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; LockManager&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;GetEdgeList() &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt; std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;vector&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;pair&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;txn_id_t, txn_id_t&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// std::vector&amp;lt;std::pair&amp;lt;txn_id_t, txn_id_t&amp;gt;&amp;gt; edges(0);
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; edge_list_;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/blockquote&gt;
&lt;p&gt;å®Œæˆäº†åŠ è¾¹ä¹‹åï¼Œå¼€å§‹æ‰¾ç¯ã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„ç¯æ˜¯ä»å°åˆ°å¤§å¼€å§‹æ‰¾ï¼Œä½†æ˜¯è¿”å›çš„åº”è¯¥æ˜¯ç¯ä¸­çš„æœ€å¤§å€¼ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; LockManager&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;HasCycle(txn_id_t &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;txn_id) &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;txn : txn_set_) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    txn_sort_list_.emplace_back(txn);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;sort(txn_sort_list_.begin(), txn_sort_list_.end(),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            [](&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; txn_id_t &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;t1, &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; txn_id_t &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;t2) { &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; t1 &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; t2; });
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;begin_txn : txn_sort_list_) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    cycle_set_.clear();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (SearchCycle(begin_txn)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#75715e&#34;&gt;// è¯´æ˜æœ‰ç¯ï¼›æ‰¾åˆ°æœ€å¤§çš„.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; youngest_txn &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;cycle_set_.begin();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; cycle_node : cycle_set_) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        youngest_txn &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;max(youngest_txn, cycle_node);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;txn_id &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; youngest_txn;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; true;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; false;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; LockManager&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;SearchCycle(txn_id_t txn_id_) &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (searched_set_.count(txn_id_) &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; false;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// è¯´æ˜ä»æ­¤å¼€å§‹ï¼Œæ²¡æœ‰ç¯
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (cycle_set_.find(txn_id_) &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; cycle_set_.end()) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// å·²ç»è¢«æ ‡è®°è¿‡äº†ï¼Œè¯´æ˜å½¢æˆäº†ç¯
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; true;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  cycle_set_.emplace(txn_id_);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;linked_nodes &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; waits_for_[txn_id_];
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;sort(linked_nodes.begin(), linked_nodes.end(), [](&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; txn_id_t &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;t1, &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; txn_id_t &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;t2) { &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; t1 &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; t2; });
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;linked_node : linked_nodes) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (SearchCycle(linked_node)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; true;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;// æ‰¾å®Œäº†éƒ½æ²¡æœ‰ç¯ï¼ŒåŠ å…¥è¢«æœç´¢è¿‡çš„ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  searched_set_.emplace(txn_id_);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  cycle_set_.erase(txn_id_);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; false;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;task3-concurrent-query-execution&#34;&gt;Task3 Concurrent Query Execution&lt;/h2&gt;
&lt;p&gt;You will need to update the &lt;code&gt;Next()&lt;/code&gt; methods of some executors (sequential scan, insert, and delete)&lt;/p&gt;
&lt;p&gt;éœ€è¦å¯¹è¿™å‡ ä¸ªç®—å­åŠ é”ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆæˆ‘ä»¬è¦äº†è§£åŠ é”çš„çº§åˆ«ï¼š&lt;/p&gt;
&lt;p&gt;é€šè¿‡ä¸Šç½‘ï¼ŒæŸ¥è¯¢åˆ°ä¸åŒäº‹åŠ¡åˆ†åˆ«è¦åŠ å“ªäº›é”&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;read-uncommitted(ç®€ç§°ï¼šRU)ï¼šè¿™é‡ŒæŸ¥è¯¢ä¸åŠ é”ï¼Œä½†æ˜¯å¢åˆ æ”¹åŠ äº†è¡Œçº§å…±äº«é”ï¼Œç›´åˆ°äº‹ç‰©è¢«æäº¤æˆ–å›æ»šæ‰ä¼šè§£é”ã€‚
read-committed(ç®€ç§°ï¼šRC)ï¼šäº‹åŠ¡è¯»å–çš„æ—¶å€™ï¼ŒæŸ¥è¯¢æ“ä½œä¸ä¼šåŠ é”ã€‚è¿›è¡Œå¢åˆ æ”¹æ—¶ï¼Œä¼šåŠ è¡Œçº§å…±äº«é”ï¼Œç›´åˆ°äº‹ç‰©è¢«æäº¤æˆ–å›æ»šæ‰ä¼šè§£é”ã€‚
repeatable-read(ç®€ç§°ï¼šRR)ï¼šäº‹åŠ¡è¯»å–æ—¶åŠ è¡Œçº§å…±äº«é”ï¼Œç›´åˆ°äº‹åŠ¡ç»“æŸæ‰ä¼šé‡Šæ”¾ã€‚
serializable(ç®€ç§°ï¼šSE)ï¼šäº‹åŠ¡è¯»å–æ—¶åŠ è¡¨çº§æ’å®ƒé”ï¼Œç›´åˆ°äº‹åŠ¡ç»“æŸæ—¶ï¼Œæ‰é‡Šæ”¾ã€‚è¿™é‡Œå› ä¸ºæœ‰ä¸€ä¸ªä¸²è¡ŒåŒ–çš„ä¸€ç§çŠ¶æ€ï¼Œæœªè§¦å‘å‰åªå¯ä»¥è¿›è¡ŒæŸ¥è¯¢æ“ä½œï¼Œä¸€æ—¦è¿›è¡Œå¢åˆ æ”¹ä¸²è¡ŒåŒ–å°±ä¼šè¢«è§¦å‘ï¼Œå¢åˆ æ”¹æŸ¥éƒ½ä¼šè¢«äº‹åŠ¡é˜»å¡ï¼
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºCSDNåšä¸»ã€ŒIT_Holmesã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚
åŸæ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/IT_Holmes/article/details/122641669&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;seq-scan&#34;&gt;seq Scan&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/database/lab4/image-20230713211300499.png&#34;
	width=&#34;768&#34;
	height=&#34;824&#34;
	srcset=&#34;https://antio2.cn/tech/database/lab4/image-20230713211300499_hud6cfd3704d93db6e844b6366c11e3878_163178_480x0_resize_box_3.png 480w, https://antio2.cn/tech/database/lab4/image-20230713211300499_hud6cfd3704d93db6e844b6366c11e3878_163178_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20230713211300499&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;93&#34;
		data-flex-basis=&#34;223px&#34;
	
&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;éš”ç¦»çº§åˆ«&lt;/th&gt;
&lt;th&gt;åŠ é”æƒ…å†µ&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;read-uncommitted&lt;/td&gt;
&lt;td&gt;ä¸åŠ é”&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;read-committed&lt;/td&gt;
&lt;td&gt;æŸ¥è¯¢æ“ä½œåŠ é”,åŠ å®Œè¡Œé”é©¬ä¸Šé‡Šæ”¾&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;repeatable-read&lt;/td&gt;
&lt;td&gt;è¯»å–æ—¶åŠ è¡Œçº§å…±äº«é”ï¼Œè¯»å–å®Œå†é‡Šæ”¾è¡Œé”ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨Initä¸­ï¼Œéœ€è¦å…ˆåŠ ISé”ï¼Œç„¶ååœ¨Nextä¸­ï¼Œå¯¹è¡ŒåŠ Sé”&lt;/p&gt;
&lt;p&gt;é¦–å…ˆæ˜¯åŠ è¡¨é”&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; SeqScanExecutor&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;Init() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  table_info_ &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; exec_ctx_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetCatalog()&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetTable(plan_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetTableOid());
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; txn &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; exec_ctx_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetTransaction();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetIsolationLevel()&lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt;IsolationLevel&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;READ_UNCOMMITTED) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// éœ€è¦åŠ æ„å‘è¯»é”
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;exec_ctx_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetLockManager()&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;LockTable(txn, LockManager&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;LockMode&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;INTENTION_SHARED,table_info_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;oid_)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;SetState(TransactionState&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;ABORTED);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;throw&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Exception&lt;/span&gt;(ExceptionType&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;INVALID,&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Cant lock table&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  table_iter_ &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; table_info_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;table_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;Begin(exec_ctx_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetTransaction());
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åæ˜¯åŠ è¡Œé”&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetIsolationLevel()&lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt;IsolationLevel&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;READ_UNCOMMITTED) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;// å¦‚æœä¸æ˜¯RUï¼Œéœ€è¦åœ¨è¯»å‰åŠ Sé”
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;lm&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;LockRow(txn,LockManager&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;LockMode&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;SHARED,oid,&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;rid)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;throw&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ExecutionException&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Can&amp;#39;t lock row&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨è§£é”æ—¶ï¼Œä¸åŒéš”ç¦»çº§åˆ«è§£é”æ—¶æœºä¸åŒï¼Œå…·ä½“å‚ç…§æˆ‘ä¸Šé¢çš„è¡¨&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; res &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; table_info_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;table_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetTuple(&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;rid, tuple, exec_ctx_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetTransaction());
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;lock_rids_.emplace_back(rid);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetIsolationLevel()&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;IsolationLevel&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;READ_COMMITTED) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;lm&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;UnlockRow(txn,oid,&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;rid)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;throw&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ExecutionException&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Can&amp;#39;t unlock row&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(table_iter_&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;table_info_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;table_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;End()) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  done_ &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; true;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetIsolationLevel()&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;IsolationLevel&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;REPEATABLE_READ) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// å¦‚æœæ˜¯RRï¼Œåœ¨æœ€åé‡Šæ”¾è¯»é”ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;lock_rid:lock_rids_) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;lm&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;UnlockRow(txn, oid, &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;lock_rid)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;throw&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ExecutionException&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Can&amp;#39;t unlock row&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetIsolationLevel()&lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt;IsolationLevel&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;READ_UNCOMMITTED) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// é‡Šæ”¾IS
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;exec_ctx_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetLockManager()&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;UnlockTable(txn,table_info_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;oid_)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;SetState(TransactionState&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;ABORTED);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;throw&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ExecutionException&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Can&amp;#39;t unlock table&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  lock_rids_.clear();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; res;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;insert&#34;&gt;insert&lt;/h3&gt;
&lt;p&gt;å¯¹äºinsert,é¦–å…ˆå¯¹è¡¨ä¸ŠIXé”ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶ååœ¨å†™æ—¶ï¼Œå¯¹æ¯ä¸ªtupleä¸ŠXé”ã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„è¿˜è¦ç»´æŠ¤transactionçš„write set.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt; (child_executor_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;Next(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;next_tuple, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;next_rid)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (table_info_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;table_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;InsertTuple(next_tuple, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;next_rid, exec_ctx_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetTransaction())) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// å¦‚æœæ’å…¥æˆåŠŸï¼Œæ‰èƒ½è·å–ridï¼Œè¿™ä¸ªæ—¶å€™æ‰èƒ½å¾—åˆ°lock
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// æ‰€ä»¥ä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜:å¹»è±¡è¯»å–ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;try&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;lock_m&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;LockRow(txn,LockManager&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;LockMode&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;EXCLUSIVE,table_info_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;oid_,next_rid)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;SetState(TransactionState&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;ABORTED);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;throw&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ExecutionException&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Can&amp;#39;t lock row&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }&lt;span style=&#34;color:#66d9ef&#34;&gt;catch&lt;/span&gt; (TransactionAbortException&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; e) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;throw&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ExecutionException&lt;/span&gt;(e.GetInfo());
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; index : indexes_) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      index&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;index_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;InsertEntry(next_tuple.KeyFromTuple(child_executor_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetOutputSchema(), index&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;key_schema_,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                                         index&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;index_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetKeyAttrs()),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                 next_rid, exec_ctx_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetTransaction());
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;AppendIndexWriteRecord(IndexWriteRecord(next_rid,table_info_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;oid_,WType&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;INSERT,next_tuple,index&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;index_oid_,exec_ctx_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetCatalog()));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;AppendTableWriteRecord(TableWriteRecord(next_rid,WType&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;INSERT, next_tuple, table_info_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;table_.get()));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;try&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;lock_m&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;UnlockRow(txn,table_info_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;oid_,next_rid)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;SetState(TransactionState&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;ABORTED);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;throw&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ExecutionException&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Can&amp;#39;t unlock row&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }&lt;span style=&#34;color:#66d9ef&#34;&gt;catch&lt;/span&gt; (TransactionAbortException&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; e) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;throw&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ExecutionException&lt;/span&gt;(e.GetInfo());
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    rows_cnt&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;try&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;lock_m&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;UnlockTable(txn,table_info_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;oid_)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;SetState(TransactionState&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;ABORTED);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;throw&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ExecutionException&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Can&amp;#39;t unlock table&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;span style=&#34;color:#66d9ef&#34;&gt;catch&lt;/span&gt; (TransactionAbortException&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; e) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;throw&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ExecutionException&lt;/span&gt;(e.GetInfo());
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªç–‘ç‚¹ï¼šéœ€ä¸éœ€è¦åœ¨ä»£ç é‡Œé¢è§£é”è¡Œé”ï¼š&lt;/p&gt;
&lt;p&gt;ç»è¿‡æ€è€ƒä¹‹åï¼Œå…¶å®æ˜¯ä¸éœ€è¦çš„ï¼ŒXé”åº”å½“åœ¨Commitæˆ–Abort é˜¶æ®µè¢«transaction managerè§£é”ã€‚ï¼ˆå¦‚æœåœ¨æ‰§è¡Œæ—¶è§£é”ï¼Œä¼šå¯¼è‡´è¿›å…¥æ”¶ç¼©é˜¶æ®µï¼ï¼‰&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥æˆ‘åˆæ”¹æˆäº†ä¸éœ€è¦è§£é”çš„ä»£ç &lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; InsertExecutor&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;Next(Tuple &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;tuple, RID &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;rid) &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (is_end_) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; false;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;// exec_ctx_-&amp;gt;GetLockManager()-&amp;gt;LockUpgrade(exec_ctx_-&amp;gt;GetTransaction(), *rid);
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  RID next_rid;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  Tuple next_tuple;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;int32_t&lt;/span&gt; rows_cnt &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; lock_m &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; exec_ctx_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetLockManager();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt; (child_executor_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;Next(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;next_tuple, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;next_rid)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (table_info_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;table_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;InsertTuple(next_tuple, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;next_rid, exec_ctx_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetTransaction())) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#75715e&#34;&gt;// å¦‚æœæ’å…¥æˆåŠŸï¼Œæ‰èƒ½è·å–ridï¼Œè¿™ä¸ªæ—¶å€™æ‰èƒ½å¾—åˆ°lock
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;      &lt;span style=&#34;color:#75715e&#34;&gt;// æ‰€ä»¥ä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜:å¹»è±¡è¯»å–ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;try&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;lock_m&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;LockRow(txn,LockManager&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;LockMode&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;EXCLUSIVE,table_info_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;oid_,next_rid)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;SetState(TransactionState&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;ABORTED);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;throw&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ExecutionException&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Can&amp;#39;t lock row&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      }&lt;span style=&#34;color:#66d9ef&#34;&gt;catch&lt;/span&gt; (TransactionAbortException&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; e) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;throw&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ExecutionException&lt;/span&gt;(e.GetInfo());
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; index : indexes_) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        index&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;index_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;InsertEntry(next_tuple.KeyFromTuple(child_executor_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetOutputSchema(), index&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;key_schema_,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                                           index&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;index_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetKeyAttrs()),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                   next_rid, exec_ctx_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetTransaction());
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;AppendIndexWriteRecord(IndexWriteRecord(next_rid,table_info_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;oid_,WType&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;INSERT,next_tuple,index&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;index_oid_,exec_ctx_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetCatalog()));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      txn&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;AppendTableWriteRecord(TableWriteRecord(next_rid,WType&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;INSERT, next_tuple, table_info_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;table_.get()));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      rows_cnt&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;vector&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;Value&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; values;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  values.reserve(GetOutputSchema().GetColumnCount());
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  values.emplace_back(TypeId&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;INTEGER, rows_cnt);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;tuple &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Tuple{values, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;GetOutputSchema()};
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  is_end_ &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; true;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; true;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;delete&#34;&gt;delete&lt;/h3&gt;
&lt;p&gt;deleteå’Œinsertè¿˜æŒºåƒçš„ï¼Œç…§ç€æ”¹å°±è¡Œã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; DeleteExecutor&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;Init() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  child_executor_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;Init();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;try&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;exec_ctx_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetLockManager()&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;LockTable(txn_,LockManager&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;LockMode&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;INTENTION_EXCLUSIVE,plan_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;table_oid_)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;throw&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ExecutionException&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Can&amp;#39;t Get X Lock On Table&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }&lt;span style=&#34;color:#66d9ef&#34;&gt;catch&lt;/span&gt; (TransactionAbortException&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; e) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;throw&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ExecutionException&lt;/span&gt;(e.GetInfo());
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  table_info_ &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; exec_ctx_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetCatalog()&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetTable(plan_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;table_oid_);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  indexes_ &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; exec_ctx_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetCatalog()&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetTableIndexes(table_info_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;name_);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; DeleteExecutor&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;Next(&lt;span style=&#34;color:#a6e22e&#34;&gt;[[maybe_unused]]&lt;/span&gt; Tuple &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;tuple, RID &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;rid) &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (is_end_) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; false;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;int32_t&lt;/span&gt; row_cnt &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  Tuple next_tuple{};
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  RID next_rid;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; lock_m &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; exec_ctx_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetLockManager();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt; (child_executor_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;Next(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;next_tuple, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;next_rid)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;try&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;lock_m&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;LockRow(txn_,LockManager&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;LockMode&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;EXCLUSIVE,table_info_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;oid_,next_rid)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        txn_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;SetState(TransactionState&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;ABORTED);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;throw&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ExecutionException&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Can&amp;#39;t lock row&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }&lt;span style=&#34;color:#66d9ef&#34;&gt;catch&lt;/span&gt; (TransactionAbortException&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; e) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;throw&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ExecutionException&lt;/span&gt;(e.GetInfo());
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;table_info_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;table_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;MarkDelete(next_rid, exec_ctx_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetTransaction())) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;continue&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; index : indexes_) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      index&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;index_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;DeleteEntry(
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          next_tuple.KeyFromTuple(table_info_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;schema_, index&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;key_schema_, index&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;index_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetKeyAttrs()), next_rid,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          exec_ctx_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetTransaction());
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      txn_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;AppendIndexWriteRecord(IndexWriteRecord(next_rid,table_info_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;oid_,WType&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;DELETE,next_tuple,index&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;index_oid_,exec_ctx_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetCatalog()));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    txn_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;AppendTableWriteRecord(TableWriteRecord(next_rid,WType&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;DELETE, next_tuple, table_info_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;table_.get()));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    row_cnt&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;vector&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;Value&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; values &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; {Value(TypeId&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;INTEGER, row_cnt)};
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;tuple &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Tuple(values, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;plan_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;OutputSchema());
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; is_end_ &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; true;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;-ä¸€äº›æç¤º&#34;&gt;âš  ä¸€äº›æç¤º&lt;/h2&gt;
&lt;p&gt;åœ¨å…·ä½“çš„äº‹åŠ¡éš”ç¦»çº§åˆ«æ§åˆ¶ä¸­ï¼Œé€šè¿‡æ€è€ƒ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;è¿™ä¸ªéš”ç¦»çº§åˆ«æœ‰ä»€ä¹ˆç‰¹æ€§ï¼Ÿ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç›¸æ¯”æ›´é«˜ä¸€çº§çš„éš”ç¦»çº§åˆ«ï¼Œæˆ‘ç¼ºå°‘äº†ä»€ä¹ˆéš”ç¦»æ€§ï¼Ÿ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç›¸æ¯”ä½ä¸€çº§çš„ï¼Œæˆ‘åˆæä¾›äº†ä»€ä¹ˆåŠŸèƒ½ï¼Ÿ&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸¾ä¸ªä¾‹å­ï¼šRead Commitedéš”ç¦»çº§åˆ«ï¼Œ ç›¸æ¯”Read Uncommited(è¯»æœªæäº¤)ï¼Œæ¯æ¬¡éœ€è¦è¯»åˆ°çš„å¿…é¡»æ˜¯&lt;strong&gt;å·²ç»æäº¤è¿‡&lt;/strong&gt;çš„æ•°æ®ï¼Œè€Œä¸æ˜¯å·²ä¿®æ”¹è€Œæœªæäº¤çš„æ•°æ®ã€‚æ‰€ä»¥RCç›¸æ¯”RUï¼Œéœ€è¦ç»™æ¯ä¸ªè¡ŒåŠ ä¸Šè¯»é”æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ï¼ˆå› ä¸ºå…±äº«é”ä¸æ’ä»–é”å†²çªï¼Œå¦‚æœèƒ½åŠ è¯»é”ï¼Œè¯¥è¡Œ&lt;strong&gt;ä¸€å®šä¸æ˜¯è¿˜å¤„äºäº‹åŠ¡è¿›è¡Œä¸­çš„ä¿®æ”¹&lt;/strong&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆå†çœ‹æ›´é«˜ä¸€çº§å‘¢ï¼ŸRCç›¸æ¯”å¯é‡å¤è¯»ï¼Œ ä¸éœ€è¦åœ¨åŒä¸€æ¬¡äº‹åŠ¡çš„å¤šæ¬¡è¯»ä¸­è·å¾—ç›¸åŒæ•°æ®ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨æ¯æ¬¡è¯»å–åç«‹åˆ»é‡Šæ”¾è¯»é”ï¼Œè€ŒRRç›¸æ¯”RCï¼Œéœ€è¦ä¸€ç›´æŒæœ‰è¯»é”ã€‚&lt;/p&gt;
</description>
        </item>
        <item>
        <title>CMU15-445|Project3|Query Execution</title>
        <link>https://antio2.cn/tech/database/query_execution/</link>
        <pubDate>Mon, 01 May 2023 20:35:01 +0800</pubDate>
        
        <guid>https://antio2.cn/tech/database/query_execution/</guid>
        <description>&lt;img src="https://antio2.cn/tech/database/query_execution/blogimage-20230530234132716.png" alt="Featured image of post CMU15-445|Project3|Query Execution" /&gt;&lt;h2 id=&#34;0x00-å‡†å¤‡å·¥ä½œ&#34;&gt;0x00 å‡†å¤‡å·¥ä½œ&lt;/h2&gt;
&lt;p&gt;ğŸ§é¦–å…ˆé€šè¿‡æŸ¥çœ‹ç¤ºä¾‹äº†è§£æ€ä¹ˆå®ç°æ‰§è¡Œå™¨&lt;/p&gt;
&lt;h3 id=&#34;0x01-ç›¸å…³çš„ç±»&#34;&gt;0x01 ç›¸å…³çš„ç±»&lt;/h3&gt;
&lt;h4 id=&#34;executorcatalogschema&#34;&gt;Executor&amp;amp;Catalog&amp;amp;Schema&lt;/h4&gt;
&lt;p&gt;æ‰€æœ‰çš„Executor(åœ¨bustubä¸­)ï¼Œéƒ½æ˜¯Abstract_Executorçš„æ´¾ç”Ÿç±»&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;AbstractExecutor&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;/**
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;   * Construct a new AbstractExecutor instance.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;   * @param exec_ctx the executor context that the executor runs with
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;   */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;explicit&lt;/span&gt; AbstractExecutor(ExecutorContext &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;exec_ctx) &lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; exec_ctx_{exec_ctx} {}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;/** Virtual destructor. */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;virtual&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt;AbstractExecutor() &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;default&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;/**
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;   * Initialize the executor.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;   * @warning This function must be called before Next() is called!
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;   */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;virtual&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Init&lt;/span&gt;() &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;/**
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;   * Yield the next tuple from this executor.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;   * @param[out] tuple The next tuple produced by this executor
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;   * @param[out] rid The next tuple RID produced by this executor
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;   * @return `true` if a tuple was produced, `false` if there are no more tuples
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;   */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;virtual&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Next&lt;/span&gt;(Tuple &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;tuple, RID &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;rid) &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;/** @return The schema of the tuples that this executor produces */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;virtual&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;GetOutputSchema&lt;/span&gt;() &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; Schema &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;/** @return The executor context in which this executor runs */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;GetExecutorContext&lt;/span&gt;() &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt; ExecutorContext &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; { &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; exec_ctx_; }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;protected&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;/** The executor context in which the executor runs */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ExecutorContext &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;exec_ctx_;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;};
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ°å¿…é¡»å®ç°çš„æ¥å£ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;void Init()&lt;/code&gt;ç”¨äºåˆå§‹åŒ–ï¼Œå¿…é¡»åœ¨&lt;code&gt;Next()&lt;/code&gt;ä¹‹å‰è¢«è°ƒç”¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;bool Next(Tuple *tuple, RID *rid)&lt;/code&gt;æ¥è·å–è¯¥æ‰§è¡Œå™¨ä¸‹ä¸€ä¸ªTupleå’ŒRID,å¦‚æœæ²¡æœ‰åˆ™è¿”å›falseã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;const Schema &amp;amp; GetOutputSchema()&lt;/code&gt;,è·å–è¯¥æ‰§è¡Œå™¨è¾“å‡ºçš„Schemaã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ğŸ§Schemaå­˜å‚¨äº†ä¸€ä¸ªåˆ—å‘é‡ï¼Œç±»ä¼¼äº&lt;code&gt;(__mock_table_1.colA:INTEGER, __mock_table_1.colB:INTEGER)&lt;/code&gt;,ColumnåŒ…å«äº†åˆ—åã€åˆ—ç±»å‹ã€åˆ—åœ¨tupleä¸­çš„åç§»é‡ã€åˆ—å¤§å°ç­‰ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Abstract_executor&lt;/code&gt;è¿˜æœ‰ä¸€ä¸ªå±æ€§ï¼š&lt;code&gt;ExecutorContext *exec_ctx_&lt;/code&gt;,æŒ‡ç¤ºäº†æ‰§è¡Œå™¨çš„ä¸Šä¸‹æ–‡ã€‚&lt;/p&gt;
&lt;p&gt;exec_ctxçš„æ„é€ å™¨å¦‚ä¸‹&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;ExecutorContext(Transaction *transaction, Catalog *catalog, BufferPoolManager *bpm, TransactionManager *txn_mgr,
                LockManager *lock_mgr)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å¯ä»¥çœ‹å‡ºæ¥æ‰§è¡Œå™¨å†…å®¹ç”±å½“å‰äº‹åŠ¡ã€catalogã€ç¼“å­˜ç®¡ç†å™¨ã€äº‹åŠ¡ç®¡ç†å™¨ã€é”ç®¡ç†å™¨ç»„æˆã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;catalog&lt;/code&gt;,ï¼ˆä¸­æ–‡ç¿»è¯‘ç›®å½•ï¼‰æ—¨åœ¨ä¾› DBMS æ‰§è¡Œå¼•æ“ä¸­çš„æ‰§è¡Œå™¨ä½¿ç”¨ã€‚å®ƒå¤„ç†è¡¨åˆ›å»ºã€è¡¨æŸ¥æ‰¾ã€ç´¢å¼•åˆ›å»ºå’Œç´¢å¼•æŸ¥æ‰¾ã€‚ty.ht é€šè¿‡æŸ¥çœ‹&lt;code&gt;catalog&lt;/code&gt;åŸå§‹ç±»ï¼Œå¯ä»¥çœ‹åˆ°å‡ ä¸ªæ–¹æ³•ï¼Œ&lt;code&gt;get_table&lt;/code&gt;,&lt;code&gt;get_index&lt;/code&gt;,&lt;code&gt;tree_index&lt;/code&gt;,&lt;code&gt;create_table&lt;/code&gt;,&lt;code&gt;create_index&lt;/code&gt;ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;ğŸ˜¼é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªæŠ½è±¡ç±»â€”â€”&lt;code&gt;AbstractPlanNode&lt;/code&gt;,è¿™ä¸ªä»£è¡¨äº†æ‰§è¡Œè®¡åˆ’æ ‘ç»“ç‚¹çš„åŸºç±»ï¼Œæ„é€ æ–¹æ³•æœ‰ä¸€ä¸ªæŒ‡ç¤ºè¾“å‡ºçš„schemaçš„&lt;code&gt;shared_ptr&lt;/code&gt;,è¿˜æœ‰å­è®¡åˆ’ç»“ç‚¹çš„å‘é‡&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c++&#34; data-lang=&#34;c++&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;AbstractPlanNode(SchemaRef output_schema, std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;vector&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;AbstractPlanNodeRef&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; children)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; output_schema_(std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;move(output_schema)), children_(std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;move(children)) {}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;expression&#34;&gt;Expression&lt;/h4&gt;
&lt;p&gt;ğŸ¦„bustubè¿˜æœ‰ä¸€ç³»åˆ—Expressionç±»ï¼Œæ¥è¡¨ç¤ºè¡¨è¾¾å¼ï¼Œæ¯”å¦‚é€»è¾‘è¡¨è¾¾å¼ã€å¸¸é‡è¡¨è¾¾å¼ã€‚&lt;/p&gt;
&lt;p&gt;æ¥çœ‹æ„é€ å‡½æ•°&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;AbstractExpression(std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;vector&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;AbstractExpressionRef&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; children, TypeId ret_type)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; children_{std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;move(children)}, ret_type_{ret_type} {}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å› ä¸ºExpressionè¢«æ ‘çŠ¶ç»“æ„è¡¨ç¤ºï¼Œå®ƒæ˜¯ç”±ä¸€ç³»åˆ—çš„å­è¡¨è¾¾å¼çš„ã€‚è¿˜æœ‰è¿”å›ç±»å‹ã€‚&lt;/p&gt;
&lt;p&gt;ExpressionæŠ½è±¡ç±»æœ‰ä»¥ä¸‹å‡ ä¸ªæ–¹æ³•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;virtual auto Evaluate(const Tuple *tuple, const Schema &amp;amp;schema) const -&amp;gt; Value = 0;&lt;/code&gt;é€šè¿‡ç»™å®štupleå’Œschemaæ±‚å½“å‰è¡¨è¾¾å¼çš„å€¼ã€‚æ¯”å¦‚constant_value_expressionç±»å‹çš„ç›´æ¥è¿”å›ä¸€ä¸ªvalue,column_value_expressionè¿”å›è¯¥tupleä¸­æŒ‡å®šåˆ—çš„å€¼ï¼Œarithmetic_expressionè¿”å›ä¸¤ä¸ªå­è¡¨è¾¾å¼çš„è®¡ç®—ç»“æœã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;virtual auto EvaluateJoin(const Tuple *left_tuple, const Schema &amp;amp;left_schema, const Tuple *right_tuple,const Schema &amp;amp;right_schema) const -&amp;gt; Value = 0;&lt;/code&gt; ç”¨äºè·å–è”ç»“æ“ä½œä¸­æŒ‡å®šåˆ—çš„å€¼ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;tuple&#34;&gt;Tuple&lt;/h4&gt;
&lt;p&gt;tupleç±»è¡¨ç¤ºä¸€ä¸ªå…ƒç»„ï¼Œæ¥ä¸‹æ¥è§£ætupleçš„å®ç°ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c++&#34; data-lang=&#34;c++&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;private&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Get the starting storage address of specific column
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; GetDataPtr(&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; Schema &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;schema, &lt;span style=&#34;color:#66d9ef&#34;&gt;uint32_t&lt;/span&gt; column_idx) &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;char&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt; allocated_{false};  &lt;span style=&#34;color:#75715e&#34;&gt;// is allocated?
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;RID rid_{};              &lt;span style=&#34;color:#75715e&#34;&gt;// if pointing to the table heap, the rid is valid
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;uint32_t&lt;/span&gt; size_{&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;};
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;char&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;data_{&lt;span style=&#34;color:#66d9ef&#34;&gt;nullptr&lt;/span&gt;};
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/blockquote&gt;
&lt;p&gt;GetDataPtrç”¨äºè·å–æŒ‡å‘æ•°æ®çš„æŒ‡é’ˆã€‚å¯¹äºisInlineç±»å‹ï¼ˆä¸æ˜¯Varcharï¼‰ï¼Œè¿”å›&lt;code&gt;(char*)(data+offset)&lt;/code&gt;,å¯¹äºnot inlineçš„åˆ—ï¼Œ &lt;code&gt;*reinterpret_cast&amp;lt;int32_t *&amp;gt;(data_ + col.GetOffset())&lt;/code&gt;è¿™ä¸ªæœ¬èº«ï¼ˆdata_ + col.GetOffset()çš„å€¼ï¼‰æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œè¯¥ä½ç½®å­˜æ”¾äº†ä¸€ä¸ªoffsetå€¼ï¼Œæœ€å&lt;code&gt;return (data_ + offset);&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;tupleåœ¨å†…å­˜ä¸­çš„å­˜æ”¾æ ¼å¼å¦‚ä¸‹ï¼Œæ³¨æ„ä¸ä¼šä¿å­˜RID&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c++&#34; data-lang=&#34;c++&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; Tuple&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;SerializeTo(&lt;span style=&#34;color:#66d9ef&#34;&gt;char&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;storage) &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  memcpy(storage, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;size_, &lt;span style=&#34;color:#66d9ef&#34;&gt;sizeof&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;int32_t&lt;/span&gt;)); &lt;span style=&#34;color:#75715e&#34;&gt;// å¤§å°
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  memcpy(storage &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;sizeof&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;int32_t&lt;/span&gt;), data_, size_);&lt;span style=&#34;color:#75715e&#34;&gt;// data_
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åæ˜¯Tupleçš„æ„é€ å™¨&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c++&#34; data-lang=&#34;c++&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Tuple&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;Tuple(std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;vector&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;Value&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; values, &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; Schema &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;schema) &lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; allocated_(true) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  assert(values.size() &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; schema&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetColumnCount());
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;// 1. Calculate the size of the tuple.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;uint32_t&lt;/span&gt; tuple_size &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; schema&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetLength(); &lt;span style=&#34;color:#75715e&#34;&gt;// æ³¨æ„è¿™é‡Œtuple_sizeå’Œschemaçš„lengthä¸åŒï¼Œtuple_sizeåŒ…å«äº†varcharçš„é•¿åº¦ï¼Œè€Œschemaä¸­åªæœ‰å…¶æŒ‡å‘offsetæŒ‡é’ˆçš„å¤§å°ï¼ˆsizeof(int32_t*)ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;i : schema&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetUnlinedColumns()) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; len &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; values[i].GetLength();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (len &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; BUSTUB_VALUE_NULL) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      len &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    tuple_size &lt;span style=&#34;color:#f92672&#34;&gt;+=&lt;/span&gt; (len &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;sizeof&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;uint32_t&lt;/span&gt;));&lt;span style=&#34;color:#75715e&#34;&gt;// lenä¸ºvarcharçš„å®é™…é•¿åº¦ã€‚sizeof(uint32_t)ä¸ºæŒ‡ç¤ºoffsetçš„æŒ‡é’ˆå¤§å°ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;// 2. Allocate memory. åˆ†é…å¤§å°ä¸ºtuple_sizeçš„å†…å­˜ç©ºé—´
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  size_ &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; tuple_size;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  data_ &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;char&lt;/span&gt;[size_];
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;memset(data_, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, size_);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;// 3. Serialize each attribute based on the input value.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;uint32_t&lt;/span&gt; column_count &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; schema&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetColumnCount();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;uint32_t&lt;/span&gt; offset &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; schema&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetLength();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;uint32_t&lt;/span&gt; i &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; i &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt; column_count; i&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;col &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; schema&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetColumn(i);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;col.IsInlined()) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#75715e&#34;&gt;// Serialize relative offset, where the actual varchar data is stored.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;      &lt;span style=&#34;color:#75715e&#34;&gt;// å°†çœŸæ­£çš„æ•°æ®çš„offsetå­˜æ”¾åˆ°åˆ—çš„åç§»ä¸Š
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;reinterpret_cast&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;uint32_t&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&amp;gt;&lt;/span&gt;(data_ &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; col.GetOffset()) &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; offset;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#75715e&#34;&gt;// Serialize varchar value, in place (size+data).
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;      values[i].SerializeTo(data_ &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; offset);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; len &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; values[i].GetLength();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (len &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; BUSTUB_VALUE_NULL) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        len &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      offset &lt;span style=&#34;color:#f92672&#34;&gt;+=&lt;/span&gt; (len &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;sizeof&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;uint32_t&lt;/span&gt;)); &lt;span style=&#34;color:#75715e&#34;&gt;// æ”¹å˜ä¸‹ä¸€ä¸ªvarcharçš„åç§»å€¼ï¼Œè¯¥varcharï¼ˆä¸ç®—åˆ—åœ¨inlineæ®µçš„å ç”¨ï¼‰ï¼Œå¤§å°ä¸ºlen+sizeof(uint32_t)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    } &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      values[i].SerializeTo(data_ &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; col.GetOffset());
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Serializeæ ¹æ®ä¸åŒçš„valueå®ç°æ–¹å¼ä¸åŒï¼Œå¯¹äºinlineç±»å‹ï¼Œæ˜¯ç›´æ¥å°†å…¶æ”¾åˆ°å¯¹åº”ä½ç½®ã€‚å¯¹äºvarcharç±»å‹ï¼Œå…ˆå­˜æ”¾é•¿åº¦ï¼ˆdataçš„é•¿åº¦ï¼Œä¸å«å¤´éƒ¨ï¼‰ï¼Œç„¶åmemcpyæ•°æ®æ®µã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c++&#34; data-lang=&#34;c++&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; BooleanType&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;SerializeTo(&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; Value &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;val, &lt;span style=&#34;color:#66d9ef&#34;&gt;char&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;storage) &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;reinterpret_cast&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;int8_t&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&amp;gt;&lt;/span&gt;(storage) &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; val.value_.boolean_;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; IntegerType&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;SerializeTo(&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; Value &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;val, &lt;span style=&#34;color:#66d9ef&#34;&gt;char&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;storage) &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;reinterpret_cast&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;int32_t&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&amp;gt;&lt;/span&gt;(storage) &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; val.value_.integer_;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; VarlenType&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;SerializeTo(&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; Value &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;val, &lt;span style=&#34;color:#66d9ef&#34;&gt;char&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;storage) &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;uint32_t&lt;/span&gt; len &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; GetLength(val);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (len &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; BUSTUB_VALUE_NULL) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    memcpy(storage, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;len, &lt;span style=&#34;color:#66d9ef&#34;&gt;sizeof&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;uint32_t&lt;/span&gt;));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  memcpy(storage, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;len, &lt;span style=&#34;color:#66d9ef&#34;&gt;sizeof&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;uint32_t&lt;/span&gt;));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  memcpy(storage &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;sizeof&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;uint32_t&lt;/span&gt;), val.value_.varlen_, len);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ğŸšå¤§æ¦‚äº†è§£äº†å‡ ä¸ªç›¸å…³ç±»ä¹‹åï¼Œå†æ¥çœ‹æä¾›çš„Sampleã€‚&lt;/p&gt;
&lt;h3 id=&#34;0x02-projection&#34;&gt;0x02 Projection&lt;/h3&gt;
&lt;p&gt;ä¸‹é¢çœ‹æä¾›çš„å‡ ä¸ªä¾‹å­ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;bustub&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;EXPLAIN&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt; BINDER &lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;BoundSelect &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;table&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&amp;lt;&lt;/span&gt;empty&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  columns&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;[(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;)],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  groupBy&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;[],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;having&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;where&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;limit&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;offset&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  order_by&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;[],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  is_distinct&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ctes&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt; PLANNER &lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Projection &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt; exprs&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;[(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;)] &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; (__unnamed&lt;span style=&#34;color:#f92672&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;:INTEGER)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;Values&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;rows&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; ()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt; OPTIMIZER &lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Projection &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt; exprs&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;[(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;)] &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; (__unnamed&lt;span style=&#34;color:#f92672&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;:INTEGER)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;Values&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;rows&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; ()
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Projectioné€šå¸¸æœ‰ä¸€ä¸ªchild,è´Ÿè´£è¾“å‡ºã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;bustub&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;EXPLAIN&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;SELECT&lt;/span&gt; colA &lt;span style=&#34;color:#66d9ef&#34;&gt;FROM&lt;/span&gt; __mock_table_1;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt; BINDER &lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;BoundSelect &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;table&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;BoundBaseTableRef &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;table&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;__mock_table_1, oid&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  columns&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;[__mock_table_1.colA],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  groupBy&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;[],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;having&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;where&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;limit&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;offset&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  order_by&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;[],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  is_distinct&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ctes&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt; PLANNER &lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Projection &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt; exprs&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;[&lt;span style=&#34;color:#f92672&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; (__mock_table_1.colA:INTEGER)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  MockScan &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;table&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;__mock_table_1 &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; (__mock_table_1.colA:INTEGER, __mock_table_1.colB:INTEGER)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt; OPTIMIZER &lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Projection &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt; exprs&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;[&lt;span style=&#34;color:#f92672&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; (__mock_table_1.colA:INTEGER)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  MockScan &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;table&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;__mock_table_1 &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; (__mock_table_1.colA:INTEGER, __mock_table_1.colB:INTEGER)bustub&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;EXPLAIN&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;SELECT&lt;/span&gt; colA &lt;span style=&#34;color:#66d9ef&#34;&gt;FROM&lt;/span&gt; __mock_table_1;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;bustub&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;EXPLAIN&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;SELECT&lt;/span&gt; colA &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; colB &lt;span style=&#34;color:#66d9ef&#34;&gt;AS&lt;/span&gt; a, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;AS&lt;/span&gt; b &lt;span style=&#34;color:#66d9ef&#34;&gt;FROM&lt;/span&gt; __mock_table_1;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt; BINDER &lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;BoundSelect &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;table&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;BoundBaseTableRef &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;table&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;__mock_table_1, oid&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  columns&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;[((__mock_table_1.colA&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;__mock_table_1.colB) &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; a), ((&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;) &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; b)],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  groupBy&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;[],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;having&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;where&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;limit&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;offset&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  order_by&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;[],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  is_distinct&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ctes&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt; PLANNER &lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Projection &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt; exprs&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;[(&lt;span style=&#34;color:#f92672&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;), (&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;)] &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; (a:INTEGER, b:INTEGER)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  MockScan &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;table&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;__mock_table_1 &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; (__mock_table_1.colA:INTEGER, __mock_table_1.colB:INTEGER)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt; OPTIMIZER &lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Projection &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt; exprs&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;[(&lt;span style=&#34;color:#f92672&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;), (&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;)] &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; (a:INTEGER, b:INTEGER)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  MockScan &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;table&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;__mock_table_1 &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; (__mock_table_1.colA:INTEGER, __mock_table_1.colB:INTEGER)bustub&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;EXPLAIN&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;SELECT&lt;/span&gt; colA &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; colB &lt;span style=&#34;color:#66d9ef&#34;&gt;AS&lt;/span&gt; a, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;AS&lt;/span&gt; b &lt;span style=&#34;color:#66d9ef&#34;&gt;FROM&lt;/span&gt; __mock_table_1;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Projectionæœ‰ä¸‰ç§è¾“å‡ºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;ColumnValueExpression&lt;/code&gt;: directly places a column of the child executor to the output. The syntax &lt;code&gt;#0.0&lt;/code&gt; means the first column in the first child. You will see something like &lt;code&gt;#0.0 = #1.0&lt;/code&gt;ï¼ˆç¬¬ä¸€ä¸ªå­—èŠ‚ç‚¹çš„ç¬¬ä¸€åˆ—ç­‰äºç¬¬äºŒä¸ªå­ç»“ç‚¹çš„ç¬¬äºŒåˆ—ï¼‰ in a plan for joins.(ç›´æ¥è¾“å‡ºå­ç»“ç‚¹çš„ä¸€ä¸ªåˆ—)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ConstantExpression&lt;/code&gt;: represents a constant value (è¾“å‡ºå¸¸é‡).&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ArithmeticExpression&lt;/code&gt;: a tree representing an arithmetic computation. For example, &lt;code&gt;1 + 2&lt;/code&gt; would be represented by an &lt;code&gt;ArithmeticExpression&lt;/code&gt; with two &lt;code&gt;ConstantExpression&lt;/code&gt; (&lt;code&gt;1&lt;/code&gt; and &lt;code&gt;2&lt;/code&gt;) as children.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Projectionçš„NEXT()å®ç°å¾ˆç®€å•&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c++&#34; data-lang=&#34;c++&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; ProjectionExecutor&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;Next(Tuple &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;tuple, RID &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;rid) &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  Tuple child_tuple{};
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;// Get the next tuple
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; status &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; child_executor_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;Next(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;child_tuple, rid);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;status) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; false;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;// Compute expressions
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;vector&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;Value&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; values{};
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  values.reserve(GetOutputSchema().GetColumnCount());
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;expr : plan_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetExpressions()) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    values.push_back(expr&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;Evaluate(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;child_tuple, child_executor_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetOutputSchema()));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;tuple &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Tuple{values, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;GetOutputSchema()};
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; true;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é¦–å…ˆä»å­æ‰§è¡Œå™¨è·å–ä¸‹ä¸€ä¸ªtuple,ç„¶åæ ¹æ®è¾“å‡ºschemaç”³è¯·å¯¹åº”å¤§å°(æœ‰å¤šå°‘åˆ—)çš„Valueå‘é‡ç”¨äºè¾“å‡ºã€‚ï¼Œæ¥ä¸‹æ¥éå†&lt;code&gt;ProjectionPlanNode&lt;/code&gt;ä¸­çš„&lt;code&gt;expressions_&lt;/code&gt;,è¿™äº›expressionå°±æ˜¯åœ¨0x01ä¸­æåˆ°è¿‡çš„ï¼Œç”¨äºè¡¨ç¤ºè¾“å‡ºçš„è¡¨è¾¾å¼ã€‚æ¥ä¸‹æ¥ç”Ÿæˆä¸€ä¸ªæ–°çš„Value&lt;code&gt;expr-&amp;gt;Evaluate(&amp;amp;child_tuple, child_executor_-&amp;gt;GetOutputSchema())&lt;/code&gt;,é€šè¿‡Expressionçš„Evaluateæ–¹æ³•ï¼Œä»£å…¥å¯¹åº”çš„Schemaå’Œtupleï¼Œè®¡ç®—å‡ºä¸€ä¸ªå€¼ã€‚è®¡ç®—å‡ºæ‰€æœ‰Valueåï¼Œé€šè¿‡Valueå’ŒSchemaç”Ÿæˆä¸€ä¸ªtuple&lt;code&gt;*tuple = Tuple{values, &amp;amp;GetOutputSchema()};&lt;/code&gt;ã€‚ç„¶åè¿”å›true,Nextæ–¹æ³•ç»“æŸã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;expr : plan_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetExpressions()) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    values.push_back(expr&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;Evaluate(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;child_tuple, child_executor_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetOutputSchema()));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨è¿™å¥ä¸­ï¼Œå¯¹äºConstantValueExpressionï¼Œè¿”å›æ˜¯å¸¸é‡ï¼Œchild_tupleå¯¹äºè¾“å‡ºæ²¡æœ‰å½±å“ã€‚å¯¹äºcolumn_value,&lt;code&gt;ColumnValueExpression&lt;/code&gt;ç±»ä¸­åœ¨åˆ›å»ºæ—¶æœ‰ä¸€ä¸ªå±æ€§ï¼šcol_idx_ï¼Œå¯ä»¥çŸ¥é“æ˜¯ç¬¬å‡ åˆ—ï¼Œä»è€Œè°ƒç”¨&lt;code&gt;tuple-&amp;gt;GetValue(&amp;amp;schema, col_idx_)&lt;/code&gt;å¾—å‡ºç»“æœã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Evaluate&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; Tuple &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;tuple, &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; Schema &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;schema) &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt; Value &lt;span style=&#34;color:#66d9ef&#34;&gt;override&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; tuple&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetValue(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;schema, col_idx_);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;0x03-filter&#34;&gt;0x03 Filter&lt;/h3&gt;
&lt;p&gt;A &lt;strong&gt;filter&lt;/strong&gt; plan node is used to filter the output of a child using a given predicate. For example,&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;EXPLAIN SELECT * FROM __mock_table_1 WHERE colA &amp;gt; 1;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;A filter plan node has exactly one child and contains a predicate.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¹‹å‰æˆ‘ä¸€ç›´æŠŠpredicateè®°æ··æˆpredictäº†ï¼Œç°åœ¨æ‰å‘ç°predicateæ˜¯ä»€ä¹ˆæ„æ€ğŸ˜‚&lt;/li&gt;
&lt;li&gt;predicateæ˜¯ï¼ˆæ–­è¨€/è°“è¯­ï¼‰ï¼Œæ¯”å¦‚&lt;em&gt;Frank likes cake&lt;/em&gt;ä¸­çš„è°“è¯­å¯ä»¥æ˜¯ä»¥ä¸‹ä¸¤ç§æƒ…å†µ
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;likes cake&lt;/em&gt;æ˜¯è°“è¯­ï¼ŒFrankæ˜¯å‚æ•°&lt;/li&gt;
&lt;li&gt;&lt;em&gt;likes&lt;/em&gt;æ˜¯è°“è¯­ï¼Œ&lt;em&gt;Frank&lt;/em&gt;å’Œ&lt;em&gt;cake&lt;/em&gt;æ˜¯å‚æ•°&lt;/li&gt;
&lt;li&gt;ä¸ç®¡æ€ä¹ˆæ ·ï¼Œè°“è¯­éƒ½å¯èƒ½æ˜¯çœŸæˆ–å‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;FilterPlanNode&lt;/strong&gt;è¿”å›æ»¡è¶³predicateä¸ºçœŸçš„tupleã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; FilterExecutor&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;Next(Tuple &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;tuple, RID &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;rid) &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; filter_expr &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; plan_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetPredicate();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt; (true) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// Get the next tuple
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; status &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; child_executor_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;Next(tuple, rid);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;status) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; false;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; value &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; filter_expr&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;Evaluate(tuple, child_executor_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetOutputSchema()); &lt;span style=&#34;color:#75715e&#34;&gt;// åˆ¤æ–­æ–­è¨€çš„å€¼
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;value.IsNull() &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; value.GetAs&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;()) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; true;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;0x04-value&#34;&gt;0x04 Value&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;The ValuesPlanNode represents rows of values. For example,&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;INSERT INTO table VALUES ((0, 1), (1, 2))&lt;/code&gt;, where we will have&lt;code&gt;(0, 1)&lt;/code&gt; and &lt;code&gt;(1, 2)&lt;/code&gt; as the output of this executor.&lt;/li&gt;
&lt;li&gt;ä¹Ÿå°±æ˜¯è¯´ï¼Œschemaæ˜¯ï¼ˆint,intï¼‰ï¼Œç„¶åè¿™ä¸ªä¾‹å­æœ‰ä¸¤è¡Œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¯ä»¥çœ‹å‡ºVALUEçš„NEXT()æ ¹æ®schemaè¾“å‡ºä¸€è¡Œï¼Œç„¶åé€šè¿‡æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€è¡Œã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;bustub&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;EXPLAIN&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;values&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;a&amp;#39;&lt;/span&gt;), (&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;b&amp;#39;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt; BINDER &lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;BoundSelect &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;table&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;BoundExpressionListRef &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt; identifier&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;__values&lt;span style=&#34;color:#f92672&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;values&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;[[&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, a], [&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;, b]] &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  columns&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;[__values&lt;span style=&#34;color:#f92672&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, __values&lt;span style=&#34;color:#f92672&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, __values&lt;span style=&#34;color:#f92672&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  groupBy&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;[],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;having&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;where&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;limit&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;offset&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  order_by&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;[],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  is_distinct&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ctes&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt; PLANNER &lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Projection &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt; exprs&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;[&lt;span style=&#34;color:#f92672&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;] &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; (__values&lt;span style=&#34;color:#f92672&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;:INTEGER, __values&lt;span style=&#34;color:#f92672&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;:INTEGER, __values&lt;span style=&#34;color:#f92672&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;:VARCHAR)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;Values&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;rows&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; (__values&lt;span style=&#34;color:#f92672&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;:INTEGER, __values&lt;span style=&#34;color:#f92672&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;:INTEGER, __values&lt;span style=&#34;color:#f92672&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;:VARCHAR)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt; OPTIMIZER &lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;Values&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;rows&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; (__values&lt;span style=&#34;color:#f92672&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;:INTEGER, __values&lt;span style=&#34;color:#f92672&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;:INTEGER, __values&lt;span style=&#34;color:#f92672&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;:VARCHAR)bustub&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;EXPLAIN&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;values&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;a&amp;#39;&lt;/span&gt;), (&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;b&amp;#39;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;bustub&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;EXPLAIN&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;INSERT&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;INTO&lt;/span&gt; table1 &lt;span style=&#34;color:#66d9ef&#34;&gt;VALUES&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;a&amp;#39;&lt;/span&gt;), (&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;b&amp;#39;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt; BINDER &lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;BoundInsert &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;table&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;BoundBaseTableRef &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;table&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;table1, oid&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;22&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;select&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;  BoundSelect &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;table&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;BoundExpressionListRef &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt; identifier&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;__values&lt;span style=&#34;color:#f92672&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;values&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;[[&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, a], [&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;, b]] &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    columns&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;[__values&lt;span style=&#34;color:#f92672&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, __values&lt;span style=&#34;color:#f92672&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, __values&lt;span style=&#34;color:#f92672&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    groupBy&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;[],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;having&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;where&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;limit&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;offset&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    order_by&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;[],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    is_distinct&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ctes&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt; PLANNER &lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;Insert&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt; table_oid&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;22&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; (__bustub_internal.insert_rows:INTEGER)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  Projection &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt; exprs&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;[&lt;span style=&#34;color:#f92672&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;] &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; (__values&lt;span style=&#34;color:#f92672&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;:INTEGER, __values&lt;span style=&#34;color:#f92672&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;:INTEGER, __values&lt;span style=&#34;color:#f92672&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;:VARCHAR)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;Values&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;rows&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; (__values&lt;span style=&#34;color:#f92672&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;:INTEGER, __values&lt;span style=&#34;color:#f92672&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;:INTEGER, __values&lt;span style=&#34;color:#f92672&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;:VARCHAR)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt; OPTIMIZER &lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;Insert&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt; table_oid&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;22&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; (__bustub_internal.insert_rows:INTEGER)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;Values&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;rows&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; (__values&lt;span style=&#34;color:#f92672&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;:INTEGER, __values&lt;span style=&#34;color:#f92672&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;:INTEGER, __values&lt;span style=&#34;color:#f92672&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;:VARCHAR)bustub&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;EXPLAIN&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;INSERT&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;INTO&lt;/span&gt; table1 &lt;span style=&#34;color:#66d9ef&#34;&gt;VALUES&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;a&amp;#39;&lt;/span&gt;), (&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;b&amp;#39;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Valueç”¨äºç›´æ¥æä¾›å€¼ã€‚&lt;/p&gt;
&lt;p&gt;Value Planä¸­æœ‰ç”¨äºè¡¨ç¤ºå€¼çš„è¡¨è¾¾å¼ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;std::vector&amp;lt;std::vector&amp;lt;AbstractExpressionRef&amp;gt;&amp;gt; values_;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æœ€å¤–å±‚vectoræ˜¯è¡Œçš„å‘é‡ï¼Œä¸­é—´çš„&lt;code&gt;std::vector&amp;lt;AbstractExpressionRef&amp;gt;&lt;/code&gt;æ˜¯ä¸€è¡Œä¸­çš„è¡¨è¾¾å¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œvalue planä¸­æœ‰å¤šè¡Œç­‰å¾…è½¬æ¢çš„æ•°æ®ï¼Œæ¯ä¸€è¡Œæ•°æ®æœ‰å¤šä¸ªè¡¨è¾¾å¼ï¼ˆåˆ—ï¼‰ç»„æˆã€‚value_executorè´Ÿè´£æ¯æ¬¡å–&lt;code&gt;values_&lt;/code&gt;çš„ä¸€è¡Œï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºtupleğŸ”,ç„¶åè¾“å‡ºã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; ValuesExecutor&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;Next(Tuple &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;tuple, RID &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;rid) &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (cursor_ &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;=&lt;/span&gt; plan_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetValues().size()) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; false;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;vector&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;Value&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; values{};
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  values.reserve(GetOutputSchema().GetColumnCount());
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;row_expr &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; plan_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetValues()[cursor_]; &lt;span style=&#34;color:#75715e&#34;&gt;// è·å–æŒ‡é’ˆæŒ‡å‘çš„è¡Œ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;col : row_expr) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    values.push_back(col&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;Evaluate(&lt;span style=&#34;color:#66d9ef&#34;&gt;nullptr&lt;/span&gt;, dummy_schema_)); &lt;span style=&#34;color:#75715e&#34;&gt;// è®¡ç®—æ¯åˆ—çš„å€¼
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;tuple &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Tuple{values, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;GetOutputSchema()}; &lt;span style=&#34;color:#75715e&#34;&gt;// å°†ä¸€è¡Œå€¼è½¬æ¢ä¸ºtuple
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  cursor_ &lt;span style=&#34;color:#f92672&#34;&gt;+=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;// æŒ‡å‘ä¸‹ä¸€è¡Œ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; true;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;0x05-å¦‚ä½•é€šè¿‡clionç•Œé¢è°ƒè¯•&#34;&gt;0x05 å¦‚ä½•é€šè¿‡Clionç•Œé¢è°ƒè¯•ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;è¿™é‡Œä»‹ç»ä¸€ä¸‹p3çš„è°ƒè¯•æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æ„å»ºå¥½é¡¹ç›®åï¼Œåº”è¯¥å‡ºç°æœ‰å¯¹åº”çš„æµ‹è¯•é¡¹ç›®&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/database/query_execution/blogimage-20230530230247883.png&#34;
	width=&#34;901&#34;
	height=&#34;520&#34;
	srcset=&#34;https://antio2.cn/tech/database/query_execution/blogimage-20230530230247883_hu22d28417e146b94a80560161bd1a3053_103133_480x0_resize_box_3.png 480w, https://antio2.cn/tech/database/query_execution/blogimage-20230530230247883_hu22d28417e146b94a80560161bd1a3053_103133_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20230530230247883&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;173&#34;
		data-flex-basis=&#34;415px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;ç„¶åç¼–è¾‘é…ç½®ï¼Œè¿™é‡Œé€‰æ‹©ç›®æ ‡æ–‡ä»¶ï¼Œç„¶åå¡«å†™å®å‚ä¸ºå¯¹åº”çš„sltæ–‡ä»¶å°±è¡Œã€‚æ³¨æ„ä½¿ç”¨ç»å¯¹è·¯å¾„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/database/query_execution/blogimage-20230530230435509.png&#34;
	width=&#34;1053&#34;
	height=&#34;672&#34;
	srcset=&#34;https://antio2.cn/tech/database/query_execution/blogimage-20230530230435509_hu859165163438f3896f45b71e91e20429_123645_480x0_resize_box_3.png 480w, https://antio2.cn/tech/database/query_execution/blogimage-20230530230435509_hu859165163438f3896f45b71e91e20429_123645_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20230530230435509&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;156&#34;
		data-flex-basis=&#34;376px&#34;
	
&gt;&lt;/p&gt;
&lt;h2 id=&#34;0x10-å­˜å–æ–¹æ³•æ‰§è¡Œå™¨&#34;&gt;0x10 å­˜å–æ–¹æ³•æ‰§è¡Œå™¨&lt;/h2&gt;
&lt;p&gt;éœ€è¦å®Œæˆåœ¨é˜…è¯»æˆ–å†™å­˜å‚¨è¡¨çš„æ‰§è¡Œå™¨ã€‚&lt;/p&gt;
&lt;h3 id=&#34;0x11-seqscan&#34;&gt;0x11 SeqScan&lt;/h3&gt;
&lt;p&gt;SeqScanè´Ÿè´£å¤„ç†&lt;code&gt;SELECT * from table&lt;/code&gt;ï¼Œé€šè¿‡è¿­ä»£æ•´ä¸ªtable,å¹¶ä¸€ä¸ªä¸ªè¿”å›å®ƒçš„tupleã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆçœ‹SeqScanPlançš„æ„é€ å™¨&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;SeqScanPlanNode(SchemaRef output, table_oid_t table_oid, std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;string table_name,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                AbstractExpressionRef filter_predicate &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nullptr&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; AbstractPlanNode(std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;move(output), {}),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      table_oid_{table_oid},
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      table_name_(std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;move(table_name)),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      filter_predicate_(std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;move(filter_predicate)) {}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ„é€ éœ€è¦è¾“å‡ºçš„Schema,æ ‡è¯†tableçš„oid,table_name,å’Œä¸€ä¸ªè¡¨è¾¾å¼predicateï¼Œåœ¨ä¸ä½¿ç”¨MergeFilterScanæ—¶ï¼Œè¯¥predicateå§‹ç»ˆä¸ºç©ºã€‚è¯¥PlanèŠ‚ç‚¹æ²¡æœ‰å­èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡ Catalogä¸­çš„&lt;code&gt;GetTable(table_oid_t table_oid)&lt;/code&gt;ï¼Œå¯ä»¥è·å–åˆ°å¯¹åº”table_infoã€‚è€Œcatalogåœ¨exec_ctxä¸­ã€‚&lt;/p&gt;
&lt;p&gt;æ•…&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; SeqScanExecutor&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;Init() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  tableInfo_  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; exec_ctx_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetCatalog()&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetTable(plan_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetTableOid());
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€šè¿‡æŸ¥çœ‹æºæ–‡ä»¶ï¼Œå¯ä»¥çŸ¥é“TableHeapç±»ä¸­å¯ä»¥è·å–tuple&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;/**
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;   * Read a tuple from the table.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;   * @param rid rid of the tuple to read
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;   * @param tuple output variable for the tuple
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;   * @param txn transaction performing the read
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;   * @return true if the read was successful (i.e. the tuple exists)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;   */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;GetTuple&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; RID &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;rid, Tuple &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;tuple, Transaction &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;txn) &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´åƒè¿™æ ·å°±èƒ½è·å–åˆ°æŒ‡å®šRIDçš„tuple&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;tableInfo_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;table_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetTuple(&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;rid,tuple, exec_ctx_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetTransaction());
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é‚£ä¹ˆè·å–äº†æŒ‡å®šçš„RIDï¼ˆé€šè¿‡æŒ‡é’ˆï¼‰ï¼Œå°±èƒ½å¾ˆè½»æ¾åœ°å®ç°è·å–tuple&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; SeqScanExecutor&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;Init() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  tableInfo_  &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; exec_ctx_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetCatalog()&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetTable(plan_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetTableOid());
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  table_iter_ &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;  tableInfo_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;table_.get()&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;Begin(exec_ctx_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetTransaction());
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; SeqScanExecutor&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;Next(Tuple &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;tuple, RID &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;rid) &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(table_iter_&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;tableInfo_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;table_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;End()) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; false;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;rid &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; table_iter_&lt;span style=&#34;color:#f92672&#34;&gt;++-&amp;gt;&lt;/span&gt;GetRid();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; tableInfo_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;table_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetTuple(&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;rid,tuple, exec_ctx_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetTransaction());
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;0x12-insert&#34;&gt;0x12 Insert&lt;/h3&gt;
&lt;p&gt;Insertçš„æ‰§è¡Œå™¨æ¯”è¾ƒæ€ªã€‚å…·ä½“çœ‹ä¸€ä¸‹å°±æ‡‚äº†ã€‚Nextè¿”å›çš„tupleæ˜¯ä¸€ä¸ªæ•´æ•°ï¼ŒæŒ‡ç¤ºæ’å…¥äº†å¤šå°‘è¡Œã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;bustub&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; insert into test_simple_seq_1 values (&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;),(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;),(&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ˜¾ç¤º&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;__bustub_internal.insert_rows&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;bustub&amp;gt; explain insert into test_simple_seq_2 values &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;1,2&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;,&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;3,4&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;,&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;5,6&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt; BINDER &lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;BoundInsert &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  table&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;BoundBaseTableRef &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt; table&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;test_simple_seq_2, oid&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;19&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;select&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;  BoundSelect &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    table&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;BoundExpressionListRef &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt; identifier&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;__values#0, values&lt;span style=&#34;color:#f92672&#34;&gt;=[[&lt;/span&gt;1, 2&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;3, 4&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;5, 6&lt;span style=&#34;color:#f92672&#34;&gt;]]&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    columns&lt;span style=&#34;color:#f92672&#34;&gt;=[&lt;/span&gt;__values#0.0, __values#0.1&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    groupBy&lt;span style=&#34;color:#f92672&#34;&gt;=[]&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    having&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    where&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    limit&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    offset&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    order_by&lt;span style=&#34;color:#f92672&#34;&gt;=[]&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    is_distinct&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;false,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ctes&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt; PLANNER &lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Insert &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt; table_oid&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;19&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt; | &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;__bustub_internal.insert_rows:INTEGER&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  Projection &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt; exprs&lt;span style=&#34;color:#f92672&#34;&gt;=[&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#0.0, #0.1] } | (__values#0.0:INTEGER, __values#0.1:INTEGER)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Values &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt; rows&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt; | &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;__values#0.0:INTEGER, __values#0.1:INTEGER&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt; OPTIMIZER &lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Insert &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt; table_oid&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;19&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt; | &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;__bustub_internal.insert_rows:INTEGER&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  Values &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt; rows&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt; | &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;__values#0.0:INTEGER, __values#0.1:INTEGER&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;bustub&amp;gt; explain insert into test_simple_seq_2 values &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;1,2&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;,&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;3,4&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;,&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;5,6&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ³¨æ„æ¯æ¬¡å–å‡ºä¸€ä¸ªtupleæ’å…¥åï¼Œè¿˜è¦é€šè¿‡&lt;code&gt; exec_ctx_-&amp;gt;GetCatalog()-&amp;gt;GetTableIndexes(table_info_-&amp;gt;name_);&lt;/code&gt;è°ƒç”¨æ‰€æœ‰çš„ç´¢å¼•ï¼Œç„¶åè¿›è¡Œç´¢å¼•çš„æ’å…¥ã€‚&lt;/p&gt;
&lt;h3 id=&#34;0x13-delete&#34;&gt;0x13 Delete&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;delete node&lt;/code&gt;å’Œ&lt;code&gt;insert node&lt;/code&gt;ç›¸ä¼¼ï¼Œéƒ½æ˜¯é€šè¿‡&lt;code&gt;child_node&lt;/code&gt;è·å–tupleï¼Œç„¶åæ„é€ ä¸€ä¸ªåªæœ‰æ•´æ•°çš„tupleï¼ŒæŒ‡ç¤ºæ“ä½œçš„è¡Œæ•°ã€‚å¹¶ä¸”æ›´æ–°ç´¢å¼•ã€‚é€šè¿‡è§£é‡Šå™¨å°±èƒ½å¾ˆç®€å•çœ‹å‡ºæ¥æ˜¯æ€ä¹ˆåšçš„äº†&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;bustub&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; EXPLAIN &lt;span style=&#34;color:#66d9ef&#34;&gt;delete&lt;/span&gt; from test_2 where colA &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; colB;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt; BINDER &lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Delete { table&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;BoundBaseTableRef { table&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;test_2, oid&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;21&lt;/span&gt; }, expr&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;(test_2.colA&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;test_2.colB) }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt; PLANNER &lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Delete { table_oid&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;21&lt;/span&gt; } &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; (__bustub_internal.delete_rows:INTEGER)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  Filter { predicate&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;(&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0.0&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0.1&lt;/span&gt;) } &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; (test_2.colA:INTEGER, test_2.colB:INTEGER, test_2.colC:INTEGER)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    SeqScan { table&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;test_2 } &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; (test_2.colA:INTEGER, test_2.colB:INTEGER, test_2.colC:INTEGER)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt; OPTIMIZER &lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Delete { table_oid&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;21&lt;/span&gt; } &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; (__bustub_internal.delete_rows:INTEGER)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  SeqScan { table&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;test_2, filter&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;(&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0.0&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0.1&lt;/span&gt;) } &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; (test_2.colA:INTEGER, test_2.colB:INTEGER, test_2.colC:INTEGER)bustub&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; EXPLAIN &lt;span style=&#34;color:#66d9ef&#34;&gt;delete&lt;/span&gt; from test_2 where colA &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; colB... ;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿˜æ˜¯è¦è®°ä½åˆ é™¤ç´¢å¼•&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; index:indexes) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      index&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;index_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;DeleteEntry(
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          next_tuple.KeyFromTuple(
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              table_info_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;schema_,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              index&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;key_schema_,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              index&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;index_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetKeyAttrs()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              ), next_rid,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          exec_ctx_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetTransaction()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          );
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;0x14-indexscan&#34;&gt;0x14 IndexScan&lt;/h3&gt;
&lt;p&gt;é€šè¿‡ç´¢å¼•æŸ¥è¯¢æ‰€æœ‰ï¼ŒçŸ¥é“æ€ä¹ˆé€šè¿‡ç´¢å¼•è·å–RIDå°±å¯ä»¥å®ç°äº†&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; IndexScanExecutor&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;Init() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  index_info_ &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; exec_ctx_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetCatalog()&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetIndex(plan_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;index_oid_);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  table_info_ &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; exec_ctx_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetCatalog()&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetTable(index_info_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;table_name_);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  tree_ &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;dynamic_cast&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;BPlusTreeIndexForOneIntegerColumn &lt;span style=&#34;color:#f92672&#34;&gt;*&amp;gt;&lt;/span&gt;(index_info_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;index_.get());
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  BPlusTreeIndexIteratorForOneIntegerColumn iterator &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; tree_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetBeginIterator();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt;(iterator&lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt;tree_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetEndIterator()) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    rids_.emplace_back((&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;iterator).second);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;0x20-aggregation--join-executors&#34;&gt;0x20 Aggregation &amp;amp; Join Executors&lt;/h2&gt;
&lt;h3 id=&#34;0x21aggregation&#34;&gt;0x21Aggregation&lt;/h3&gt;
&lt;p&gt;å®ç°èšåˆæ“ä½œï¼Œæ¯”å¦‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;EXPLAIN&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;SELECT&lt;/span&gt; colA, &lt;span style=&#34;color:#66d9ef&#34;&gt;MIN&lt;/span&gt;(colB) &lt;span style=&#34;color:#66d9ef&#34;&gt;FROM&lt;/span&gt; __mock_table_1 &lt;span style=&#34;color:#66d9ef&#34;&gt;GROUP&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;BY&lt;/span&gt; colA;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;EXPLAIN&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;COUNT&lt;/span&gt;(colA), &lt;span style=&#34;color:#66d9ef&#34;&gt;min&lt;/span&gt;(colB) &lt;span style=&#34;color:#66d9ef&#34;&gt;FROM&lt;/span&gt; __mock_table_1;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;EXPLAIN&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;SELECT&lt;/span&gt; colA, &lt;span style=&#34;color:#66d9ef&#34;&gt;MIN&lt;/span&gt;(colB) &lt;span style=&#34;color:#66d9ef&#34;&gt;FROM&lt;/span&gt; __mock_table_1 &lt;span style=&#34;color:#66d9ef&#34;&gt;GROUP&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;BY&lt;/span&gt; colA &lt;span style=&#34;color:#66d9ef&#34;&gt;HAVING&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;MAX&lt;/span&gt;(colB) &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;EXPLAIN&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;DISTINCT&lt;/span&gt; colA, colB &lt;span style=&#34;color:#66d9ef&#34;&gt;FROM&lt;/span&gt; __mock_table_1;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘è®¤ä¸ºä¸€ä¸ªæœ‰ä»£è¡¨æ€§çš„sqlè¯­å¥æ˜¯&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;bustub&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;EXPLAIN&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;MIN&lt;/span&gt;(colB),colA &lt;span style=&#34;color:#66d9ef&#34;&gt;FROM&lt;/span&gt; __mock_table_1 &lt;span style=&#34;color:#66d9ef&#34;&gt;GROUP&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;BY&lt;/span&gt; colA &lt;span style=&#34;color:#66d9ef&#34;&gt;HAVING&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;MAX&lt;/span&gt;(colB) &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt; PLANNER &lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Projection &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt; exprs&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;[&lt;span style=&#34;color:#f92672&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; (&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;unnamed&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;:INTEGER, __mock_table_1.colA:INTEGER)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  Filter &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt; predicate&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;) &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; (__mock_table_1.colA:INTEGER, agg&lt;span style=&#34;color:#f92672&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;:INTEGER, agg&lt;span style=&#34;color:#f92672&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;:INTEGER)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Agg &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt; types&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;[&lt;span style=&#34;color:#66d9ef&#34;&gt;max&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;min&lt;/span&gt;], aggregates&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;[&lt;span style=&#34;color:#f92672&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;], group_by&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;[&lt;span style=&#34;color:#f92672&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; (__mock_table_1.colA:INTEGER, agg&lt;span style=&#34;color:#f92672&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;:INTEGER, agg&lt;span style=&#34;color:#f92672&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;:INTEGER)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      MockScan &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;table&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;__mock_table_1 &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; (__mock_table_1.colA:INTEGER, __mock_table_1.colB:INTEGER)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ€ç»ˆselectçš„æœ‰&lt;code&gt;MIN(colB),colA&lt;/code&gt;,ä½†æ˜¯HAVINGä½¿ç”¨èšåˆå‡½æ•°MAX,æ•…Aggæ‰§è¡Œå™¨ä¸­éœ€è¦ç®—ä¸¤ä¸ªèšåˆå€¼ï¼šmax(colB)å’Œmin(colB),Aggè¾“å‡ºçš„schemaä¸­æœ‰&lt;code&gt;(__mock_table_1.colA:INTEGER, agg#0:INTEGER, agg#1:INTEGER)&lt;/code&gt;,å…¶ä¸­&lt;code&gt;agg#0:INTEGER&lt;/code&gt;ä¹Ÿå°±æ˜¯&lt;code&gt;max&lt;/code&gt;ç”¨äºç»™è¿‡æ»¤ç®—å­è¿‡æ»¤ã€‚&lt;/p&gt;
&lt;p&gt;ä¹Ÿå³æ˜¯è¯´ï¼Œæ¯æ¬¡Aggå‡½æ•°çš„nextè¾“å‡ºè¿™æ ·ä¸€ä¸ªschema: &lt;strong&gt;ç”¨äºåˆ†ç»„çš„åˆ—ï¼Œä»¥åŠéœ€è¦çš„èšåˆå‡½æ•°çš„å€¼&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;bustub&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;EXPLAIN&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;DISTINCT&lt;/span&gt; colA, colB &lt;span style=&#34;color:#66d9ef&#34;&gt;FROM&lt;/span&gt; __mock_table_1;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt; OPTIMIZER &lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Agg &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt; types&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;[], aggregates&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;[], group_by&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;[&lt;span style=&#34;color:#f92672&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;#&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;] &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; (__mock_table_1.colA:INTEGER, __mock_table_1.colB:INTEGER)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  MockScan &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;table&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;__mock_table_1 &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; (__mock_table_1.colA:INTEGER, __mock_table_1.colB:INTEGER)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;DISTINCT&lt;/code&gt;è¢«è®¡åˆ’ä¸ºgroup_by,è¾“å‡ºä¸¤ä¸ªç”¨äºè¢«åˆ†ç»„çš„åˆ—ã€‚&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆå¦‚ä½•å®ç°å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;åœ¨è¯¾ç¨‹ä¸­ï¼Œèšåˆæœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼šæ’åºå’Œå“ˆå¸Œã€‚æ’åºæ˜¯å…ˆå°†æŒ‡å®šåˆ—æ’åºï¼Œç„¶åå°±èƒ½é€‰å‡ºç‹¬ç‰¹å€¼ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿™é‡Œï¼Œä½¿ç”¨å“ˆå¸Œæ–¹æ³•ã€‚ä¹Ÿå°±æ˜¯è¯´è¯­å¥ä¸éœ€è¦&lt;code&gt;SORT&lt;/code&gt;çš„æƒ…å†µï¼Œç”¨å“ˆå¸Œæ›´å¥½ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;We provide you with the &lt;code&gt;SimpleAggregationHashTable&lt;/code&gt; data structure that exposes an in-memory hash table (&lt;code&gt;std::unordered_map&lt;/code&gt;) but with an interface designed for computing aggregations. This class also exposes the &lt;code&gt;SimpleAggregationHashTable::Iterator&lt;/code&gt; type that can be used to iterate through the hash table. You will need to fill out the &lt;code&gt;CombineAggregateValues&lt;/code&gt; function for this class.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;é¡¹ç›®å‡å®šäº†å“ˆå¸Œè¡¨ä¸ä¼šæº¢å‡ºå†…å­˜ï¼Œç„¶åæä¾›äº†&lt;code&gt;SimpleAggregationHashTable&lt;/code&gt;ä½œä¸ºå“ˆå¸Œè¡¨ï¼Œå¹¶ç»™äº†ä¸€ä¸ªè¿­ä»£å™¨ç”¨äºéå†æ‰€æœ‰å€¼ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºæ¯ä¸€ä¸ª&lt;code&gt;tuple&lt;/code&gt;ï¼Œæ£€æŸ¥å®ƒçš„ &lt;code&gt;entry&lt;/code&gt;ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œé‚£ä¹ˆåŠ å…¥å“ˆå¸Œè¡¨ã€‚å¦‚æœå·²ç»å­˜åœ¨ï¼Œé‚£ä¹ˆæœ‰ä¸¤ç§æƒ…å†µ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Duplicate:ç›´æ¥ä¸¢å¼ƒ&lt;/li&gt;
&lt;li&gt;Group by:æ‰§è¡Œ&lt;code&gt;aggregate computation&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ¥ä¸‹æ¥å®ç°&lt;code&gt;class SimpleAggregationHashTable &lt;/code&gt;ä¸­çš„&lt;code&gt;CombineAggregateValues&lt;/code&gt;ï¼ˆåœ¨&lt;code&gt;src\include\execution\executors\aggregation_executor.h&lt;/code&gt;é‡Œé¢ï¼‰ï¼Œè¿™ä¸ªå‡½æ•°æ˜¯è¢«&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c++&#34; data-lang=&#34;c++&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;InsertCombine&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; AggregateKey &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;agg_key, &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; AggregateValue &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;agg_val) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (ht_.count(agg_key) &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      ht_.insert({agg_key, GenerateInitialAggregateValue()});
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    CombineAggregateValues(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;ht_[agg_key], agg_val);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™æ ·è°ƒç”¨çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºæ¯ä¸ªtuple,å…ˆæ‰¾å‡ºå®ƒçš„&lt;code&gt;agg_key&lt;/code&gt;ä½œä¸ºå“ˆå¸Œè¡¨çš„keyï¼Œå¦‚æœå“ˆå¸Œè¡¨ä¸­æ²¡æœ‰è¿™ä¸ªkeyï¼Œå°±å…ˆåˆå§‹åŒ–ã€‚ç„¶åå°†éœ€è¦èšåˆçš„å€¼æ’å…¥åˆ°å“ˆå¸Œè¡¨ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;count(*)æ˜¯æœ€å¥½å†™çš„ï¼Œæ¯æ¬¡+1å°±è¡Œ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; AggregationType::CountStarAggregate:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;result&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;aggregates_.&lt;span style=&#34;color:#66d9ef&#34;&gt;at&lt;/span&gt;(i).&lt;span style=&#34;color:#66d9ef&#34;&gt;Add&lt;/span&gt;(ValueFactory::GetIntegerValue(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          break;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åæ˜¯count(column)ï¼Œéœ€è¦åˆ¤æ–­æ˜¯å¦æ˜¯null&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; AggregationType&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;CountAggregate:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(input.aggregates_.at(i).IsNull()) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#66d9ef&#34;&gt;break&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(result&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;aggregates_.at(i).IsNull()) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  result&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;aggregates_.at(i)&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;ValueFactory&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;GetIntegerValue(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                } &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  result&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;aggregates_.at(i).Add(ValueFactory&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;GetIntegerValue(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#66d9ef&#34;&gt;break&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          }
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¥ä¸‹æ¥çš„Sum,Min,Maxå°±ä¸å†èµ˜è¿°äº†&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; AggregationType&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;MinAggregate:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(input.aggregates_.at(i).IsNull()) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#66d9ef&#34;&gt;break&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(result&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;aggregates_.at(i).IsNull()) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  result&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;aggregates_.at(i)&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;input.aggregates_.at(i);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;((input.aggregates_.at(i).CompareLessThan(result&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;aggregates_.at(i)))&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;CmpBool&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;CmpTrue ){
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    result&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;aggregates_.at(i) &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; input.aggregates_.at(i);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#66d9ef&#34;&gt;break&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          }
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å®ç°å¥½è¿™ä¸ªå‡½æ•°ä¹‹åï¼Œè¿™ä¸ªæ–‡ä»¶åªæœ‰æœ€ä¸‹é¢ä¸¤ä¸ªæˆå‘˜å±æ€§éœ€è¦åšäº†ï¼›&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;private&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;/** The aggregation plan node */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; AggregationPlanNode &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;plan_;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;/** The child executor that produces tuples over which the aggregation is computed */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;unique_ptr&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;AbstractExecutor&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; child_;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;/** Simple aggregation hash table */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;// TODO(Student): Uncomment SimpleAggregationHashTable aht_;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  SimpleAggregationHashTable aht_;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;/** Simple aggregation hash table iterator */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;// TODO(Student): Uncomment SimpleAggregationHashTable::Iterator aht_iterator_;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  SimpleAggregationHashTable&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;Iterator aht_iterator_;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æŠŠæ³¨é‡Šå‰é¢éƒ¨åˆ†åˆ æ‰å³å¯ã€‚æç¤ºä½ éœ€è¦ç”¨è¿™ä¸¤ä¸ªå±æ€§ã€‚&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥å¯ä»¥å»æ„‰æ‚¦å®ç°&lt;code&gt;src\execution\aggregation_executor.cpp&lt;/code&gt;äº†ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆå®ç°æ„é€ å‡½æ•°&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;AggregationExecutor&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;AggregationExecutor(ExecutorContext &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;exec_ctx, &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; AggregationPlanNode &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;plan,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                         std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;unique_ptr&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;AbstractExecutor&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt;child)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; AbstractExecutor(exec_ctx),plan_(plan),child_(std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;move(child)), aht_(plan&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;aggregates_,plan&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;agg_types_), aht_iterator_(aht_.Begin()) {}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åå®ç°Init,è¿™é‡Œå°±åº”è¯¥æŠŠå­ç»“ç‚¹é‡Œçš„æ‰€æœ‰tupleæ‹¿å‡ºæ¥äº†ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt;(child_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;Next(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;tuple,&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;rid)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    aht_.InsertCombine(MakeAggregateKey(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;tuple), MakeAggregateValue(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;tuple));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åè¦æ³¨æ„æ€è€ƒç©ºè¡¨çš„æƒ…å†µã€‚æœ‰ä»¥ä¸‹ä¸¤ç§ç‰¹æ®Šæƒ…å†µï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœå“ˆå¸Œè¡¨ä¸ºç©ºï¼Œä½†æ˜¯æœ‰&lt;code&gt;count(*)&lt;/code&gt;ã€‚è¿™ç§æƒ…å†µåº”è¯¥ä¼šè¿”å›ä¸€ä¸ª0å€¼ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœå“ˆå¸Œè¡¨ä¸ºç©ºï¼Œä½†æ˜¯æ˜¯å…¶ä»–æƒ…å†µã€‚æ¯”å¦‚åœ¨ä¸€ä¸ªç©ºè¡¨ä¸­&lt;code&gt;select v5, min(v1), sum(v2), count(*) from t1 group by v5&lt;/code&gt;ï¼Œè¿™ç§æ—¶å€™æ˜¯æ²¡è¾“å‡ºçš„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é‚£ä¹ˆå¤„ç†ç©ºè¡¨æƒ…å†µï¼šå¦‚æœå“ˆå¸Œè¡¨ä¸ºç©ºä¸”æ²¡æœ‰&lt;code&gt;group by&lt;/code&gt;,ä¹Ÿå°±æ˜¯è¯´åªæœ‰èšåˆå‡½æ•°ï¼Œé‚£ä¹ˆåº”å½“åˆå§‹åŒ–ä¸€è¡Œåˆå§‹å€¼ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(aht_.Size()&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; plan_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;group_bys_.empty()) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    aht_.InitEmpty();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;-----&lt;/span&gt; in SimpleHashTable
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; InitEmpty() &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; { ht_.insert({AggregateKey{std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;vector&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;Value&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;{}},GenerateInitialAggregateValue()}); }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™æ ·å°±èƒ½å¤„ç†ç©ºè¡¨äº†ï¼Œæ¯”å¦‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;select&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;count&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;),&lt;span style=&#34;color:#66d9ef&#34;&gt;count&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;),&lt;span style=&#34;color:#66d9ef&#34;&gt;count&lt;/span&gt;(v1) &lt;span style=&#34;color:#66d9ef&#34;&gt;from&lt;/span&gt; t1; &lt;span style=&#34;color:#75715e&#34;&gt;-- no groups, no output
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;--- YOUR RESULT ---
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; integer_null 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;--- EXPECTED RESULT ---
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; integer_null
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¥ä¸‹æ¥æ˜¯å¤„ç†Nextå‡½æ•°&lt;/p&gt;
&lt;p&gt;Nextç›´æ¥éå†å“ˆå¸Œè¡¨å°±è¡Œäº†ã€‚ç„¶åé€šè¿‡Explainï¼Œå¯ä»¥çœ‹å‡ºæ¥è¾“å‡ºæ—¶group byåœ¨å‰é¢ï¼Œèšåˆå€¼åœ¨åé¢ã€‚é€šè¿‡Valuesæ„é€ tupleæ—¶æ³¨æ„ä¸‹é¡ºåºå³å¯&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/database/query_execution/blogimage-20230530234132716.png&#34;
	width=&#34;1521&#34;
	height=&#34;537&#34;
	srcset=&#34;https://antio2.cn/tech/database/query_execution/blogimage-20230530234132716_hua2686da8763bdb02459aa6bcc9ebe30c_287251_480x0_resize_box_3.png 480w, https://antio2.cn/tech/database/query_execution/blogimage-20230530234132716_hua2686da8763bdb02459aa6bcc9ebe30c_287251_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20230530234132716&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;283&#34;
		data-flex-basis=&#34;679px&#34;
	
&gt;&lt;/p&gt;
&lt;h3 id=&#34;0x22-nestedloopjoin&#34;&gt;0x22 NestedLoopJoin&lt;/h3&gt;
&lt;p&gt;Nested Loop Joinå®ç°åµŒå¥—å¾ªç¯è¿æ¥ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  NestedLoopJoinPlanNode(SchemaRef output_schema, AbstractPlanNodeRef left, AbstractPlanNodeRef right,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                         AbstractExpressionRef predicate, JoinType join_type)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; AbstractPlanNode(std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;move(output_schema), {std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;move(left), std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;move(right)}),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        predicate_(std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;move(predicate)),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        join_type_(join_type) {}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;plan_nodeä¸­ç»™å‡ºè¿æ¥çš„å·¦å­ç»“ç‚¹å’Œå³å­èŠ‚ç‚¹ï¼Œè¿˜æœ‰æ–­è¨€ã€‚é€šè¿‡åˆ¤æ–­æ–­è¨€æ˜¯å¦ä¸ºçœŸï¼Œæ¥å†³å®šä¸¤ä¸ªtupleæ˜¯å¦è¢«è¿æ¥ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å¦‚ä½•è¾“å‡ºï¼Ÿ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;blockquote&gt;
&lt;p&gt;The output schema of this operator is all columns from the left table followed by all the columns from the right table.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è¾“å‡ºçš„schemaéƒ½æ˜¯å…ˆå·¦ç»“ç‚¹ï¼Œå†å³ç»“ç‚¹&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦‚ä½•åˆ¤æ–­ï¼Ÿ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;blockquote&gt;
&lt;p&gt;for each tuple in the join&amp;rsquo;s outer table, you should consider each tuple in the join&amp;rsquo;s inner table, and emit an output tuple if the join predicate is satisfied.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¯¹äºæ¯ä¸ªå¤–å±‚å¾ªç¯çš„tupleï¼Œéƒ½è¦å¾ªç¯è€ƒè™‘å†…å±‚çš„tupleï¼Œå¦‚æœæ»¡è¶³ä¹‹å‰æåˆ°çš„predicateï¼ˆæ–­è¨€ï¼‰ï¼Œé‚£ä¹ˆè¾“å‡ºç»“æœã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆè€ƒè™‘æ‹¿åˆ°å†…å±‚ä¸­çš„æ‰€æœ‰tupleå¹¶å­˜æ”¾åœ¨å†…å­˜ä¸­ï¼Œç„¶åé€šè¿‡è°ƒç”¨å¤–å±‚ï¼ˆå·¦ç»“ç‚¹ï¼‰çš„next()å‡½æ•°ï¼Œè·å¾—ä¸€ä¸ªå¤–å±‚tupleï¼Œå†ç”¨è¿™ä¸ªtupleå»å¾ªç¯æ¯”è¾ƒå†…å­˜ä¸­çš„tuples(å³ç»“ç‚¹çš„tuple)ï¼Œå¦‚æœæ»¡è¶³æ–­è¨€ï¼Œé‚£ä¹ˆè¾“å‡ºç»“æœã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦‚ä½•è§£å†³æ–­è¨€é—®é¢˜ï¼Ÿ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Hint:&lt;/strong&gt; You will want to make use of the predicate in the &lt;code&gt;NestedLoopJoinPlanNode&lt;/code&gt;. In particular, take a look at &lt;code&gt;AbstractExpression::EvaluateJoin&lt;/code&gt;, which handles the left tuple and right tuple and their respective schemas. Note that this returns a &lt;code&gt;Value&lt;/code&gt;, which could be false, true, or NULL. See &lt;code&gt;FilterExecutor&lt;/code&gt; on how to apply predicates on tuples.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é€šè¿‡è°ƒç”¨&lt;code&gt;AbstractExpression::EvaluateJoin&lt;/code&gt;,æ¯”å¦‚æ¯”è¾ƒè¿æ¥(æ¯”å¦‚ä»£æ•°è¡¨ç¤ºä¸º$\theta_{a.col1&amp;lt;b.col1}$ )ï¼Œçš„&lt;code&gt;EvaluateJoin&lt;/code&gt;æ˜¯&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;EvaluateJoin&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; Tuple &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;left_tuple, &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; Schema &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;left_schema, &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; Tuple &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;right_tuple,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; Schema &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;right_schema) &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt; Value &lt;span style=&#34;color:#66d9ef&#34;&gt;override&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Value lhs &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; GetChildAt(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;EvaluateJoin(left_tuple, left_schema, right_tuple, right_schema);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Value rhs &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; GetChildAt(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;EvaluateJoin(left_tuple, left_schema, right_tuple, right_schema);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; ValueFactory&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;GetBooleanValue(PerformComparison(lhs, rhs));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Init&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;é¦–å…ˆè·å–å†…å±‚çš„æ‰€æœ‰tuples&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; NestedLoopJoinExecutor&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;Init() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;// throw NotImplementedException(&amp;#34;NestedLoopJoinExecutor is not implemented&amp;#34;);
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;//
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  LOG_INFO(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Nested Loop Join Init&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  left_executor_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;Init();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  right_executor_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;Init();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  Tuple tuple;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  RID rid;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt;(right_executor_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;Next(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;tuple, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;rid)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// LOG_INFO(&amp;#34;To Fetch Right Tuple&amp;#34;);
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    right_tuples_.emplace_back(tuple);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  right_iter_ &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; right_tuples_.end();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Nextæ“ä½œå¦‚ä½•è¿›è¡Œå‘¢ï¼Ÿ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è€ƒè™‘ç¬¬ä¸€æ¬¡Nextï¼Œé¦–å…ˆè¦å–å‡ºå¤–å±‚çš„left_tupleï¼Œç„¶åå’Œå†…å±‚åšæ¯”è¾ƒã€‚
&lt;ul&gt;
&lt;li&gt;å¦‚æœç›¸ç­‰å°±è¿”å›ç»“æœã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœè¯¥æ¬¡æ²¡æœ‰å¯ä»¥joinçš„right_tupleï¼Œé‚£ä¹ˆå–å‡ºä¸‹ä¸€ä¸ªleft_tupleï¼Œç»§ç»­è¿›è¡Œæ¯”è¾ƒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;è€ƒè™‘æ¥ä¸‹æ¥çš„Nextæ“ä½œï¼šæœ‰å‡ ç§æƒ…å†µï¼š
&lt;ul&gt;
&lt;li&gt;å¦‚æœå·²ç»ä¸¤å±‚éå†å®Œï¼Œè¿”å›false&lt;/li&gt;
&lt;li&gt;å¦‚æœright_tupleså·²ç»è¢«éå†å®Œäº†ï¼Œéœ€è¦å–å‡ºä¸‹ä¸€ä¸ªleft_tuple&lt;/li&gt;
&lt;li&gt;å¦‚æœright_tuplesæ²¡æœ‰è¢«éå†å®Œï¼Œä½¿ç”¨ä¸Šä¸€æ¬¡çš„left_tupleè¿›è¡Œæ“ä½œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ç”»å‡ºæµç¨‹å›¾å¤§æ¦‚é•¿è¿™æ ·&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/database/query_execution/blogimage-20230608235835612.png&#34;
	width=&#34;848&#34;
	height=&#34;776&#34;
	srcset=&#34;https://antio2.cn/tech/database/query_execution/blogimage-20230608235835612_hu9f3b154b74079d7814be20c4d2ca8fe4_35936_480x0_resize_box_3.png 480w, https://antio2.cn/tech/database/query_execution/blogimage-20230608235835612_hu9f3b154b74079d7814be20c4d2ca8fe4_35936_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20230608235835612&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;109&#34;
		data-flex-basis=&#34;262px&#34;
	
&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç„¶åå°±æ˜¯æ€ä¹ˆemitçš„é—®é¢˜äº†
&lt;ul&gt;
&lt;li&gt;å¦‚æœæ»¡è¶³è¿æ¥æ¡ä»¶ï¼Œç›´æ¥å°†å·¦å³tupleåˆå¹¶è¾“å‡ºå³å¯ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœæ˜¯left joinï¼Œé‚£ä¹ˆåœ¨right_iteræŒ‡åˆ°æœ€åæ—¶ï¼Œéœ€è¦åˆ¤æ–­ä¸€ä¸‹æ˜¯å¦ä¹‹å‰è¾“å‡ºè¿‡ã€‚å¦‚æœè¯¥left_tupleåœ¨æ•´ä¸ªå¾ªç¯éƒ½æ²¡è¾“å‡ºè¿‡ï¼Œéœ€è¦è¾“å‡ºä¸€ä¸ªtuple: è¯¥tupleä»¥left_tupleå¼€å§‹ï¼Œä»¥right_tupleåˆ—æ•°ç›®ä¸ªçš„ç©ºå€¼ç»“æŸã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å®Œæˆåï¼Œåº”è¯¥å¯ä»¥é€šè¿‡09çš„å‰ä¸‰ä¸ªæµ‹è¯•&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/database/query_execution/blogimage-20230609005816542.png&#34;
	width=&#34;1121&#34;
	height=&#34;553&#34;
	srcset=&#34;https://antio2.cn/tech/database/query_execution/blogimage-20230609005816542_hu224bd8a09da0f2e05c8c9f2a6af2cc08_29288_480x0_resize_box_3.png 480w, https://antio2.cn/tech/database/query_execution/blogimage-20230609005816542_hu224bd8a09da0f2e05c8c9f2a6af2cc08_29288_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20230609005816542&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;202&#34;
		data-flex-basis=&#34;486px&#34;
	
&gt;&lt;/p&gt;
&lt;h3 id=&#34;0x23-nestedindexjoin&#34;&gt;0x23 NestedIndexJoin&lt;/h3&gt;
&lt;p&gt;æ¥ä¸‹æ¥æ˜¯NestedIndexJoinã€‚å½“joinå³ä¾§çš„keyå­˜åœ¨ç´¢å¼•æ—¶ï¼Œloop joinè¢«ä¼˜åŒ–ä¸ºindex join&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;the join condition is an equi-condition &lt;code&gt;v1 = v3&lt;/code&gt;. This means that for all tuples from the left side, the system can use the key &lt;code&gt;v1&lt;/code&gt; to query the index &lt;code&gt;t2v3&lt;/code&gt; to produce the join result.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å¤–ä¾§çš„æ¯ä¸ªtupleå…ˆå–åˆ°é”®ï¼Œç„¶åé€šè¿‡è¿™ä¸ªé”®å»æŸ¥è¯¢ç´¢å¼•ä¸­æ˜¯å¦æœ‰å¯ä»¥è¿æ¥çš„å³ä¾§tupleã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Hint:&lt;/strong&gt; You will want to fetch the tuple from the outer table, construct the index probe key by using &lt;code&gt;key_predicate&lt;/code&gt;, and then look up the RID in the index to retrieve the corresponding tuple for the inner table.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;é€šè¿‡planä¸­çš„&lt;code&gt;key_predicate&lt;/code&gt;ï¼Œæ„é€ å·¦tupleçš„æ¢æµ‹é”®ã€‚&lt;/p&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´ï¼Œé€šè¿‡&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;vector&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;Value&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; key{plan_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;KeyPredicate()&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;Evaluate(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;left_tuple,child_executor_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetOutputSchema())};
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Tuple key_tuple &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Tuple(key,index_info_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;index_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetKeySchema());
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è·å–indexçš„keyï¼Œç„¶åé€šè¿‡è¯¥keyæŸ¥è¯¢right_tupleã€‚&lt;/p&gt;
&lt;p&gt;ç„¶åæ³¨æ„ä¸€ä¸‹å®ç°å·¦è¿æ¥ï¼Œè¯¥æ‰§è¡Œå™¨å’Œä¸Šä¸€ä¸ªå·®ä¸å¤šã€‚&lt;/p&gt;
&lt;p&gt;å®Œæˆä¸¤ä¸ªjoinåï¼Œ9-12éƒ½èƒ½é€šè¿‡äº†&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-makefile&#34; data-lang=&#34;makefile&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;make&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;p3.09-simple-join_test&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;p3.10-multi-way-join_test&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;p3.11-repeat-execute_test&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;p3.12-nested-index-join_test&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;-j2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/database/query_execution/blogimage-20230609123414786.png&#34;
	width=&#34;1130&#34;
	height=&#34;641&#34;
	srcset=&#34;https://antio2.cn/tech/database/query_execution/blogimage-20230609123414786_hu10f7a06a05eb585c21de20c6240d5c79_47576_480x0_resize_box_3.png 480w, https://antio2.cn/tech/database/query_execution/blogimage-20230609123414786_hu10f7a06a05eb585c21de20c6240d5c79_47576_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20230609123414786&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;176&#34;
		data-flex-basis=&#34;423px&#34;
	
&gt;&lt;/p&gt;
&lt;h2 id=&#34;0x30-sort--limit-executors-and-top-n-optimization&#34;&gt;0x30 Sort + Limit Executors and Top-N Optimization&lt;/h2&gt;
&lt;h3 id=&#34;0x31-sort&#34;&gt;0x31 Sort&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;Except in the case that the &lt;code&gt;ORDER BY&lt;/code&gt; attributes matches the keys of an index, BusTub will use a &lt;a class=&#34;link&#34; href=&#34;https://github.com/cmu-db/bustub/blob/master/src/include/execution/plans/sort_plan.h&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;&lt;code&gt;SortPlanNode&lt;/code&gt;&lt;/a&gt; for all &lt;code&gt;ORDER BY&lt;/code&gt; operators.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;é™¤äº†ORDER BY å…³é”®è¯è¢«åˆ›å»ºäº†ç´¢å¼•çš„æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨Index Scanã€‚&lt;/p&gt;
&lt;p&gt;å…¶ä»–æ—¶å€™éƒ½è¦è°ƒç”¨è¯¥Sort Plan Nodeè¿›è¡Œæ’åº&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;You can assume that all entries in a table can fit in memory&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ‰€æœ‰çš„tupleéƒ½å¯ä»¥è¢«å­˜æ”¾åˆ°å†…å­˜ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;è¯´å®è¯ï¼Œçœ‹åˆ°è¿™é‡Œæœ‰ä¸€ç‚¹å°å¤±æœ›ï¼Œå› ä¸ºè¯¾ç¨‹ä¸­è®²äº†å¾ˆå¤šmerge sortï¼Œç»“æœè¿™é‡Œç›´æ¥ç”¨&lt;code&gt;std::sort&lt;/code&gt;å°±è¡Œäº†ã€‚&lt;/p&gt;
&lt;p&gt;sort planä¸­å­˜åœ¨&lt;code&gt;std::vector&amp;lt;std::pair&amp;lt;OrderByType, AbstractExpressionRef&amp;gt;&amp;gt; order_bys&lt;/code&gt;å†³å®šæ’åº&lt;/p&gt;
&lt;p&gt;é»˜è®¤ä¸ºASCã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;bustub&amp;gt; EXPLAIN SELECT * FROM __mock_table_1 ORDER BY colA ASC, colB DESC;
=== BINDER ===
BoundSelect {
  table=BoundBaseTableRef { table=__mock_table_1, oid=0 },
  columns=[__mock_table_1.colA, __mock_table_1.colB],
  groupBy=[],
  having=,
  where=,
  limit=,
  offset=,
  order_by=[BoundOrderBy { type=Ascending, expr=__mock_table_1.colA }, BoundOrderBy { type=Descending, expr=__mock_table_1.colB }],
  is_distinct=false,
  ctes=,
}
=== PLANNER ===
Sort { order_bys=[(Ascending, #0.0), (Descending, #0.1)] } | (__mock_table_1.colA:INTEGER, __mock_table_1.colB:INTEGER)
  Projection { exprs=[#0.0, #0.1] } | (__mock_table_1.colA:INTEGER, __mock_table_1.colB:INTEGER)
    MockScan { table=__mock_table_1 } | (__mock_table_1.colA:INTEGER, __mock_table_1.colB:INTEGER)
=== OPTIMIZER ===
Sort { order_bys=[(Ascending, #0.0), (Descending, #0.1)] } | (__mock_table_1.colA:INTEGER, __mock_table_1.colB:INTEGER)
  MockScan { table=__mock_table_1 } | (__mock_table_1.colA:INTEGER, __mock_table_1.colB:INTEGER)bustub&amp;gt; EXPLAIN SELECT * FROM __mock_table_1 ORDER BY colA ASC, colB DESC;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å¯ä»¥çœ‹å‡ºæ¥ï¼Œå¯¹äºsortæ‰§è¡Œå™¨ï¼Œå¯ä»¥æœ‰å¤šä¸ªorder byçš„å…³é”®å­—ã€‚é€šè¿‡é‡å†™tupleé—´çš„cmpå‡½æ•°è¿›è¡Œæ’åºã€‚&lt;/p&gt;
&lt;p&gt;åœ¨Initä¸­ï¼Œé¦–å…ˆåˆ›å»ºå¯¹è±¡å­˜å‚¨å­ç»“ç‚¹çš„æ‰€æœ‰tuple&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;using&lt;/span&gt; TupleInfo &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;pair&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;Tuple,RID&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;vector&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;TupleInfo&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; tuples_;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åè¦é‡å†™sortçš„æ’åºå‡½æ•°ï¼Œä¼ ç»Ÿçš„å†™æ³•æ˜¯éœ€è¦æ–°å»ºä¸€ä¸ªå‡½æ•°ï¼Œæ¯”å¦‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt; SortExecutor&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;TupleCmp(&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; TupleInfo&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;t1, &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; TupleInfo&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;t2) 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¥è¿›è¡Œæ’åºï¼Œä½†æ˜¯åœ¨è¿™é‡Œtupleæœ¬èº«çš„ä¿¡æ¯ä¸è¶³ä»¥æ”¯æŒæ¯”è¾ƒæ“ä½œã€‚æ‰€ä»¥è¦é€šè¿‡lambdaå‡½æ•°çš„å˜é‡æ•è·æ¥å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥å°±æ˜¯å¦‚ä½•è¿›è¡Œæ¯”è¾ƒçš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡order_byçš„expressionè¿›è¡Œè®¡ç®—valueï¼Œå¹¶é€šè¿‡Compareå‡½æ•°è¿›è¡Œæ¯”è¾ƒã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæ»¡è¶³ä¸¤å…ƒç´ äº¤æ¢çš„æ¡ä»¶ï¼Œè¦ç«‹å³é€€å‡ºã€‚&lt;/p&gt;
&lt;p&gt;å¦åˆ™è¦ä¸€ç›´æ¯”è¾ƒï¼Œç›´åˆ°ä¸¤å€¼å®Œå…¨ç›¸ç­‰ï¼Œæ­¤æ—¶ä¸äº¤æ¢é¡ºåºã€‚&lt;/p&gt;
&lt;h3 id=&#34;0x32-limit&#34;&gt;0x32 Limit&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;The &lt;code&gt;LimitExecutor&lt;/code&gt; constrains the number of output tuples from its child executorr. If the number of tuples produced by its child executor is less than the limit specified in the plan node, this executor has no effect and yields all of the tuples that it receives.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ„Ÿè§‰è¿™ä¸ªæ¯”è¾ƒç®€å•ï¼Œç›´æ¥ç”¨ä¸€ä¸ªè®¡æ•°å™¨å®ç°å°±å¥½äº†ã€‚&lt;/p&gt;
&lt;p&gt;plan_ä¸­æœ‰ä¸€ä¸ª&lt;code&gt;std::size_t limit&lt;/code&gt;å˜é‡è¡¨ç¤ºlimitå€¼ã€‚&lt;/p&gt;
&lt;p&gt;&lt;em&gt;å®Œæˆsortå’Œlimitä¹‹åï¼Œé€šè¿‡æµ‹è¯•&lt;code&gt;make p3.13-sort-limit_test -j2&lt;/code&gt;&lt;/em&gt;&lt;/p&gt;
&lt;h3 id=&#34;0x33-top-n-optimization-rule&#34;&gt;0x33 Top-N Optimization Rule&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;For this last task, you are going to modify BusTub&amp;rsquo;s optimizer to support converting top-N queries. Consider the following query:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;EXPLAIN SELECT * FROM __mock_table_1 ORDER BY colA LIMIT 10;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;By default, BusTub will execute this query by (1) sort all data from the table (2) get the first 10 elements. This is obviously inefficient, since the query only needs the smallest values. A smarter way of doing this is to dynamically keep track of the smallest 10 elements so far. This is what the BusTub&amp;rsquo;s &lt;code&gt;TopNExecutor&lt;/code&gt; does.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å½“Limitå’ŒORDER BY åŒæ—¶å‡ºç°æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦è·Ÿè¸ªå‰Nä¸ªå…ƒç´ å³å¯ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¬¬ä¸€æ­¥ï¼šç”Ÿæˆæ–°çš„plan node!&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;bustub&amp;gt; EXPLAIN SELECT * FROM __mock_table_1 ORDER BY colA LIMIT 10;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt; BINDER &lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;BoundSelect &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  table&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;BoundBaseTableRef &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt; table&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;__mock_table_1, oid&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  columns&lt;span style=&#34;color:#f92672&#34;&gt;=[&lt;/span&gt;__mock_table_1.colA, __mock_table_1.colB&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  groupBy&lt;span style=&#34;color:#f92672&#34;&gt;=[]&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  having&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  where&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  limit&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;10,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  offset&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  order_by&lt;span style=&#34;color:#f92672&#34;&gt;=[&lt;/span&gt;BoundOrderBy &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt; type&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;Default, expr&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;__mock_table_1.colA &lt;span style=&#34;color:#f92672&#34;&gt;}]&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  is_distinct&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;false,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ctes&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt; PLANNER &lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Limit &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt; limit&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt; | &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;__mock_table_1.colA:INTEGER, __mock_table_1.colB:INTEGER&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  Sort &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt; order_bys&lt;span style=&#34;color:#f92672&#34;&gt;=[(&lt;/span&gt;Default, &lt;span style=&#34;color:#75715e&#34;&gt;#0.0)] } | (__mock_table_1.colA:INTEGER, __mock_table_1.colB:INTEGER)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Projection &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt; exprs&lt;span style=&#34;color:#f92672&#34;&gt;=[&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#0.0, #0.1] } | (__mock_table_1.colA:INTEGER, __mock_table_1.colB:INTEGER)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      MockScan &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt; table&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;__mock_table_1 &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt; | &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;__mock_table_1.colA:INTEGER, __mock_table_1.colB:INTEGER&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt; OPTIMIZER &lt;span style=&#34;color:#f92672&#34;&gt;===&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;TopN &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt; n&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;10, order_bys&lt;span style=&#34;color:#f92672&#34;&gt;=[(&lt;/span&gt;Default, &lt;span style=&#34;color:#75715e&#34;&gt;#0.0)]} | (__mock_table_1.colA:INTEGER, __mock_table_1.colB:INTEGER)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  MockScan &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt; table&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;__mock_table_1 &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt; | &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;__mock_table_1.colA:INTEGER, __mock_table_1.colB:INTEGER&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;bustub&amp;gt; EXPLAIN SELECT * FROM __mock_table_1 ORDER BY colA LIMIT 10;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€šè¿‡è§‚å¯Ÿå‘ç°ï¼Œå½“plannerä¸­ï¼Œæœ‰ä¸€ä¸ªlimitçš„å­ç»“ç‚¹æ˜¯sortï¼Œé‚£ä¹ˆä¼šè¢«åˆå¹¶æ›¿æ¢ä¸ºä¸€ä¸ªTopNç»“ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;å…·ä½“æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿé€šè¿‡è§‚å¯Ÿ&lt;code&gt;src/optimizer/optimizer.cpp&lt;/code&gt;å¯ä»¥çœ‹åˆ°ï¼Œ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; Optimizer&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;Optimize(&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; AbstractPlanNodeRef &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;plan) &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt; AbstractPlanNodeRef {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (force_starter_rule_) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// Use starter rules when `force_starter_rule_` is set to true.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; p &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; plan;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    p &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; OptimizeMergeProjection(p);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    p &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; OptimizeMergeFilterNLJ(p);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    p &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; OptimizeNLJAsIndexJoin(p);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    p &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; OptimizeOrderByAsIndexScan(p);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    p &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; OptimizeSortLimitAsTopN(p);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; p;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;// By default, use user-defined rules.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;OptimizeCustom&lt;/span&gt;(plan);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€šè¿‡å¤šæ¬¡è°ƒç”¨ä¼˜åŒ–å‡½æ•°ï¼Œå¯¹planè¿›è¡Œæ›´æ”¹ã€‚è€Œplanä¸­æ˜¯é€’å½’å­ç»“ç‚¹è°ƒç”¨ä¼˜åŒ–å™¨çš„ã€‚ï¼ˆæˆ‘ä¸ªäººæ„Ÿè§‰ç±»ä¼¼äºä¿®é¥°å™¨æ¨¡å¼ï¼‰&lt;/p&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;vector&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;AbstractPlanNodeRef&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; children;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;child : plan&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetChildren()) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    children.emplace_back(OptimizeSortLimitAsTopN(child));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è€Œè¦ä¼˜åŒ–topnï¼Œæ»¡è¶³ä¸‹é¢æ¡ä»¶å°±è¡Œäº†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¯¥ç»“ç‚¹ä¸ºLimitç±»å‹&lt;/li&gt;
&lt;li&gt;å­ç»“ç‚¹ä¸ºSortç±»å‹&lt;/li&gt;
&lt;li&gt;æ³¨æ„åˆ°Limitåªèƒ½æœ‰ä¸€ä¸ªå­ç»“ç‚¹ï¼Œæ‰€ä»¥åˆ¤æ–­ç¬¬ä¸€ä¸ªchildç±»å‹å°±å¥½äº†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœ€åè¿”å›ä¸€ä¸ªtopNçš„planã€‚ä¹Ÿå°±æ˜¯è¯´è¿”å›&lt;code&gt;src/include/execution/plans/topn_plan.h&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;ç„¶åå®ç°ä¼˜åŒ–å™¨&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(optimized_plan&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetType()&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;PlanType&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;Limit) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    assert(optimized_plan&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;children_.size()&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(children.at(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;GetType()&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;PlanType&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;Sort) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// TODO è‡ªå·±å®ç°ä»£ç å—
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;        TopNPlanNode &lt;span style=&#34;color:#a6e22e&#34;&gt;top_n_plan&lt;/span&gt;(&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;ç›¸åº”çš„å‚æ•°&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// return æ–°çš„plan
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å®ç°å¥½ä¼˜åŒ–å™¨ä¹‹åï¼Œå®ŒæˆTopNExecutorã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœè¦æ’åºï¼Œå‡è®¾å…±æœ‰nä¸ªtupleï¼Œæ‰€éœ€æ—¶é—´ä¸º$nlogn$,å‡è®¾limitä¸ºlä¸”l&amp;lt;n,æ‰€éœ€æ—¶é—´ä¸º$\Omicron(nlogl)$ï¼Œ è¿™é‡Œä½¿ç”¨å †ï¼Œæ¯æ¬¡æ’å…¥ç»´æŠ¤å’ŒæŸ¥è¯¢ï¼ˆå¼¹å‡ºä¸€ä¸ªtupleï¼‰ç»´æŠ¤éƒ½éœ€è¦$logl$,ä¸€å…±æŸ¥è¯¢læ¬¡ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨Initä¸­ï¼Œé€šè¿‡&lt;a class=&#34;link&#34; href=&#34;https://en.cppreference.com/w/cpp/container/priority_queue&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;std::priority_queue - cppreference.com&lt;/a&gt; ç»´æŠ¤ä¸€ä¸ªå †&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;A &lt;code&gt;priority queue&lt;/code&gt; is a container adaptor that provides constant time lookup of the largest (by default) element, at the expense of logarithmic insertion and extraction.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´ï¼Œé»˜è®¤æ˜¯å¤§æ ¹å †ï¼Œä¹‹å‰sortè¿”å›cmpå‡½æ•°ä¸ºtrueæ—¶ï¼Œæ˜¯è¿”å›ç¬¬ä¸€ä¸ªå‚æ•°è¾ƒå°çš„æƒ…å†µï¼Œå¤§æ ¹å †é»˜è®¤è¾ƒå¤§çš„åœ¨é¡¶éƒ¨ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨ç²˜è´´sort executoré‡Œé¢çš„æ¯”è¾ƒå‡½æ•°æ—¶ï¼Œè¦ä¿®æ”¹ä¸€ä¸‹å¤§å°é¡ºåºã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;åœ¨ C++ ä¸­ï¼Œ&lt;code&gt;std::priority_queue&lt;/code&gt; æ˜¯åŸºäºå †ï¼ˆHeapï¼‰å®ç°çš„ï¼Œå®ƒçš„å†…éƒ¨æ•°æ®ç»“æ„æ˜¯ä¸€ä¸ªæ•°ç»„æˆ–å‘é‡ï¼Œç”¨äºå­˜å‚¨å †ä¸­çš„å…ƒç´ ï¼ŒåŒæ—¶è¿˜æœ‰ä¸€ä¸ªæ¯”è¾ƒå‡½æ•°ï¼Œç”¨äºæ¯”è¾ƒå…ƒç´ çš„å¤§å°å…³ç³»ã€‚&lt;/p&gt;
&lt;p&gt;å½“æ’å…¥ä¸€ä¸ªæ–°å…ƒç´ æ—¶ï¼Œ&lt;code&gt;std::priority_queue&lt;/code&gt; ä¼šå°†è¯¥å…ƒç´ æ’å…¥åˆ°å †çš„æœ«å°¾ï¼Œç„¶åé€šè¿‡ä¸Šæ»¤æ“ä½œï¼ˆpercolate upï¼‰å°†è¯¥å…ƒç´ ç§»åŠ¨åˆ°åˆé€‚çš„ä½ç½®ä¸Šï¼Œä»¥æ»¡è¶³å †çš„æ€§è´¨ã€‚å…·ä½“è€Œè¨€ï¼Œä¸Šæ»¤æ“ä½œä¼šå°†æ–°å…ƒç´ ä¸æ–­å‘ä¸Šç§»åŠ¨ï¼Œç›´åˆ°å®ƒçš„çˆ¶èŠ‚ç‚¹å°äºæˆ–ç­‰äºå®ƒï¼Œæˆ–è€…åˆ°è¾¾å †é¡¶ã€‚&lt;/p&gt;
&lt;p&gt;å½“å¼¹å‡ºå †é¡¶å…ƒç´ æ—¶ï¼Œ&lt;code&gt;std::priority_queue&lt;/code&gt; ä¼šå°†å †é¡¶å…ƒç´ å’Œå †æœ«å°¾çš„å…ƒç´ äº¤æ¢ä½ç½®ï¼Œç„¶åé€šè¿‡ä¸‹æ»¤æ“ä½œï¼ˆpercolate downï¼‰å°†å †é¡¶å…ƒç´ ç§»åŠ¨åˆ°åˆé€‚çš„ä½ç½®ä¸Šï¼Œä»¥æ»¡è¶³å †çš„æ€§è´¨ã€‚å…·ä½“è€Œè¨€ï¼Œä¸‹æ»¤æ“ä½œä¼šå°†å †é¡¶å…ƒç´ ä¸æ–­å‘ä¸‹ç§»åŠ¨ï¼Œç›´åˆ°å®ƒçš„å­èŠ‚ç‚¹å¤§äºæˆ–ç­‰äºå®ƒï¼Œæˆ–è€…åˆ°è¾¾å †åº•ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿›è¡Œä¸Šæ»¤æˆ–ä¸‹æ»¤æ“ä½œæ—¶ï¼Œ&lt;code&gt;std::priority_queue&lt;/code&gt; ä¼šä½¿ç”¨æ¯”è¾ƒå‡½æ•°æ¥ç¡®å®šå…ƒç´ çš„å¤§å°å…³ç³»ã€‚å¦‚æœæ¯”è¾ƒå‡½æ•°è¿”å› &lt;code&gt;true&lt;/code&gt;ï¼Œåˆ™è¡¨ç¤ºç¬¬ä¸€ä¸ªå‚æ•°çš„ä¼˜å…ˆçº§æ¯”ç¬¬äºŒä¸ªå‚æ•°é«˜ï¼Œå³ç¬¬ä¸€ä¸ªå‚æ•°åº”è¯¥åœ¨å †ä¸­é å‰çš„ä½ç½®ï¼›å¦‚æœæ¯”è¾ƒå‡½æ•°è¿”å› &lt;code&gt;false&lt;/code&gt;ï¼Œåˆ™è¡¨ç¤ºç¬¬äºŒä¸ªå‚æ•°çš„ä¼˜å…ˆçº§æ¯”ç¬¬ä¸€ä¸ªå‚æ•°é«˜ï¼Œå³ç¬¬äºŒä¸ªå‚æ•°åº”è¯¥åœ¨å †ä¸­é å‰çš„ä½ç½®ã€‚&lt;/p&gt;
&lt;p&gt;é»˜è®¤æƒ…å†µä¸‹ï¼Œ&lt;code&gt;std::priority_queue&lt;/code&gt; ä½¿ç”¨ &lt;code&gt;std::less&lt;/code&gt; ä½œä¸ºæ¯”è¾ƒå‡½æ•°ï¼Œå³ä½¿ç”¨ &lt;code&gt;&amp;lt;&lt;/code&gt; è¿ç®—ç¬¦æ¥æ¯”è¾ƒå…ƒç´ çš„å¤§å°å…³ç³»ã€‚å¦‚æœæƒ³è¦ä½¿ç”¨è‡ªå®šä¹‰çš„æ¯”è¾ƒå‡½æ•°ï¼Œå¯ä»¥åœ¨åˆ›å»º &lt;code&gt;std::priority_queue&lt;/code&gt; å¯¹è±¡æ—¶ï¼Œå°†è¯¥æ¯”è¾ƒå‡½æ•°ä½œä¸ºç¬¬ä¸‰ä¸ªæ¨¡æ¿å‚æ•°ä¼ é€’è¿›å»ã€‚åœ¨è¿›è¡Œä¸Šæ»¤æˆ–ä¸‹æ»¤æ“ä½œæ—¶ï¼Œ&lt;code&gt;std::priority_queue&lt;/code&gt; ä¼šä½¿ç”¨è¯¥æ¯”è¾ƒå‡½æ•°æ¥ç¡®å®šå…ƒç´ çš„å¤§å°å…³ç³»ã€‚ä¾‹å¦‚ï¼Œå¦‚æœè¦ä½¿ç”¨å°æ ¹å †ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ª lambda è¡¨è¾¾å¼æ¥å®šä¹‰æ¯”è¾ƒå‡½æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; cmp &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; [](&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; left, &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; right) { &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; left &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; right; };
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;priority_queue&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;, std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;vector&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;decltype&lt;/span&gt;(cmp)&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; min_heap(cmp);
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œå®šä¹‰äº†ä¸€ä¸ª lambda è¡¨è¾¾å¼ &lt;code&gt;cmp&lt;/code&gt;ï¼Œå®ƒå°†ä¸¤ä¸ªå…ƒç´ çš„å¤§å°æ¯”è¾ƒç»“æœå–åï¼Œå³ &lt;code&gt;left &amp;gt; right&lt;/code&gt; å˜ä¸º &lt;code&gt;left &amp;lt; right&lt;/code&gt;ï¼Œä»è€Œå®ç°äº†å°æ ¹å †çš„æ•ˆæœã€‚ç„¶ååœ¨åˆ›å»º &lt;code&gt;std::priority_queue&lt;/code&gt; å¯¹è±¡æ—¶ï¼Œå°†è¯¥æ¯”è¾ƒå‡½æ•°ä½œä¸ºç¬¬ä¸‰ä¸ªæ¨¡æ¿å‚æ•°ä¼ é€’ç»™å®ƒã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ¯”å¦‚åœ¨ä¸Šæµ®è¿‡ç¨‹ä¸­ï¼ŒCmpå‡½æ•°çš„ä½¿ç”¨æ–¹å¼æ˜¯&lt;code&gt;(Cmp(çˆ¶èŠ‚ç‚¹ï¼Œå­ç»“ç‚¹))&lt;/code&gt;ï¼Œé»˜è®¤ä½¿ç”¨&lt;code&gt;std::less&lt;/code&gt;å°äºç¬¦å·ï¼Œå¦‚æœçˆ¶èŠ‚ç‚¹æ¯”å­ç»“ç‚¹å°ï¼Œè¿”å›trueï¼Œé‚£ä¹ˆå­ç»“ç‚¹ä¸Šæµ®ï¼Œæœ€ç»ˆçš„æ•ˆæœæ˜¯è¶Šä¸Šé¢çš„è¶Šå¤§ã€‚åœ¨ä¸‹æ»¤æ“ä½œä¸­ï¼Œå¦‚æœ&lt;code&gt;(Cmp(çˆ¶èŠ‚ç‚¹ï¼Œå­ç»“ç‚¹))&lt;/code&gt;è¿”å›trueï¼Œäº¤æ¢ç»“ç‚¹ï¼Œæœ€ç»ˆæ•ˆæœæ˜¯è¾ƒå°çš„çˆ¶èŠ‚ç‚¹æ²‰ä¸‹å»äº†ï¼Œç»´æŠ¤å¤§æ ¹å †ç‰¹æ€§ã€‚&lt;/p&gt;
&lt;p&gt;å›åˆ°æˆ‘ä»¬çš„Top-Nä¸­æ¥ï¼Œè¦ä½¿æ»¡è¶³ç»´æŠ¤å‰Nçš„tuple,åº”è¯¥ä¿è¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å½“æ¯æ¬¡æ’å…¥æ—¶ï¼Œå¦‚æœé˜Ÿåˆ—ä¸­å·²ç»æœ‰äº†Nä¸ªtupleï¼Œé‚£ä¹ˆè¿™æ˜¯ç¬¬N+1ä¸ªtuple&lt;/li&gt;
&lt;li&gt;å¼¹å‡ºä¸€ä¸ªtupleï¼Œè¯¥tupleæ˜¯æœ€â€˜å°â€™çš„ã€‚å°æ˜¯æŒ‡ï¼šæ’åºåœ¨åé¢çš„ä½ç½®ã€‚&lt;/li&gt;
&lt;li&gt;å¯ä»¥çœ‹å‡ºæ¥ï¼Œæˆ‘ä»¬åº”è¯¥æŠŠæœ€å°çš„tupleæ”¾åœ¨ä¸Šé¢ï¼Œè€Œä¸æ˜¯ç›´è§‰ä¸­çš„å¤§æ ¹å †ã€‚&lt;/li&gt;
&lt;li&gt;è¦æ˜¯æœ€&amp;rsquo;å°&amp;rsquo;çš„tupleåœ¨ä¸Šé¢ï¼Œæ¯æ¬¡&lt;code&gt;cmp(çˆ¶ç»“ç‚¹ï¼Œå­ç»“ç‚¹)&lt;/code&gt;æ—¶ï¼Œå¦‚æœçˆ¶å­ç»“ç‚¹éœ€è¦äº¤æ¢ï¼Œå°±æ˜¯æ»¡è¶³sortåºä¸­ï¼Œçˆ¶åœ¨å­å‰é¢çš„æƒ…å†µï¼Œ&lt;code&gt;cmp(çˆ¶ï¼Œå­){return çˆ¶é¡ºåºåœ¨å„¿å­å‰é¢}&lt;/code&gt;ï¼Œè€Œæˆ‘ä»¬åœ¨sortä¸­å®ç°çš„é€»è¾‘ä¹Ÿæ˜¯è¿™æ ·ã€‚&lt;/li&gt;
&lt;li&gt;ä¹Ÿå°±æ˜¯è¯´ï¼Œsortæ‰§è¡Œå™¨ä¸­çš„æ¯”è¾ƒå‡½æ•°å¯ä»¥ç›´æ¥ç”¨åœ¨è¿™é‡Œï¼Œè€Œä¸éœ€è¦æ›´æ”¹ã€‚ï¼ˆæœ€åé»˜è®¤è¿”å›æˆ‘æ”¹æˆäº†falseï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; cmp &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; [order_bys &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; plan_&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;order_bys_, schema &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; GetOutputSchema()](TupleInfo &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;t1, TupleInfo &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;t2){
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// TODO å®ç°ä½ çš„æ¯”è¾ƒå‡½æ•°
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  };
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;priority_queue&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;TupleInfo,std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;vector&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;TupleInfo&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;decltype&lt;/span&gt;(cmp)&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; pq(cmp);
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™é‡Œè¯´çš„å¯èƒ½æœ‰ç‚¹ç»•ï¼Œå®é™…ä¸Šæˆ‘ä»¬å°±æ˜¯è¦å®ç°ä¸€ä¸ªå †ï¼Œæ¯æ¬¡æ’å…¥ç»“ç‚¹æ—¶ï¼ŒæŠŠæœ€ä¼˜å…ˆåº¦å°ï¼ˆè¾“å‡ºæ—¶åœ¨åé¢ï¼‰çš„å¼¹å‡ºå»ã€‚æœ€åæˆ‘ä»¬éå†è¿™ä¸ªå †æ˜¯ä»ä¼˜å…ˆåº¦ä½åˆ°ä¼˜å…ˆåº¦é«˜æ’åºçš„ã€‚æ‰€ä»¥æœ€åé€šè¿‡ä¸€ä¸ªvectorå­˜å‚¨å¹¶åè½¬ã€‚ï¼ˆä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨å †ï¼‰ã€‚çŸ¥é“å †æ˜¯å¦‚ä½•å®ç°çš„ï¼Œåº”è¯¥æœ‰åŠ©äºç†è§£è¿™é‡Œã€‚&lt;/p&gt;
&lt;p&gt;åˆ°è¿™é‡Œï¼Œåº”è¯¥å¯ä»¥é€šè¿‡1-16äº†&lt;/p&gt;
</description>
        </item>
        <item>
        <title>æŸ¥è¯¢è®¡åˆ’ç»ƒä¹ </title>
        <link>https://antio2.cn/tech/database/query_execution_homework/</link>
        <pubDate>Thu, 23 Mar 2023 20:08:01 +0800</pubDate>
        
        <guid>https://antio2.cn/tech/database/query_execution_homework/</guid>
        <description>&lt;h2 id=&#34;0x1-sorting-algorithms&#34;&gt;0x1 Sorting Algorithms&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;We have a database file with fourteen million pages (N = 14,000,000 pages), and we want to sort it using external merge sort. Assume that the DBMS is not using double buffering or blocked I/O, and that it uses quicksort for in-memory sorting. Let B denote the number of buffers.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æœ‰14,000,000é¡µï¼ŒBè¡¨ç¤ºBufferæ± å®¹é‡&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;(a) Assume that the DBMS has eight buffers. How many passes does the DBMS need to perform in order to sort the file&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å‡å¦‚Bufferæ± å®¹é‡ä¸º8å—ï¼Œåœ¨å½’å¹¶æ’åºä¸­ï¼Œä¸ƒå—ç”¨äºè¾“å…¥ï¼Œä¸€å—ç”¨äºè¾“å‡ºç»“æœğŸ“•ã€‚&lt;strong&gt;ç¬¬ä¸€æ¬¡å½’å¹¶&lt;/strong&gt;ï¼šæ¯8ä¸ªä¸ºä¸€ç»„ï¼Œè¯»å…¥8ä¸ªé¡µï¼Œå› ä¸ºå†…å­˜å¯ä»¥å®¹çº³è¿™8ä¸ªé¡µçš„æ‰€æœ‰å…ƒç»„ï¼Œæ‰€ä»¥ç›´æ¥åœ¨å†…å­˜ä¸­è¿›è¡Œæ’åºã€‚è¿™æ ·å°±å½¢æˆäº†ï¼ˆ14,000,000/8ï¼‰ä¸ªå½’å¹¶æ®µã€‚&lt;strong&gt;ç¬¬äºŒé˜¶æ®µ&lt;/strong&gt;ï¼šæ¥ä¸‹æ¥ï¼Œå°†å½’å¹¶æ®µæ¯ä¸ƒä¸ªä¸ºä¸€ç»„ï¼Œå†æ¬¡æ’åºè¾“å‡ºåˆ°ç¬¬å…«ä¸ªå†…å­˜å—ä¸­ï¼ˆæ»¡äº†å°±è¾“å‡ºï¼Œä¸€å…±ä¼šè¾“å‡º7*7æ¬¡(å› ä¸ºæœ‰7ä¸ªå½’å¹¶æ®µï¼Œæ¯ä¸ªå½’å¹¶æ®µæœ‰7é¡µ)ï¼‰ã€‚æ‰€ä»¥ï¼Œä¸€å…±ä¼šè¿›è¡Œ$$log_7(14,000,000/8)+1$$ è¶Ÿå½’å¹¶ã€‚è®¡ç®—ç»“æœä¸º&lt;strong&gt;9&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;(b)Again, assuming that the DBMS has eight buffers. What is the total I/O cost to sort the file&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ¯é¡µæ¯è¶Ÿå½’å¹¶éƒ½è¦ç»è¿‡ä¸€æ¬¡è¯»å…¥å’Œä¸€æ¬¡è¯»å‡ºï¼Œæ•…ç»“æœä¸º$$14,000,000\times 2\times 9 = 252,000,000$$&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;(c) What is the smallest number of buffers B that the DBMS can sort the target file using only eight passes&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æŒ‰ç…§å½’å¹¶æ’åºçš„æ€æƒ³ï¼Œç¬¬ä¸€æ¬¡å†…å­˜ä¸­æ’åºå½¢æˆ&lt;strong&gt;14,000,000/B&lt;/strong&gt;ä¸ªå½’å¹¶æ®µï¼Œç„¶ååœ¨æ–°çš„ä¸€è¶Ÿä¸­ï¼Œæ¯ä¸ƒä¸ªå½’å¹¶æ®µä¸€èµ·è¾“å‡ºæˆä¸€ä¸ªæ–°çš„å½’å¹¶æ®µã€‚ä¹Ÿå°±æ˜¯è¦æ±‚è§£$$log_{B-1}(14,000,000/B)+1&amp;lt;8$$ï¼Œä¹Ÿå³æ±‚æœ€å°çš„Bä½¿å¾—$$B*(B-1)^7&amp;gt;14,000,000$$,è§£å¾—&lt;strong&gt;B=9&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;(d)Suppose the DBMS has forty-two buffers. What is the largest database file (expressed in terms of N, the number of pages) that can be sorted with external merge sort using four passes&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ğŸ’¬å¦‚æœå†…å­˜æ± æœ‰42é¡µï¼Œé‚£ä¹ˆç¬¬ä¸€æ¬¡å½’å¹¶æ¯ç»„ä¸º42é¡µï¼Œæ¥ä¸‹æ¥3è¶Ÿæ¯æ¬¡å¤„ç†41ä¸ªå½’å¹¶æ®µï¼Œç­”æ¡ˆä¸º$$42*41^3=2,894,682$$&lt;/p&gt;
&lt;h2 id=&#34;0x2-join-algorithms&#34;&gt;0x2 Join Algorithms&lt;/h2&gt;
&lt;p&gt;Consider relations R(a, b, c), S(a, d), and T(a, e, f) to be joined on the common attribute a. Assume that there are no indexes available on the tables to speed up the join algorithms.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;There are B = 445 pages in the buffer&lt;/li&gt;
&lt;li&gt;Table R spans M = 1,500 pages with 80 tuples per page&lt;/li&gt;
&lt;li&gt;Table S spans N = 4,500 pages with 150 tuples per page&lt;/li&gt;
&lt;li&gt;Table T spans O = 200 pages with 250 tuples per page&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;â“Answer the following questions on computing the I/O costs for the joins. You can assume the simplest cost model where pages are read and written one at a time. You can also assume that you will need &lt;strong&gt;one&lt;/strong&gt; buffer block to hold the evolving output block and &lt;strong&gt;one&lt;/strong&gt; input block to hold the current input block of the inner relation. You may ignore the cost of the writing of the final results.&lt;/p&gt;
&lt;p&gt;è®¡ç®—ä»¥ä¸‹æƒ…å†µçš„IOæ¶ˆè€—ï¼š&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;(a)Block nested loop join with S as the outer relation and R as the inner relation:&lt;/strong&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;for å°†(B-2)å—å¤–å…³ç³»è¡¨è¯»å…¥å¤–å…³ç³»Så…¥å†…å­˜: (æ‰§è¡Œ4500/(B-2)æ¬¡)
	for è¯»å…¥å¤–å…³ç³» (æ‰§è¡Œ1500æ¬¡)ï¼š
		è¿›è¡Œè¿æ¥æ“ä½œï¼Œè¾“å‡ºåˆ°é¢„ç•™å—ä¸­
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Sä¸ºå¤–è¡¨ï¼Œè¯»å…¥æ¶ˆè€—4500æ¬¡IOï¼Œç„¶åå¾ªç¯æ‰«æå†…è¡¨Rã€‚æ‰«ææ—¶ï¼Œå†…å­˜ä¸­çš„ï¼ˆB-2ï¼‰å—å¤–è¡¨å’Œä¸€å—å†…è¡¨è¿æ¥ï¼Œè¯»å®Œ1500æ¬¡å¤–è¡¨åï¼Œæ‰§è¡Œä¸‹ä¸€æ¬¡å¾ªç¯ ï¼Œå†è¯»å…¥ï¼ˆB-2ï¼‰å—å¤–è¡¨ï¼Œç„¶åå†è¯»1500é¡µå†…è¡¨è¿›è¡Œè¿æ¥ã€‚æ‰€ä»¥ä¸€å…±æ¶ˆè€—$$4500+1500*ceil(4500/443)=21000$$&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;(b)Block nested loop join with R as the outer relation and S as the inner relation:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ğŸ§©å’Œaæ€è·¯ç›¸åŒï¼Œå†…å¤–è¡¨äº’æ¢ï¼Œ$$1500+4500*ceil(1500/443)=19500$$&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;(c)Sort-merge join with S as the outer relation and R as the inner relation:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;sort-mergeæ˜¯å…ˆæŒ‰ç…§é”®è¿›è¡Œæ’åºï¼Œç„¶åæŒ‰ç…§é¡ºåºè¿›è¡Œè¿æ¥ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;What is the cost of sorting the tuples in R on attribute a&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ’åºRè¦å¤šå°‘æ¬¡IO?ä½¿ç”¨ç¬¬ä¸€é¢˜å½’å¹¶æ’åºçš„æ€è·¯ï¼Œè¦è¿›è¡Œ$$1+log_{443}(1500/445)=2$$è¶Ÿï¼Œç„¶åè¯»å†™ä¸º$$2\times 2\times 1500=6000$$æ¬¡ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;What is the cost of sorting the tuples in S on attribute a?&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;$$1+log_{443}(4500/445)=2$$,ç„¶åè¯»å†™$$2\times 2\times 4500=18000$$æ¬¡ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;What is the cost of the merge phase in the worst-case scenario?&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;âš ï¸worst-case scenarioæŒ‡çš„æ˜¯æ‰€æœ‰æ’åºçš„å€¼éƒ½ä¸€æ ·ï¼Œè¿™ç§æƒ…å†µä¸‹è¦è¿›è¡ŒMxNæ¬¡é¡µæ¯”è¾ƒã€‚$$1, 500 \times  4, 500 = 6, 750, 000$$&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;What is the cost of the merge phase assuming there are no duplicates in the join attribute?&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;M+Næ¬¡ï¼Œæƒ³è±¡æœ‰ä¸¤ä¸ªæ¸¸æ ‡ï¼Œå¦‚æœæ²¡æœ‰é‡å¤å€¼çš„è¯ï¼Œä¸¤ä¸ªæ¸¸æ ‡ä¼šä¸€ç›´ç§»åŠ¨ã€‚$$1, 500 + 4, 500 = 6, 000$$&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Now consider joining R, S and then joining the result with T. Suppose the cost of the final merge phase is 800 and assume that there are no duplicates in the join attribute. How many pages did the join result of R and S span?&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™é“é¢˜æ˜¯å€’æ¨ï¼Œå·²çŸ¥Rå’ŒSçš„è¿è¡¨å’ŒTæœ€åjoinçš„costä¸º800ï¼Œå› ä¸ºTæœ‰200é¡µï¼Œæ•…Rå’ŒSæœ€åç”Ÿæˆ600é¡µï¼ˆç”¨æ²¡æœ‰é‡å¤å€¼æƒ…å†µä¸‹çš„M+Nçš„å…¬å¼ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;(d)Hash join with S as the outer relation and R as the inner relation. You may ignore recursive partitioning and partially filled blocks.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Sä½œä¸ºå¤–è¡¨,Rä¸ºå†…è¡¨ï¼Œå¿½ç•¥ä¸€ä¸ªbucketæ»¡äº†çš„æƒ…å†µ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;What is the cost of the probe phase?&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ï¼ˆM+Nï¼‰,æŠŠå†…å­˜ä¸­ç›¸åº”çš„bucketå–å‡ºæ¥ï¼Œç„¶åç”¨h2å†åˆ›å»ºå“ˆå¸Œç´¢å¼•è¿›è¡Œè¿æ¥æ“ä½œã€‚è¿™é‡Œç”¨å“ˆå¸Œå‡½æ•°2çš„åŸå› æ˜¯ï¼šéœ€è¦ç”Ÿæˆä¸åŒçš„å“ˆå¸Œå€¼ï¼Œå› ä¸ºä¹‹å‰åˆ†ç»„æ—¶ç”¨h1åï¼Œåœ¨ä¸€ä¸ªbucketä¸­çš„éƒ½æ˜¯ç›¸åŒçš„å“ˆå¸Œå€¼ï¼Œå†ç”¨h1å·²ç»æ²¡æ„ä¹‰äº†ï¼Œä¸èƒ½å¿«é€Ÿæ‰¾åˆ°å±æ€§çœŸæ­£ç›¸åŒçš„å…ƒç»„ã€‚ğŸŒ²&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;What is the cost of the partition phase?&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;2*(M+N),å› ä¸ºè¦æ‰«æä¸€éRå’ŒS,æŠŠå…ƒç»„åˆ†åˆ°ä¸åŒçš„bucketä¸­ï¼Œç„¶åå†å†™å›å†…å­˜ã€‚ğŸ“Š&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;(e)Assume that the tables do not fit in main memory and that a high cardinality of distinct values hash to the same bucket using your hash function h1. Which of the following approaches works the best?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æœ‰å¤§é‡ä¸åŒçš„å€¼éƒ½è¢«å“ˆå¸Œåˆ°äº†åŒæ ·çš„bucketä¸­ï¼Œ åº”è¯¥å¦‚ä½•å¤„ç†ï¼Ÿ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;âœ…Create hashtables for the inner and outer relation using h1 and rehash into an embedded hash table using h2 != h1 for large buckets ï¼ˆç”¨h2ç”Ÿæˆä¸åŒçš„å“ˆå¸Œå€¼ï¼Œå› ä¸ºä¸åŒçš„å“ˆå¸Œå‡½æ•°å†å‡ºç°è¿™ç§ç¢°æ’æ¦‚ç‡æ˜¯å¾ˆå°çš„ï¼‰&lt;/li&gt;
&lt;li&gt;Create hashtables for the inner and outer relation using h1 and rehash into an embedded hash table using h1 for large buckets&lt;/li&gt;
&lt;li&gt;Use linear probing for collisions and page in and out parts of the hashtable needed at a given time&lt;/li&gt;
&lt;li&gt;Create 2 hashtables half the size of the original one, run the same hash join algorithm on the tables, and then merge the hashtables together&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;0x3-query-execution&#34;&gt;0x3 Query Execution&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;(a) Which processing model has on average the smallest working buffer per operator invocation? Ignore optimizations like projection pushdown. Select only one answer.&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Iterator âœ…&lt;/li&gt;
&lt;li&gt;Materialization&lt;/li&gt;
&lt;li&gt;Vectorization&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Iterator ,åˆè¢«ç§°ä¸ºæµæ°´çº¿æ¨¡å‹ï¼Œå¯ä»¥ä¸€ä¸ªå…ƒç»„ä¸€ä¸ªå…ƒç»„å¤„ç†ã€‚Materialization æ˜¯æŠŠæ‰€æœ‰å…ƒç»„åˆå¹¶ï¼Œç„¶åæ¨ç»™çˆ¶èŠ‚ç‚¹ã€‚Vectorization Modelæœ‰ç‚¹åƒä¸¤ä¸ªæ¨¡å‹çš„æŠ˜ä¸­ï¼Œä¸€æ¬¡æ‹¿å¤šä¸ªtupleï¼Œæ—¢ä¸æ‹¿å®Œï¼Œä¹Ÿä¸ä¸€ä¸ªä¸€ä¸ªæ‹¿ã€‚æ‰€ä»¥ä½¿ç”¨ç¼“å­˜æœ€å°çš„æ˜¯Iteratorï¼Œå› ä¸ºå¤§éƒ¨åˆ†æƒ…å†µå®ƒå¯ä»¥å¤„ç†å•ä¸ªå…ƒç»„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;(b) In the iterator processing model, the logic of an operator is independent of its children and parents. (i.e., the code does not case on what type of iterator the children or parents are)&lt;/strong&gt; âœ…&lt;/p&gt;
&lt;p&gt;åˆ¤æ–­é¢˜ã€‚æµæ°´çº¿æ¨¡å‹ä¸­æ“ä½œå’Œçˆ¶å­ç»“ç‚¹æ— å…³ã€‚è¿™æ˜¯å¯¹çš„ï¼Œå› ä¸ºä¸€ä¸ªoperatorå®ç°nextã€closeã€emitè¿™ä¸‰ä¸ªæ¥å£å°±è¡Œäº†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;(c) In the vectorized processing model, each operator that receives input from multiple children &lt;em&gt;requires&lt;/em&gt; multi-threaded execution to generate the Next() output tuples from each child&lt;/strong&gt; âŒ&lt;/p&gt;
&lt;p&gt;å‘é‡æ¨¡å‹ä¸€å®šè¦å¤šçº¿ç¨‹ï¼Ÿæ˜¯å¯ä»¥å•çº¿ç¨‹çš„&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;(d) The iterator processing model often leads to good code locality (in the instruction cache sense).&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;localityï¼šè¿‘é‚»ã€‚æµæ°´çº¿æ¨¡å‹ä¸€å®šèƒ½å¸¦æ¥å¥½çš„ä»£ç å±€éƒ¨æ€§ï¼Ÿä¸ä¸€å®šï¼Œå› ä¸ºå¦‚æœæ˜¯ä¸€ä¸ªtupleä¸€ä¸ªtupleå¤„ç†çš„è¯ï¼Œå‡å¦‚è¿™ä¸ªæµæ°´çº¿å¾ˆé•¿ï¼Œæ¯”å¦‚é€šè¿‡å‡½æ•°f1ã€f2ã€f3&amp;hellip;..f10000,æ¯å¤„ç†ä¸€ä¸ªtuple,å°±ä¼šå°†ä»£ç ä»å†…å­˜è¯»åˆ°ç¼“å­˜ä¸­ï¼Œå¯èƒ½å°†f10000è¯»åˆ°cacheä¸­æ—¶ï¼Œå‰é¢çš„å‡½æ•°å·²ç»è¢«è¸¢å‡ºå»äº†ï¼Œæ‰€ä»¥ä»£ç å±€éƒ¨æ€§çœŸçš„ä¸è¡Œã€‚è€Œä¸”ä¸åŒå‡½æ•°ä¹‹é—´çš„nextå¯èƒ½æ˜¯è¿œç¨‹è°ƒç”¨ï¼ˆå®ƒä»¬åœ¨å†…å­˜ä¸åœ¨åŒä¸€ä¸ªé¡µä¸Šï¼‰âŒ&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;(e) An index scan is always better (fewer I/O operations, faster run-time) than a sequential scan, regardless of the processing model.&lt;/strong&gt; âŒ&lt;/p&gt;
&lt;p&gt;ç´¢å¼•æ‰«æä¸€å®šæ¯”é¡ºåºæ‰«æå¥½ï¼Ÿä¸ä¸€å®šï¼Œå¦‚æœæ˜¯éèšç°‡ç´¢å¼•ï¼Œæ‰«æä¼šä¸åœåœ°è¯»å–ä¸åŒçš„é¡µã€‚è€Œä¸”é€šè¿‡ä¼˜åŒ–é¡ºåºæ‰«æï¼Œé€šè¿‡æŠŠä¸‹ä¸€é¡µæå‰æ‹¿åˆ°å†…å­˜ä¸­ï¼Œå¯èƒ½è¿˜æ›´å¿«ã€‚Postgreçš„ä¼˜åŒ–å™¨å¦‚æœé¢„æµ‹åˆ°è¦æ‹¿è¶…è¿‡10%çš„è¡Œï¼Œé‚£ä¹ˆä¼šè¿›è¡Œé¡ºåºæ‰«æã€‚&lt;/p&gt;
&lt;h2 id=&#34;0x4-æ€»ç»“&#34;&gt;0x4 æ€»ç»“&lt;/h2&gt;
&lt;p&gt;é€šè¿‡è¿™æ¬¡ä½œä¸šï¼ŒåŠ æ·±äº†å¯¹å½’å¹¶æ’åºï¼Œè¿æ¥æ“ä½œï¼ŒæŸ¥è¯¢æ‰§è¡Œçš„ç†è§£ã€‚è¿™äº›çŸ¥è¯†ç‚¹åœ¨è¯¾ä»¶ä¸Šå…¨éƒ½æœ‰ï¼Œä¸Šè¯¾ä¹Ÿè®²è¿‡ã€‚é€šè¿‡å®šé‡åˆ†æä¹Ÿæ˜¯å¯¹æ“ä½œçš„æµç¨‹æœ‰äº†æŒæ¡ã€‚&lt;/p&gt;
</description>
        </item>
        <item>
        <title>æŸ¥è¯¢è®¡åˆ’ä¸ä¼˜åŒ–</title>
        <link>https://antio2.cn/tech/database/query/</link>
        <pubDate>Tue, 21 Mar 2023 20:31:24 +0800</pubDate>
        
        <guid>https://antio2.cn/tech/database/query/</guid>
        <description>&lt;h2 id=&#34;é€»è¾‘è®¡åˆ’ä¸ç‰©ç†è®¡åˆ’&#34;&gt;é€»è¾‘è®¡åˆ’ä¸ç‰©ç†è®¡åˆ’&lt;/h2&gt;
&lt;p&gt;é€»è¾‘è®¡åˆ’ä¸ç‰©ç†è®¡åˆ’ä¸¤è€…çš„åŒºåˆ«åœ¨äºï¼šé€»è¾‘è®¡åˆ’å‘Šè¯‰ä½ ç®—å­çš„æ§åˆ¶æµç¨‹ï¼Œè€Œç‰©ç†è®¡åˆ’æŒ‡å®šç®—å­çš„å…·ä½“æ‰§è¡Œæ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;å…·ä½“æ¥è¯´ï¼Œä¸€ä¸ªé€»è¾‘è®¡åˆ’çš„ç®—å­ä¸ºScan, ç‰©ç†è®¡åˆ’å¯ä»¥ç”ŸæˆIndex Scanæˆ–è€…Seq Scanã€‚å†æ¯”å¦‚Join: å¯èƒ½å­˜åœ¨Sort Join,Hash Join&amp;hellip;&lt;/p&gt;
&lt;h3 id=&#34;ä¼˜åŒ–æœç´¢ä¸­æ­¢&#34;&gt;ä¼˜åŒ–æœç´¢ä¸­æ­¢&lt;/h3&gt;
&lt;p&gt;å› ä¸ºæŸ¥æ‰¾ä¸€ä¸ªæœ€ä¼˜çš„æŸ¥è¯¢è®¡åˆ’æ˜¯ä¸€ä¸ªNPé—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ‰¾åˆ°åœä¸‹æ¥çš„æ–¹æ³•ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¦‚æœä¼˜åŒ–å™¨è¿è¡Œä¸€å®šæ—¶é—´ï¼Œä¸­æ­¢ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœä¸€ä¸ªè®¡åˆ’ä¼˜åŒ–å¾—è¶³å¤Ÿå·ï¼Œä¸­æ­¢ã€‚&lt;/li&gt;
&lt;li&gt;å½“ç©·ä¸¾å®Œæ¯•ï¼Œä¸­æ­¢ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;heuristic-based&#34;&gt;Heuristic-Based&lt;/h2&gt;
&lt;p&gt;å¯å‘å¼ç®—æ³•ï¼šé€šè¿‡è§„åˆ™ï¼Œæ‰§è¡Œä»é€»è¾‘åˆ°ç‰©ç†çš„è½¬åŒ–æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å¯¹äºç¬¦åˆè¦æ±‚çš„ï¼Œæ€»æ˜¯åº”ç”¨è§„åˆ™ã€‚æ‰€ä»¥è¿™æ˜¯é™æ€çš„ä¼˜åŒ–æ–¹å¼ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç¼ºç‚¹åœ¨äº&lt;strong&gt;å„ç§é…ç½®éœ€è¦å†™åœ¨ä»£ç é‡Œé¢&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;heuristic--cost-based-join-search&#34;&gt;Heuristic + Cost-Based Join Search&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;Example: System R&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨é™æ€çš„è§„åˆ™è¿›è¡Œæœ€åˆçš„ä¼˜åŒ–ã€‚ç„¶åä½¿ç”¨åŠ¨æ€è§„åˆ’è¿›è¡Œjoin reorder(é€šè¿‡åˆ†æ²»)ã€‚&lt;/p&gt;
&lt;p&gt;æœ€åˆåªè¿›è¡Œå·¦æ·±æ ‘çš„ä¼˜åŒ–ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;åˆ†å±‚æœç´¢&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Starburst:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Query Rewrite&lt;/li&gt;
&lt;li&gt;Plan Optimization&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ç«å±±ä¼˜åŒ–&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åŸºäºæˆæœ¬çš„ä¼˜åŒ–å™¨ã€‚&lt;/p&gt;
&lt;p&gt;æŸ¥è¯¢ä¼˜åŒ–æ¦‚è¿°&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æŸ¥è¯¢ä¼˜åŒ–çš„ä¸¤ç§æ–¹æ³•ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Rules:é€šè¿‡é™æ€çš„æ¡ä»¶åˆ¤æ–­ï¼Œæ¥é‡å†™æŸ¥è¯¢ã€‚é€šè¿‡æŸ¥çœ‹catalogè€Œä¸æ˜¯æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;Cost-based æšä¸¾SQLçš„æ‰€æœ‰æ–¹æ¡ˆï¼Œå¹¶ä¸”é¢„ä¼°æˆæœ¬ç„¶åé€‰æ‹©æˆæœ¬ä½çš„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æŸ¥è¯¢ä¼˜åŒ–çš„æµæ°´çº¿&#34;&gt;æŸ¥è¯¢ä¼˜åŒ–çš„æµæ°´çº¿&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;SQL Rewriter å¯¹SQLè¯­å¥è¿›è¡Œé‡å†™æ ‡è®°ä¸Šé¢å¤–ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰&lt;/li&gt;
&lt;li&gt;Parser è¿›è¡Œç¼–è¯‘ï¼Œå°†sQLè½¬åŒ–ä¸ºè¯­æ³•æ ‘&lt;/li&gt;
&lt;li&gt;Binder å°†SQLå¼•ç”¨çš„ç¬¦å·è½¬åŒ–ä¸ºå†…éƒ¨æ ‡è®°ã€‚æ¯”å¦‚&lt;code&gt;select * from foo&lt;/code&gt;,ä¼šé€šè¿‡å­—ç¬¦ä¸²&amp;quot;foo&amp;quot;æ¥å¯»æ‰¾ç›¸åº”çš„è¡¨ã€‚&lt;/li&gt;
&lt;li&gt;Logical Plan&lt;/li&gt;
&lt;li&gt;Tree Rewiteré€šè¿‡æŸ¥è¯¢system catalogæ¥è¿›è¡Œä¼˜åŒ–&lt;/li&gt;
&lt;li&gt;è¿›å…¥Optimizer,è®¡ç®—æˆæœ¬æ¨¡å‹&lt;/li&gt;
&lt;li&gt;ç”Ÿæˆç‰©ç†è®¡åˆ’&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;é€»è¾‘è®¡åˆ’å’Œç‰©ç†è®¡åˆ’çš„åŒºåˆ«ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;é€»è¾‘è®¡åˆ’ç”Ÿæˆå…³ç³»ä»£æ•°è¡¨è¾¾å¼ï¼Œç‰©ç†è®¡åˆ’ä½¿ç”¨å…·ä½“çš„æ“ä½œç¬¦ï¼Œæ˜¯å®é™…æ‰§è¡Œçš„åº•å±‚é€»è¾‘ã€‚é€»è¾‘è®¡åˆ’å’Œç‰©ç†è®¡åˆ’ä¸ä¸€å®šä¸€ä¸€å¯¹åº”ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¼˜åŒ–æ–¹æ³•&#34;&gt;ä¼˜åŒ–æ–¹æ³•&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;Predicate Pushdown,é€šè¿‡æå‰æ‰§è¡Œè°“è¯­ï¼ˆä»è¯­æ³•æ ‘ä¸Šå¾€ä¸‹æ¨ï¼‰ï¼Œæ¥å‡å°‘å·¥ä½œé‡&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Selectionsï¼šè¶Šæ—©æ‰§è¡Œè¿‡æ»¤æ“ä½œè¶Šå¥½ã€‚&lt;/li&gt;
&lt;li&gt;Projections: ææ—©æ‰§è¡Œï¼Œæ¥æœ€å°åŒ–è¦æ‰§è¡Œçš„å…ƒç»„æ•°æ®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;å•ä¸€å…³ç³»æ¨¡å‹&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é¡ºåºæŸ¥è¯¢&lt;/li&gt;
&lt;li&gt;èšç°‡ç´¢å¼•&lt;/li&gt;
&lt;li&gt;ç´¢å¼•æ‰«æ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é¦–å…ˆåˆ¤æ–­æ˜¯å¦sargable(Search Argument  Able)æ˜¯å¦åˆå¯¹åº”ç´¢å¼•ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨å¤§å¤šæ•°DBMSé‡‡ç”¨heuristics(å¯å‘å¼)è€Œä¸æ˜¯ç²¾ç¡®çš„æ¨¡å‹ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªsargableçš„queryèƒ½å¾ˆå®¹æ˜“è¢«å¯å‘å¼çš„æ¨¡å‹æ‰§è¡Œã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å¤šä¸ªå…³ç³»æ¨¡å‹&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å¯ä»¥æšä¸¾çš„ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ“ä½œé¡ºåº&lt;/li&gt;
&lt;li&gt;æ“ä½œçš„æ–¹æ³•ï¼šæ¯”å¦‚hashã€sort-mergeã€nested loop&amp;hellip;&lt;/li&gt;
&lt;li&gt;æ‹¿åˆ°æ•°æ®çš„æ–¹æ³•ï¼šIndex#1ã€Index#2ã€Seq Scan&amp;hellip;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;éšç€joinæ•°é‡çš„å¢åŠ ï¼Œå¯è¡Œçš„æ‰€æœ‰æ–¹æ³•ä¹Ÿä¼šå¢åŠ ï¼Œæ•…ä¸èƒ½ä½¿ç”¨æšä¸¾ï¼Œè¦é™åˆ¶æœç´¢çš„æ•°é‡æ¥åœ¨å¯æ¥å—çš„æ—¶é—´å†…æ‰¾åˆ°ä¼˜åŒ–çš„æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è‡ªåº•å‘ä¸Šï¼šä»nothingé€æ¸æ„å»ºæ–¹æ¡ˆã€‚ä¾‹å­ï¼šIBM System R, DB2, MySQL, Postgres, most open-source DBMSs&lt;/li&gt;
&lt;li&gt;è‡ªé¡¶å‘ä¸‹ï¼šä»æƒ³è¦çš„ç»“æœå¼€å§‹ï¼Œç„¶åä»è¯­æ³•æ ‘ä¸Šåˆ°ä¸‹ä¼˜åŒ–ã€‚ä¾‹å­ï¼šMSSQL, Greenplum, CockroachDB, Volcano&lt;/li&gt;
&lt;li&gt;é—ä¼ ç®—æ³• PostgreSQL(GEQ)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;è‡ªåº•å‘ä¸Šä¼˜åŒ–ï¼šSystem R&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;ç ”ç©¶&#34;&gt;ç ”ç©¶&lt;/h2&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://dbdb.io/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Home - Database of Databases (dbdb.io)&lt;/a&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>CMU15-445|Project2 B&#43;æ ‘ç´¢å¼•çš„å®ç°</title>
        <link>https://antio2.cn/tech/database/lab2/</link>
        <pubDate>Sat, 21 Jan 2023 00:00:00 +0000</pubDate>
        
        <guid>https://antio2.cn/tech/database/lab2/</guid>
        <description>&lt;h2 id=&#34;ä»»åŠ¡1-b-tree-page&#34;&gt;ä»»åŠ¡1 B+ Tree Page&lt;/h2&gt;
&lt;p&gt;è¿™ä¸€éƒ¨åˆ†è¦æ±‚å®ç°ä¸‰ä¸ªç±»ï¼Œä¸»è¦æ˜¯Getterå’ŒSetteræ–¹æ³•ã€‚æ³¨æ„ä¸€ä¸‹ç†è§£å°±å¥½äº†ï¼Œæ¯ä¸€ä¸ªç±»çš„å†…å­˜åˆ†é…æ˜¯å…ˆå¤´å­—èŠ‚ï¼Œç„¶åæ˜¯é”®å€¼å¯¹ï¼Œleaf pageçš„å¤´å­—èŠ‚æ˜¯28ï¼Œinternal pageçš„å¤´å­—èŠ‚æ˜¯24ã€‚&lt;/p&gt;
&lt;p&gt;internal pageæœ‰ä¸€ä¸ªå±æ€§ï¼š&lt;code&gt;MappingType array_[1];&lt;/code&gt;,MappingTypeæ˜¯é”®å€¼å¯¹&lt;code&gt;std::pair&amp;lt;KeyType, ValueType&amp;gt;&lt;/code&gt;çš„å®ï¼Œé€šè¿‡è¯¥æ•°ç»„æˆ‘ä»¬ç›´æ¥å¯¹å†…å­˜è¿›è¡Œè¯»å†™ï¼Œæ¯”å¦‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;void B_PLUS_TREE_INTERNAL_PAGE_TYPE::SetKeyAt(int index, const KeyType &amp;amp;key) {
  array_[index].first = key;
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¿™ä¹Ÿç®—æ˜¯åˆ©ç”¨äº†æ•°ç»„è¶Šç•Œçš„ç‰¹æ€§ï¼Œæ„Ÿè§‰æŒºå¦™çš„ã€‚&lt;/p&gt;
&lt;p&gt;è¿˜æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯C++çš„å˜é‡åˆå§‹åŒ–&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;auto B_PLUS_TREE_LEAF_PAGE_TYPE::KeyAt(int index) const -&amp;gt; KeyType {
  // replace with your own code
  KeyType key{array_[index].first};
  return key;
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä½¿ç”¨è¿™ä¸ªæ–¹å¼æ¥è¿”å›KeyTypeç±»å‹çš„å€¼ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä»»åŠ¡2-btree-data-structure&#34;&gt;ä»»åŠ¡2 B+Tree Data Structure&lt;/h2&gt;
&lt;p&gt;å®Œæˆäº†ç¬¬ä¸€ä¸ªéƒ¨åˆ†çš„åŸºæœ¬é¡µé¢å®ç°åï¼Œæˆ‘ä»¬åœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡ŒB+æ ‘çš„æ¥å£å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œçš„B+æ ‘åªæ”¯æŒ&lt;code&gt;unique key&lt;/code&gt;ï¼Œæ‰€ä»¥å½“å°è¯•æ’å…¥ç›¸åŒkeyæ—¶ï¼Œè¿”å›&lt;code&gt;false&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;B+æ ‘çš„ç®—æ³•å¯ä»¥çœ‹è¿™é‡Œ&lt;a class=&#34;link&#34; href=&#34;https://zh.wikipedia.org/wiki/B%2B%e6%a0%91&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;&amp;ndash;&amp;gt;B+æ ‘&lt;/a&gt;ï¼Œç»™æ²¡æœ‰æ¥è§¦è¿‡çš„åŒå­¦ç®€å•ä»‹ç»ä»¥ä¸‹ï¼ŒB+æ ‘å’Œä¹‹å‰å­¦è¿‡çš„é‚£äº›æ•°æ®ç»“æ„æœ‰ä¸ªä¸åŒï¼Œå°±æ˜¯å…¶ä»–ç®—æ³•çš„æ•°æ®æ”¾åœ¨ä¸»å­˜é‡Œï¼Œè€ŒB+æ ‘å¤šæ•°èŠ‚ç‚¹æ˜¯å­˜å‚¨åœ¨ç¡¬ç›˜ä¸Šçš„ï¼ˆè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦å…ˆå®ç°å†…å­˜ç®¡ç†å™¨Buffer Poolå’ŒB+æ ‘é¡µé¢ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªé¡¹ç›®çš„B+æ ‘å­˜å‚¨æ˜¯åŸºäº&lt;code&gt;BUSTUB_PAGE&lt;/code&gt;çš„ã€‚&lt;/p&gt;
&lt;h3 id=&#34;insertéƒ¨åˆ†&#34;&gt;Insertéƒ¨åˆ†&lt;/h3&gt;
&lt;h4 id=&#34;é¢˜ç›®åˆ†æ&#34;&gt;é¢˜ç›®åˆ†æ&lt;/h4&gt;
&lt;p&gt;è¿™ä¸ªä»»åŠ¡æ˜¯åœ¨&lt;code&gt;src/storage/index/b_plus_tree.cpp&lt;/code&gt;é‡Œé¢å®ç°çš„ã€‚&lt;/p&gt;
&lt;p&gt;åšä¹‹å‰æˆ‘ä»¬å…ˆçœ‹çœ‹å¤´æ–‡ä»¶é‡Œé¢æœ‰ä»€ä¹ˆ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;index_name_:ç´¢å¼•çš„åå­—&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;root_page_id_:æ ¹é¡µçš„idï¼Œåˆå§‹ä¸ºINVALID_PAGE_ID&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;buffer_pool_manager_ï¼šå†…å­˜ç®¡ç†æ± &lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;comparator_ï¼Œç”¨äºæ¯”è¾ƒkey&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;pre&gt;&lt;code&gt;  leaf_max_size_(leaf_max_size),
  internal_max_size_(internal_max_size) {}
  åˆ†åˆ«æ˜¯leafå’Œinternalçš„max size
  çœ‹äº†è¿™äº›ä¹‹åè¿˜æ˜¯æ„Ÿè§‰æœ‰äº›äº‘é‡Œé›¾é‡Œçš„ï¼Œäºæ˜¯çœ‹`test/storage/b_plus_tree_insert_test.cpp`
  ![](88b8de7f57474b0e9c7c87ac964b5d20.png)
  æµ‹è¯•ä»£ç ä¸­é¦–å…ˆç”Ÿæˆäº†ä¸€ä¸ªComparator,ç„¶é€šè¿‡æ–‡ä»¶å&amp;quot;test.db&amp;quot;ç”Ÿæˆäº†ä¸€ä¸ªdisk_manager,ç„¶åç”Ÿæˆäº†bufferpoolmanagerã€‚æœ€åå°†åå­—&amp;quot;foo_pk&amp;quot;,bpm,comparatorï¼Œå’Œleaf_max_size ï¼Œinternal_max_sizeä¼ å…¥ç”Ÿæˆäº†ä¸€ä¸ªBPlusTreeã€‚åœ¨è¿™é‡Œï¼ŒkeyTypeä¸ºGenericKey&amp;lt;8&amp;gt;,valueTypeä¸ºRIDã€‚
  ![header_page](6af2fa5a5d714c2a9803ed2e29576462.png)
  æ¥ä¸‹æ¥åˆ›å»ºäº†ä¸€ä¸ªä½œä¸ºheader_pageçš„é¡µé¢ã€‚![](92bf6439c4ac4b35b3b385268ed8e1d8.png)
  header_pageçš„page_id_æ€»æ˜¯ä¸º0ï¼Œç”¨äºå­˜å‚¨å…ƒæ•°æ®ã€‚åŒ…å«ç´¢å¼•åç§°å’Œå¯¹åº”çš„root_idçš„ä¿¡æ¯ã€‚![](5963c6188ed64797bcbe2c23e05d3c6a.png)
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;HeaderPageæœ‰ä¸‰ä¸ªæ–¹æ³•ï¼Œç”¨äºç®¡ç†ç›¸å…³ä¿¡æ¯ã€‚é€šè¿‡&lt;code&gt;auto GetRootId(const std::string &amp;amp;name, page_id_t *root_id) -&amp;gt; bool;&lt;/code&gt;ï¼Œå¯ä»¥è·å–root_id
&lt;img src=&#34;https://antio2.cn/tech/database/lab2/65ddaa24b3b941158bfadcad89552cd9.png&#34;
	width=&#34;964&#34;
	height=&#34;497&#34;
	srcset=&#34;https://antio2.cn/tech/database/lab2/65ddaa24b3b941158bfadcad89552cd9_hu3a73c0281331e0684ecdb9a6b180f9a6_95702_480x0_resize_box_3.png 480w, https://antio2.cn/tech/database/lab2/65ddaa24b3b941158bfadcad89552cd9_hu3a73c0281331e0684ecdb9a6b180f9a6_95702_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;193&#34;
		data-flex-basis=&#34;465px&#34;
	
&gt;
æµ‹è¯•æ¥ä¸‹æ¥æ£€éªŒæ’å…¥æ˜¯å¦æˆåŠŸã€‚&lt;/p&gt;
&lt;h4 id=&#34;é¢˜ç›®å®ç°&#34;&gt;é¢˜ç›®å®ç°&lt;/h4&gt;
&lt;p&gt;é¦–å…ˆå®ç°&lt;code&gt;IsEmpty()&lt;/code&gt;ï¼Œå¦‚æœ&lt;code&gt;root_page_id_==INVALID_PAGE_ID&lt;/code&gt;,è¿”å›trueã€‚
ç„¶åå®ç°&lt;code&gt;GetValue()&lt;/code&gt;å‡½æ•°ï¼Œæˆ‘è¿™é‡Œç²—ç•¥ç”»äº†ä¸ªæµç¨‹å›¾
&lt;img src=&#34;https://antio2.cn/tech/database/lab2/cecf5c0d7dd2414db8ddb77eef9b9af4.png&#34;
	width=&#34;827&#34;
	height=&#34;982&#34;
	srcset=&#34;https://antio2.cn/tech/database/lab2/cecf5c0d7dd2414db8ddb77eef9b9af4_hud5da62475e559f7a3ac14fbb80e13e12_96546_480x0_resize_box_3.png 480w, https://antio2.cn/tech/database/lab2/cecf5c0d7dd2414db8ddb77eef9b9af4_hud5da62475e559f7a3ac14fbb80e13e12_96546_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;æµç¨‹å›¾-GetValue&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;84&#34;
		data-flex-basis=&#34;202px&#34;
	
&gt;
å…ˆåˆ†åˆ«æŠŠå†…éƒ¨ç»“ç‚¹å’Œå¶å­ç»“ç‚¹çš„äºŒåˆ†æŸ¥æ‰¾å†™å‡ºæ¥ã€‚
&lt;img src=&#34;https://antio2.cn/tech/database/lab2/fffcae65314549dca88bb02a77924296.png&#34;
	width=&#34;1078&#34;
	height=&#34;314&#34;
	srcset=&#34;https://antio2.cn/tech/database/lab2/fffcae65314549dca88bb02a77924296_hu9e3e616a30492596f4d2e5fc2a883725_59892_480x0_resize_box_3.png 480w, https://antio2.cn/tech/database/lab2/fffcae65314549dca88bb02a77924296_hu9e3e616a30492596f4d2e5fc2a883725_59892_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;å†…éƒ¨ç»“ç‚¹&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;343&#34;
		data-flex-basis=&#34;823px&#34;
	
&gt;
ç„¶åæ˜¯å¶å­ç»“ç‚¹ï¼Œæ³¨æ„æˆ‘è¿™é‡Œå’Œå†…éƒ¨ç»“ç‚¹æœ‰äº›ä¸åŒï¼Œä¸èƒ½ç›´æ¥è¿”å›ValueTypeç±»å‹ï¼Œè€Œæ˜¯éœ€è¦åˆ¤æ–­æ˜¯å¦æ‰¾åˆ°äº†ã€‚
&lt;img src=&#34;https://antio2.cn/tech/database/lab2/84b6539c5d9b47a4a44920eabe37a44e.png&#34;
	width=&#34;974&#34;
	height=&#34;272&#34;
	srcset=&#34;https://antio2.cn/tech/database/lab2/84b6539c5d9b47a4a44920eabe37a44e_hu9556e469201920f58bd296af7b0fd723_50125_480x0_resize_box_3.png 480w, https://antio2.cn/tech/database/lab2/84b6539c5d9b47a4a44920eabe37a44e_hu9556e469201920f58bd296af7b0fd723_50125_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;358&#34;
		data-flex-basis=&#34;859px&#34;
	
&gt;
å®Œæˆè¿™ä¸¤ä¸ªå¸®åŠ©å‡½æ•°åï¼Œæ ¹æ®æµç¨‹å›¾å®ŒæˆGetValueéƒ¨åˆ†çš„ä»£ç ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€äº›æ³¨æ„ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡&lt;code&gt;reinterpret_cast&amp;lt;BPlusTreePage *&amp;gt;(buffer_pool_manager_-&amp;gt;FetchPage(page_id_)-&amp;gt;GetData());&lt;/code&gt;æ¥ä»buffer_poolä¸­è·å–é¡µ&lt;/li&gt;
&lt;li&gt;æ¯æ¬¡Findåˆ°æƒ³è¦çš„æ•°æ®ä¹‹åï¼Œè®°å¾—Unpin&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;æ¥ä¸‹æ¥è€ƒè™‘åˆ†è£‚çš„æƒ…å†µ&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœæ˜¯å¶ç»“ç‚¹ï¼Œä¹‹å‰æœ‰n-1ä¸ªé”®å€¼å¯¹ï¼Œå†æ’å…¥ä¸€ä¸ªé”®å€¼å¯¹åˆ°è¾¾max_size,æ­¤æ—¶åˆ†è£‚ï¼Œå¹¶ä¸”å‰[n/2]ä¸ªç»“ç‚¹æ”¾åœ¨åŸæ¥ç»“ç‚¹ï¼Œå‰©ä¸‹çš„æ”¾åœ¨æ–°ç»“ç‚¹ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœæ˜¯éå¶ç»“ç‚¹ï¼Œé‚£ä¹ˆåˆ†è£‚ä¹‹åï¼Œæœ¬æ¥è¯¥ç§»åŠ¨åˆ°æ–°èŠ‚ç‚¹çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¸ä¼šè¢«æ·»åŠ ï¼ˆå› ä¸ºéå¶ç»“ç‚¹çš„key0éšå«äº†ï¼‰ï¼Œè€Œæ˜¯ä¼šè¢«æ·»åŠ åˆ°è¯¥éå¶èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœè¿˜æ²¡æ‡‚çš„è¯ï¼Œæ¨èç”¨CMUæä¾›çš„åœ¨çº¿å·¥å…·è‡ªå·±å»è¯•è¯•çš„ï¼Œç½‘å€åœ¨è¿™é‡Œ&lt;a class=&#34;link&#34; href=&#34;https://15445.courses.cs.cmu.edu/fall2022/bpt-printer/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;BusTub B+ Tree Printer&lt;/a&gt;
&lt;img src=&#34;https://antio2.cn/tech/database/lab2/0607af567e9d4cb5b7cf03e3a5e6bc6c.png&#34;
	width=&#34;1569&#34;
	height=&#34;833&#34;
	srcset=&#34;https://antio2.cn/tech/database/lab2/0607af567e9d4cb5b7cf03e3a5e6bc6c_huc5d8d58ac626f64bcfac6928281e2d41_131515_480x0_resize_box_3.png 480w, https://antio2.cn/tech/database/lab2/0607af567e9d4cb5b7cf03e3a5e6bc6c_huc5d8d58ac626f64bcfac6928281e2d41_131515_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;188&#34;
		data-flex-basis=&#34;452px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;ç”»å‡ºæµç¨‹å›¾å¦‚ä¸‹
&lt;img src=&#34;https://antio2.cn/tech/database/lab2/eb6f5ce84fd74e468ce3d4cc9014e419.png&#34;
	width=&#34;739&#34;
	height=&#34;1382&#34;
	srcset=&#34;https://antio2.cn/tech/database/lab2/eb6f5ce84fd74e468ce3d4cc9014e419_hu7b265f995ecefa7a505975fb8428c3b3_120793_480x0_resize_box_3.png 480w, https://antio2.cn/tech/database/lab2/eb6f5ce84fd74e468ce3d4cc9014e419_hu7b265f995ecefa7a505975fb8428c3b3_120793_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;53&#34;
		data-flex-basis=&#34;128px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;ç”»å‡ºæµç¨‹å›¾ä¹‹åï¼Œå°±å¯ä»¥å®ç°ä»£ç äº†ã€‚
è¿™é‡Œæ’å…¥æœ‰ä¸€ä¸ªé—®é¢˜ï¼š&lt;em&gt;å°±æ˜¯æ‰¾åˆ°äº†å¯¹åº”çš„ä½ç½®åè¯¥å¦‚ä½•æ’å…¥å‘¢&lt;/em&gt;?é”®å€¼å¯¹åœ¨é¡µä¸Šæ˜¯ç›´æ¥é¡ºåºå‚¨å­˜çš„ï¼Œå¥½åƒåªèƒ½é‡‡ç”¨O(n)çš„æ–¹æ³•æŠŠç©ºä½ä¾æ¬¡æŒªå‡ºæ¥ã€‚è¿™ä¸ªçœ‹ä¼¼æ—¶é—´å¤æ‚åº¦å¾ˆé«˜ï¼Œä½†æ˜¯æ˜¯åœ¨å†…å­˜ä¸Šè¿›è¡Œæ“ä½œçš„ï¼Œå†³å®šæ—¶é—´å¤æ‚åº¦ä¸»è¦çš„å› ç´ åº”è¯¥æ˜¯ç£ç›˜è¯»å–çš„æ—¶é—´ï¼Œæ‰€ä»¥åœ¨å†…å­˜ä¸Šçš„è¯»å–æ—¶é—´å¯ä»¥å¿½ç•¥ä¸è®°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä¸€äº›ä»£ç å®ç°æ³¨æ„äº‹é¡¹&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¯æ¬¡ç”³è¯·äº†æ–°é¡µé¢ï¼Œä½¿ç”¨pageçš„GetData()æ–¹æ³•è½¬åŒ–ä¸ºB+æ ‘çš„pageç±»å‹&lt;/li&gt;
&lt;li&gt;è®°å¾—Initåˆå§‹åŒ–é¡µé¢ï¼Œè¿™é‡Œä¼šåˆå§‹åŒ–page_idå’Œparent_id,ç¼“å†²åŒºä¸­çš„pageè‡ªå¸¦çš„idå’Œb+æ ‘é¡µçš„page_idæ˜¯ä¸ä¸€æ ·çš„ï¼æ‰€ä»¥è¿™æ­¥å¾ˆé‡è¦&lt;/li&gt;
&lt;li&gt;è®°å¾—æ‰‹åŠ¨SetPageType&lt;/li&gt;
&lt;li&gt;è®°å¾—Unpin&lt;/li&gt;
&lt;li&gt;åœ¨å†™çš„æ—¶å€™æ‰å‘ç°ï¼ŒInsertParentåªèƒ½å†™åœ¨b_plus_tree_internal_pageé‡Œé¢ï¼ŒåŸå› æ˜¯b_plus_treeå’Œb_plus_tree_internal_pageä¸¤ä¸ªç±»çš„æ¨¡æ¿ä¸­çš„ValueTypeä¸åŒã€‚&lt;/li&gt;
&lt;li&gt;æ¯æ¬¡æ’å…¥åè®°å¾—IncreaseSize()&lt;/li&gt;
&lt;li&gt;InternalPageåœ¨åˆ†è£‚åï¼Œæ–°çš„internal_pageä¸­ï¼ŒValueæ‰€æŒ‡å‘çš„å­é¡µé¢éƒ½è¦æ›´æ–°parent_id
-&lt;img src=&#34;https://antio2.cn/tech/database/lab2/1077e08e082448f087e24b7e73ba31ae.png&#34;
	width=&#34;477&#34;
	height=&#34;256&#34;
	srcset=&#34;https://antio2.cn/tech/database/lab2/1077e08e082448f087e24b7e73ba31ae_hu4da811e306e78c2a5252a56c6d020e15_32621_480x0_resize_box_3.png 480w, https://antio2.cn/tech/database/lab2/1077e08e082448f087e24b7e73ba31ae_hu4da811e306e78c2a5252a56c6d020e15_32621_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;186&#34;
		data-flex-basis=&#34;447px&#34;
	
&gt;
å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•æ¥è°ƒè¯•ï¼Œæ‰“å°B+æ ‘çš„ç»“ç‚¹ğŸŒ²ï¼Œæ¥çœ‹è‡ªå·±å†™å¯¹æ²¡æœ‰ã€‚å†™å®Œä¹‹åé€šè¿‡b_plus_tree_insert_testçš„å‰ä¸¤ä¸ªæµ‹è¯•ç‚¹ï¼ˆç¬¬ä¸‰ä¸ªéœ€è¦å®ç°Task3ï¼‰ã€‚
&lt;img src=&#34;https://antio2.cn/tech/database/lab2/ec126923c7b7415f865e967819f4a49c.png&#34;
	width=&#34;682&#34;
	height=&#34;391&#34;
	srcset=&#34;https://antio2.cn/tech/database/lab2/ec126923c7b7415f865e967819f4a49c_hu928602eae73deef09492bd9d860d9897_68283_480x0_resize_box_3.png 480w, https://antio2.cn/tech/database/lab2/ec126923c7b7415f865e967819f4a49c_hu928602eae73deef09492bd9d860d9897_68283_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;174&#34;
		data-flex-basis=&#34;418px&#34;
	
&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;deleteéƒ¨åˆ†&#34;&gt;Deleteéƒ¨åˆ†&lt;/h3&gt;
&lt;p&gt;è¿™ä¸€éƒ¨åˆ†å®ç°&lt;code&gt;Remove(const KeyType &amp;amp;key, Transaction *transaction) {}&lt;/code&gt;
é¦–å…ˆç”»å‡ºæµç¨‹å›¾
&lt;img src=&#34;https://antio2.cn/tech/database/lab2/d75e2b85cfe94491804f3b5702467aca.png&#34;
	width=&#34;1390&#34;
	height=&#34;1703&#34;
	srcset=&#34;https://antio2.cn/tech/database/lab2/d75e2b85cfe94491804f3b5702467aca_hubb7f6cef3a29a596b83625da08655c5c_582840_480x0_resize_box_3.png 480w, https://antio2.cn/tech/database/lab2/d75e2b85cfe94491804f3b5702467aca_hubb7f6cef3a29a596b83625da08655c5c_582840_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;81&#34;
		data-flex-basis=&#34;195px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;ï¼ˆè¿™é‡Œå›¾ç‰‡ä¸èƒ½ç”¨SVGï¼Œä¸çŸ¥é“èƒ½å¦çœ‹æ¸…æ¥šï¼‰æœ€åé‡æ–°åˆ†å¸ƒï¼Œä»L&amp;rsquo;å€Ÿä¸€ä¸ªç´¢å¼•é¡¹ï¼Œä¹¦ä¸Šå¶ç»“ç‚¹å’Œéå¶ç»“ç‚¹æ˜¯ä¸¤ç§æƒ…å†µï¼Œä½†æ˜¯å®é™…ä¸Šåœ¨ä»£ç å®ç°ä¸­ï¼Œå†…éƒ¨èŠ‚ç‚¹æ˜¯æœ‰ç¬¬ä¸€ä¸ªkeyä½†æ˜¯ä¸ä½¿ç”¨ï¼Œæ•…ä¸¤ç§æƒ…å†µæ˜¯å¯¹é½çš„ï¼Œä¸å†åˆ†å¼€è®¨è®ºã€‚
ğŸ¥°ç„¶åå†™ä»£ç å®ç°çš„æ—¶å€™è®°å¾—ç»†å¿ƒä¸€ç‚¹ï¼Œå¦‚æœå‡ºé”™äº†å°±ç”¨IDEè°ƒè¯•ï¼Œç„¶åå¯¹ç…§æµç¨‹å›¾çœ‹å“ªé‡Œå‡ºé”™äº†ã€‚é¦–å…ˆåº”è¯¥æœ¬åœ°å¯ä»¥é€šè¿‡æµ‹è¯•ç‚¹1
&lt;img src=&#34;https://antio2.cn/tech/database/lab2/56f7159d19f748c6a571b5ae76b1176c.png&#34;
	width=&#34;882&#34;
	height=&#34;366&#34;
	srcset=&#34;https://antio2.cn/tech/database/lab2/56f7159d19f748c6a571b5ae76b1176c_hub7811b671d246fcc99097c7e39a14268_65429_480x0_resize_box_3.png 480w, https://antio2.cn/tech/database/lab2/56f7159d19f748c6a571b5ae76b1176c_hub7811b671d246fcc99097c7e39a14268_65429_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;240&#34;
		data-flex-basis=&#34;578px&#34;
	
&gt;
ç„¶åè®°å¾—æäº¤ä¹‹å‰ç”¨&lt;code&gt;check-lint&lt;/code&gt;æ£€æŸ¥ä¸€ä¸‹æ ¼å¼ä»¥åŠ&lt;code&gt;check-clang-tidy-p2&lt;/code&gt;æ£€æŸ¥ä»£ç è§„èŒƒï¼Œæœ‰æ—¶å€™ç”¨&lt;code&gt;make format&lt;/code&gt;æ˜¯æ ¼å¼åŒ–ä¸å®Œçš„ã€‚
&lt;img src=&#34;https://antio2.cn/tech/database/lab2/5561364999654ebab5097e952a730bf7.png&#34;
	width=&#34;478&#34;
	height=&#34;657&#34;
	srcset=&#34;https://antio2.cn/tech/database/lab2/5561364999654ebab5097e952a730bf7_huc9ebad82a443ac17baa08ffaa8828cee_67162_480x0_resize_box_3.png 480w, https://antio2.cn/tech/database/lab2/5561364999654ebab5097e952a730bf7_huc9ebad82a443ac17baa08ffaa8828cee_67162_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;72&#34;
		data-flex-basis=&#34;174px&#34;
	
&gt;
æˆ‘è¿™é‡Œæœ¬æ¥è¯¥æ˜¯ç¬¬ä¸€æ¬¡å°±è¿‡CheckPoint1çš„ğŸ˜­ï¼Œæˆ‘æ¥è¯´å‡ ä¸ªè‡ªå·±ä»£ç ä¸è§„èŒƒçš„åœ°æ–¹å§
&lt;img src=&#34;https://antio2.cn/tech/database/lab2/83e081e754484f4db9c4661b085533c8.png&#34;
	width=&#34;1218&#34;
	height=&#34;127&#34;
	srcset=&#34;https://antio2.cn/tech/database/lab2/83e081e754484f4db9c4661b085533c8_hu57ab9881e3bc1863c61d5ea6eb624a44_56113_480x0_resize_box_3.png 480w, https://antio2.cn/tech/database/lab2/83e081e754484f4db9c4661b085533c8_hu57ab9881e3bc1863c61d5ea6eb624a44_56113_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;959&#34;
		data-flex-basis=&#34;2301px&#34;
	
&gt;
è¿™é‡Œå·¦èŠ±æ‹¬å·&lt;code&gt;{&lt;/code&gt;åº”è¯¥åœ¨ä¸Šä¸€è¡Œï¼Œä½†æ˜¯æ³¨é‡Šå¯¼è‡´äº†æ— æ³•è‡ªåŠ¨æ ¼å¼åŒ–ã€‚è¿˜æœ‰ä¸€ç‚¹ï¼Œæ³¨é‡Šçš„&lt;code&gt;//&lt;/code&gt;åé¢å’Œå†…å®¹ä¹‹é—´æœ‰ä¸€ä¸ªç©ºæ ¼ï¼Œä»£ç å’Œ&lt;code&gt;//&lt;/code&gt;ä¹‹é—´è‡³å°‘ä¸¤ä¸ªç©ºæ ¼ã€‚&lt;img src=&#34;https://antio2.cn/tech/database/lab2/6dd8b3b292d44b01816bf6bc39235b1d.png&#34;
	width=&#34;1226&#34;
	height=&#34;167&#34;
	srcset=&#34;https://antio2.cn/tech/database/lab2/6dd8b3b292d44b01816bf6bc39235b1d_huac47430c93d22ac72bacacef29cea30c_51460_480x0_resize_box_3.png 480w, https://antio2.cn/tech/database/lab2/6dd8b3b292d44b01816bf6bc39235b1d_huac47430c93d22ac72bacacef29cea30c_51460_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;734&#34;
		data-flex-basis=&#34;1761px&#34;
	
&gt;
ifä¸­å¦‚æœæœ€åä½¿ç”¨äº†returnï¼Œåé¢ä¸è¦ç”¨else&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/database/lab2/708b524295cc46a9b71c48953607cb61.png&#34;
	width=&#34;1859&#34;
	height=&#34;887&#34;
	srcset=&#34;https://antio2.cn/tech/database/lab2/708b524295cc46a9b71c48953607cb61_hu0126e9f837e3249a879a2dc4e748841d_188489_480x0_resize_box_3.png 480w, https://antio2.cn/tech/database/lab2/708b524295cc46a9b71c48953607cb61_hu0126e9f837e3249a879a2dc4e748841d_188489_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;209&#34;
		data-flex-basis=&#34;502px&#34;
	
&gt;
ä¿®æ”¹æ ¼å¼åå†æäº¤ï¼ŒæˆåŠŸé€šè¿‡ã€‚æˆ‘è®¤ä¸ºè¿™ä¸ªé¡¹ç›®çš„ä»£ç é‡ç›¸æ¯”äºå…¶ä»–è¯¾ç¨‹ä»£ç é‡åå¤§,æ‰€ä»¥è‡ªå·±åšçš„æ—¶å€™ä¸€å®šè¦ç»†å¿ƒğŸ”&lt;/p&gt;
&lt;h2 id=&#34;ä»»åŠ¡3-index-iterator&#34;&gt;ä»»åŠ¡3 Index Iterator&lt;/h2&gt;
&lt;p&gt;å®ç°ä¸€ä¸ªè¿­ä»£å™¨ã€‚ğŸª¡
&lt;img src=&#34;https://antio2.cn/tech/database/lab2/8fd823215ebf475d9bda15ec92ae04fa.png&#34;
	width=&#34;722&#34;
	height=&#34;173&#34;
	srcset=&#34;https://antio2.cn/tech/database/lab2/8fd823215ebf475d9bda15ec92ae04fa_hu344f40acfde53fe74d72a42163b3709f_32362_480x0_resize_box_3.png 480w, https://antio2.cn/tech/database/lab2/8fd823215ebf475d9bda15ec92ae04fa_hu344f40acfde53fe74d72a42163b3709f_32362_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;417&#34;
		data-flex-basis=&#34;1001px&#34;
	
&gt;
ä»æµ‹è¯•æ–‡ä»¶æ¥çœ‹ï¼Œé¡¹ç›®ä½¿ç”¨b_plus_treeçš„begin()æ–¹æ³•æ¥è·å–ä¸€ä¸ªè¿­ä»£å™¨ï¼Œè‡³äºæ€ä¹ˆæ„é€ è¿­ä»£å™¨æ˜¯è‡ªå·±å†³å®šçš„ã€‚
æ‰€ä»¥æˆ‘ä»¬çš„è¿­ä»£å™¨æœ‰ä»¥ä¸‹å‡ ä¸ªå±æ€§ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¸€ä¸ªæŒ‡å‘LeafPageçš„æŒ‡é’ˆï¼Œæ˜¯å½“å‰è¿­ä»£å™¨æ‰€åœ¨ä½ç½®ã€‚&lt;/li&gt;
&lt;li&gt;indexè¡¨ç¤ºé”®å€¼å¯¹åœ¨å½“å‰é¡µä¸­çš„ä½ç½®ã€‚&lt;/li&gt;
&lt;li&gt;bpm,å†…å­˜ç®¡ç†å™¨ï¼Œç”¨äºè·å–å½“å‰é¡µä»¥åŠè¿­ä»£æ—¶è·å–ä¸‹ä¸€ä¸ªé¡µé¢ğŸ“ƒ&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;ä»£ç å®ç°&#34;&gt;ä»£ç å®ç°&lt;/h3&gt;
&lt;p&gt;è¿™é‡Œæˆ‘çš„å®ç°é¡ºåºæ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;é¦–å…ˆå®ç°æ„é€ å‡½æ•°&lt;code&gt;IndexIterator(LeafPage* leafPage,int idx,BufferPoolManager* bpm) :leaf_page_(leafPage),idx_(idx),bpm_(bpm){};&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç„¶ååˆ†åˆ«å®ç°Begin()å’ŒBegin(key)ï¼Œè¿™é‡Œå¸¦å‚çš„Begin(key)ä»£ç æµç¨‹å’Œä¹‹å‰çš„GetValueå¤§åŒå°å¼‚ï¼Œå¦‚æœæ²¡æ‰¾åˆ°ç­‰äºkeyçš„å€¼å°±è¿”å›ç¬¬ä¸€ä¸ªå¤§äºç­‰äºè¯¥æŒ‡é’ˆé”®å€¼å¯¹çš„è¿­ä»£å™¨ã€‚Begin()çš„è¯ç›´æ¥ä»å·¦è¾¹ä¸€è·¯èµ°ä¸‹æ¥å°±å¥½äº†ã€‚
&lt;img src=&#34;https://antio2.cn/tech/database/lab2/0d865d791adc4ec39b147d5f4d303e4f.png&#34;
	width=&#34;881&#34;
	height=&#34;389&#34;
	srcset=&#34;https://antio2.cn/tech/database/lab2/0d865d791adc4ec39b147d5f4d303e4f_hu1e45c0c24de562947d390dc8bdf215b4_91239_480x0_resize_box_3.png 480w, https://antio2.cn/tech/database/lab2/0d865d791adc4ec39b147d5f4d303e4f_hu1e45c0c24de562947d390dc8bdf215b4_91239_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;226&#34;
		data-flex-basis=&#34;543px&#34;
	
&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;End()å’ŒBegin()ç›¸åï¼Œä¸€ç›´èµ°æœ€å³è·¯å°±å¥½ï¼Œæœ€åindex=å¶ç»“ç‚¹çš„size&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç„¶åè¿˜æœ‰ä¸€ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹ï¼Œæˆ‘ä»¬æŠŠå¶ç»“ç‚¹æŒ‡é’ˆä½œä¸ºå‚æ•°ä¼ ç»™äº†è¿­ä»£å™¨ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜åœ¨ç”¨è¿­ä»£å™¨çš„æ—¶å€™æ˜¯è¦ä¿è¯è¯¥é¡µé¢åœ¨å†…å­˜æ± é‡Œçš„ğŸ“Œã€‚ä¸€å¼€å§‹æˆ‘æ˜¯åœ¨&lt;strong&gt;ææ„å‡½æ•°&lt;/strong&gt;é‡Œé¢äº†è¿›è¡Œä¸€æ¬¡Unpinæ“ä½œï¼Œä½†æ˜¯å¯èƒ½ä¼šå¯¼è‡´å†…å­˜æ± å·²ç»è¢«åˆ é™¤åï¼Œè¿­ä»£å™¨æ‰ææ„å¯¼è‡´å†…å­˜å¼‚å¸¸çš„æƒ…å†µã€‚ä½†æ˜¯å¦‚æœä¸Unpinçš„è¯ï¼Œæ¯”å¦‚å¾ªç¯é‡Œé¢ä¸€ç›´è°ƒç”¨tree.end(),å°±ä¼šå¯¼è‡´é¡µé¢è¢«pinä¸Šå»å ç”¨å†…å­˜æ± ã€‚ç›®å‰æ²¡æœ‰æƒ³åˆ°è§£å†³æ–¹æ³•ï¼Œå¦‚æœè¦åœ¨å¤–éƒ¨åˆ›å»ºè¿­ä»£å™¨çš„è¯ï¼Œå¿…é¡»åœ¨bpmè¢«deleteä¹‹å‰è¿›è¡Œé”€æ¯ã€‚å¯èƒ½ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆå¯ä»¥è§£å†³ï¼Œä½†æ˜¯æµ‹è¯•çš„ç»“æ„å°±ä¸å…è®¸è¿™ä¹ˆå¹²ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¹‹åé‡è½½è¿ç®—ç¬¦æ¯”è¾ƒç®€å•&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;operator++()å…ˆåˆ¤æ–­æ˜¯å¦æ˜¯è¯¥é¡µçš„æœ€åä¸€ä¸ªè®°å½•ï¼Œå¦‚æœæ˜¯ï¼Œé‚£ä¹ˆleaf_pageå˜ä¸ºä¸‹ä¸€é¡µï¼Œå¹¶ä¸”unpinå½“å‰é¡µé¢ã€‚è¿™é‡Œè¦æ³¨æ„å¦‚æœæœ€åä¸€ä¸ªleafçš„æœ€åä¸€æ¡è®°å½•ï¼Œé‚£ä¹ˆæ˜¯ä¸èƒ½è·³åˆ°next_pageä¸Šçš„ï¼Œåº”è¯¥ç›´æ¥idx++,è¿™æ ·è¿­ä»£å™¨ä½ç½®å°±å’ŒEnd()ä¸€æ ·äº†ã€‚&lt;/li&gt;
&lt;li&gt;åˆ¤æ–­æ˜¯å¦ç›¸ç­‰ï¼šåˆ¤æ–­leaf_page_å’Œidx_æ˜¯å¦ç›¸ç­‰å³å¯ã€‚
&lt;img src=&#34;https://antio2.cn/tech/database/lab2/a2ddbfb3b61d45d690438116396dc10f.png&#34;
	width=&#34;1669&#34;
	height=&#34;379&#34;
	srcset=&#34;https://antio2.cn/tech/database/lab2/a2ddbfb3b61d45d690438116396dc10f_huf5fe88054f4b51ef5f338422021f2f38_147953_480x0_resize_box_3.png 480w, https://antio2.cn/tech/database/lab2/a2ddbfb3b61d45d690438116396dc10f_huf5fe88054f4b51ef5f338422021f2f38_147953_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;440&#34;
		data-flex-basis=&#34;1056px&#34;
	
&gt;
å®Œæˆä»£ç ååœ¨æœ¬åœ°é€šè¿‡Insertå’ŒDeleteæœ€åä¸€ä¸ªæµ‹è¯•ç‚¹ã€‚è¿™ä¸ªä»»åŠ¡åº”è¯¥æ˜¯è¯¥é¡¹ç›®ä¸­ä»£ç é‡æœ€å°çš„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ä»»åŠ¡4-å¤šçº¿ç¨‹&#34;&gt;ä»»åŠ¡4 å¤šçº¿ç¨‹&lt;/h2&gt;
&lt;p&gt;é¦–å…ˆç›´æ¥åŠ å¤§é”è‚¯å®šæ˜¯ä¸è¡Œçš„ï¼Œè¦ç”¨Crabbingçš„æ–¹å¼è¿›è¡ŒåŠ é”ã€‚&lt;/p&gt;
&lt;p&gt;é”çš„æ¥å£åœ¨Pageé‡Œé¢ã€‚
&lt;img src=&#34;https://antio2.cn/tech/database/lab2/3057be1e28e84f85af8b242d4c4ece24.png&#34;
	width=&#34;464&#34;
	height=&#34;287&#34;
	srcset=&#34;https://antio2.cn/tech/database/lab2/3057be1e28e84f85af8b242d4c4ece24_huec533730bda9ec6e14665316a564f78e_40097_480x0_resize_box_3.png 480w, https://antio2.cn/tech/database/lab2/3057be1e28e84f85af8b242d4c4ece24_huec533730bda9ec6e14665316a564f78e_40097_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;161&#34;
		data-flex-basis=&#34;388px&#34;
	
&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ³¨æ„ä¸€ä¸ªPageéœ€è¦å…ˆè¢«Unlockï¼Œç„¶åå†Unpinã€‚é‚£ä¹ˆå°±å‡ºç°äº†ä¸€ä¸ªé—®é¢˜ï¼Œä¹‹å‰Task2å†™çš„æŸ¥æ‰¾åˆ°éœ€è¦çš„å¶ç»“ç‚¹æ“ä½œéƒ½æ˜¯ç”¨å®Œçˆ¶èŠ‚ç‚¹å°±ç›´æ¥é‡Šæ”¾äº†ï¼Œç°åœ¨åœ¨æ’å…¥å’Œåˆ é™¤æ“ä½œæ—¶å¿…é¡»æä¸€ä¸ªé˜Ÿåˆ—ä¿å­˜æ‰€æœ‰é¡µï¼Œç„¶åç¡®è®¤å­é¡µé¢safeåé‡Šæ”¾æ‰€æœ‰çš„ç¥–å…ˆé¡µï¼ˆä¼˜å…ˆé‡Šæ”¾æœ€ä¸Šé¢çš„ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;root_page_id_éœ€è¦B+æ ‘å»å•ç‹¬æä¸ªé”å»ä¿æŠ¤ä¸€ä¸‹ï¼Œä¿®æ”¹root_page_idæ—¶ç”³è¯·ä¸ªroot_latchçš„å†™é”ï¼Œè¯»çš„æ—¶å€™æä¸ªè¯»é”ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚ä½•åˆ¤æ–­safe?
&lt;ul&gt;
&lt;li&gt;æ’å…¥æ“ä½œï¼šå­ç»“ç‚¹ä¸ªæ•°å°äºmaxsize-1(æœ‰å“¨å…µä½ç½®)&lt;/li&gt;
&lt;li&gt;åˆ é™¤ï¼šå­ç»“ç‚¹ä¸ªæ•°å¤§äºminsize&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æƒ³äº†ä¸€ä¸‹ï¼ŒInsertParentè¿™ç§å­é€’å½’å‡½æ•°ã€åº”è¯¥å†…éƒ¨æ˜¯ä¸ç”¨ç»™çˆ¶èŠ‚ç‚¹åŠ é”çš„ï¼Œå› ä¸ºåœ¨æœç´¢è°ƒç”¨å®ƒçš„è¿‡ç¨‹æ—¶å·²ç»é”ä¸Šäº†ã€‚ä½†åˆéšéšçº¦çº¦æ„Ÿè§‰ä¸å¤ªå¯¹ã€‚å¸Œæœ›èƒ½æœ‰ä¼šçš„æ¥è¯´ä¸€ä¸‹&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…¶ä»–çš„ä¸è¯´ä»€ä¹ˆäº†ï¼Œå…·ä½“çš„åŠ é”æ“ä½œå¯ä»¥çœ‹èµ„æ–™https://15445.courses.cs.cmu.edu/fall2022/notes/09-indexconcurrency.pdf
&lt;img src=&#34;https://antio2.cn/tech/database/lab2/471f85fc16224628b4439906485ba32e.png&#34;
	width=&#34;1174&#34;
	height=&#34;808&#34;
	srcset=&#34;https://antio2.cn/tech/database/lab2/471f85fc16224628b4439906485ba32e_hu4eab784917173734676a6dc407c7506b_486156_480x0_resize_box_3.png 480w, https://antio2.cn/tech/database/lab2/471f85fc16224628b4439906485ba32e_hu4eab784917173734676a6dc407c7506b_486156_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;145&#34;
		data-flex-basis=&#34;348px&#34;
	
&gt;
ç›´æ¥æŒ‰ç…§è¿™ä¸ªæœ€åŸºç¡€çš„å†™ã€‚ç„¶åå†™ä¹‹å‰è®°å¾—æäº¤ä¸€ä¸‹Git,å…å¾—å†™çƒ‚äº†ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶åæˆ‘è¿™é‡ŒçŠ¯äº†ä¸€ä¸ªå¾ˆä½çº§çš„é”™è¯¯ï¼Œä¸çŸ¥é“ä½ ä»¬èƒ½ä¸èƒ½çœ‹å‡ºæ¥ã€‚&lt;img src=&#34;https://antio2.cn/tech/database/lab2/49da3db33a6142c9bcb441bd8754c605.png&#34;
	width=&#34;1006&#34;
	height=&#34;172&#34;
	srcset=&#34;https://antio2.cn/tech/database/lab2/49da3db33a6142c9bcb441bd8754c605_huabd847912dfcc9f5f523cfb350656beb_55042_480x0_resize_box_3.png 480w, https://antio2.cn/tech/database/lab2/49da3db33a6142c9bcb441bd8754c605_huabd847912dfcc9f5f523cfb350656beb_55042_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;584&#34;
		data-flex-basis=&#34;1403px&#34;
	
&gt;
åæ­£æˆ‘åœ¨è¿™é‡Œè°ƒäº†ä¸€ä¸ªå°æ—¶æ‰å‘ç°ä¸æ˜¯é”çš„é—®é¢˜ã€‚è€Œä¸”ä¹‹å‰åœ¨Findä¸­ä¹Ÿé”™è¿‡ç±»ä¼¼çš„ã€‚çœŸçš„èƒ½è¢«è‡ªå·±è ¢å“­
&lt;img src=&#34;https://antio2.cn/tech/database/lab2/1deb69257f1c44d38f11340d9ab2c59d.png&#34;
	width=&#34;905&#34;
	height=&#34;460&#34;
	srcset=&#34;https://antio2.cn/tech/database/lab2/1deb69257f1c44d38f11340d9ab2c59d_hu16cb7c76d7003f4793782f399ffbb356_101630_480x0_resize_box_3.png 480w, https://antio2.cn/tech/database/lab2/1deb69257f1c44d38f11340d9ab2c59d_hu16cb7c76d7003f4793782f399ffbb356_101630_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;196&#34;
		data-flex-basis=&#34;472px&#34;
	
&gt;
è¿™ä¸ªè¦æ³¨æ„æ€è€ƒpinä½çš„é¡µå’Œlockçš„å…³ç³»ï¼Œè¦æ˜¯ä¸€ä¸ªé¡µè¢«é”ä½ï¼Œé‚£ä¹ˆè‚¯å®šæ˜¯ä¸èƒ½å½»åº•unpinæ‰å®ƒçš„ï¼Œå¦åˆ™lru-kç­–ç•¥å¯èƒ½æŠŠä»–æ¢æ‰ï¼Œpageçš„latchä¿¡æ¯ä¸ä¼šè¢«å†™è¿›ç£ç›˜ï¼Œä»è€Œå¼•å‘æ­»é”é—®é¢˜ã€‚å¦‚æœä½ è¦å»unlockä¸€ä¸ªä¸åœ¨å†…å­˜ä¸­çš„pageï¼Œå°±ä¼šå¼•èµ·å†…å­˜æ³„æ¼é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶åè¿˜æœ‰ä¸€ç‚¹ï¼Œå¦‚æœä½ æœ‰æ­»é”é—®é¢˜å¯èƒ½æ˜¯å…¶ä»–å¸®åŠ©å‡½æ•°å†™é”™äº†ï¼Œä¸è¦åªæ­»ç›¯ç€insertå’Œremoveä¸æ”¾ã€‚
æœ€åæ”¾ä¸€å¼ æˆ‘æ£€æŸ¥æ—¶ç”»çš„æµç¨‹å›¾å§ï¼Œè“è‰²æ˜¯è¯»é”ï¼Œçº¢è‰²æ˜¯å†™é”&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/database/lab2/591f869b02694cf18df4a87738ed71ee.png&#34;
	width=&#34;935&#34;
	height=&#34;1460&#34;
	srcset=&#34;https://antio2.cn/tech/database/lab2/591f869b02694cf18df4a87738ed71ee_hu1f2d9f8bc8233c10773af9c5ded9e930_152816_480x0_resize_box_3.png 480w, https://antio2.cn/tech/database/lab2/591f869b02694cf18df4a87738ed71ee_hu1f2d9f8bc8233c10773af9c5ded9e930_152816_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;64&#34;
		data-flex-basis=&#34;153px&#34;
	
&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>ä¸€äº›è¯¾ç¨‹æ¨è</title>
        <link>https://antio2.cn/tech/describe/</link>
        <pubDate>Wed, 11 Jan 2023 00:00:00 +0000</pubDate>
        
        <guid>https://antio2.cn/tech/describe/</guid>
        <description>&lt;h2 id=&#34;cmu15-213&#34;&gt;CMU15-213&lt;/h2&gt;
&lt;h2 id=&#34;cmu15-445&#34;&gt;CMU15-445&lt;/h2&gt;
&lt;p&gt;å…³äº&lt;a class=&#34;link&#34; href=&#34;https://antio2.cn/tech/database&#34; &gt;æ•°æ®åº“å†…æ ¸å…¥é—¨&lt;/a&gt;çš„ã€‚&lt;/p&gt;
</description>
        </item>
        <item>
        <title>CMU15-445|Project1 åŸºäºLRU-Kæ›¿æ¢ç­–ç•¥çš„Buffer Pool</title>
        <link>https://antio2.cn/tech/database/lab1/</link>
        <pubDate>Thu, 27 Oct 2022 21:40:13 +0800</pubDate>
        
        <guid>https://antio2.cn/tech/database/lab1/</guid>
        <description>&lt;h2 id=&#34;æ–‡ç« ç®€ä»‹&#34;&gt;æ–‡ç« ç®€ä»‹&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;CMU 15-445 (FALL 2022) Project #1 Task#2 LRU-K æ›¿æ¢ç­–ç•¥è¯¦è§£å®ç°ï¼Œå°½é‡æä¾›æ€è·¯ï¼Œä¹Ÿå¯ä»¥ä¸ºå…¶ä»–åŒå­¦å®ç°LRU-Kç®—æ³•åšå‚è€ƒ&lt;/li&gt;
&lt;li&gt;å‚è€ƒæ–‡çŒ®ï¼š&lt;a class=&#34;link&#34; href=&#34;https://dl.acm.org/doi/epdf/10.1145/170036.170081&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;The LRU-K page replacement algorithm for database disk buffering (acm.org)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;åœ¨ç½‘ä¸Šéƒ½æ‰¾ä¸åˆ°å…¶ä»–å‚è€ƒï¼Œåªæœ‰è¿™ä¸€ç¯‡1993å¹´çš„è®ºæ–‡&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ç®—æ³•è§£æ&#34;&gt;ç®—æ³•è§£æ&lt;/h2&gt;
&lt;h3 id=&#34;lru-kæ›¿æ¢ç­–ç•¥&#34;&gt;LRU-Kæ›¿æ¢ç­–ç•¥&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;LRU-Kæ˜¯LRUç®—æ³•çš„ä¸€ç§è¡ç”Ÿã€‚å¼ºçƒˆå»ºè®®å…ˆåšä¸€ä¸‹è¿™ä¸€é“é¢˜&lt;a class=&#34;link&#34; href=&#34;https://leetcode.cn/problems/lru-cache/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;146. LRU ç¼“å­˜ - åŠ›æ‰£ï¼ˆLeetCodeï¼‰&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;å…ˆçœ‹é¢˜ç›®å¯¹è¯¥ç®—æ³•çš„æè¿°&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;The LRU-K algorithm evicts a frame whose backward k-distance is maximum of all frames in the replacer. Backward k-distance is computed as the difference in time between current timestamp and the timestamp of kth previous access. A frame with less than k historical accesses is given +inf as its backward k-distance. When multipe frames have +inf backward k-distance, the replacer evicts the frame with the earliest timestamp.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å¤§æ„æ˜¯ï¼Œæ¯æ¬¡æ›¿æ¢ä¼šä¼˜å…ˆæ›¿æ¢k-è·ç¦»æœ€è¿œçš„ä¸€ä¸ªæ•°ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å‡å¦‚è¿™ä¸ªkæ˜¯3ï¼Œç®€å•ç”»ä¸€ä¸‹ä¸€ä¸ªå®ä¾‹ï¼Œä¾æ¬¡åŠ å…¥ä¸‹é¢å‡ ä¸ªæ•°&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/database/lab1/2c2717562c324e518824fd8385895f35.png&#34;
	width=&#34;2480&#34;
	height=&#34;3508&#34;
	srcset=&#34;https://antio2.cn/tech/database/lab1/2c2717562c324e518824fd8385895f35_hua64ef303a77db967f7dfcb090eab6797_237261_480x0_resize_box_3.png 480w, https://antio2.cn/tech/database/lab1/2c2717562c324e518824fd8385895f35_hua64ef303a77db967f7dfcb090eab6797_237261_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;70&#34;
		data-flex-basis=&#34;169px&#34;
	
&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœä¸€ä¸ªæ•°å‡ºç°æ¬¡æ•°è¾¾åˆ°äº†Kæ¬¡ï¼Œé‚£ä¹ˆk-distanceå°±æ˜¯å€’æ•°ç¬¬Kæ¬¡å‡ºç°çš„ä½ç½®&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœä¸€ä¸ªæ•°å‡ºç°ä¸åˆ°Kæ¬¡ï¼Œé‚£ä¹ˆk-distanceå°±æ˜¯+inf&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è¿™æ˜¯å¯¹K-distanceä¸¥è°¨çš„å®šä¹‰&lt;img src=&#34;https://antio2.cn/tech/database/lab1/7c571bb790b7457a8345499be5a4de54.png&#34;
	width=&#34;774&#34;
	height=&#34;415&#34;
	srcset=&#34;https://antio2.cn/tech/database/lab1/7c571bb790b7457a8345499be5a4de54_hu6412ea6810ceb2e1ed0cacc589fa823d_88312_480x0_resize_box_3.png 480w, https://antio2.cn/tech/database/lab1/7c571bb790b7457a8345499be5a4de54_hu6412ea6810ceb2e1ed0cacc589fa823d_88312_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;186&#34;
		data-flex-basis=&#34;447px&#34;
	
&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;é©±é€ç­–ç•¥&#34;&gt;é©±é€ç­–ç•¥&lt;/h3&gt;
&lt;p&gt;ä¼˜å…ˆé©±é€è·ç¦»ä¸º$+inf$çš„frame,å¦‚æœæœ‰å¤šä¸ªè¿™æ ·çš„æ•°ï¼Œå…¶å®LRU-Kæ˜¯æœ‰å¤šç§ç­–ç•¥æ¥å†³å®šä¸‹ä¸€ä¸ªé©±é€è°çš„(æ¯”å¦‚ç”¨LRU)ï¼Œåœ¨æœ¬é¢˜ç›®ä¸­&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;When multipe frames have +inf backward k-distance, the replacer evicts the frame with the earliest timestamp.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä½¿ç”¨çš„å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰ç­–ç•¥ï¼Œæ¯”å¦‚åœ¨ä¸Šå›¾ä¸­ï¼Œ4å’Œ1éƒ½å‡ºç°äº†ä¸è¶³Kæ¬¡ï¼Œå¦‚æœè¦é©±é€å°±é©±é€å…ˆå‡ºç°çš„4ã€‚
å¦‚æœæ²¡æœ‰k-distanceä¸ºæ­£æ— ç©·çš„frame,ä¼˜å…ˆé©±é€è¯¥è·ç¦»æœ€å¤§çš„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¸€äº›é‡è¦çš„æ¦‚å¿µ&#34;&gt;ä¸€äº›é‡è¦çš„æ¦‚å¿µ&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬éœ€è¦ç†è§£ä¸ºä»€ä¹ˆéœ€è¦ç”¨LRU-Kè€ŒéLRUç­–ç•¥&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‡è®¾ï¼šè¯»å–é¡µçš„åºåˆ—æ˜¯éšæœºçš„ï¼Œä½†æ˜¯æ¯ä¸ªé¡µæœ‰ä¸€ä¸ªæ¯”è¾ƒç¨³å®šçš„æ¦‚ç‡è¢«è¯»å–åˆ°ï¼Œå‡è®¾pè¢«è¯»å–çš„æ¦‚ç‡æ˜¯$b_p$,é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é¢„æµ‹ï¼Œä¸¤æ¬¡pè¢«è¯»å–çš„é—´éš”æ˜¯$I_p$ï¼Œå¹¶ä¸”$I_p$å’Œ$(b_p)^-1$æ˜¯æ­£ç›¸å…³çš„ï¼ˆå®ƒä»¬æ˜¯åæ¯”å…³ç³»ï¼‰&lt;/li&gt;
&lt;li&gt;æ¥ä¸‹æ¥åˆ—ä¸¾ä¸€äº›æƒ…å†µï¼Œè¯·æ€è€ƒå®ƒä»¬ï¼ˆæˆ‘ä¸çŸ¥é“è‹±æ–‡è¯¥æ€ä¹ˆå‡†ç¡®ç¿»è¯‘ï¼Œå¤§æ¦‚æ„ä¼šä¸€ä¸‹ï¼‰
&lt;ul&gt;
&lt;li&gt;å†…éƒ¨äº‹åŠ¡ï¼ˆIntra-Transactionï¼‰ ï¼šæ¯”å¦‚ä¸€ä¸ªäº‹åŠ¡å…ˆè¯»å–ä¸€ä¸ªé¡µï¼Œç„¶ååœ¨æäº¤ä¹‹å‰å†æ¬¡è®¿é—®è¿™ä¸ªé¡µã€‚å…¶å®å°±æ˜¯ï¼šç”¨äºæ›´æ–°çš„äº‹åŠ¡ï¼Œå…ˆè¯»å–ä¸€åˆ—ï¼Œå†æ›´æ–°è¿™åˆ—&lt;/li&gt;
&lt;li&gt;äº‹åŠ¡é‡è¯•ï¼ˆTransaction-Retryï¼‰ï¼šä¸€ä¸ªäº‹åŠ¡è®¿é—®ä¸€ä¸ªé¡µç„¶åä¸­æ­¢ã€‚æ¥ä¸‹æ¥é‡è¯•è¿™ä¸ªäº‹åŠ¡å¹¶ä¸”å†æ¬¡è®¿é—®è¿™ä¸ªé¡µã€‚&lt;/li&gt;
&lt;li&gt;å†…éƒ¨æµç¨‹(Intra-Process): ä¸€ä¸ªäº‹åŠ¡è®¿é—®ä¸€ä¸ªé¡µé¢ï¼Œå¹¶ä¸”æˆåŠŸæäº¤äº†ã€‚ç„¶åä¸‹ä¸€ä¸ªåŒæ ·æµç¨‹çš„äº‹åŠ¡å†æ¬¡è®¿é—®è¿™ä¸ªé¡µã€‚è¿™ç§æ¨¡å¼çš„è®¿é—®é€šå¸¸æ˜¯ç”±è¿›è¡Œå¤§é‡æ›´æ–°çš„ç¨‹åºå¼•èµ·çš„ï¼Œæ¯”å¦‚è¿ç»­æ›´æ–°100æ¡è®°å½•&lt;/li&gt;
&lt;li&gt;(Inter-Process)è¿™ä¸ªåå­—ä¸çŸ¥é“æ€ä¹ˆç¿»è¯‘äº†ï¼Œæ³¨æ„ä¸Šä¸€ä¸ªæ˜¯&lt;code&gt;Intra&lt;/code&gt;è¡¨è¾¾åœ¨ä¸€ä¸ªProcessé‡Œé¢,&lt;code&gt;Inter&lt;/code&gt;è¡¨ç¤ºåœ¨ä¸¤ä¸ªProcessä¹‹é—´ã€‚è¿™ä¸ªä¾‹å­æ˜¯è¯´ï¼šä¸€ä¸ªäº‹åŠ¡è®¿é—®ä¸€ä¸ªé¡µï¼Œç„¶åå¦å¤–ä¸€ä¸ªä¸åŒæµç¨‹çš„äº‹åŠ¡ä¹Ÿè®¿é—®è¿™ä¸ªé¡µã€‚è¿™ä¸¤ä¸ªäº‹åŠ¡ä¹‹å‰æ˜¯å®Œå…¨ç‹¬ç«‹çš„ï¼Œç›®çš„ä¹Ÿä¸ä¸€æ ·ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ä¸Šè¿°å››ä¸ªä¾‹å­çš„å‰ä¸‰ä¸ªè¢«ç§°ä½œ==correlated reference-pair type==ï¼Œè¿™ç§ç±»å‹æš‚æ—¶è¢«æˆ‘å«åš&lt;strong&gt;å…³è”è®¿é—®å¯¹&lt;/strong&gt;ï¼Œæ³¨æ„ç¬¬å››ä¸ªä¾‹å­æ˜¯ä¸å…³è”çš„ï¼Œå¦‚æœæˆ‘ä»¬é€šè¿‡è¿™äº›å…³è”è®¿é—®å¯¹æ¥ä¼°è®¡å‰é¢æåˆ°çš„é—´éš”æ—¶é—´$I_p$ï¼Œé€šå¸¸ä¼šå¾—åˆ°é”™è¯¯çš„ç»“æœã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Œè€ƒè™‘ä¸Šé¢æåˆ°çš„ä¾‹å­ä¸€ï¼šæˆ‘ä»¬è¦åœ¨ä¸€ä¸ªäº‹åŠ¡æ›´æ–°æ—¶è®¿é—®ä¸€ä¸ªpageä¸¤æ¬¡ï¼Œå¦‚æœæˆ‘ä»¬ç¬¬ä¸€æ¬¡è®¿é—®åï¼Œä¼°è®¡$I_p$ä¸º$+inf$é‚£ä¹ˆå°±ä¼šä¸¢æ‰è¿™ä¸ªpageï¼Œåœ¨ç¬¬äºŒæ¬¡è®¿é—®æ—¶åˆé€šè¿‡IOè¯»å…¥ç¼“å­˜é€ æˆæµªè´¹ã€‚å¦‚æœæˆ‘ä»¬é€šè¿‡è¿™ä¸¤æ¬¡é—´éš”æ—¶é—´æ¥ä¼°è®¡$I_p$ï¼Œé‚£ä¹ˆè¿™ä¸ªé—´éš”æ—¶é—´æ˜¯éå¸¸çŸ­çš„ï¼æˆ‘ä»¬å°±ä¼šé€ æˆä¸€ä¸ªè¯¯è§£ï¼šè¿™ä¸ªpageå¾ˆå¸¸ç”¨ã€‚ä½†äº‹å®ä¸Šè¿™ä¸ªæ›´æ–°äº‹åŠ¡å·²ç»ç»“æŸäº†ï¼Œå¯èƒ½å¾ˆé•¿ä¸€æ®µæ—¶é—´å†…è¿™ä¸ªpageä¸ä¼šè¢«å†æ¬¡ç”¨åˆ°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¾—åˆ°è¿™æ ·ä¸€ä¸ªç»“è®º&lt;/strong&gt;ï¼šç¼“å­˜ç³»ç»Ÿ&lt;em&gt;ä¸åº”è¯¥&lt;/em&gt;ç›´æ¥ä¸¢å¼ƒä¸€ä¸ªpageï¼Œè€Œæ˜¯åº”è¯¥ä¿ç•™åˆ°ä¸‹ä¸€æ¬¡è®¿é—®æˆ–è€…æ˜¯ä¿ç•™åˆ°ä¸‹ä¸€æ¬¡è®¿é—®çš„å¯èƒ½æ€§å˜åˆ°å¾ˆå°çš„æ—¶å€™ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨å¦å¤–ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬ä¼°è®¡ä¸¤æ¬¡ä½¿ç”¨pageçš„é—´éš”æ—¶ï¼Œ&lt;strong&gt;ä¸åº”è¯¥&lt;/strong&gt;ä½¿ç”¨å…³è”è®¿é—®å¯¹æ¥ä¼°è®¡ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚ä½•åˆ¤æ–­ä¸¤æ¬¡è®¿é—®æ˜¯ä¸æ˜¯å…³è”è®¿é—®å‘¢ï¼Ÿä¸€ä¸ªæ–¹æ³•æ˜¯è®¾ç½®ä¸€ä¸ªæ—¶é—´é˜ˆå€¼ï¼Œåœ¨é˜ˆå€¼ä¹‹ä¸‹å°±æ˜¯å…³è”è®¿é—®ã€‚&lt;/li&gt;
&lt;li&gt;å…³è”è®¿é—®å¯èƒ½æ˜¯ä¸€è¿ä¸²çš„è®¿é—®ï¼Œè€Œä¸åªæ˜¯ä¸¤æ¬¡ã€‚æ¯”å¦‚ä¸€ç™¾æ¬¡å¯¹åŒä¸€ä¸ªé¡µä¸Šè®°å½•çš„æ›´æ–°ã€‚æˆ‘ä»¬æŠŠè¿™ä¸€è¿ä¸²ç§°ä¸ºå…³è”è®¿é—®æ—¶æœŸã€‚åœ¨ä¼°è®¡ä¸€ä¸ªé¡µä¸¤æ¬¡ä½¿ç”¨é—´éš”æ—¶ï¼Œåº”è¯¥æ—¶è®¡ç®—&lt;code&gt;ä¸€æ¬¡å…³è”è®¿é—®çš„ç»“æŸ&lt;/code&gt;å’Œ&lt;code&gt;ä¸‹ä¸€æ®µå…³è”è®¿é—®å¼€å§‹&lt;/code&gt;ä¹‹é—´çš„æ—¶é—´é—´éš”ã€‚&lt;/li&gt;
&lt;li&gt;å³ä½¿ä¸€ä¸ªé¡µé¢è¢«é©±é€ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦ä¿ç•™è¿™ä¸ªè®¿é—®å†å²ä¸€æ®µæ—¶é—´ã€‚æ¯”å¦‚æˆ‘ä»¬åœ¨ç¬¬1ç§’è®¿é—®äº†p,ç¬¬äºŒç§’é©±é€äº†pï¼Œç¬¬3ç§’åˆè®¿é—®äº†pï¼Œç¬¬4ç§’é©±é€äº†pï¼Œç¬¬5ç§’è®¿é—®äº†p(è¿™é‡Œä¸ä¸€å®šæ˜¯ç§’ï¼Œå¯ä»¥ç†è§£ä¸ºå¾ˆå¿«)ã€‚é‚£ä¹ˆå®é™…ä¸Šæˆ‘ä»¬æ˜¯ä»¥ä¸€ä¸ªå¾ˆé«˜çš„é¢‘ç‡åœ¨è®¿é—®pï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰å†å²è®°å½•ï¼Œæˆ‘ä»¬æ˜¯æ— æ³•æ„è¯†åˆ°è¿™ä¸ªäº‹å®çš„ã€‚è¿™ä¸ªå†å²ä¿ç•™æ—¶é—´è¢«ç§°ä¸º$Retained Information Period$,è®ºæ–‡ä¸­ç»™å‡ºçš„å»ºè®®æ—¶é—´æ˜¯200s(ä¸€ä¸ªæ‹‡æŒ‡æ³•åˆ™)&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å…·ä½“å®ç°&#34;&gt;å…·ä½“å®ç°&lt;/h2&gt;
&lt;h3 id=&#34;æ•°æ®ç»“æ„çº¦å®š&#34;&gt;æ•°æ®ç»“æ„çº¦å®š&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/database/lab1/ef6fa019051c42dda8617a63b221c8f7.png&#34;
	width=&#34;724&#34;
	height=&#34;338&#34;
	srcset=&#34;https://antio2.cn/tech/database/lab1/ef6fa019051c42dda8617a63b221c8f7_hu98044698df24616293534af8d2bc5731_104762_480x0_resize_box_3.png 480w, https://antio2.cn/tech/database/lab1/ef6fa019051c42dda8617a63b221c8f7_hu98044698df24616293534af8d2bc5731_104762_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;214&#34;
		data-flex-basis=&#34;514px&#34;
	
&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨è¿™é‡Œï¼Œé¦–å…ˆå®šä¹‰äº†ä¸¤ä¸ªå‡½æ•°
&lt;ul&gt;
&lt;li&gt;ç¬¬ä¸€ä¸ªæ˜¯&lt;code&gt;HIST(p)&lt;/code&gt;,æ˜¯å…³äºpçš„è®¿é—®è®°å½•ï¼ˆhistoryï¼‰çš„ã€‚&lt;code&gt;HIST(p,n)&lt;/code&gt;å°±æ˜¯é¡µé¢på€’æ•°ç¬¬næ¬¡è¢«è®¿é—®çš„æ—¶é—´ã€‚ä¾‹å¦‚&lt;code&gt;HIST(2,1)&lt;/code&gt;å°±æ˜¯2å·é¡µé¢æœ€åä¸€æ¬¡è¢«è®¿é—®çš„æ—¶é—´(è¿™ä¸ªæ˜¯ä¸ç®—å…³è”è®¿é—®çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯æ®µå…³è”è®¿é—®åªè¢«è®°å½•ä¸€æ¬¡)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;LAST(p)&lt;/code&gt;å°±æ˜¯é¡µé¢pæœ€åä¸€æ¬¡è¢«è®¿é—®çš„æ—¶é—´ï¼Œè¿™ä¸ªæ˜¯æ— è®ºå…³è”è®¿é—®çš„&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;ä¼ªä»£ç å®ç°&#34;&gt;ä¼ªä»£ç å®ç°&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æ¯å½“æˆ‘ä»¬æ–°å¢ä¸€æ¬¡è®¿é—®è®°å½•ï¼Œå¦‚æœpå·²ç»è¢«è®°å½•äº†ï¼Œæœ‰ä¸¤ç§æƒ…å†µ
&lt;ul&gt;
&lt;li&gt;è¿™æ¬¡è®¿é—®åœ¨å…³è”è®¿é—®ä¸­ï¼Œï¼ˆä¹Ÿå°±æ˜¯åœ¨ä»–çš„å‰é¢å·²ç»æœ‰äº†å…¶ä»–å…³è”è®¿é—®ï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦æ›´æ–°&lt;code&gt;LAST(p)&lt;/code&gt;å°±å¥½äº†&lt;/li&gt;
&lt;li&gt;å¦‚æœæ˜¯ä¸€æ®µæ–°çš„è®¿é—®ï¼Œé‚£ä¹ˆå…³é—­æ—§çš„è®¿é—®ï¼Œå¹¶ä¸”è®¡ç®—$LAST(p)-HIST(p,1)$å°†ä»–ç¼©ä¸ºä¸€ä¸ªç‚¹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å¦‚æœè¿™ä¸ªpageæ²¡æœ‰åœ¨bufferä¸­ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦ä¸¢å¼ƒå¦å¤–ä¸€ä¸ªpageï¼ˆbufferæ»¡äº†çš„æƒ…å†µï¼‰
&lt;ul&gt;
&lt;li&gt;ä¸€ä¸ªæ­£åœ¨&lt;strong&gt;å…³è”è®¿é—®æ—¶æœŸ&lt;/strong&gt;ä¸­çš„pageæ˜¯ä¸åº”è¯¥è¢«ä¸¢æ‰çš„ã€‚&lt;/li&gt;
&lt;li&gt;ä¼˜å…ˆé€‰æ‹©K-distanceæœ€å¤§çš„ã€‚ä¹Ÿå°±æ˜¯$b_t(q,K)$æœ€å¤§ï¼Œæˆ–è€…è¯´æ˜¯$HIST(q,K)$æœ€å°çš„ã€‚ï¼ˆä¹‹å‰çœ‹è¿™ä¸ªåœ°æ–¹ä¸ç†è§£ï¼Œåæ¥æƒ³é€šäº†ï¼šHISTæ˜¯è®°å½•çš„æ—¶é—´ï¼Œæ—¶é—´æˆ³è¶Šå°è®¿é—®çš„è¶Šæ—©ï¼Œä¹Ÿå°±æ˜¯è·ç¦»è¶Šå¤§ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ä¼ªä»£ç æ˜¯é•¿è¿™æ ·çš„
&lt;img src=&#34;https://antio2.cn/tech/database/lab1/ad6fe348b13c47878ac1c6ea40528c31.png&#34;
	width=&#34;439&#34;
	height=&#34;786&#34;
	srcset=&#34;https://antio2.cn/tech/database/lab1/ad6fe348b13c47878ac1c6ea40528c31_hu6a8118b0d7d54cea847a1e3c0eeb24c6_193607_480x0_resize_box_3.png 480w, https://antio2.cn/tech/database/lab1/ad6fe348b13c47878ac1c6ea40528c31_hu6a8118b0d7d54cea847a1e3c0eeb24c6_193607_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;55&#34;
		data-flex-basis=&#34;134px&#34;
	
&gt;&lt;/li&gt;
&lt;li&gt;å®ƒè¿™é‡Œçš„å®ç°å°±æ˜¯ç”¨äº†ä¸€ä¸ªé˜Ÿåˆ—è®°å½•&lt;code&gt;HIST&lt;/code&gt;ä¸åŒçš„pageå‡ºç°æ—¶é—´ï¼Œç„¶åç”¨äº†å¾ªç¯æ¥å¯»æ‰¾æ»¡è¶³æ¡ä»¶æœ€å°çš„æ—¶é—´æˆ³ã€‚å¦‚æœè¢«é©±é€çš„æ˜¯ä¸ªè¢«ä¿®æ”¹è¿‡çš„é¡µé¢ï¼Œè¿˜éœ€è¦å°†å®ƒå†™å›ç¡¬ç›˜ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨å®é™…çš„å®ç°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ç”¨å †æ¥ä¼˜åŒ–è¿™ä¸ªå¯»æ‰¾æœ€å¤§K-distanceçš„è¿‡ç¨‹ã€‚&lt;/li&gt;
&lt;li&gt;ç„¶åå°±æ˜¯ä¸€äº›å®éªŒè¯æ˜ï¼Œæœ‰å…´è¶£çš„å¯ä»¥å»çœ‹ä¸‹åŸæ–‡ã€‚è¿™é‡Œå°±å…ˆä¸è®²äº†&lt;img src=&#34;https://antio2.cn/tech/database/lab1/cbd5aedca06f4088aa0c031ce326773f.png&#34;
	width=&#34;946&#34;
	height=&#34;602&#34;
	srcset=&#34;https://antio2.cn/tech/database/lab1/cbd5aedca06f4088aa0c031ce326773f_hu0210624d3b0a17b0e1e066326098f635_448684_480x0_resize_box_3.png 480w, https://antio2.cn/tech/database/lab1/cbd5aedca06f4088aa0c031ce326773f_hu0210624d3b0a17b0e1e066326098f635_448684_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;157&#34;
		data-flex-basis=&#34;377px&#34;
	
&gt;
&lt;img src=&#34;https://antio2.cn/tech/database/lab1/0e4ca7dadf40476c8c215deaa67cadad.png&#34;
	width=&#34;908&#34;
	height=&#34;823&#34;
	srcset=&#34;https://antio2.cn/tech/database/lab1/0e4ca7dadf40476c8c215deaa67cadad_hu3ff019721a7c450242d8d5c94e8641b1_654731_480x0_resize_box_3.png 480w, https://antio2.cn/tech/database/lab1/0e4ca7dadf40476c8c215deaa67cadad_hu3ff019721a7c450242d8d5c94e8641b1_654731_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;110&#34;
		data-flex-basis=&#34;264px&#34;
	
&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;cå®ç°&#34;&gt;C++å®ç°&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;è¿™é‡Œæˆ‘æ²¡æœ‰å®ç°è®ºæ–‡ä¸­åŒºåˆ†å…³è”è®¿é—®çš„æƒ…å†µï¼Œè€Œæ˜¯å°†æ‰€æœ‰è®¿é—®éƒ½è§†ä½œç‹¬ç«‹çš„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;è§£æ&#34;&gt;è§£æ&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;é¦–å…ˆæ¥çœ‹æˆ‘ä»¬æœ‰å“ªäº›æ•°æ®ç»“æ„&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  size_t current_timestamp_{&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;};
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  size_t curr_size_{&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;};
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  size_t max_size_;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  size_t replacer_size_;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  size_t k_;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;mutex latch_;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;using&lt;/span&gt; timestamp &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;list&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;size_t&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;;&lt;span style=&#34;color:#75715e&#34;&gt;//è®°å½•å•ä¸ªé¡µæ—¶é—´æˆ³çš„åˆ—è¡¨
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;using&lt;/span&gt; k_time &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;pair&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;frame_id_t,size_t&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;unordered_map&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;frame_id_t,timestamp&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; hist;&lt;span style=&#34;color:#75715e&#34;&gt;//ç”¨äºè®°å½•æ‰€æœ‰é¡µçš„æ—¶é—´æˆ³
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;unordered_map&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;frame_id_t,size_t&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; recorded_cnt_;&lt;span style=&#34;color:#75715e&#34;&gt;//ç”¨äºè®°å½•,è®¿é—®äº†å¤šå°‘æ¬¡
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;unordered_map&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;frame_id_t,&lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; evictable_;&lt;span style=&#34;color:#75715e&#34;&gt;//ç”¨äºè®°å½•æ˜¯å¦å¯ä»¥è¢«é©±é€
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;list&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;frame_id_t&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; new_frame_;&lt;span style=&#34;color:#75715e&#34;&gt;//ç”¨äºè®°å½•ä¸æ»¡kæ¬¡çš„é¡µ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;unordered_map&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;frame_id_t,std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;list&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;frame_id_t&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;::&lt;/span&gt;iterator&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; new_locate_;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;list&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;k_time&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; cache_frame_;&lt;span style=&#34;color:#75715e&#34;&gt;//ç”¨äºè®°å½•åˆ°è¾¾kæ¬¡çš„é¡µ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;unordered_map&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;frame_id_t,std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;list&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;k_time&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;::&lt;/span&gt;iterator&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; cache_locate_;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;åç§°&lt;/th&gt;
&lt;th&gt;ä½œç”¨&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;current_timestamp_&lt;/td&gt;
&lt;td&gt;å½“å‰çš„æ—¶é—´æˆ³,æ¯è¿›è¡Œä¸€æ¬¡recordæ“ä½œåŠ ä¸€&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;curr_size_&lt;/td&gt;
&lt;td&gt;å½“å‰å­˜æ”¾çš„å¯é©±é€é¡µé¢æ•°é‡&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;max_size&lt;/td&gt;
&lt;td&gt;æœ€å¤šå¯é©±é€é¡µé¢æ•°é‡ï¼ˆå»æ‰è¢«pinä½çš„é¡µé¢ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;replacer_size_&lt;/td&gt;
&lt;td&gt;æ•´ä¸ªä¸»å­˜å¤§å°ï¼ˆåŒ…æ‹¬è¢«pinçš„é¡µé¢ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;k_&lt;/td&gt;
&lt;td&gt;lru-kä¸­çš„kå€¼&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;latch_&lt;/td&gt;
&lt;td&gt;ç”¨äºç»´æŠ¤å¤šçº¿ç¨‹çš„é”&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;timestamp&lt;/td&gt;
&lt;td&gt;å•ä¸ªé¡µé¢çš„ä¸€è¿ä¸²æ—¶é—´æˆ³&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;k_time&lt;/td&gt;
&lt;td&gt;é¡µé¢å’Œkthæ—¶é—´æˆ³&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;hist&lt;/td&gt;
&lt;td&gt;æ‰€æœ‰é¡µé¢çš„è®¿é—®è®°å½•&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;recorded_cnt_&lt;/td&gt;
&lt;td&gt;è¢«è®¿é—®æ¬¡æ•°çš„è®°å½•&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;evictable&lt;/td&gt;
&lt;td&gt;è®°å½•ä¸€ä¸ªé¡µé¢æ˜¯å¦å¯ä»¥è¢«é©±é€&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;new_frame_&lt;/td&gt;
&lt;td&gt;è®°å½•ä¸æ»¡è¶³kæ¬¡è®¿é—®é¡µçš„é¡µå·&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;new_locate_&lt;/td&gt;
&lt;td&gt;é¡µå·åˆ°ä¸Šé¢è¿™ä¸ªé“¾è¡¨è¿­ä»£å™¨çš„å“ˆå¸Œè¡¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;cache_frame&lt;/td&gt;
&lt;td&gt;åˆ°è¾¾kæ¬¡é¡µçš„é“¾è¡¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;cache_locate_&lt;/td&gt;
&lt;td&gt;å“ˆå¸Œè¡¨ï¼Œè§£é‡ŠåŒä¸Š&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹äºæ»¡è¶³è®¿é—®è¿‡kæ¬¡çš„å’Œæ²¡åˆ°è¾¾kæ¬¡çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸¤ä¸ªé“¾è¡¨æ¥ç®¡ç†&lt;/li&gt;
&lt;li&gt;ç¬¬ä¸€ä¸ªé“¾è¡¨æ˜¯ä¸æ»¡è¶³kæ¬¡çš„ï¼Œæˆ‘ä»¬æ¯æ¬¡é€šè¿‡å¤´æ’æ³•åŠ å…¥æ–°çš„é¡µé¢ï¼Œå¦‚æœè¦åœ¨è¿™é‡Œé¢é©±é€ä¸€ä¸ªé¡µé¢ï¼Œé‡‡ç”¨&lt;code&gt;reverse_iterator&lt;/code&gt;åå‘è¿­ä»£å™¨ä»åå¾€å‰éå†ï¼ŒæŸ¥æ‰¾å…è®¸è¢«é©±é€çš„é¡µé¢&lt;img src=&#34;https://antio2.cn/tech/database/lab1/f76b6e2a569a407c8cc63b29c67d2c67.png&#34;
	width=&#34;2480&#34;
	height=&#34;3508&#34;
	srcset=&#34;https://antio2.cn/tech/database/lab1/f76b6e2a569a407c8cc63b29c67d2c67_hu9a8d3de9c02791adb2d451befb096b11_227748_480x0_resize_box_3.png 480w, https://antio2.cn/tech/database/lab1/f76b6e2a569a407c8cc63b29c67d2c67_hu9a8d3de9c02791adb2d451befb096b11_227748_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;70&#34;
		data-flex-basis=&#34;169px&#34;
	
&gt;&lt;/li&gt;
&lt;li&gt;æ¥ç€æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ–°çš„ç±»å‹ï¼Œ&lt;code&gt;using k_time = std::pair&amp;lt;frame_id_t,size_t&amp;gt;;&lt;/code&gt;è¿™ä¸ªè¡¨ç¤ºé¡µé¢å¯¹åº”çš„å€’æ•°ç¬¬kæ¬¡è®¿é—®çš„æ—¶é—´æˆ³ã€‚&lt;/li&gt;
&lt;li&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;list&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;k_time&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; cache_frame_;&lt;span style=&#34;color:#75715e&#34;&gt;//ç”¨äºè®°å½•åˆ°è¾¾kæ¬¡çš„é¡µ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;unordered_map&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;frame_id_t,std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;list&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;k_time&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;::&lt;/span&gt;iterator&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; cache_locate_;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ–°çš„é“¾è¡¨ï¼Œè¿™ä¸ªé“¾è¡¨æ˜¯æŒ‰ç…§æ—¶é—´æˆ³ä»å°åˆ°å¤§æ’åˆ—çš„&lt;/li&gt;
&lt;li&gt;ä¹Ÿå°±æ˜¯è¯´ï¼Œè¶Šå‰é¢çš„é¡µå®ƒçš„k-distanceè¶Šå¤§&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æˆ‘ä»¬é€šè¿‡äºŒåˆ†æŸ¥æ‰¾ç»´æŠ¤è¿™ä¸ª&lt;code&gt;cache_frame_&lt;/code&gt;çš„ç¨³å®šæ€§&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; kth_time &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; hist[frame_id].front();&lt;span style=&#34;color:#75715e&#34;&gt;//è·å–å½“å‰é¡µé¢çš„å€’æ•°ç¬¬kæ¬¡å‡ºç°çš„æ—¶é—´
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;     k_time &lt;span style=&#34;color:#a6e22e&#34;&gt;new_cache&lt;/span&gt;(frame_id,kth_time);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; it &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;upper_bound(cache_frame_.begin(),cache_frame_.end(),new_cache, CmpTimestamp);&lt;span style=&#34;color:#75715e&#34;&gt;//æ‰¾åˆ°è¯¥æ’å…¥çš„ä½ç½®
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;     it &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; cache_frame_.insert(it,new_cache);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     cache_locate_[frame_id] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; it;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;ç„¶åæ¥çœ‹æ–¹æ³•åˆ—è¡¨&lt;/li&gt;
&lt;/ul&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ–¹æ³•åŸå‹&lt;/th&gt;
&lt;th&gt;ä½œç”¨&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;LRUKReplacer(size_t num_frames, size_t k)&lt;/td&gt;
&lt;td&gt;ç”Ÿæˆå™¨ï¼Œnum_framesæ˜¯æœ€å¤§ç¼“å­˜ï¼Œkæ˜¯lru_kä¸­çš„kå€¼&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;auto Evict(frame_id_t *frame_id) -&amp;gt; bool&lt;/td&gt;
&lt;td&gt;é©±é€ä¸€ä¸ªé¡µé¢ï¼Œå¹¶ä¿å­˜åˆ°frame_idä¸­&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;void RecordAccess(frame_id_t frame_id);&lt;/td&gt;
&lt;td&gt;å¢åŠ ä¸€ä¸ªé¡µé¢çš„è®¿é—®è®°å½•&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;void SetEvictable(frame_id_t frame_id, bool set_evictable);&lt;/td&gt;
&lt;td&gt;è®¾ç½®ä¸€ä¸ªé¡µé¢æ˜¯å¦å¯ä»¥è¢«é©±é€&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;void Remove(frame_id_t frame_id);&lt;/td&gt;
&lt;td&gt;ç§»é™¤æŒ‡å®šé¡µé¢&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;auto Size() -&amp;gt; size_t;&lt;/td&gt;
&lt;td&gt;è¿”å›å¯é©±é€é¡µé¢çš„å¤§å°&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;æºç &#34;&gt;æºç &lt;/h3&gt;
&lt;h4 id=&#34;lru-kh&#34;&gt;&lt;code&gt;LRU-K.h&lt;/code&gt;&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;//
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Created by Anti on 2022/12/27.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;//
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#ifndef LRU_K_H
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#define LRU_K_H
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;lt;limits&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;lt;list&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;lt;mutex&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;lt;unordered_map&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;lt;vector&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;lt;algorithm&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;LRUKReplacer&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;using&lt;/span&gt; frame_id_t &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;explicit&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;LRUKReplacer&lt;/span&gt;(size_t num_frames, size_t k);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt;LRUKReplacer()&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;default&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Evict&lt;/span&gt;(frame_id_t &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;frame_id) &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;RecordAccess&lt;/span&gt;(frame_id_t frame_id);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;SetEvictable&lt;/span&gt;(frame_id_t frame_id, &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt; set_evictable);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Remove&lt;/span&gt;(frame_id_t frame_id);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Size&lt;/span&gt;() &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt; size_t;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;private&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    size_t current_timestamp_{&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;};
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    size_t curr_size_{&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;};
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    size_t max_size_;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    size_t replacer_size_;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    size_t k_;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;mutex latch_;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;using&lt;/span&gt; timestamp &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;list&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;size_t&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;;&lt;span style=&#34;color:#75715e&#34;&gt;//è®°å½•å•ä¸ªé¡µæ—¶é—´æˆ³çš„åˆ—è¡¨
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;using&lt;/span&gt; k_time &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;pair&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;frame_id_t,size_t&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;unordered_map&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;frame_id_t,timestamp&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; hist;&lt;span style=&#34;color:#75715e&#34;&gt;//ç”¨äºè®°å½•æ‰€æœ‰é¡µçš„æ—¶é—´æˆ³
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;unordered_map&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;frame_id_t,size_t&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; recorded_cnt_;&lt;span style=&#34;color:#75715e&#34;&gt;//ç”¨äºè®°å½•,è®¿é—®äº†å¤šå°‘æ¬¡
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;unordered_map&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;frame_id_t,&lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; evictable_;&lt;span style=&#34;color:#75715e&#34;&gt;//ç”¨äºè®°å½•æ˜¯å¦å¯ä»¥è¢«é©±é€
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;list&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;frame_id_t&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; new_frame_;&lt;span style=&#34;color:#75715e&#34;&gt;//ç”¨äºè®°å½•ä¸æ»¡kæ¬¡çš„é¡µ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;unordered_map&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;frame_id_t,std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;list&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;frame_id_t&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;::&lt;/span&gt;iterator&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; new_locate_;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;list&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;k_time&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; cache_frame_;&lt;span style=&#34;color:#75715e&#34;&gt;//ç”¨äºè®°å½•åˆ°è¾¾kæ¬¡çš„é¡µ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;unordered_map&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;frame_id_t,std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;list&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;k_time&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;::&lt;/span&gt;iterator&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; cache_locate_;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;CmpTimestamp&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; k_time &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;f1,&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; k_time &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;f2) &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;};
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#endif &lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;//LRU_K_H
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;lru-kcpp&#34;&gt;&lt;code&gt;LRU-K.cpp&lt;/code&gt;&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;//
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Created by Anti on 2022/12/27.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;//
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;#34;LRU_K.h&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;LRUKReplacer&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;LRUKReplacer(size_t num_frames, size_t k) &lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; replacer_size_(num_frames), k_(k) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    max_size_&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;num_frames;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; LRUKReplacer&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;Evict(frame_id_t &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;frame_id) &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;lock_guard&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;mutex&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; lock(latch_);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;/**
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;     * å¦‚æœæ²¡æœ‰å¯ä»¥é©±é€å…ƒç´ 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;     */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(Size()&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; false;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;/**
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;     * é¦–å…ˆå°è¯•åˆ é™¤è·ç¦»ä¸ºæ— é™å¤§çš„ç¼“å­˜
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;     */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; it &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; new_frame_.rbegin();it&lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt;new_frame_.rend();it&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; frame &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;it;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(evictable_[frame])&lt;span style=&#34;color:#75715e&#34;&gt;//å¦‚æœå¯ä»¥è¢«åˆ é™¤
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;        {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            recorded_cnt_[frame] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            new_locate_.erase(frame);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            new_frame_.remove(frame);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;frame_id &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; frame;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            curr_size_&lt;span style=&#34;color:#f92672&#34;&gt;--&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            hist[frame].clear();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; true;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;/**
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;     * å†å°è¯•åˆ é™¤å·²ç»è®¿é—®è¿‡Kæ¬¡çš„ç¼“å­˜
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;     */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; it &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;cache_frame_.begin();it&lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt;cache_frame_.end();it&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; frame &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;it).first;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(evictable_[frame])
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            recorded_cnt_[frame] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            cache_frame_.erase(it);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            cache_locate_.erase(frame);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;frame_id &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; frame;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            curr_size_&lt;span style=&#34;color:#f92672&#34;&gt;--&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            hist[frame].clear();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; true;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; false;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; LRUKReplacer&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;RecordAccess(frame_id_t frame_id)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;lock_guard&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;mutex&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; lock(latch_);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(frame_id&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;static_cast&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;frame_id_t&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;(replacer_size_))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;throw&lt;/span&gt; std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;exception();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    current_timestamp_&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    recorded_cnt_[frame_id]&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; cnt &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; recorded_cnt_[frame_id];
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    hist[frame_id].push_back(current_timestamp_);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;/**
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;     * å¦‚æœæ˜¯æ–°åŠ å…¥çš„è®°å½•
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;     */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(cnt&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(curr_size_&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;max_size_)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            frame_id_t frame;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            Evict(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;frame);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        evictable_[frame_id] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; true;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        curr_size_&lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        new_frame_.push_front(frame_id);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        new_locate_[frame_id] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; new_frame_.begin();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;/**
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;     * å¦‚æœè®°å½•è¾¾åˆ°kæ¬¡ï¼Œåˆ™éœ€è¦ä»æ–°é˜Ÿåˆ—ä¸­åŠ å…¥åˆ°è€é˜Ÿåˆ—ä¸­
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;     */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(cnt&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;k_)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        new_frame_.erase(new_locate_[frame_id]);&lt;span style=&#34;color:#75715e&#34;&gt;//ä»æ–°é˜Ÿåˆ—ä¸­åˆ é™¤
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;        new_locate_.erase(frame_id);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; kth_time &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; hist[frame_id].front();&lt;span style=&#34;color:#75715e&#34;&gt;//è·å–å½“å‰é¡µé¢çš„å€’æ•°ç¬¬kæ¬¡å‡ºç°çš„æ—¶é—´
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;        k_time &lt;span style=&#34;color:#a6e22e&#34;&gt;new_cache&lt;/span&gt;(frame_id,kth_time);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; it &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;upper_bound(cache_frame_.begin(),cache_frame_.end(),new_cache,CmpTimestamp);&lt;span style=&#34;color:#75715e&#34;&gt;//æ‰¾åˆ°è¯¥æ’å…¥çš„ä½ç½®
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;        it &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; cache_frame_.insert(it,new_cache);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        cache_locate_[frame_id] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; it;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;/**
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;     * å¦‚æœè®°å½•åœ¨kæ¬¡ä»¥ä¸Šï¼Œéœ€è¦å°†è¯¥frameæ”¾åˆ°æŒ‡å®šçš„ä½ç½®
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;     */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(cnt&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;k_)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        hist[frame_id].erase(hist[frame_id].begin());
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        cache_frame_.erase(cache_locate_[frame_id]);&lt;span style=&#34;color:#75715e&#34;&gt;//å»é™¤åŸæ¥çš„ä½ç½®
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; kth_time &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; hist[frame_id].front();&lt;span style=&#34;color:#75715e&#34;&gt;//è·å–å½“å‰é¡µé¢çš„å€’æ•°ç¬¬kæ¬¡å‡ºç°çš„æ—¶é—´
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;        k_time &lt;span style=&#34;color:#a6e22e&#34;&gt;new_cache&lt;/span&gt;(frame_id,kth_time);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; it &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;upper_bound(cache_frame_.begin(),cache_frame_.end(),new_cache, CmpTimestamp);&lt;span style=&#34;color:#75715e&#34;&gt;//æ‰¾åˆ°è¯¥æ’å…¥çš„ä½ç½®
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;        it &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; cache_frame_.insert(it,new_cache);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        cache_locate_[frame_id] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; it;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;/**
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;     * å¦‚æœcnt&amp;lt;k_ï¼Œæ˜¯ä¸éœ€è¦åšæ›´æ–°åŠ¨ä½œçš„
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;     */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; LRUKReplacer&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;SetEvictable(frame_id_t frame_id, &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt; set_evictable)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;lock_guard&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;mutex&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; lock(latch_);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(recorded_cnt_[frame_id]&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; ;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; status &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; evictable_[frame_id];
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    evictable_[frame_id] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; set_evictable;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(status&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;!&lt;/span&gt;set_evictable)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;--&lt;/span&gt;max_size_;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;--&lt;/span&gt;curr_size_;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;status&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt;set_evictable)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt;max_size_;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;++&lt;/span&gt;curr_size_;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; LRUKReplacer&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;Remove(frame_id_t frame_id) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;lock_guard&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;mutex&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; lock(latch_);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (frame_id &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;static_cast&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;frame_id_t&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;(replacer_size_)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;throw&lt;/span&gt; std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;exception();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; cnt &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; recorded_cnt_[frame_id];
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (cnt &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; ;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;!&lt;/span&gt;evictable_[frame_id])
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;throw&lt;/span&gt; std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;exception();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(cnt&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;k_)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        new_frame_.erase(new_locate_[frame_id]);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        new_locate_.erase(frame_id);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        recorded_cnt_[frame_id] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        hist[frame_id].clear();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        curr_size_&lt;span style=&#34;color:#f92672&#34;&gt;--&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        cache_frame_.erase(cache_locate_[frame_id]);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        cache_locate_.erase(frame_id);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        recorded_cnt_[frame_id] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        hist[frame_id].clear();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        curr_size_&lt;span style=&#34;color:#f92672&#34;&gt;--&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; LRUKReplacer&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;Size() &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt; size_t { &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; curr_size_; }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;auto&lt;/span&gt; LRUKReplacer&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;CmpTimestamp(&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; LRUKReplacer&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt; k_time &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;f1,&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; LRUKReplacer&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt; k_time &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;f2) &lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; f1.second&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;f2.second;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;æµ‹è¯•&#34;&gt;æµ‹è¯•&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡GoogleTestè¿›è¡Œæµ‹è¯•ï¼Œä¸‹é¢æ˜¯æˆ‘å†™çš„æµ‹è¯•å®ä¾‹&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;TEST(LRUKReplacerTest, AntiO2)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; LRUKReplacer &lt;span style=&#34;color:#a6e22e&#34;&gt;lru_replacer&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; frame_id_t frame;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; ASSERT_EQ(lru_replacer.Size(),&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; lru_replacer.RecordAccess(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; lru_replacer.RecordAccess(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; lru_replacer.RecordAccess(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; lru_replacer.RecordAccess(&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; lru_replacer.RecordAccess(&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; lru_replacer.RecordAccess(&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; lru_replacer.RecordAccess(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; ASSERT_EQ(lru_replacer.Size(),&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; lru_replacer.RecordAccess(&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; lru_replacer.Evict(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;frame);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; ASSERT_EQ(frame,&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; lru_replacer.Evict(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;frame);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; EXPECT_EQ(frame,&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; lru_replacer.RecordAccess(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; lru_replacer.RecordAccess(&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; lru_replacer.RecordAccess(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; lru_replacer.Evict(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;frame);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; EXPECT_EQ(frame,&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; lru_replacer.RecordAccess(&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; lru_replacer.RecordAccess(&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; lru_replacer.Evict(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;frame);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; EXPECT_EQ(frame,&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; lru_replacer.Evict(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;frame);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; EXPECT_EQ(frame,&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;æµ‹è¯•ç»“æœ
&lt;img src=&#34;https://antio2.cn/tech/database/lab1/50bea46705d2444097490358573a7bd8.png&#34;
	width=&#34;634&#34;
	height=&#34;271&#34;
	srcset=&#34;https://antio2.cn/tech/database/lab1/50bea46705d2444097490358573a7bd8_hu2a3cc023ce3f20d98fcf76c2123a9231_46262_480x0_resize_box_3.png 480w, https://antio2.cn/tech/database/lab1/50bea46705d2444097490358573a7bd8_hu2a3cc023ce3f20d98fcf76c2123a9231_46262_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;233&#34;
		data-flex-basis=&#34;561px&#34;
	
&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;lru-kå°ç»“&#34;&gt;LRU-Kå°ç»“&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;LRU-Kæ˜¯å¯¹LRUç®—æ³•çš„æ”¹è¿›ï¼Œè§„é¿äº†ä¸€äº›è®¿é—®ä¸Šå®é™…çš„é—®é¢˜ï¼ŒåŒæ—¶å¸¦æ¥çš„é¢å¤–å¼€é”€ä¹Ÿæ˜¯å¯ä»¥æ¥å—çš„ï¼Œæ˜¯ä¸€ä¸ªå€¼å¾—å­¦ä¹ çš„ç®—æ³•&lt;/li&gt;
&lt;li&gt;åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿˜åº”å½“è€ƒè™‘å…³è”è®¿é—®æ—¶æœŸé€ æˆçš„å½±å“ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id=&#34;buffer-poolä»‹ç»&#34;&gt;Buffer Poolä»‹ç»&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨å®ç°ç¼“å†²æ± ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆéœ€è¦çŸ¥é“ä¸¤ä¸ªæ¦‚å¿µçš„åŒºåˆ«ï¼šframeå’Œpageã€‚&lt;/li&gt;
&lt;li&gt;åœ¨è¿™é‡Œframeæ˜¯æŒ‡åœ¨å†…å­˜ä¸­çš„ä¸€å—åŒºåŸŸï¼Œç”¨äºå­˜æ”¾pageã€‚frameåœ¨å†…å­˜ä¸­æ˜¯å›ºå®šçš„&lt;/li&gt;
&lt;li&gt;pageæ˜¯åŒ…å«äº†å…ƒä¿¡æ¯ï¼ˆæ¯”å¦‚æ˜¯å¦æ˜¯è„é¡µé¢ã€page_idç­‰ï¼‰å’Œpage_dataçš„ä¸€ä¸ªç±»ã€‚pageå¯ä»¥å­˜æ”¾åœ¨frameä¸­ï¼Œä¹Ÿå¯ä»¥å°†æ•°æ®å†™åœ¨diskä¸Šä»¥ä¾¿è¢«ç¼“å­˜æ± ä¸¢æ‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;å±æ€§&#34;&gt;å±æ€§&lt;/h3&gt;
&lt;p&gt;åœ¨ç±»&lt;code&gt;BufferPoolManagerInstance&lt;/code&gt;ä¸»è¦æœ‰ä»¥ä¸‹å±æ€§&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;pool_size_
&lt;ul&gt;
&lt;li&gt;pool_size_æ˜¯ç¼“å†²æ± çš„å¤§å°ï¼Œä¹Ÿæ˜¯æœ€å¤šframeä¸ªæ•°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Page *pages_
&lt;ul&gt;
&lt;li&gt;æŒ‡å‘ä¸€ä¸ªPageæ•°ç»„ï¼Œç”¨äºå­˜æ”¾æ‰€æœ‰çš„Pageã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;free_list_
&lt;ul&gt;
&lt;li&gt;ä¸€ä¸ªlist,é‡Œé¢å­˜æ”¾äº†ç©ºé—²çš„frame_id&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;è¿˜æœ‰ä¹‹å‰å®ç°çš„å“ˆå¸Œè¡¨ã€lru_k_replacerã€æ‰“å¼€äº†å½“å‰å¯¹åº”æ–‡ä»¶çš„disk_manager&lt;/li&gt;
&lt;li&gt;&lt;code&gt;BufferPoolManagerInstance&lt;/code&gt;æ˜¯&lt;code&gt;class Page&lt;/code&gt;çš„å‹å…ƒï¼Œå¯ä»¥ç›´æ¥è®¿é—®Pageçš„å±æ€§ï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ°Pageä»¥ä¸‹çš„å±æ€§
&lt;ul&gt;
&lt;li&gt;data_æ˜¯ä¸€ä¸ªå­—ç¬¦æ•°ç»„ï¼Œç”¨äºå­˜æ”¾æ•°æ®&lt;/li&gt;
&lt;li&gt;page_id_&lt;/li&gt;
&lt;li&gt;is_dirty_ è®°å½•æ˜¯å¦æ˜¯è„é¡µé¢&lt;/li&gt;
&lt;li&gt;pin_count_ è®°å½•è¢«pinä½çš„æ•°é‡ï¼Œå½“pin_count==0æ—¶ï¼Œè¿™ä¸ªé¡µé¢æ‰èƒ½å¤Ÿè¢«é©±é€&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æ–¹æ³•&#34;&gt;æ–¹æ³•&lt;/h3&gt;
&lt;h4 id=&#34;newpgimp&#34;&gt;NewPgImp&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;åŠŸèƒ½ï¼šä¸ºå½“å‰çš„æ•°æ®åº“å¢åŠ ä¸€é¡µï¼Œå¹¶ä¸”è¿”å›è¯¥é¡µã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœå†…å­˜ä¸­æœ‰ç©ºé—²çš„frame,(free_listä¸ç©º)åˆ™ç›´æ¥æŠŠè¯¥é¡µæ”¾åˆ°è¿™ä¸ªframeä¸Šã€‚å¦åˆ™é€šè¿‡ä¹‹å‰çš„LRU_Kç­–ç•¥é©±é€ä¸€ä¸ªframe,è¿™é‡Œå¦‚æœframeä¸­çš„pageæ˜¯è„çš„ï¼Œéœ€è¦ç”¨ä¹‹åçš„Flushæ–¹æ³•å†™å›ç£ç›˜ã€‚&lt;/li&gt;
&lt;li&gt;è¿™é‡Œè¦æ³¨æ„ï¼Œç”Ÿæˆä¸€ä¸ªPageåè®°å¾—æŠŠå®ƒçš„data_æ¸…é›¶ï¼Œç„¶åé©±é€ã€å¢åŠ ç­‰æ“ä½œéƒ½è¦å½±å“page_table_å’Œreplacer_çš„æ•°æ®ï¼Œè®°å¾—å“ˆå¸Œè¡¨å»æ‰æ—§çš„page_idå¹¶æ·»åŠ æ–°çš„é”®å€¼å¯¹ã€‚&lt;/li&gt;
&lt;li&gt;æ–°çš„pageæŒ‰ç…§é¢˜ç›®æ„æ€pin_count_ä¸º1ï¼Œä¸èƒ½å¤Ÿè¢«é©±é€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;fetchpgimp&#34;&gt;FetchPgImp&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;FetchPgImpä¼ å…¥ä¸€ä¸ªpage_idï¼Œå¹¶è¿”å›å¯¹åº”é¡µé¢çš„æŒ‡é’ˆã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœé€šè¿‡hashè¡¨æŸ¥åˆ°è¯¥pageåœ¨å†…å­˜ä¸­ï¼Œç›´æ¥è¿”å›ï¼Œè®°å¾—LRU-Kè®°å½•ä¸€ä¸‹è®¿é—®å†å²ã€‚&lt;/li&gt;
&lt;li&gt;FetchPgImpé©±é€è¿‡ç¨‹å’Œä¸Šä¸€ä¸ªæ–¹æ³•ç±»ä¼¼ã€‚ä½†æ˜¯è¦åŠ ä¸€æ­¥ï¼šä»ç£ç›˜ä¸­å°†ä¹‹å‰çš„dataè¯»å…¥å†…å­˜
&lt;code&gt;disk_manager_-&amp;gt;ReadPage(page_id,pages_[frame_id].GetData());&lt;/code&gt;
&lt;strong&gt;æ³¨æ„&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;å¦‚æœè¦fetchçš„é¡µé¢å·²ç»åœ¨poolä¸­äº†ï¼Œé‚£ä¹ˆè¦è¿›è¡Œä»¥ä¸‹æ“ä½œ
&lt;ul&gt;
&lt;li&gt;lru-kè¦è¿›è¡Œrecord&lt;/li&gt;
&lt;li&gt;æ‰‹åŠ¨setEvictableä¸ºfalse&lt;/li&gt;
&lt;li&gt;pincount++&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å¦‚æœä¸åœ¨poolä¸­ï¼Œé‚£ä¹ˆä¹Ÿè¦è¿›è¡Œä»¥ä¸Šæ“ä½œï¼Œå¹¶ä¸”pincount = 1&lt;/li&gt;
&lt;li&gt;ä¸Šé¢è¿™ä¸ªå¡äº†æˆ‘å¾ˆä¹…ï¼Œå› ä¸ºåœ¨æ–‡æ¡£é‡Œä¹Ÿæ²¡å†™å…·ä½“çš„è¦æ±‚ï¼Œå¤§å®¶å†™çš„æ—¶å€™æ³¨æ„ä¸€ä¸‹&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;unpinpgimp&#34;&gt;UnpinPgImp&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœå¯¹åº”é¡µé¢&lt;code&gt;pin_count&amp;gt;0&lt;/code&gt;å°†&lt;code&gt;pin_count_--&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;å½“pin_countä¸º0ï¼Œè®¾ç½®è¯¥é¡µé¢å¯è¢«é©±é€&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;flushpgimp&#34;&gt;FlushPgImp&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡disk_managerçš„WritePageå°†é¡µé¢å†™å…¥diskä¸­&lt;/li&gt;
&lt;li&gt;å°†è„é¡µé¢æ ‡è®°è®¾ç½®ä¸ºfalse.&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;flushallpgsimp&#34;&gt;FlushAllPgsImp&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;Flushæ‰€æœ‰é¡µé¢ï¼Œæ³¨æ„è¿™é‡Œä¸èƒ½å†™frameä¸ºç©ºçš„ä½ç½®&lt;/li&gt;
&lt;li&gt;å¯ä»¥è®¾ç½®ä¸€ä¸ªæ ‡è®°æ•°ç»„ï¼Œå°†free_listéå†ä¸€éæ‰¾å‡ºç©ºçš„frame,ç„¶åå†éå†ä¸€æ¬¡buffer_poolï¼Œä¸ä¸ºç©ºåˆ™flushã€‚å¸¦æ¥çš„æ—¶é—´å’Œç©ºé—´å¤æ‚åº¦å†—ä½™éƒ½æ˜¯$O(pool size)$ï¼Œå¯ä»¥æ¥å—ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;deletepgimp&#34;&gt;DeletePgImp&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;åˆ é™¤æŒ‡å®šPage&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ä»£ç å®ç°&#34;&gt;ä»£ç å®ç°&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨è¿™ä¸ªProjectä¸­æˆ‘å­¦åˆ°äº†å‡ ä¸ªc++çš„ç”¨æ³•ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Page *pages_;		pages_ = new Page[pool_size_];&lt;/code&gt;ä¹‹åï¼Œpages_æŒ‡å‘ä¸€ä¸ªæ•°ç»„ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨åˆ›å»ºæ–°pageæ—¶ï¼Œ&lt;code&gt;pages_[frame_id]&lt;/code&gt;æ˜¯ä¸€ä¸ªPageç±»å‹ï¼Œä¸èƒ½é€šè¿‡æŒ‡é’ˆåˆ›å»ºï¼Œæ¯”å¦‚&lt;code&gt;pages_[frame_id] = new Page()&lt;/code&gt;æ˜¯é”™çš„ã€‚ä¹Ÿä¸èƒ½&lt;code&gt;pages_[frame_id] = Page()&lt;/code&gt;ï¼Œå› ä¸ºPageæ²¡æœ‰æ‹·è´æ–¹æ³•ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡&lt;code&gt;new(&amp;amp;pages_[free_frame]) Page();&lt;/code&gt;åœ¨æŒ‡å®šä½ç½®ä¸Šæ„é€ ä¸€ä¸ªæ–°çš„Pageã€‚è¿™é‡Œnewé‡Œé¢çš„å‚æ•°æ˜¯ä¸€ä¸ªåœ°å€ã€‚&lt;/li&gt;
&lt;li&gt;åŒç†ï¼Œ&lt;code&gt;pages_[frame_id]&lt;/code&gt;ä¸æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨åˆ é™¤é¡µçš„æ—¶å€™ï¼Œä¸èƒ½ä½¿ç”¨&lt;code&gt;delete pages_[frame_id]&lt;/code&gt;,å¯ä»¥é€šè¿‡&lt;code&gt;pages_[frame_id].~Page()&lt;/code&gt;æ¥è°ƒç”¨ææ„å‡½æ•°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç„¶åå…¶ä»–çš„ä»£ç å®ç°æŒ‰ç…§é¢˜ç›®è¦æ±‚åšå°±è¡Œäº†ï¼Œæ³¨æ„æ¯æ¬¡frameçš„å˜æ›´å¯¹page_table_ã€replacer_çš„å½±å“ï¼Œé‡åˆ°é”™è¯¯ä½¿ç”¨GDBæˆ–è€…é€šè¿‡IDEè°ƒè¯•å·¥å…·æ¥è°ƒè¯•æ‰¾åˆ°é—®é¢˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å…³äºå¤šçº¿ç¨‹&#34;&gt;å…³äºå¤šçº¿ç¨‹&lt;/h2&gt;
&lt;p&gt;æˆ‘è‡ªå·±ç›´æ¥ç”¨çš„æ˜¯å¤§é”ï¼Œä¹Ÿå°±æ˜¯åœ¨æ¯ä¸ªå‡½æ•°çš„ç¬¬ä¸€æ’åŠ äº†ä¸€è¡Œ
&lt;code&gt;std::scoped_lock&amp;lt;std::mutex&amp;gt; lock(latch_);&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;æ³¨æ„å¦‚æœç”¨è¿™ç§æ–¹æ³•ï¼Œé‚£ä¹ˆä½ çš„å‡½æ•°ä¹‹é—´æ˜¯ä¸èƒ½ç›¸äº’è°ƒç”¨çš„ï¼Œæ¯”å¦‚ä½ åœ¨ã€&lt;code&gt;FetchPgImp&lt;/code&gt;ä¸­ï¼Œå‡†å¤‡é©±é€ä¸€ä¸ªè„é¡µé¢ï¼Œé‚£ä¹ˆä½ æ˜¯ä¸èƒ½è°ƒç”¨&lt;code&gt;FlushPgImp&lt;/code&gt;çš„ï¼Œå¦åˆ™ä¼šå¼•èµ·æ­»é”ã€‚åŒç†&lt;code&gt;AllocatePage()&lt;/code&gt;å‰é¢ä¹Ÿæ˜¯ä¸èƒ½åŠ é”çš„ï¼Œå› ä¸º&lt;code&gt;AllocatePage()&lt;/code&gt;ä¼šè¢«&lt;code&gt;FetchPgImp&lt;/code&gt;è°ƒç”¨ã€‚
å¦‚æœè¦å†™æ›´ç»†ç²’åº¦çš„è¯ï¼Œå¯ä»¥å°è¯•è¯»å†™é”åˆ†å¼€ï¼Œç„¶åç”¨Pageé‡Œé¢çš„å°é”ã€‚ä¸è¿‡å†™çš„ç²—ç³™ä¸€ç‚¹ä¹Ÿèƒ½è¿‡å°±æ˜¯äº†
&lt;img src=&#34;https://antio2.cn/tech/database/lab1/1879398e3b5b428caba5524b7e5d2aed.png&#34;
	width=&#34;407&#34;
	height=&#34;752&#34;
	srcset=&#34;https://antio2.cn/tech/database/lab1/1879398e3b5b428caba5524b7e5d2aed_hu80e454c3bea3fb60b0b188c2a803e654_120884_480x0_resize_box_3.png 480w, https://antio2.cn/tech/database/lab1/1879398e3b5b428caba5524b7e5d2aed_hu80e454c3bea3fb60b0b188c2a803e654_120884_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;54&#34;
		data-flex-basis=&#34;129px&#34;
	
&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>CMU 15-445|Project0 å¼€å§‹åšä¸€ä¸ªæ•°æ®åº“å†…æ ¸</title>
        <link>https://antio2.cn/tech/database/lab0/</link>
        <pubDate>Sat, 24 Sep 2022 21:10:53 +0800</pubDate>
        
        <guid>https://antio2.cn/tech/database/lab0/</guid>
        <description>&lt;img src="https://antio2.cn/tech/database/lab0/b114872c3bbf4c2fbd98f37aa9ddcb9d.png" alt="Featured image of post CMU 15-445|Project0 å¼€å§‹åšä¸€ä¸ªæ•°æ®åº“å†…æ ¸" /&gt;&lt;h1 id=&#34;cmu-15-445-fall-2022-project-0-ä¸€äº›æ³¨æ„äº‹é¡¹&#34;&gt;CMU 15-445 (FALL 2022) Project #0 ä¸€äº›æ³¨æ„äº‹é¡¹&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;We will make the auto-grader for each assignment available to non-CMU students on Gradescope after their due date for CMU students. In exchange for making this available to the public, we ask that you do not make your project implementations public on Github or other source code repositories.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;CMUä¸ºå¤–æ ¡çš„å­¦ç”Ÿæä¾›äº†è‡ªåŠ¨æµ‹è¯•å¹³å°å’Œå…¬å¼€è¯¾ï¼Œä»£ä»·æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿé‚£å°±æ˜¯ä¸è¦ç›´æ¥å…¬å¼€ä»£ç åœ¨ç½‘ä¸Šã€‚è¿˜è¯·å¤§å®¶éµå®ˆã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç¯‡åšå®¢è®°å½•ä¸€äº›è¸©çš„å‘ï¼Œæ¬¢è¿äº¤æµ&lt;/p&gt;
&lt;h2 id=&#34;çŸ¥è¯†ç‚¹&#34;&gt;çŸ¥è¯†ç‚¹&lt;/h2&gt;
&lt;h3 id=&#34;è¯­è¨€åŸºç¡€&#34;&gt;è¯­è¨€åŸºç¡€&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;C++åŸºç¡€è¯­æ³•&lt;/li&gt;
&lt;li&gt;&lt;code&gt;unique_ptr&lt;/code&gt;çš„ç”¨æ³•&lt;/li&gt;
&lt;li&gt;&lt;code&gt;std::move&lt;/code&gt;å¯ä»¥å°†å·¦å€¼æ˜¾ç¤ºè½¬åŒ–ä¸ºå³å€¼&lt;/li&gt;
&lt;li&gt;å¹¶å‘é”çš„ä½¿ç”¨&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;ç®—æ³•è¦æ±‚&#34;&gt;ç®—æ³•è¦æ±‚&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Trieæœ¬èº«çš„åŸç†å¾ˆç®€å•ï¼Œå¯ä»¥å®ç°&lt;code&gt;O(length)&lt;/code&gt;çš„å¢åˆ æ”¹æŸ¥æ“ä½œï¼Œå½“ç„¶ç¼ºç‚¹å°±æ˜¯ç©ºé—´æ¢æ—¶é—´&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://leetcode.cn/problems/implement-trie-prefix-tree/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;å¯ä»¥å…ˆåšè¿™é“é¢˜&lt;/a&gt;ã€‚ä¹Ÿå¯ä»¥ç›´æ¥åš&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å¼€å‘ç¯å¢ƒ&#34;&gt;å¼€å‘ç¯å¢ƒ&lt;/h2&gt;
&lt;p&gt;æˆ‘æ˜¯åœ¨è‡ªå·±çš„Ubuntu22.04çš„æœåŠ¡å™¨ä¸Šæ­å»ºç¯å¢ƒçš„ã€‚ä½†æ˜¯ç”¨çš„æœ¬åœ°Clionå¼€å‘ã€‚å¦‚æœè¦ç”¨winï¼Œè®°å¾—ä¸€å®šè¦å…ˆåœ¨linuxä¸Šé¢æŠŠæºæ–‡ä»¶ä¸‹å¥½ï¼Œä¸ç„¶è„šæœ¬ä¼šå‡ºç°é”™è¯¯ï¼ˆå› ä¸ºæ¢è¡Œç¬¦çš„åŸå› ï¼Œå¦‚æœå‡ºé”™äº†å¯ä»¥è¿›è¡Œæ›¿æ¢ï¼‰ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æœ¬åœ°æµ‹è¯•&#34;&gt;æœ¬åœ°æµ‹è¯•&lt;/h2&gt;
&lt;p&gt;==æ³¨æ„åœ¨makeå‰æŠŠæƒ³è¦æµ‹è¯•çš„é¢˜ç›®Testæ–‡ä»¶ä¸­çš„DISABLED_ç»™å»æ‰ã€‚==
å› ä¸ºGTestçš„å®ï¼Œæµ‹è¯•åå‰é¢æœ‰&lt;code&gt;DISABLED_&lt;/code&gt;ä¼šè¢«è·³è¿‡æµ‹è¯•ã€‚
&lt;img src=&#34;https://antio2.cn/tech/database/lab0/b114872c3bbf4c2fbd98f37aa9ddcb9d.png&#34;
	width=&#34;1920&#34;
	height=&#34;1029&#34;
	srcset=&#34;https://antio2.cn/tech/database/lab0/b114872c3bbf4c2fbd98f37aa9ddcb9d_hu2daf6dc1198a8efdba44bc4f1fafece7_308860_480x0_resize_box_3.png 480w, https://antio2.cn/tech/database/lab0/b114872c3bbf4c2fbd98f37aa9ddcb9d_hu2daf6dc1198a8efdba44bc4f1fafece7_308860_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;æµ‹è¯•&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;186&#34;
		data-flex-basis=&#34;447px&#34;
	
&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç„¶åä½ å¯ä»¥é€šè¿‡è‡ªå·±å†™ä»£ç å¢åŠ ä¸€äº›æ ·ä¾‹&lt;/li&gt;
&lt;li&gt;æ¯”å¦‚&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;TEST(MyStarterTest,MyTest1)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Trie trie;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt; success;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    trie.Insert&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;aaa&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    success&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;trie.Insert&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;aa&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    EXPECT_EQ(success, true);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;TEST(MyStarterTest,MyTest2)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Trie trie;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt; success;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    trie.Insert&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;abc&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    success&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;trie.Insert&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;abed&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    EXPECT_EQ(success, true);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;code&gt;MyStarterTest&lt;/code&gt;å°±æ˜¯ä¸€ä¸ªæµ‹è¯•ç»„ï¼Œå‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯æµ‹è¯•çš„åå­—ã€‚é€šè¿‡å¯¹å€¼æ¯”è¾ƒåˆ¤æ–­æµ‹è¯•æ˜¯å¦é€šè¿‡&lt;/li&gt;
&lt;li&gt;æ¯”å¦‚&lt;code&gt;EXPECT_EQ(success, true)&lt;/code&gt;ï¼Œå°±æ˜¯åˆ¤æ–­å˜é‡successæ˜¯å¦ä¸ºtrue&lt;/li&gt;
&lt;li&gt;&lt;code&gt;EXPECT_EQ((*child_node)-&amp;gt;GetKeyChar(), &#39;c&#39;);&lt;/code&gt;åˆ¤æ–­è¯¥èŠ‚ç‚¹æ˜¯å¦keyä¸ºc&lt;/li&gt;
&lt;li&gt;&lt;code&gt;EXPECT_NE(child_node, nullptr);&lt;/code&gt;åˆ¤æ–­&lt;code&gt;child_node&lt;/code&gt;æ˜¯å¦ä¸ç­‰äº&lt;code&gt;nullptr&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;è‡ªå®šä¹‰æµ‹è¯•æ•ˆæœ
&lt;img src=&#34;https://antio2.cn/tech/database/lab0/b69438c21b5d418c8d35ba1b85ad89f8.png&#34;
	width=&#34;675&#34;
	height=&#34;347&#34;
	srcset=&#34;https://antio2.cn/tech/database/lab0/b69438c21b5d418c8d35ba1b85ad89f8_hue061b8907b1d4057145da046989e95c0_58219_480x0_resize_box_3.png 480w, https://antio2.cn/tech/database/lab0/b69438c21b5d418c8d35ba1b85ad89f8_hue061b8907b1d4057145da046989e95c0_58219_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;194&#34;
		data-flex-basis=&#34;466px&#34;
	
&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ç½‘ä¸Šè¯„æµ‹&#34;&gt;ç½‘ä¸Šè¯„æµ‹&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/database/lab0/da1b08fcdbeb49b09b56f3924112b204.png&#34;
	width=&#34;1324&#34;
	height=&#34;888&#34;
	srcset=&#34;https://antio2.cn/tech/database/lab0/da1b08fcdbeb49b09b56f3924112b204_huf684dd951ebf14d13ff068464a5f6e39_73922_480x0_resize_box_3.png 480w, https://antio2.cn/tech/database/lab0/da1b08fcdbeb49b09b56f3924112b204_huf684dd951ebf14d13ff068464a5f6e39_73922_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;149&#34;
		data-flex-basis=&#34;357px&#34;
	
&gt;
ç½‘å€æ˜¯&lt;a class=&#34;link&#34; href=&#34;https://www.gradescope.com/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;gradescope&lt;/a&gt;ã€‚ç„¶åå¡«å…¥ä¸Šé¢çš„é‚€è¯·ç ï¼Œå­¦æ ¡è®°å¾—å†™CMUã€‚&lt;/p&gt;
&lt;p&gt;==æäº¤è®°å¾—ç”¨zip==ä¸èƒ½ç”¨github!!!&lt;/p&gt;
&lt;h2 id=&#34;ä»£ç æ ¼å¼&#34;&gt;ä»£ç æ ¼å¼&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/database/lab0/a5b6ffbb789341039148665bab688328.png&#34;
	width=&#34;1043&#34;
	height=&#34;676&#34;
	srcset=&#34;https://antio2.cn/tech/database/lab0/a5b6ffbb789341039148665bab688328_hu6f04b0a3998a6c0049e56046a634fab5_112336_480x0_resize_box_3.png 480w, https://antio2.cn/tech/database/lab0/a5b6ffbb789341039148665bab688328_hu6f04b0a3998a6c0049e56046a634fab5_112336_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;154&#34;
		data-flex-basis=&#34;370px&#34;
	
&gt;
æœ¬åœ°æµ‹è¯•é€šè¿‡ä¹‹åç›´æ¥å»ç½‘ä¸Šæäº¤ä¹‹å‰ï¼Œè®°å¾—æ ¼å¼åŒ–è‡ªå·±çš„ä»£ç ã€‚
&lt;img src=&#34;https://antio2.cn/tech/database/lab0/0f3c88f2e72b4641abf300a22598d4fa.png&#34;
	width=&#34;1451&#34;
	height=&#34;432&#34;
	srcset=&#34;https://antio2.cn/tech/database/lab0/0f3c88f2e72b4641abf300a22598d4fa_hu8e2a3624307439c71e9eb94e8a9f2300_105939_480x0_resize_box_3.png 480w, https://antio2.cn/tech/database/lab0/0f3c88f2e72b4641abf300a22598d4fa_hu8e2a3624307439c71e9eb94e8a9f2300_105939_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;335&#34;
		data-flex-basis=&#34;806px&#34;
	
&gt;
æ€»ä¹‹è®°å¾—é€šè¿‡è¿™ä¸ªæ£€æŸ¥è‡ªå·±çš„ä»£ç æ ¼å¼æ˜¯å¦æ­£ç¡®ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/database/lab0/b73a048cb1c646a9b80c9c4539a300ab.png&#34;
	width=&#34;1920&#34;
	height=&#34;1021&#34;
	srcset=&#34;https://antio2.cn/tech/database/lab0/b73a048cb1c646a9b80c9c4539a300ab_hu838933ee43be2a6a7dff2415fea42a02_337291_480x0_resize_box_3.png 480w, https://antio2.cn/tech/database/lab0/b73a048cb1c646a9b80c9c4539a300ab_hu838933ee43be2a6a7dff2415fea42a02_337291_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;188&#34;
		data-flex-basis=&#34;451px&#34;
	
&gt;
ç„¶åç»å†è¿‡æ— æ•°æ¬¡debugåå‘ç°è‡ªå·±æœ‰ä¸ªåˆå€¼æ²¡èµ‹ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶åè¿™ä¸ªOJæœ‰ä¸ªæ¯”è¾ƒå¥½çš„åœ°æ–¹å°±æ˜¯ä½ å¯ä»¥é€šè¿‡coutæ‰“å°å‡ºä½ æƒ³è¦çš„ä¿¡æ¯
&lt;img src=&#34;https://antio2.cn/tech/database/lab0/eebfb585d31649e19150b316b5a728eb.png&#34;
	width=&#34;1920&#34;
	height=&#34;1021&#34;
	srcset=&#34;https://antio2.cn/tech/database/lab0/eebfb585d31649e19150b316b5a728eb_hu831c2f68806b813e6816c32a798b745a_224526_480x0_resize_box_3.png 480w, https://antio2.cn/tech/database/lab0/eebfb585d31649e19150b316b5a728eb_hu831c2f68806b813e6816c32a798b745a_224526_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;188&#34;
		data-flex-basis=&#34;451px&#34;
	
&gt;&lt;/p&gt;
&lt;h2 id=&#34;æ³¨æ„äº‹é¡¹&#34;&gt;æ³¨æ„äº‹é¡¹&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;é‡åˆ°é—®é¢˜å°è¯•åœ¨ä¸åŒçš„åœ°æ–¹è¾“å‡ºæµ‹è¯•ä¿¡æ¯ï¼Œç„¶åé¡ºç€ç¨‹åºæ§åˆ¶æµçœ‹ï¼Œå¦‚æœå¤šæ¬¡æ‰¾ä¸åˆ°é”™è¯¯ä¸€å®šè¦ä»”ç»†ï¼Œæƒ³æƒ³è‡ªå·±æ˜¯ä¸æ˜¯å“ªé‡Œçœ‹æ¼äº†&lt;/li&gt;
&lt;/ul&gt;
</description>
        </item>
        <item>
        <title>å½’æ¡£</title>
        <link>https://antio2.cn/page/archives/</link>
        <pubDate>Sun, 06 Mar 2022 00:00:00 +0000</pubDate>
        
        <guid>https://antio2.cn/page/archives/</guid>
        <description></description>
        </item>
        <item>
        <title>å­¦ä¹ Mysql å¸¸ç”¨æŒ‡ä»¤</title>
        <link>https://antio2.cn/tech/mysql_basic/</link>
        <pubDate>Sun, 21 Nov 2021 20:58:49 +0800</pubDate>
        
        <guid>https://antio2.cn/tech/mysql_basic/</guid>
        <description>&lt;h2 id=&#34;sqlæ•°æ®ç±»å‹&#34;&gt;Sqlæ•°æ®ç±»å‹&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;th&gt;æ•°æ®ç±»å‹&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;æ•´å½¢&lt;/td&gt;
&lt;td&gt;bit,int&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å°æ•°&lt;/td&gt;
&lt;td&gt;decimal&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å­—ç¬¦ä¸²&lt;/td&gt;
&lt;td&gt;varchar,char&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ—¶é—´&lt;/td&gt;
&lt;td&gt;date,time,datetime&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æšä¸¾&lt;/td&gt;
&lt;td&gt;enum&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;mysqlå­—æ®µçº¦æŸ&#34;&gt;Mysqlå­—æ®µçº¦æŸ&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;çº¦æŸå‚æ•°&lt;/th&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;primary_key&lt;/td&gt;
&lt;td&gt;ä¸»é”®çº¦æŸ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;not null&lt;/td&gt;
&lt;td&gt;éç©ºçº¦æŸ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;unique&lt;/td&gt;
&lt;td&gt;å”¯ä¸€çº¦æŸ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;default&lt;/td&gt;
&lt;td&gt;é»˜è®¤çº¦æŸ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;AUTO_INCREMENT&lt;/td&gt;
&lt;td&gt;è‡ªå¢&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;mysqlæ•°æ®åº“æœåŠ¡ç«¯å¯åŠ¨&#34;&gt;Mysqlæ•°æ®åº“æœåŠ¡ç«¯å¯åŠ¨&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;sudo service mysql []&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;æŸ¥çœ‹çŠ¶æ€&lt;/td&gt;
&lt;td&gt;status&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å¯åŠ¨&lt;/td&gt;
&lt;td&gt;start&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;åœæ­¢&lt;/td&gt;
&lt;td&gt;stop&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;é‡å¯&lt;/td&gt;
&lt;td&gt;restart&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;é…ç½®æ–‡ä»¶åœ°å€&#34;&gt;é…ç½®æ–‡ä»¶åœ°å€&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;/etc/mysql/mysql.conf.d&lt;/code&gt;&lt;/p&gt;
&lt;h1 id=&#34;mysqlç»ˆç«¯æŒ‡ä»¤æ“ä½œ&#34;&gt;Mysqlç»ˆç«¯æŒ‡ä»¤æ“ä½œ&lt;/h1&gt;
&lt;h2 id=&#34;ç™»å½•å®¢æˆ·ç«¯æ“ä½œ&#34;&gt;ç™»å½•å®¢æˆ·ç«¯æ“ä½œ&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;è¿æ¥æŒ‡ä»¤&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;code&gt;mysql -uç”¨æˆ·  -på¯†ç &lt;/code&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ˜¾ç¤ºæ—¶é—´&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;code&gt;select now();&lt;/code&gt;&lt;/p&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;é€€å‡ºè¿æ¥&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;code&gt;quit/ exit/ ctrl + d&lt;/code&gt;&lt;/p&gt;
&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;åˆ›å»ºç”¨æˆ·&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;code&gt;CREATE USER anti@localhost IDENTIFIED BY &#39;123456&#39;;&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&#34;æ•°æ®åº“æ“ä½œ&#34;&gt;æ•°æ®åº“æ“ä½œ&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;th&gt;æŒ‡ä»¤&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;æŸ¥çœ‹æ‰€æœ‰æ•°æ®åº“&lt;/td&gt;
&lt;td&gt;show databases&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æŸ¥çœ‹å½“å‰æ‰€ç”¨çš„æ•°æ®åº“&lt;/td&gt;
&lt;td&gt;select database()&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;åˆ‡æ¢åˆ°æŒ‡å®šæ•°æ®åº“&lt;/td&gt;
&lt;td&gt;use [æ•°æ®åº“å]&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;åˆ›å»ºæ•°æ®åº“&lt;/td&gt;
&lt;td&gt;create database æ•°æ®åº“å charset=utf8&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;åˆ é™¤æ•°æ®åº“&lt;/td&gt;
&lt;td&gt;drop database[æ•°æ®åº“å]&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;è¡¨æ“ä½œ&#34;&gt;è¡¨æ“ä½œ&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;th&gt;æŒ‡ä»¤&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;æŸ¥çœ‹æ‰€æœ‰è¡¨&lt;/td&gt;
&lt;td&gt;show tables&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;åˆ›å»ºè¡¨&lt;/td&gt;
&lt;td&gt;create table è¡¨åï¼ˆå­—æ®µåç§° æ•°æ®ç±»å‹ å¯é€‰çº¦æŸ ä¸»é”®[ä¸ä¸ºç©º] è‡ªå¢ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ”¹å˜è¡¨çš„å­—æ®µç±»å‹&lt;/td&gt;
&lt;td&gt;alter table [è¡¨å] modify [field]&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;åˆ é™¤è¡¨&lt;/td&gt;
&lt;td&gt;drop table [è¡¨å]&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;mysql-crudæ“ä½œ&#34;&gt;Mysql-CRUDæ“ä½œ&lt;/h2&gt;
&lt;h3 id=&#34;æŸ¥è¯¢æ•°æ®&#34;&gt;æŸ¥è¯¢æ•°æ®&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;th&gt;æŒ‡ä»¤&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;æŸ¥è¯¢æ‰€æœ‰åˆ—&lt;/td&gt;
&lt;td&gt;select * from è¡¨å&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æŒ‡å®šåˆ—æŸ¥è¯¢&lt;/td&gt;
&lt;td&gt;select åˆ—å(,åˆ—å) from è¡¨å&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;æ’å…¥æ•°æ®&#34;&gt;æ’å…¥æ•°æ®&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;th&gt;å¤‡æ³¨&lt;/th&gt;
&lt;th&gt;æŒ‡ä»¤&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;å…¨åˆ—æ’å…¥&lt;/td&gt;
&lt;td&gt;å€¼çš„æ’å…¥é¡ºåºå’Œåˆ—çš„é¡ºåºä¸€è‡´&lt;/td&gt;
&lt;td&gt;insert into è¡¨å values(&amp;hellip;);&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;éƒ¨åˆ†åˆ—æ’å…¥&lt;/td&gt;
&lt;td&gt;å€¼çš„é¡ºåºå’Œç»™å‡ºåˆ—çš„é¡ºåºå¯¹åº”&lt;/td&gt;
&lt;td&gt;insert into è¡¨åï¼ˆåˆ—1&amp;hellip;ï¼‰ values(å€¼&amp;hellip;);&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å…¨åˆ—å¤šè¡Œæ’å…¥&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;insert into è¡¨å values(&amp;hellip;),(&amp;hellip;),(&amp;hellip;);&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;éƒ¨åˆ†åˆ—å¤šè¡Œæ’å…¥&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&amp;hellip;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;ä¿®æ”¹æ•°æ®&#34;&gt;ä¿®æ”¹æ•°æ®&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;update&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;è¡¨å&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;set&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;åˆ—&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;å€¼&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;ï¼Œåˆ—&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;å€¼&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;... &lt;span style=&#34;color:#66d9ef&#34;&gt;where&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;æ¡ä»¶&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;ä¾‹å¦‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;update&lt;/span&gt; students &lt;span style=&#34;color:#66d9ef&#34;&gt;set&lt;/span&gt; age &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;18&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;ï¼Œ&lt;/span&gt;gender &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;å¥³&amp;#39;&lt;/span&gt;... &lt;span style=&#34;color:#66d9ef&#34;&gt;where&lt;/span&gt; id &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;6&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;åˆ é™¤æ•°æ®&#34;&gt;åˆ é™¤æ•°æ®&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;delete&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;from&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;è¡¨å&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;where&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;ä¸»é”®ï¼ˆä¾‹å¦‚&lt;/span&gt; id &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;66&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;ï¼‰&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;æ•°æ®åº“å¤‡ä»½å¯¼å‡º&#34;&gt;æ•°æ®åº“å¤‡ä»½å¯¼å‡º&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;mysqldump -uç”¨æˆ·å -p æ•°æ®åº“åå­— è¡¨åå­— &amp;gt; data.sql&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&#34;æ¢å¤å¯¼å…¥&#34;&gt;æ¢å¤å¯¼å…¥&lt;/h2&gt;
&lt;p&gt;åœ¨&lt;code&gt;use æ•°æ®åº“å&lt;/code&gt; &lt;code&gt;source data.sql&lt;/code&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>å¾®å…‰å°ä»»åŠ¡|Simple_linux</title>
        <link>https://antio2.cn/tech/simple_linux/</link>
        <pubDate>Wed, 03 Nov 2021 21:06:28 +0800</pubDate>
        
        <guid>https://antio2.cn/tech/simple_linux/</guid>
        <description>&lt;h2 id=&#34;step1&#34;&gt;Step1&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨vscode+SSH remoteè¿æ¥äº‘æœåŠ¡å™¨&lt;/p&gt;
&lt;h2 id=&#34;step2&#34;&gt;Step2&lt;/h2&gt;
&lt;p&gt;&amp;hellip;&lt;/p&gt;
&lt;h2 id=&#34;step3&#34;&gt;Step3&lt;/h2&gt;
&lt;p&gt;ç”¨è„šæœ¬&lt;code&gt;ps -u root &amp;gt;&amp;gt; /home/anti/glimmer/auto_record&lt;/code&gt;é‡å®šå‘è¾“å‡ºåˆ°æŒ‡å®šæ–‡ä»¶&lt;/p&gt;
&lt;p&gt;é€šè¿‡&lt;code&gt;crontab&lt;/code&gt;é…ç½®  &lt;code&gt;0 */1 * * * /home/anti/bin/auto_record.sh&lt;/code&gt;å®ç°ä¸€ä¸ªå°æ—¶è®°å½•ä¸€æ¬¡&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/simple_linux/1102.png&#34;
	width=&#34;1920&#34;
	height=&#34;1030&#34;
	srcset=&#34;https://antio2.cn/tech/simple_linux/1102_hufc14dd3a660ee1ee6c2be46049ab8467_121002_480x0_resize_box_3.png 480w, https://antio2.cn/tech/simple_linux/1102_hufc14dd3a660ee1ee6c2be46049ab8467_121002_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;186&#34;
		data-flex-basis=&#34;447px&#34;
	
&gt;
æŒ‚äº†ä¸€ä¸ªä¸‹åˆä¹‹å
&lt;img src=&#34;https://antio2.cn/tech/simple_linux/110202.png&#34;
	width=&#34;1920&#34;
	height=&#34;1030&#34;
	srcset=&#34;https://antio2.cn/tech/simple_linux/110202_hu85d380c288f06a7fda27babfc7d56cc3_231553_480x0_resize_box_3.png 480w, https://antio2.cn/tech/simple_linux/110202_hu85d380c288f06a7fda27babfc7d56cc3_231553_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;186&#34;
		data-flex-basis=&#34;447px&#34;
	
&gt;&lt;/p&gt;
&lt;h2 id=&#34;step4&#34;&gt;Step4&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;å®‰è£…Nginx&lt;/li&gt;
&lt;li&gt;é…ç½®æ–‡ä»¶&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;server {
    listen 10086;
    server_name  101.34.233.95;
    location /{
        root /www/html;
        index glimmer.html;   
    }
    
}
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;è®¿é—®æŒ‡å®šç«¯å£&lt;code&gt;10086&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://antio2.cn/tech/simple_linux/110203.png&#34;
	width=&#34;1248&#34;
	height=&#34;249&#34;
	srcset=&#34;https://antio2.cn/tech/simple_linux/110203_hu4fd71cfde466c19204473d784bc6a27d_15948_480x0_resize_box_3.png 480w, https://antio2.cn/tech/simple_linux/110203_hu4fd71cfde466c19204473d784bc6a27d_15948_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;501&#34;
		data-flex-basis=&#34;1202px&#34;
	
&gt;&lt;br&gt;
ï¼ˆæ³¨æ„äº‘æœåŠ¡å™¨é˜²ç«å¢™è¦å…ˆå¼€æŒ‡å®šç«¯å£ï¼Œ= =è¿˜ä»¥ä¸ºé…ç½®é”™äº†ï¼‰&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å®‰è£…&lt;code&gt;docker&lt;/code&gt;ï¼Œ&lt;code&gt;pull&lt;/code&gt; &lt;code&gt;nginx&lt;/code&gt;å’Œ&lt;code&gt;nextcloud&lt;/code&gt;é•œåƒ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é…ç½®&lt;code&gt;nginx&lt;/code&gt;å¯¹åº”é…ç½®(æˆ‘è¿™é‡Œç”¨äº†10001)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;nextcloud&lt;/code&gt;å®‰è£…&lt;code&gt;registration&lt;/code&gt;åº”ç”¨ï¼Œé…ç½®é‚®ä»¶æœåŠ¡å™¨ã€‚å®ç°æ³¨å†Œã€&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
</description>
        </item>
        <item>
        <title>A&#43;B Problem</title>
        <link>https://antio2.cn/tech/aplusb/</link>
        <pubDate>Wed, 08 Mar 2017 00:00:00 +0000</pubDate>
        
        <guid>https://antio2.cn/tech/aplusb/</guid>
        <description>&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-CPP&#34; data-lang=&#34;CPP&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#include&amp;lt;bits/stdc++.h&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;using&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;namespace&lt;/span&gt; std;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; a,b,ans;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cin&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt;a&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt;b;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(a&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;b)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ans&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;a&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;b&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(a&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;b)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ans&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;a&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;a&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;a&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;b&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;b&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;b;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ans&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;ans&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt;(a&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&lt;/span&gt;b)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ans&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;a&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;b&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;b&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;a;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ans&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;ans&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cout&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt;ans;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
        </item>
        <item>
        <title>Search</title>
        <link>https://antio2.cn/page/search/</link>
        <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
        
        <guid>https://antio2.cn/page/search/</guid>
        <description></description>
        </item>
        <item>
        <title>å…³äº</title>
        <link>https://antio2.cn/about/</link>
        <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
        
        <guid>https://antio2.cn/about/</guid>
        <description>&lt;p&gt;ä½ å¥½ï¼Œæˆ‘å…¨ç½‘é€šç”¨idå« &lt;code&gt;AntiO2&lt;/code&gt; ã€‚ç›®å‰æ˜¯&lt;a class=&#34;link&#34; href=&#34;https://www.uestc.edu.cn/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ç”µå­ç§‘æŠ€å¤§å­¦&lt;/a&gt;åœ¨è¯»è½¯ä»¶å·¥ç¨‹å¤§ä¸‰å­¦ç”Ÿã€‚&lt;/p&gt;
&lt;h2 id=&#34;social&#34;&gt;Social&lt;/h2&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://antio2.cn&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;&lt;img src=&#34;https://img.shields.io/badge/Blog-AntiO2-1ABC9C?style=flat-square&amp;amp;logo=databricks&amp;amp;cacheSeconds=3600&amp;amp;link=https%3A%2F%2Fantio2.cn%2F&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;Blog&#34;
	
	
&gt;&lt;/a&gt;&lt;a class=&#34;link&#34; href=&#34;https://wakatime.com/@f65e5155-c188-4658-ad5e-796c158f07a9&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;&lt;img src=&#34;https://wakatime.com/badge/user/f65e5155-c188-4658-ad5e-796c158f07a9.svg&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;wakatime&#34;
	
	
&gt;&lt;/a&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/AntiO2&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;&lt;img src=&#34;https://img.shields.io/badge/GitHub-AntiO2-100000?style=flat&amp;amp;logo=github&amp;amp;logoColor=white&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;/a&gt;&lt;img src=&#34;https://img.shields.io/badge/Bilibili-FFFFFF?logo=bilibili&amp;amp;logoColor=%2300A1D6&amp;amp;cacheSeconds=3600&amp;amp;link=https%3A%2F%2Fspace.bilibili.com%2F52596817&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;Static Badge&#34;
	
	
&gt;&lt;/p&gt;
&lt;h3 id=&#34;æ—¥å¸¸&#34;&gt;æ—¥å¸¸&lt;/h3&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://steamcommunity.com/id/AntiO2/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;&lt;img src=&#34;https://img.shields.io/badge/Steam-000000?style=for-the-badge&amp;amp;logo=steam&amp;amp;logoColor=white&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;Steam&#34;
	
	
&gt;&lt;/a&gt;&lt;a class=&#34;link&#34; href=&#34;https://leetcode.cn/u/antio2/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;&lt;img src=&#34;https://img.shields.io/badge/-LeetCode-FFA116?style=for-the-badge&amp;amp;logo=LeetCode&amp;amp;logoColor=black&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;/a&gt;&lt;img src=&#34;https://img.shields.io/badge/Ubisoft-f6f6f3?style=for-the-badge&amp;amp;logo=ubisoft&amp;amp;logoColor=%23000000&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;Static Badge&#34;
	
	
&gt;&lt;img src=&#34;https://img.shields.io/badge/KFC-F40027?style=for-the-badge&amp;amp;logo=kfc&amp;amp;logoColor=white&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;KFC&#34;
	
	
&gt;&lt;img src=&#34;https://img.shields.io/badge/Mcdonalds-red?style=for-the-badge&amp;amp;logo=mcdonalds&amp;amp;logoColor=%23FBC817&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;Static Badge&#34;
	
	
&gt;&lt;img src=&#34;https://img.shields.io/badge/Adobe%20Premiere%20Pro-%239999FF?style=for-the-badge&amp;amp;logo=adobepremierepro&amp;amp;logoColor=%23FFFFFF&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;Static Badge&#34;
	
	
&gt;&lt;img src=&#34;https://img.shields.io/badge/cocacola-%23D00013?style=for-the-badge&amp;amp;logo=cocacola&amp;amp;logoColor=FFFFFF&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;Static Badge&#34;
	
	
&gt;
&lt;img src=&#34;https://img.shields.io/badge/Counter_Strike-%23000000?style=for-the-badge&amp;amp;logo=counterstrike&amp;amp;logoColor=%23FFFFFF&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;Static Badge&#34;
	
	
&gt;&lt;a class=&#34;link&#34; href=&#34;https://stratz.com/players/350562148&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;&lt;img src=&#34;https://img.shields.io/badge/DOTA2-%E5%A4%A9%E9%81%93%E9%85%AC%E5%8B%A4-FFFFFF?style=for-the-badge&amp;amp;logo=data%3Aimage%2Fpng%3Bbase64%2CiVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAACXBIWXMAAAsTAAALEwEAmpwYAAARGUlEQVR4nO1dZ3RT15bWmzftx8yPqQuSzJr25s0kAVu9WAUMDhgDbrIxBl7oDgYDDwI4odeY3kIHg%2B%2BlBQjwUukPQgohsQkQCBMH%2B8rAS4ZiYZKQOL6Kv1n7WJIlq13JRpaJvrX2suTbzjnfPfvss%2Fc%2BRzJZHHHEEUccccQRRxxxxBFHHHHEEUcccTwa1B594l8enOz8%2BoMTnb8lqTvR6fCDU0%2F89yN6XBwtUXei04d1Jzu930xGp9oHJzvDS050stMx2eMKXNn%2Flw22HUaHjRst2vjlDoF72yFwl0WBqxIFzi7auJ%2BY0GeBq6JjDoF%2FSxS4ZXRNg41Ponu0RVmIjLoTnc7SZ9YzWpLhJqXzftnjBAjc0w6Be8lh44%2BJAv%2FQYePRGhEF7nuHjT%2FqqOGLIez4n7YoI1NTgQg52fmBrKMDf9r9jw4bN94hcJ%2B0lgAJct5h44twi%2FuHR0RInayjAsKOTqLALW6LnhB2z7Hx9aLAbcZX28PW%2BWwAD0zIPllHA67z%2FywK%2FBbS%2F9EmwuFDDI1D%2FCZUlv6T1PKTNUUDeEsy6k52unfv9JNPyToKgDl%2F5qjhnxcF7m57E%2BHw7TH3HTU7JwL7fy2lLszSOtF5P40ZTtnXsci4wf%2FGqb%2B9G%2BPGvnYnw1u4c6jZ%2FR%2ByxxmiUJbF3kCPiv%2F89VuA%2BC0YxG%2FZ9%2FYnw63GHjiquTzZ4wbq%2FqLAr%2FVX6cb6u%2FBEY%2F1dxKAaW0VqVtaRYTfn9rWbrbfsFuuth%2FyCs4Eqi58bvAjBzw3tTkAAFXYYwo6%2FDqvu5pybtRZrH1ksgApjt%2BSApC5zSMCKNj6s8e4hD20x0PgBROBO4tq2vw2n7naL9YYsFkA9QwohNJg3fleJxob77K%2Fjxmvt3%2FDB5Y%2BoXPNXHYoQ0rc%2F8gvP1mX%2BjpFR%2F9by9m5EtK1wh4OZxaSmmkix3qjtlpsqa28EGsDbQipPLcOiQiuK81MDyuxh%2FXH41Qnua%2FavHIfpQ9ICnr94XA5qPlyNuxc34sevdkgqh2jjVso6Ahw1fG6gStgvbcJ7u6fjzM7Q8sFrs3Dv0iav67%2F%2BdB1yNHKMkisxW6kLKNOVOqR2eQan%2BZfx8etz0fvZpzFDoQ14%2FjCFAlZNIruG5HmLDi8PTsO2uSNwu2J9YFIELlsWy0BN2X%2BKNq7OX%2BHpDRygU7LGkSpWdSJ2LBiFU1wxI6koPRmD5Ym4ac5y6ufAUqRUY1p%2BKhaNycYgeWLQcytNGRieqMA2TTe8ru2JV1VmzFTqMFCeiFydEtfP%2BFe5NKeK2ckjc4f4m4E7Zf3LQ1jDUOWpQUNJlSkDq1Um5CR2dRNEZFxI6heSDJI%2F6lORm5iAjIQuOKDt4f6%2FYMrENVM6k2pTZtB7UDmGyeWYNzozmPr6KCbnKA6BGxtM584ZmY6XFFpJjWlvIV%2Bbs1nj3LNYw7qu1mLFXY%2Fve7XJ2KftgSO6XjisS8EubTJ4bXeva%2BhFcH2uMWXh%2BcREzC%2FICjXIj5bFnteWswcr9OwR6ZgeISH2NpIvjOk%2B%2F3tb9xw%2BTkpjhFOPnKfUu48tVxmZmq0%2BuzL4AC%2FwteF4iR85yIUeyiqJBULsfntRDrZrumOL2oKb5mxwmu74P2dPLFZqMXtEf4lWF79eFgvAzZ1PSYlnhCKk0piBTwx9mZp5VI3%2FjTk75DlH9b3wmbE%2F%2B7xZbWFWnVjN%2Ba1TY%2F0dNNbfdhFSjxtlT3aYOUcgQj5N6osXdBoM0itRmGLEGJ0Gl4zSBm6pQuPCQoMRmYoEDFYrsEffE7cDkPOlMR0HdT3Z57OGPsyY%2BOq0fyuLyHAREhNzE4qBSw27BiJkkkGPI1unkE0POu%2Fo1qkYoJZjt74nUyetIeKOxYpdumTkqBJROms4Hn65nU0sZw9JQ76qiRh%2FhsImtYX9vW3JRr%2Buz%2BLgmvHS1JbAfd%2BaGH2rwRISJBQ0GCHzDSaUzh7ude7Nj9dgYr9kTNMZmJkaCRlk1o7WqvHSgFQ2B2pZHiJmWm4vrE7q5nPtFk3z%2FyYo1MwzILWeZG22HyFhZIcEIqTGlIkRGjUOrBzndf5PVWXYu3gM8tUKHNf3DpuQuQYjXltWGLRMtg9XYZRe43MtTRBd5jKVmcoumRAbd6798qYkFzL4oH7dlIEhGiWObJnic90Xx5dgmEWLhVqjpEHZJasMFpQUZOO7a9sClunq0RLMNBl9rt2p6c7mPpERwgPVO6OfSuoQ%2BJfbihCSq8Z01hvOHZjtcy016qoJeawnlRv7SiKE9P9inQmDdEq8v2dGIPWC%2B70H%2Bly7q5WEOGzc1HYghDveGkI8Z8QuKU%2FqhwEqOS69vcjvPd7bNR15GgW26rtLnrV%2FaEjDSLUKswanMeek5%2F3e31LsUw7qrWtUJvf3yAjh340qGZQn60zNlFzIZRPzUKBQuitKkzF6i1s24FlDH2Zl0aDr7z7flK%2FHlKwUjNdo8b%2BmdMnWVqm%2BO3LUchxYWcTGJ7rX%2BFQLziel%2BQzot81WtwmcJ09gfrhw6sqsrTbKJZYESl4O843BJ4fnMZuenH4uK4j8Sv4a8JihNwbqlGzQDVBhHFxVhFylHG%2Fqe0keV0gtvqjXobC3GftWjEOeMtHnpXCZvCQvKJQYmqzH3c82httD0CDs1EeNEEcNXxBuAdkbmZHM4g%2BuCm%2FwqHxLOWxIwVCLFncubAh4v6ozy1HQ04g5OgNze0glhmbjq3UWn%2FHok6S%2BOOa06MiAyEroil2LXwi7nk4ZGTVCRBu%2FIuw3proMw3saUKIyuBtgh4d68Cdl%2BmQUpBhx%2F%2FMtAe%2F7Q2Up1r04CEPUSpwzeKufcKVU042pN%2Fq8Rm1GpjIBX55cGhEhosAvjRohbH1GmAU8VjoVqV2e9norD%2BlS8JWfwd3uIesMFkzo1z2o%2BcpU4qG5zKLaoGtu1HCFHIyuzxOUGiwZnxtp7yAL7o1oEnI53ALOHZWBiQq1VwOwgT2Eqqm15GCxwYziAb1Dxrsp5Dsjvw%2FGaTV%2BXe2hhGIjt5zRSBrc0%2BVdWZw9MlK4i1EjRLRxtnALuGBMFgYnJnqZmeRNldJQ9yxWzDEY8crorICe12ZVweGt9b9HnkqOAzr%2FRkMgIavqNaehccOchf5dn8WbGydFqLK46ugRIvC14RbwxkdrMMikxjilyt0AWz18RqHkjsWKqXoD1kzOl%2FQ8CioV9jKxAZ8aV%2BpzyOx2fSaTd2dJZIM6ZfZHj5AI13NsmTWMVTISQuyWHPzJnIVCrRbcgtGSnvdD5XZsnT4UQ9QKfODR0FKlVYTY%2BPqYJqTijQVI6%2FoMSlRJYasse0tnpFaNAyvGSn52%2BeH5GKRXYZXWHNaA33EIiUBlkQu7UK5yuzwuG%2FtjvzMQFK5UGjPYW3%2Fp7YWSn197eRNmDUnDWK0WV039JRMS6Twk2ior7EG9pS%2FrmL5X2Fkkdg8RaFxYNDXshqIBP5cGfH1K0Pu%2Fo3%2BOmelnds2I%2FUE9ErP3USU5PFzv6x0OJeSSGZdqQbFW7zcARp7eNGcuWF6SKmAIN2bM3kgmhqEIoVn2GL0WswzGprdfKindcrFiUHrA7MJAQg5Gbt4oDFTJccrgGwAjN8oZQypGyBVYOmFAbE8M2W4KYRaQks0mK3yjcySkusj18f7emdg2ezjGajXueIQUOWLojXy92se9LkWuHC3BUJMWy3Rmd%2FqPp0TofieVtSRqhFCmXrgFPL59GlMB%2Fjy85Oyb1C%2FZfe7ayfl4UasLyyI6bkqFbefcCFQLj7orW7BgeAbG%2B3lmpIQ4BG5ETLvfSZZNGIChCoVPY07W63GKf8lLncwalIYyU3hWGEX%2FDs0bzRo4kvJNyUzBe4bUNiEkqu73SAJUJGTTe04MSSgHK1%2BnQr0zaORwCn2vO7Ic95%2FLC4uU9Und8fv0HizlJ5yykZ%2BMopHXWvjAIiFEFLjvUL75L2TRBG0K0xaELNWbseuVgoDXfHtoMc6bpCfOuZ2ReaGdkZ5ytHQqig3NoYFW9pB3okoGI6Rpp55WEUI%2BpmxFgs%2FCHIeH0DGKHp7wYwkFdUYmGfFKQWhnpEuKUi3uaGYbEDIl6oSgivttuIRsmjkUgxVyd2VP61MxK69PyOuuHV%2FCJnNkikolhdz6k%2FQGHFgW2sXy%2BZFXMFSj9JtX3GHSgAjBFui0lIo%2FzGe%2BrA2aZv8VBafyNYrAaTq2ZqH0IJozhDNHoXj51wUFcFz3Hp9aysKRGdgdwFUfASEftQsZTkKKws06aekuodSf59UqrJsyGPXXg%2Bv8pYU5bMlZOIM8yXfTJsJR7f%2BeFLO3KhPdgalWEyLwhe1GCCUWS022DraCihIUZumSUNTHglvn17LzKY5OWYsny4rBLRyFklGZGKBKxOfOpQLhyvfzpvhdwLl9zgis0Af2OnsRcn0dxM8nwXFlGhzCNv%2FpPze2%2Fr2sPSEK3Jq28mXtMfRkmeo5Kjmy5Ako1Gsxz2DEJm03tgQt1JrAYGIzZzKVV5hiwlinjOmZxJYn%2BEva8yFEKIN4YSjEivwmIWJaEmLjl8selwU7LvnGnM0aL9KGDybkjqlI6scSLUhoAWkob0AzIaXNZJBc9DbV2YKdmj1PyGIBtBNbWxFijzHxUllXpzWRcWEwHF%2BWtFRXr8piBU1jSfDd4R4LQmw8HFUb4Kj2ds2IAn%2BPFi%2FJYgkOgRsTjJDFRTkYq1AGTYyztxCyfE4aenvFLGiuQPFxSkWNpIHvOhOw%2Fa13p%2FAwrUXxHFMkWVnRdCSGt3EAdy5QoS%2B8uQDp8i5sIT%2Blkx7S9WSJztQwroX811xiTGdJdFbnpgGZCV2xR9ODzaTHKFXsf7QFxlJ1kk9u7l1niNfnnqZ0FnMpVLiufxrr1ObmY0lpsCY0Pa9v12exQKln8RDK76WXKYiZ%2BwGAX8liEaje9a%2FB4u20VI3cJ%2BP6dWcNGmxbjdQuz2DRC9lsOdrKSfnu84v6J%2BPyO6%2BwfCkieL7K4F6L%2BIYuBXmJCUHvW5BqZgt1DqwuYhPVlseojPtWjmNpr%2FQ%2FSpa7GGB5BNtaw8b%2FuyyWIdrKcqSYweSNrTqzAtdOLGFZIZ5S8Yf5PsEm8mm1zIanOQoRRb2OhBqwZGwOzh%2Bc63NPEsrTpRxj1%2FU0L3Edu3pssdfElBLuqHyUHOGXDIFrpD0kZR0BtEehFFLaQq4cLWHbL5FQA0brubSvvKyjgMYTUeD2RatxHFEW0cbtjckNZ0IFsdjm9zHQgI4ob%2FEXs6ANI2njyBhoRLSJCPwJ3N7%2FN7KODBbutXF726ZByvDT1WKI1Zvbg5CDUreJ7Rhjio1bGarSYtVGOK6vZX4jf8eJDNrs%2FofyCPKkIpQma4pb1uHGDCkQq7kMf%2FtqiVUbIF4a4%2BG8GwzHFzPZOnKv86o3MzIaKpdGb6vxGj5X9jiDJlIUVXNXvLoU4mfDvD2pFU65FlmeVZsIzcCFHf8m%2ByWAXA3s5yps%2FB3HFzP8k1Hh9KoK4aXztIGKsjf9XMVjqKI8ca9b1lP3Ldbsez1yn%2FTa3uliQU1AQirym8aUqKgn%2Fkdyobd7xC8auGPK%2B63dYn3Q5AC0Pqjrlvsb17GG8oF7gxEiVm981D3ie4p6xsRucNFCrSV3sqdHlr67jokV%2BdaAZFwKvr1SK%2BUj2tvqF9EjWsJuzrbUWnIam8jIabR3yzW5jgGyX4kVA9e3JKOhPP%2B2WLmMfofwCKVmtkFPoHu8S0lsuL77v2S%2FdNhN1n61Zuta%2Bm0Nf8fFT%2FPTGsrz9zSU578rVgxchMuD%2Fs51jPJkGwTO4LDtHEU7JNDaC1oQ0%2FTDknxt8w9L8rXshyVt3EU6h51r40dS4jNw%2Bs%2BjWuE44ogjjjjiiCOOOOKII4444ogjjjjiiCMOWRTx%2F%2F2B0VE%2BbfLaAAAAAElFTkSuQmCC&amp;amp;labelColor=FFFFFF&amp;amp;color=red&amp;amp;link=https%3A%2F%2Fstratz.com%2Fplayers%2F350562148&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;Static Badge&#34;
	
	
&gt;&lt;/a&gt;&lt;img src=&#34;https://img.shields.io/badge/League_of_Legends-%23C28F2C?style=for-the-badge&amp;amp;logo=leagueoflegends&amp;amp;logoColor=FFFFFF&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;Static Badge&#34;
	
	
&gt;&lt;img src=&#34;https://img.shields.io/badge/Valorant-%23FA4454?style=for-the-badge&amp;amp;logo=valorant&amp;amp;logoColor=FFFFFF&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;Static Badge&#34;
	
	
&gt;&lt;/p&gt;
&lt;h3 id=&#34;æˆ‘çš„æŠ€èƒ½&#34;&gt;æˆ‘çš„æŠ€èƒ½&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;https://img.shields.io/badge/C%2B%2B-00599C?style=for-the-badge&amp;amp;logo=c%2B%2B&amp;amp;logoColor=white&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;C&amp;#43;&amp;#43;&#34;
	
	
&gt;&lt;img src=&#34;https://img.shields.io/badge/Java-ED8B00?style=for-the-badge&amp;amp;logo=openjdk&amp;amp;logoColor=white&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;img src=&#34;https://img.shields.io/badge/Go-00ADD8?style=for-the-badge&amp;amp;logo=go&amp;amp;logoColor=white&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;Go&#34;
	
	
&gt;&lt;img src=&#34;https://img.shields.io/badge/C-00599C?style=for-the-badge&amp;amp;logo=c&amp;amp;logoColor=white&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;C&#34;
	
	
&gt;&lt;img src=&#34;https://img.shields.io/badge/Vue.js-35495E?style=for-the-badge&amp;amp;logo=vue.js&amp;amp;logoColor=4FC08D&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;img src=&#34;https://img.shields.io/badge/Flask-000000?style=for-the-badge&amp;amp;logo=flask&amp;amp;logoColor=white&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;img src=&#34;https://img.shields.io/badge/Spring-6DB33F?style=for-the-badge&amp;amp;logo=spring&amp;amp;logoColor=white&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;img src=&#34;https://img.shields.io/badge/PostgreSQL-316192?style=for-the-badge&amp;amp;logo=postgresql&amp;amp;logoColor=white&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;img src=&#34;https://img.shields.io/badge/Python-3776AB?style=for-the-badge&amp;amp;logo=python&amp;amp;logoColor=white&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;Python&#34;
	
	
&gt;&lt;img src=&#34;https://img.shields.io/badge/MySQL-00000F?style=for-the-badge&amp;amp;logo=mysql&amp;amp;logoColor=white&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;img src=&#34;https://img.shields.io/badge/jQuery-0769AD?style=for-the-badge&amp;amp;logo=jquery&amp;amp;logoColor=white&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;img src=&#34;https://img.shields.io/badge/JavaScript-F7DF1E?style=for-the-badge&amp;amp;logo=javascript&amp;amp;logoColor=black&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;img src=&#34;https://img.shields.io/badge/CMake-%23064F8C?style=for-the-badge&amp;amp;logo=cmake&amp;amp;logoColor=%23FFFFFF&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;Static Badge&#34;
	
	
&gt;&lt;img src=&#34;https://img.shields.io/badge/Spring_Boot-%236DB33F?style=for-the-badge&amp;amp;logo=springboot&amp;amp;logoColor=%23FFFFFF&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;Static Badge&#34;
	
	
&gt;&lt;img src=&#34;https://img.shields.io/badge/elasticsearch-%23005571?style=for-the-badge&amp;amp;logo=elasticsearch&amp;amp;logoColor=%23FFFFFF&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;Static Badge&#34;
	
	
&gt;&lt;img src=&#34;https://img.shields.io/badge/redis-%23DD0031.svg?&amp;amp;style=for-the-badge&amp;amp;logo=redis&amp;amp;logoColor=white&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;img src=&#34;https://img.shields.io/badge/vuetify-%231867C0?style=for-the-badge&amp;amp;logo=vuetify&amp;amp;logoColor=FFFFFF&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;Static Badge&#34;
	
	
&gt;&lt;img src=&#34;https://img.shields.io/badge/axios-%235A29E4?style=for-the-badge&amp;amp;logo=axios&amp;amp;logoColor=FFFFFF&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;Static Badge&#34;
	
	
&gt;&lt;/p&gt;
&lt;h3 id=&#34;å·¥å…·&#34;&gt;å·¥å…·&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;https://img.shields.io/badge/CLion-000000?style=for-the-badge&amp;amp;logo=clion&amp;amp;logoColor=white&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;img src=&#34;https://img.shields.io/badge/Visual_Studio_Code-0078D4?style=for-the-badge&amp;amp;logo=visual%20studio%20code&amp;amp;logoColor=white&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;img src=&#34;https://img.shields.io/badge/IntelliJ_IDEA-000000.svg?style=for-the-badge&amp;amp;logo=intellij-idea&amp;amp;logoColor=white&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;img src=&#34;https://img.shields.io/badge/VIM-%2311AB00.svg?&amp;amp;style=for-the-badge&amp;amp;logo=vim&amp;amp;logoColor=white&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;img src=&#34;https://img.shields.io/badge/termius-%23000000?style=for-the-badge&amp;amp;logo=termius&amp;amp;logoColor=FFFFFF&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;Static Badge&#34;
	
	
&gt;
&lt;img src=&#34;https://img.shields.io/badge/GIT-E44C30?style=for-the-badge&amp;amp;logo=git&amp;amp;logoColor=white&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;img src=&#34;https://img.shields.io/badge/nginx-%23009639?style=for-the-badge&amp;amp;logo=nginx&amp;amp;logoColor=FFFFFF&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;Static Badge&#34;
	
	
&gt;&lt;img src=&#34;https://img.shields.io/badge/docker-%232496ED?style=for-the-badge&amp;amp;logo=docker&amp;amp;logoColor=FFFFFF&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;Static Badge&#34;
	
	
&gt;&lt;img src=&#34;https://img.shields.io/badge/postman-%23FF6C37?style=for-the-badge&amp;amp;logo=postman&amp;amp;logoColor=FFFFFF&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;Static Badge&#34;
	
	
&gt;&lt;img src=&#34;https://img.shields.io/badge/pnpm-%23F69220?style=for-the-badge&amp;amp;logo=pnpm&amp;amp;logoColor=FFFFFF&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;Static Badge&#34;
	
	
&gt;&lt;img src=&#34;https://img.shields.io/badge/poe-%235D5CDE?style=for-the-badge&amp;amp;logo=poe&amp;amp;logoColor=FFFFFF&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;Static Badge&#34;
	
	
&gt;
&lt;img src=&#34;https://img.shields.io/badge/windows%20terminal-4D4D4D?style=for-the-badge&amp;amp;logo=windows%20terminal&amp;amp;logoColor=white&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;img src=&#34;https://img.shields.io/badge/Microsoft_Edge-0078D7?style=for-the-badge&amp;amp;logo=Microsoft-edge&amp;amp;logoColor=white&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;img src=&#34;https://img.shields.io/badge/Notion-%23000000?style=for-the-badge&amp;amp;logo=notion&amp;amp;logoColor=FFFFFF&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;Static Badge&#34;
	
	
&gt;&lt;img src=&#34;https://img.shields.io/badge/powershell-5391FE?style=for-the-badge&amp;amp;logo=powershell&amp;amp;logoColor=white&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;img src=&#34;https://img.shields.io/badge/tmux-1BB91F?style=for-the-badge&amp;amp;logo=tmux&amp;amp;logoColor=white&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;img src=&#34;https://img.shields.io/badge/tampermonkey-%2300485B?style=for-the-badge&amp;amp;logo=tampermonkey&amp;amp;logoColor=FFFFFF&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;Static Badge&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://img.shields.io/badge/Windows-0078D6?style=for-the-badge&amp;amp;logo=windows&amp;amp;logoColor=white&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;img src=&#34;https://img.shields.io/badge/Ubuntu-E95420?style=for-the-badge&amp;amp;logo=ubuntu&amp;amp;logoColor=white&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;img src=&#34;https://img.shields.io/badge/Xiaomi-%23FF6900?style=for-the-badge&amp;amp;logo=Xiaomi&amp;amp;logoColor=%23FFFFFF&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;Static Badge&#34;
	
	
&gt;&lt;img src=&#34;https://img.shields.io/badge/lenovo-%23E2231A?style=for-the-badge&amp;amp;logo=lenovo&amp;amp;logoColor=%23FFFFFF&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;Static Badge&#34;
	
	
&gt;&lt;img src=&#34;https://img.shields.io/badge/logitech-%2300B8FC?style=for-the-badge&amp;amp;logo=logitech&amp;amp;logoColor=FFFFFF&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;Static Badge&#34;
	
	
&gt;&lt;img src=&#34;https://img.shields.io/badge/amd-%23ED1C24?style=for-the-badge&amp;amp;logo=amd&amp;amp;logoColor=FFFFFF&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;Static Badge&#34;
	
	
&gt;&lt;/p&gt;
</description>
        </item>
        
    </channel>
</rss>
